<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="pda" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <statements>
    
    <!--로그인-->
    <select id="SelectUser" resultClass="ModelsLibrary.Pda.PdaVo" parameterClass="ModelsLibrary.Pda.PdaVo">
      SELECT  
          USR_ID
        , USR_PWD
        , USR_N1ST_NM  AS USR_NM
      FROM TB_SYS_USR
        WHERE 1=1
          AND DELT_FLG = 'N'
          AND CHNL_CD = #CHNL_CD#
          AND USR_ID = #USR_ID#
    </select>
    
    <!--거래처-->
    <select id="SelectCoNm" resultClass="ModelsLibrary.Pda.PdaVo" parameterClass="ModelsLibrary.Pda.PdaVo">
      SELECT  
          T1.CO_NO AS CO_CD
        , T1.CO_NM 
      FROM TB_CD_CO AS T1, 
           TB_CD_CO_TP AS T2  
         WHERE 1=1  
          AND T1.CHNL_CD = T2.CHNL_CD 
          AND T1.CO_NO = T2.CO_NO
          AND T2.CO_TP_CD = #CO_TP_CD#
          AND T2.CHNL_CD  = #CHNL_CD#
    </select>
    
    <!--설비-->
    <select id="SelectEqNm" resultClass="ModelsLibrary.Pda.PdaVo" parameterClass="ModelsLibrary.Pda.PdaVo">
        SELECT PROD_EQ_NO AS EQ_NO
           , EQ_NM
        FROM TB_PROD_EQ T1
         WHERE 1 = 1
           AND CHNL_CD  = #CHNL_CD#
           AND EQ_TP_CD IN ('2', '3')  
    </select>

	<!--시스템 코드-->
	<select id="SelectSysCd" resultClass="ModelsLibrary.Pda.PdaVo" parameterClass="ModelsLibrary.Pda.PdaVo">
		SELECT CLSS_CD
		    , CLSS_DESC 
		FROM TB_SYS_CLSS_CD 
		    WHERE 1=1 
			    AND CHNL_CD     = #CHNL_CD#
			    AND CLSS_TP_CD  = #CLSS_TP_CD#
				AND DELT_FLG = 'N'
	</select>
    
    
    
      
    <!--원자재발주입고-->
    <select id="P01SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
        SELECT T1.PUR_ORD_NO      
           , T2.PUR_ORD_SEQ
           , CONVERT(VARCHAR(10), T1.PUR_DT, 23) AS PUR_DT
           , T1.PUR_CO_CD                                     AS CO_CD
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.PUR_CO_CD)  AS CO_NM      
           , T3.N1ST_ITM_GRP_CD
           , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
		   , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-001', T3.ITM_GRP_CLSS_CD) AS ITM_GRP_NM
           , T3.ITM_CD
           , T3.ITM_NM
           , T3.ITM_SZ_NM
           , T3.UOM_CD
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T3.UOM_CD) AS UOM_NM
           , T2.PUR_QTY
           , ISNULL(dbo.FF_ORD_CUST_LOT_SUM(T1.CHNL_CD, T2.PUR_ORD_NO, T2.PUR_ORD_SEQ), 0) AS IN_QTY
		   ,  CONVERT(VARCHAR(10), T2.IN_REQ_DT, 23) AS IN_REQ_DT
		   , T1.CHNL_CD
        FROM TB_PUR_ORD       T1
           , TB_PUR_ORD_DTL   T2
           , TB_CD_ITM        T3
       WHERE 1 = 1
         AND T1.CHNL_CD     = T2.CHNL_CD
         AND T1.PUR_ORD_NO  = T2.PUR_ORD_NO
         AND T2.ITM_CD      = T3.ITM_CD
         AND T1.CHNL_CD     = #CHNL_CD# 
         AND T1.PUR_CLZ_FLG = 'N'
		 AND T3.ACT_INSP_FLG = 'Y'
		 AND NOT EXISTS(SELECT 'X' FROM TB_INAUD_TMP X WHERE X.PUR_ORD_NO = T2.PUR_ORD_NO AND X.PUR_ORD_SEQ = T2.PUR_ORD_SEQ AND X.CHNL_CD = T2.CHNL_CD)
        <isNotNull property="CO_CD" >
         AND T1.PUR_CO_CD   = #CO_CD#
        </isNotNull>
		<isNotNull property="PUR_ORD_NO" >
			AND T1.PUR_ORD_NO   = #PUR_ORD_NO#
		</isNotNull>
		<isNotNull property="PUR_ORD_SEQ" >
			AND T2.PUR_ORD_SEQ   = #PUR_ORD_SEQ#
		</isNotNull>
      ORDER BY T2.UPD_DT DESC
    </select>

    <select id="P01SelectDtlList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
      SELECT 
           ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY CRE_DT DESC) AS RN 
         , PUR_ORD_NO
         , PUR_ORD_SEQ
         , MTRL_LOT_NO
         , ISNULL(ITM_QTY, 0) AS IN_QTY
         , CHNL_CD
         , PRNT_LOT_NO
         , CONVERT(VARCHAR, UPD_DT, 120) AS UPD_DT
		 , LOC_CD
		 , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'P-008', LOC_CD) AS LOC_NM
      FROM TB_PUR_ORD_CUST_LOT
       WHERE 1 = 1
         AND CHNL_CD      = #CHNL_CD#
         AND PUR_ORD_NO   = #PUR_ORD_NO# 
         AND PUR_ORD_SEQ  = #PUR_ORD_SEQ#
        <isNotNull property="PRNT_LOT_NO" >
         AND PRNT_LOT_NO  = #PRNT_LOT_NO#
        </isNotNull>
    </select>
      
    <insert id="P01InsertDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
      INSERT INTO TB_PUR_ORD_CUST_LOT 
      (
          CHNL_CD
        , MTRL_LOT_NO
        , PUR_ORD_NO
        , PUR_ORD_SEQ
        , PRNT_LOT_NO
        , ITM_QTY
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
		, LOC_CD
      ) 
      VALUES
      ( 
	     #CHNL_CD#
        , dbo.FF_FPRF_N1ST_STEP_LOTNO(#CHNL_CD#, GETDATE())
	    , #PUR_ORD_NO#
        , #PUR_ORD_SEQ#
        , #PRNT_LOT_NO#
        , #IN_QTY#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
		, #LOC_CD#
      )
    </insert>

    <update id="P01UpdateDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
     UPDATE TB_PUR_ORD_CUST_LOT
       SET ITM_QTY        = #IN_QTY#
      WHERE 1 = 1
       AND CHNL_CD        = #CHNL_CD#
       AND MTRL_LOT_NO    = #MTRL_LOT_NO#
    </update>
    
    <delete id="P01DeleteDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
      DELETE FROM TB_PUR_ORD_CUST_LOT
        WHERE 1 = 1
          AND CHNL_CD        = #CHNL_CD#
          AND MTRL_LOT_NO    = #MTRL_LOT_NO#
    </delete>

	  
	  <!--SCM 가입고-->
	<select id="P11SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
	    SELECT 
              T3.PUR_ORD_NO
            , T4.PUR_ORD_SEQ
            , CONVERT(VARCHAR(10), T3.PUR_DT, 23) AS PUR_DT
            , 'ANP'  AS PUR_CO_NM
            , T5.N1ST_ITM_GRP_CD
            , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T5.ITM_GRP_CLSS_CD, T5.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
            , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-001', T5.ITM_GRP_CLSS_CD) AS ITM_GRP_NM
            , T4.ITM_CD 
            , T5.ITM_NM
            , T5.ITM_SZ_NM
            , T5.UOM_CD
            , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T5.UOM_CD) AS UOM_NM
            , T4.PUR_QTY
            , ISNULL(dbo.FF_ORD_CUST_LOT_SUM(T1.CHNL_CD, T4.PUR_ORD_NO, T4.PUR_ORD_SEQ), 0) AS IN_QTY
            , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T3.PUR_CO_CD)  AS CO_NM 
            , CONVERT(VARCHAR(10), T4.IN_REQ_DT, 23)       AS IN_REQ_DT
             <!--
			    , CONVERT(VARCHAR(10), GETDATE(), 23)          AS IN_DT
                , CONVERT(VARCHAR(10), GETDATE() + 365, 23)    AS EXP_DT
                , T3.PUR_ORD_NO + '-' + dbo.F_RPAD(T4.PUR_ORD_SEQ, 3, '0')  AS GBN     
			-->
             , dbo.FF_ITM_ROUT_NM(T1.CHNL_CD, 'N', T4.ITM_CD) AS ROUT_NM
             , dbo.FF_ITM_ROUT_NM(T1.CHNL_CD, 'C', T4.ITM_CD) AS ROUT_CD     
             , T1.CHNL_CD
			 , T3.PUR_ORD_NO + '-' + dbo.F_RPAD(T4.PUR_ORD_SEQ, 3, '0') AS BAR_CD
          FROM TB_SCM_ORD_RLSE  T1
             , TB_SCM_PUR       T2 
             , TB_PUR_ORD        T3
             , TB_PUR_ORD_DTL    T4
             , TB_CD_ITM         T5
        WHERE 1 = 1 
          AND T1.CHNL_CD        = #CHNL_CD#
          AND T1.CHNL_CD        = T2.CHNL_CD
          AND T1.CHNL_CD        = T3.CHNL_CD
          AND T1.CHNL_CD        = T4.CHNL_CD
          AND T1.CHNL_CD        = T5.CHNL_CD  
          AND T1.SCM_RLSE_NO    = T2.SCM_RLSE_NO
          AND T3.PUR_ORD_NO     = T4.PUR_ORD_NO
          AND T2.SCM_PUR_NO     = T4.ORD_NO 
          AND T2.SCM_PUR_SEQ    = T4.ORD_SEQ
          AND T4.ITM_CD         = T5.ITM_CD
        AND NOT EXISTS(SELECT 'X' FROM TB_INAUD_TMP X WHERE X.PUR_ORD_NO = T4.PUR_ORD_NO AND X.PUR_ORD_SEQ = T4.PUR_ORD_SEQ AND X.CHNL_CD = T2.CHNL_CD)
          AND T3.PUR_CLZ_FLG   <![CDATA[<>]]> 'Y'
          AND T2.PUR_STS_CD    <![CDATA[<>]]> 'D'
        <!--AND T2.SCM_PUR_CO_CD  = 'SUJ01'-->
      <isNotNull property="GBN" >
          AND T3.PUR_ORD_NO + '-' + dbo.F_RPAD(T4.PUR_ORD_SEQ, 3, '0')  = #GBN#
       </isNotNull>
      UNION ALL
      SELECT T2.SCM_PUR_NO
           , T2.SCM_PUR_SEQ
           , CONVERT(VARCHAR(10), T2.PUR_CFM_DT, 23) AS PUR_DT
           , 'ANP'                  AS PUR_CO_NM 
           , T4.N1ST_ITM_GRP_CD
           , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T4.ITM_GRP_CLSS_CD, T4.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-001', T4.ITM_GRP_CLSS_CD) AS ITM_GRP_NM
           , T2.SCM_PUR_ITM_CD      AS ITM_CD 
           , T4.ITM_NM
           , T4.ITM_SZ_NM
           , T4.UOM_CD
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T4.UOM_CD) AS UOM_NM     
           , T5.SCM_RLSE_QTY
           , ISNULL(dbo.FF_ORD_CUST_LOT_SUM(T1.CHNL_CD, T2.SCM_PUR_NO, T2.SCM_PUR_SEQ), 0) AS IN_QTY
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.SCM_PUR_CO_CD)  AS CO_NM 
           , CONVERT(VARCHAR(10), T2.SCM_RLSE_ESTM_DT , 23)       AS IN_REQ_DT
           , dbo.FF_ITM_ROUT_NM(T1.CHNL_CD, 'N',  T2.SCM_PUR_ITM_CD) AS ROUT_NM          
           , T2.SCM_ROUT_CD
           , T1.CHNL_CD
		   , T6.SCM_GRP_BX_NO AS BAR_CD
        FROM TB_SCM_RLSE_ESTM  T1
           , TB_SCM_PUR        T2 
           , TB_SCM_ORD_RLSE   T3
           , TB_CD_ITM         T4
           , TB_SCM_RLSE       T5
           , TB_SCM_RLSE_DTL   T6
        WHERE 1 = 1
          AND T1.CHNL_CD        = #CHNL_CD# 
          AND T1.CHNL_CD        = T2.CHNL_CD   
          AND T1.CHNL_CD        = T3.CHNL_CD   
          AND T1.CHNL_CD        = T4.CHNL_CD   
          AND T1.CHNL_CD        = T5.CHNL_CD   
          AND T1.CHNL_CD        = T6.CHNL_CD       
           AND T1.SCM_RLSE_NO    = T3.SCM_RLSE_NO
          AND T1.SCM_PUR_NO     = T2.SCM_PUR_NO
          AND T1.SCM_PUR_SEQ    = T2.SCM_PUR_SEQ
          AND T2.SCM_RLSE_NO    = T3.SCM_RLSE_NO
          AND T2.SCM_PUR_ITM_CD = T4.ITM_CD
          AND T1.SCM_RLSE_NO    = T5.SCM_RLSE_NO
          AND T1.SCM_RLSE_SEQ   = T5.SCM_RLSE_SEQ
          AND T5.SCM_SPL_RLSE_NO  = T6.SCM_SPL_RLSE_NO   
	    <isNotNull property="GBN" >
		    AND T6.SCM_GRP_BX_NO    = #GBN#
	    </isNotNull>
      UNION ALL
      SELECT T2.SCM_PUR_NO
           , T2.SCM_PUR_SEQ
           , CONVERT(VARCHAR(10), T2.PUR_CFM_DT, 23) AS PUR_DT
           , 'ANP'                  AS PUR_CO_NM  
           , T4.N1ST_ITM_GRP_CD
           , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T4.ITM_GRP_CLSS_CD, T4.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-001', T4.ITM_GRP_CLSS_CD) AS ITM_GRP_NM
           , T2.SCM_PUR_ITM_CD      AS ITM_CD 
           , T4.ITM_NM
           , T4.ITM_SZ_NM
           , T4.UOM_CD
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T4.UOM_CD) AS UOM_NM     
           , T6.SCM_BX_QTY
           , ISNULL(dbo.FF_ORD_CUST_LOT_SUM(T1.CHNL_CD, T2.SCM_PUR_NO, T2.SCM_PUR_SEQ), 0) AS IN_QTY
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.SCM_PUR_CO_CD)  AS CO_NM 
           , CONVERT(VARCHAR(10), T2.SCM_RLSE_ESTM_DT , 23)       AS IN_REQ_DT
           , dbo.FF_ITM_ROUT_NM(T1.CHNL_CD, 'N',  T2.SCM_PUR_ITM_CD) AS ROUT_NM          
           , T2.SCM_ROUT_CD
           , T1.CHNL_CD
		   , T5.SCM_SPL_RLSE_NO  AS GBN
        FROM TB_SCM_RLSE_ESTM  T1
           , TB_SCM_PUR        T2 
           , TB_SCM_ORD_RLSE   T3
           , TB_CD_ITM         T4
           , TB_SCM_RLSE       T5
           , TB_SCM_RLSE_DTL   T6
        WHERE 1 = 1
          AND T1.CHNL_CD        = #CHNL_CD#
          AND T1.CHNL_CD        = T2.CHNL_CD   
          AND T1.CHNL_CD        = T3.CHNL_CD   
          AND T1.CHNL_CD        = T4.CHNL_CD   
          AND T1.CHNL_CD        = T5.CHNL_CD   
          AND T1.CHNL_CD        = T6.CHNL_CD       
           AND T1.SCM_RLSE_NO    = T3.SCM_RLSE_NO
          AND T1.SCM_PUR_NO     = T2.SCM_PUR_NO
          AND T1.SCM_PUR_SEQ    = T2.SCM_PUR_SEQ
          AND T2.SCM_RLSE_NO    = T3.SCM_RLSE_NO
          AND T2.SCM_PUR_ITM_CD = T4.ITM_CD
          AND T1.SCM_RLSE_NO    = T5.SCM_RLSE_NO
          AND T1.SCM_RLSE_SEQ   = T5.SCM_RLSE_SEQ
          AND T5.SCM_SPL_RLSE_NO   = T6.SCM_SPL_RLSE_NO   
		<isNotNull property="GBN" >
		    AND T5.SCM_SPL_RLSE_NO   = dbo.FN_splitValue(#GBN#, '-', 1) + '-' + dbo.FN_splitValue(#GBN#, '-', 2)
		    AND T5.SCM_SPL_RLSE_NO + '-' + dbo.F_RPAD(T6.SCM_BX_SEQ, 3, '0')    = #GBN#
	    </isNotNull>
	</select>
	  
  <select id="P11SelectDtlList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
      SELECT 
           ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY CRE_DT DESC) AS RN 
         , PUR_ORD_NO
         , PUR_ORD_SEQ
         , MTRL_LOT_NO
         , ISNULL(ITM_QTY, 0) AS IN_QTY
         , CHNL_CD
         , PRNT_LOT_NO
         , CONVERT(VARCHAR, UPD_DT, 120) AS UPD_DT
		 , LOC_CD
		 , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'P-008', LOC_CD) AS LOC_NM
      FROM TB_PUR_ORD_CUST_LOT
       WHERE 1 = 1
         AND CHNL_CD      = #CHNL_CD#
         AND PUR_ORD_NO   = #PUR_ORD_NO# 
         AND PUR_ORD_SEQ  = #PUR_ORD_SEQ#
        <isNotNull property="PRNT_LOT_NO" >
         AND PRNT_LOT_NO  = #PRNT_LOT_NO#
        </isNotNull>
    </select>
      
    <insert id="P11InsertDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
      INSERT INTO TB_PUR_ORD_CUST_LOT 
      (
          CHNL_CD
        , MTRL_LOT_NO
        , PUR_ORD_NO
        , PUR_ORD_SEQ
        , PRNT_LOT_NO
        , ITM_QTY
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
		, LOC_CD
      ) 
      VALUES
      ( 
	     #CHNL_CD#
        , dbo.FF_FPRF_N1ST_STEP_LOTNO(#CHNL_CD#, GETDATE())
	    , #PUR_ORD_NO#
        , #PUR_ORD_SEQ#
        , #PRNT_LOT_NO#
        , #IN_QTY#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
		, #LOC_CD#
      )
    </insert>

    <update id="P11UpdateDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
     UPDATE TB_PUR_ORD_CUST_LOT
       SET ITM_QTY        = #IN_QTY#
      WHERE 1 = 1
       AND CHNL_CD        = #CHNL_CD#
       AND MTRL_LOT_NO    = #MTRL_LOT_NO#
    </update>
    
    <delete id="P11DeleteDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
      DELETE FROM TB_PUR_ORD_CUST_LOT
        WHERE 1 = 1
          AND CHNL_CD        = #CHNL_CD#
          AND MTRL_LOT_NO    = #MTRL_LOT_NO#
    </delete>

	  
	  <!--정입고-->
    <select id="P10SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
	    SELECT 
                CO_NM
			  , CO_CD	
              , PUR_ORD_NO
              , PUR_ORD_SEQ
              , ITM_GRP_NM
              , ITM_CD
              , ITM_NM
              , ITM_SZ_NM
              , UOM_CD
              , UOM_NM
              , N1ST_ITM_GRP_CD
              , N1ST_ITM_GRP_NM
              , INAUD_DT
              , LOC_CD
              , N1ST_LOC_CD
              , N1ST_LOC_NM
              , PUR_QTY
              , IN_QTY
              , MTRL_LOT_NO
              , GBN
              , MTRL_EXP_DY
              , INSP_FLG
              , MTRL_MAKE_DT
         FROM
        (
              SELECT 
                      ROW_NUMBER() OVER(PARTITION BY NULL ORDER BY T2.UPD_DT) AS RN
                    , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.PUR_CO_CD) AS CO_NM
					, T1.PUR_CO_CD AS CO_CD
                    , T2.PUR_ORD_NO
                    , T2.PUR_ORD_SEQ
                    , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD, 'L-001', T3.ITM_GRP_CLSS_CD) AS ITM_GRP_NM
                    , T3.ITM_CD
                    , T3.ITM_NM
                    , T3.ITM_SZ_NM
                    , T3.UOM_CD
                    , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD, 'L-003', T3.UOM_CD) AS UOM_NM
                    , T3.N1ST_ITM_GRP_CD
                    , dbo.PUR_N1ST_GRP_NM_FNC(T3.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
                    , '' AS INAUD_DT
                    , '' AS LOC_CD
                    , '' AS N1ST_LOC_CD
                    , '' AS N1ST_LOC_NM
                    , T2.PUR_QTY
                    , T2.PUR_QTY AS IN_QTY
                    , '' AS MTRL_LOT_NO
                    , T3.ACT_INSP_FLG AS GBN
                    , '' AS MTRL_EXP_DY
                    , '' AS INSP_FLG
                    , '' AS MTRL_MAKE_DT
                FROM 
                     TB_PUR_ORD T1
                    ,TB_PUR_ORD_DTL T2 
                    ,TB_CD_ITM T3
               WHERE 1 = 1 
                 AND T1.CHNL_CD = T2.CHNL_CD
                 AND T1.CHNL_CD = T3.CHNL_CD
                 AND T2.CHNL_CD = T3.CHNL_CD
                 AND T1.CHNL_CD = #CHNL_CD#
                 AND T1.PUR_ORD_NO = T2.PUR_ORD_NO
                 AND T2.ITM_CD = T3.ITM_CD
                 AND T3.ACT_INSP_FLG = 'N'
				 AND NOT EXISTS (SELECT 'X' FROM TB_FPRF_N1ST_STEP_ROUT X WHERE 1 = 1 AND X.PRNT_LOT_NO =  (T2.PUR_ORD_NO + '_' + CONVERT(VARCHAR, (T2.PUR_ORD_SEQ))))
                <isNotNull property="CO_CD" >
					AND T1.PUR_CO_CD   = #CO_CD#
				</isNotNull>
                <isNotNull property="PUR_ORD_NO" >
					AND T2.PUR_ORD_NO   = #PUR_ORD_NO#
				</isNotNull>
                <isNotNull property="PUR_ORD_SEQ" >
					AND T2.PUR_ORD_SEQ   = #PUR_ORD_SEQ#
				</isNotNull>
        UNION ALL  
               SELECT 
                      ROW_NUMBER() OVER(PARTITION BY NULL ORDER BY T1.UPD_DT) AS RN  
                    , T1.CO_CD
                    , CASE WHEN T1.CO_CD IS NULL THEN (SELECT dbo.CD_COMPANY_NM_FNC(T4.CHNL_CD, T4.PUR_CO_CD) FROM TB_PUR_ORD T4 WHERE 1 =1 AND T1.PUR_ORD_NO = T4.PUR_ORD_NO AND T1.CHNL_CD = T4.CHNL_CD) 
                          ELSE dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD) END AS CO_NM
                    , T1.PUR_ORD_NO
                    , T1.PUR_ORD_SEQ
                    , dbo.CD_SYS_CLSS_FNC(T2.CHNL_CD, 'L-001', T2.ITM_GRP_CLSS_CD) AS ITM_GRP_NM
                    , T2.ITM_CD
                    , T2.ITM_NM
                    , T2.ITM_SZ_NM
                    , T2.UOM_CD
                    , dbo.CD_SYS_CLSS_FNC(T2.CHNL_CD, 'L-003', T2.UOM_CD) AS UOM_NM
                    , T2.N1ST_ITM_GRP_CD
                    , dbo.PUR_N1ST_GRP_NM_FNC(T2.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
                    , CONVERT(VARCHAR(10),T1.INAUD_DT,23) AS INAUD_DT
                    , T1.LOC_CD
                    , '' AS N1ST_LOC_CD
                    , '' AS N1ST_LOC_NM
				    , (SELECT X.PUR_QTY FROM TB_PUR_ORD_DTL X WHERE 1 = 1 AND X.CHNL_CD = T1.CHNL_CD AND X.PUR_ORD_NO = T1.PUR_ORD_NO AND X.PUR_ORD_SEQ = T1.PUR_ORD_SEQ) AS PUR_QTY 	
                    , ISNULL(T1.ITM_QTY,0) AS IN_QTY
                    , T1.LOT_NO AS MTRL_LOT_NO
                    , T2.ACT_INSP_FLG AS GBN
                    ,ISNULL (T1.MTRL_EXP_DY,0) AS MTRL_EXP_DY
                    , T1.INSP_FLG AS INSP_FLG
                    , CONVERT(VARCHAR(10),T1.MTRL_MAKE_DT,23) AS MTRL_MAKE_DT
                FROM TB_INAUD_TMP T1 
                    ,TB_CD_ITM T2
               WHERE 1 = 1 
                 AND T1.CHNL_CD = T2.CHNL_CD
                 AND T1.ITM_CD = T2.ITM_CD
                 AND T1.CHNL_CD = #CHNL_CD#
                 AND T2.ACT_INSP_FLG = 'Y'
                 AND T1.INSP_FLG = 'Y'
                 AND T1.OK_FLG = 'N'
                <isNotNull property="CO_CD" >
                    AND T1.CO_CD   = #CO_CD#
                </isNotNull>
                <isNotNull property="PUR_ORD_NO" >
                    AND T1.PUR_ORD_NO   = #PUR_ORD_NO#
                </isNotNull>
                <isNotNull property="PUR_ORD_SEQ" >
                    AND T1.PUR_ORD_SEQ   = #PUR_ORD_SEQ#
                </isNotNull>
        ) TT
	  </select>

	  
	  <insert id="P10InsertMst" parameterClass="ModelsLibrary.Pda.PdaVo">
       INSERT INTO TB_FPRF_N1ST_STEP_ROUT
       (
            CHNL_CD
          , MTRL_LOT_NO
          , ITM_CD
          , ITM_IN_DT
          , CO_CD
          , ITM_QTY
          , MTRL_MAKE_DT
          , MTRL_EXP_DY
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , PRNT_LOT_NO
          , CLZ_FLG
		  , LOC_CD
		  , N1ST_LOC_CD
        )
        SELECT
            #CHNL_CD#
          , dbo.FF_FPRF_N1ST_STEP_LOTNO(#CHNL_CD#, GETDATE()) 
          , #ITM_CD#
          , GETDATE()
          , #CO_CD#
          , #IN_QTY#
          , CONVERT(DATETIME, #MTRL_MAKE_DT#) 
          , #MTRL_EXP_DY#
          , #UPD_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          , #PRNT_LOT_NO#
          , 'N'
		  , #LOC_CD#
		  , #N1ST_LOC_CD#
    </insert>
	  
	  
	  <update id="P10UpdateMst" parameterClass="ModelsLibrary.Pda.PdaVo">
		  UPDATE TB_FPRF_N1ST_STEP_ROUT
		    SET 
			      ITM_QTY       = #IN_QTY#
		        , LOC_CD        = #LOC_CD#
		        , N1ST_LOC_CD   = #N1ST_LOC_CD#
				, MTRL_MAKE_DT  = #MTRL_MAKE_DT#
                , MTRL_EXP_DY   = #MTRL_EXP_DY#
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
		        AND MTRL_LOT_NO = #MTRL_LOT_NO#
	  </update>

	  <update id="P10UpdateDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
		  UPDATE TB_INAUD_TMP
		    SET OK_FLG = 'Y'
		  WHERE 1 = 1
		    AND CHNL_CD = #CHNL_CD#
		    AND LOT_NO  = #MTRL_LOT_NO#
	  </update>



	  <!--제품출하-->
    <select id="P02SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
        SELECT 
             T2.SL_RLSE_NO
           , T2.SL_RLSE_SEQ
           , CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 23) AS SL_RLSE_DT
           , T1.SL_CO_CD  AS CO_CD
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS CO_NM
           , T3.N1ST_ITM_GRP_CD
           , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
           , T2.SL_ITM_CD  AS ITM_CD
           , T3.ITM_NM    
           , T3.ITM_SZ_NM
           , T2.SL_ITM_QTY  AS IN_QTY
           , ISNULL(dbo.FF_SALE_RLSE_LOT_SUM(T1.CHNL_CD, T2.SL_RLSE_NO, T2.SL_RLSE_SEQ), 0) AS OUT_QTY
        FROM TB_SL_RLSE       T1
           , TB_SL_RLSE_DTL   T2
           , TB_CD_ITM        T3
       WHERE 1 = 1
         AND T1.CHNL_CD       = #CHNL_CD#
         AND T1.CHNL_CD       = T2.CHNL_CD
         AND T1.CHNL_CD       = T3.CHNL_CD
         AND T1.SL_RLSE_NO    = T2.SL_RLSE_NO   
         AND T2.SL_ITM_CD     = T3.ITM_CD  
        <isNotNull property="SL_RLSE_NO" >
         AND T2.SL_RLSE_NO LIKE #SL_RLSE_NO#
        </isNotNull>
         AND NOT EXISTS (SELECT 'X'
                           FROM TB_SL_RLSE_MAP X 
                          WHERE 1 = 1
                            AND T2.SL_RLSE_NO   = X.SL_RLSE_NO
                            AND T2.SL_RLSE_SEQ  = X.SL_RLSE_SEQ
                         )   
      ORDER BY T2.UPD_DT DESC
    </select>
    
    <select id="P02SelectDtlList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
       SELECT  
          ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY LOT_SEQ DESC) AS RN 
        , CHNL_CD
        , LOT_SEQ
        , PROD_LOT_NO
        , RLSE_LOT_NO
        , SL_RLSE_NO
        , SL_RLSE_SEQ 
        , ISNULL(ITM_QTY, 0) AS IN_QTY
        , CONVERT(VARCHAR, UPD_DT, 120) AS UPD_DT
        , (PROD_LOT_NO + '_' + RLSE_LOT_NO + '_' + CONVERT(VARCHAR, LOT_SEQ)) AS GBN
      FROM TB_SL_RLSE_LOT
       WHERE 1 = 1
         AND CHNL_CD      = #CHNL_CD#
         AND SL_RLSE_NO   = #SL_RLSE_NO# 
         AND SL_RLSE_SEQ  = #SL_RLSE_SEQ#
        <isNotNull property="PROD_LOT_NO" >
         AND PROD_LOT_NO  = #PROD_LOT_NO#
        </isNotNull>
        <isNotNull property="RLSE_LOT_NO" >
         AND RLSE_LOT_NO  = #RLSE_LOT_NO#
        </isNotNull>
    </select>
    
    <insert id="P02InsertDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
    INSERT INTO TB_SL_RLSE_LOT
    ( 
        CHNL_CD
      , PROD_LOT_NO
      , RLSE_LOT_NO
      , SL_RLSE_NO
      , SL_RLSE_SEQ
      , ITM_QTY
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
    ) VALUES (
	      #CHNL_CD#
      , #PROD_LOT_NO#
      , #RLSE_LOT_NO#
      , #SL_RLSE_NO#
      , #SL_RLSE_SEQ#
      , #IN_QTY#
      , #CRE_USR_ID#
      , GETDATE()
      , #UPD_USR_ID#
      , GETDATE()
    )
    </insert>
    
    <update id="P02UpdateDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
     UPDATE TB_SL_RLSE_LOT
       SET ITM_QTY        = #IN_QTY#
      WHERE 1 = 1
       AND CHNL_CD        = #CHNL_CD#
       AND LOT_SEQ        = #LOT_SEQ#
       AND PROD_LOT_NO    = #PROD_LOT_NO#
       AND RLSE_LOT_NO    = #RLSE_LOT_NO#
    </update>
    
    <delete id="P02DeleteDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
      DELETE FROM TB_SL_RLSE_LOT
        WHERE 1 = 1
          AND CHNL_CD        = #CHNL_CD#
          AND LOT_SEQ        = #LOT_SEQ#
          AND PROD_LOT_NO    = #PROD_LOT_NO#
          AND RLSE_LOT_NO    = #RLSE_LOT_NO#
    </delete>

    
    


    <!--원재료 LOT투입-->
    <select id="P03SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
       SELECT 
               MAX(CHNL_CD) AS CHNL_CD
             , MAX(N2ND_LOT_NO) AS N2ND_LOT_NO
             , MAX(RN) AS LOT_SEQ
             , GBN
             , PUR_ORD_NO 
          FROM 
          (
                SELECT  
                      X1.CHNL_CD
                    , X1.PROD_ORD_NO AS N2ND_LOT_NO
                    , (SELECT COUNT(*) FROM TB_PROD_N1ST_JOIN_ROUT F1 WHERE 1=1 AND F1.CHNL_CD = X1.CHNL_CD AND F1.N2ND_LOT_NO = X1.PROD_ORD_NO) AS RN
                    , (X1.PROD_ORD_NO  + ' / ' + dbo.PUR_N1ST_GRP_NM_FNC(X1.CHNL_CD, 'G', X3.N1ST_ITM_GRP_CD)) AS GBN
                    , ( SELECT  ISNULL(A, '') + ', ' + ISNULL(B, '') + ', ' + ISNULL(C, '') + ', ' + ISNULL(D, '') + ', ' + ISNULL(E, '')
                        FROM(    
                              SELECT N2ND_LOT_NO 
                                  , MAX(CASE WHEN RN = 1 THEN  N1ST_LOT_NO END) AS A
                                  , MAX(CASE WHEN RN = 2 THEN  N1ST_LOT_NO END) AS B
                                  , MAX(CASE WHEN RN = 3 THEN  N1ST_LOT_NO END) AS C
                                  , MAX(CASE WHEN RN = 4 THEN  N1ST_LOT_NO END) AS D
                                  , MAX(CASE WHEN RN = 4 THEN  N1ST_LOT_NO END) AS E
                              FROM (
                                    SELECT  
                                          ROW_NUMBER() OVER (PARTITION BY F1.N2ND_LOT_NO ORDER BY F1.CRE_DT DESC) AS RN  
                                        , F1.N1ST_LOT_NO
                                        , F1.N2ND_LOT_NO
                                    FROM TB_PROD_N1ST_JOIN_ROUT F1
                                      WHERE 1=1
                                        AND F1.CHNL_CD     = X1.CHNL_CD
                                        AND F1.N2ND_LOT_NO = X1.PROD_ORD_NO
                                    ) AS Z1
                            GROUP BY N2ND_LOT_NO 
                   ) AS T1 ) AS PUR_ORD_NO
                     FROM TB_FPRF_N2ND_STEP_ROUT  X1
                        , TB_PROD_ROUT_ITM_MAP    X2  
                        , TB_CD_ITM               X3
                    WHERE 1 = 1
                      AND X1.CHNL_CD      = #CHNL_CD#
                      AND X1.CHNL_CD      = X2.CHNL_CD
                      AND X1.CHNL_CD      = X3.CHNL_CD
                      AND X1.ROUT_ITM_CD  = X2.ROUT_ITM_CD
                      AND X1.ROUT_ITM_CD  = X3.ITM_CD
                  <isNotNull property="N2ND_LOT_NO" >
                    AND X1.PROD_ORD_NO  = #N2ND_LOT_NO#
                  </isNotNull>
           ) AS T1           
           WHERE 1=1 
              AND N2ND_LOT_NO IS NOT NULL
              AND N2ND_LOT_NO != ''
           GROUP BY GBN, PUR_ORD_NO
           ORDER BY LOT_SEQ DESC
    </select>
      
    <select id="P03SelectDtlList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
      SELECT  
          T1.CHNL_CD
        , ROW_NUMBER() OVER (PARTITION BY T1.N2ND_LOT_NO ORDER BY T1.CRE_DT DESC) AS RN  
        , T1.N1ST_LOT_NO
        , T1.N2ND_LOT_NO
        , T1.UPD_USR_ID AS USR_ID
        , CONVERT(VARCHAR, T1.UPD_DT, 120) AS CRE_DT
        , (SELECT MAX(dbo.PUR_N1ST_GRP_NM_FNC(X1.CHNL_CD, 'G', X3.N1ST_ITM_GRP_CD)) AS GBN
           FROM TB_FPRF_N2ND_STEP_ROUT  X1
              , TB_PROD_ROUT_ITM_MAP    X2  
              , TB_CD_ITM               X3
          WHERE 1 = 1
            AND X1.CHNL_CD      = T1.CHNL_CD
            AND X1.CHNL_CD      = X2.CHNL_CD
            AND X1.CHNL_CD      = X3.CHNL_CD
            AND X1.ROUT_ITM_CD  = X2.ROUT_ITM_CD
            AND X1.ROUT_ITM_CD  = X3.ITM_CD
            AND X1.PROD_ORD_NO  = T1.N2ND_LOT_NO) AS GBN
        , (T1.N1ST_LOT_NO + '_' + T1.N2ND_LOT_NO) AS CO_TP_CD    
      FROM TB_PROD_N1ST_JOIN_ROUT T1
        WHERE 1=1
          AND T1.CHNL_CD     = #CHNL_CD#
          AND T1.N2ND_LOT_NO = #N2ND_LOT_NO#
        <isNotNull property="N1ST_LOT_NO" >
          AND T1.N1ST_LOT_NO = #N1ST_LOT_NO#
        </isNotNull>
    </select>
    
     <insert id="P03InsertDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
      INSERT INTO TB_PROD_N1ST_JOIN_ROUT
      ( 
           CHNL_CD
         , N1ST_LOT_NO
         , N2ND_LOT_NO
         , CRE_USR_ID
         , CRE_DT
         , UPD_USR_ID
         , UPD_DT
       ) VALUES (
           #CHNL_CD#
         , #N1ST_LOT_NO#
         , #N2ND_LOT_NO#
         , #CRE_USR_ID#
         , GETDATE()
         , #UPD_USR_ID#
         , GETDATE() 
       )
    </insert>
    
    <!--
    <update id="P03UpdateDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
     UPDATE TB_SL_RLSE_LOT
       SET ITM_QTY        = #IN_QTY#
      WHERE 1 = 1
       AND CHNL_CD        = #CHNL_CD#
       AND LOT_SEQ        = #LOT_SEQ#
       AND PROD_LOT_NO    = #PROD_LOT_NO#
       AND RLSE_LOT_NO    = #RLSE_LOT_NO#
    </update>
    -->
    
    <delete id="P03DeleteDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
      DELETE FROM TB_PROD_N1ST_JOIN_ROUT
        WHERE 1 = 1
          AND CHNL_CD        = #CHNL_CD#
          AND N1ST_LOT_NO    = #N1ST_LOT_NO#
          AND N2ND_LOT_NO    = #N2ND_LOT_NO#
    </delete>
      
      
    <statement id="ProcP03" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_ProductN1stJoinRout #CHNL_CD#, #RLSE_LOT_NO#, #PROD_LOT_NO#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>


    
    
    
  
    
    <!--금형생산 입/출고-->
    <select id="P04SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
      <!--
      SELECT EQ_NO 
           , dbo.FF_EQ_NM_FNC(#CHNL_CD#, EQ_NO)  AS EQ_NM
           , MOLD_NO 
           , CASE WHEN MOLD_NO IS NULL THEN '입고' ELSE '출고' END AS MOLD_DESC
           , dbo.FF_ITM_LOC_NM(CHNL_CD, '001', MOLD_NO)   AS MOLD_LOC_NM     
        FROM TB_PDA_MOLD_EQ_MAP
       WHERE 1 = 1
         AND CHNL_CD = #CHNL_CD#
         -->
          SELECT  
             CASE WHEN T2.MOLD_NO IS NULL THEN '입고' ELSE '출고' END AS MOLD_DESC 
           , T2.EQ_NO 
           , dbo.FF_EQ_NM_FNC(T1.CHNL_CD, T2.EQ_NO)  AS EQ_NM
           , T1.MOLD_NO
		   , T1.MOLD_NM
           , T1.MOLD_SZ
           , dbo.FF_ITM_LOC_NM(T1.CHNL_CD, '001', T1.MOLD_NO)   AS MOLD_LOC_NM     
           , ( T2.EQ_NO  + '_' + T1.MOLD_NO ) AS ITM_NM
          FROM  TB_PROD_MOLD_CD T1  LEFT OUTER JOIN  TB_PDA_MOLD_EQ_MAP T2  ON(T1.CHNL_CD = T2.CHNL_CD AND T1.MOLD_NO = T2.MOLD_NO)
           WHERE 1 = 1
            AND T1.CHNL_CD = #CHNL_CD#
        <isNotNull property="MOLD_NO" >
          AND T1.MOLD_NO  = #MOLD_NO#
        </isNotNull>
      <isNotNull property="GBN" >
        <isEqual property="GBN" compareValue="O">
          <!-- O : 금형출고 가능한것 (설비장착을목적으로)-->
          AND T2.MOLD_NO IS NULL
        </isEqual>
        <isEqual property="GBN" compareValue="I">
          <!--I : 금형입고  가능한것 (설비 탈착 )-->
          AND T2.MOLD_NO IS NOT  NULL
        </isEqual>
      </isNotNull>
    </select>

     <select id="P04SelectDtlList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
         SELECT 
               RN 
             , EQ_NO
             , dbo.FF_EQ_NM_FNC(CHNL_CD, EQ_NO)  AS EQ_NM
             , MOLD_NO
			 , (SELECT TOP 1 MOLD_NM FROM TB_PROD_MOLD_CD AS X WHERE 1=1 AND X.CHNL_CD = T1.CHNL_CD AND X.MOLD_NO = T1.MOLD_NO) AS MOLD_NM
             , IO_CD
             , IO_NM
             , CRE_DT
             , CHNL_CD
          FROM (
              SELECT ROW_NUMBER() OVER (PARTITION BY MOLD_NO ORDER BY CRE_DT DESC) AS RN 
                   , EQ_NO
                   , IO_CD
                   , CASE WHEN IO_CD = 'I' THEN '입고' ELSE '출고' END AS IO_NM
                   , CONVERT(VARCHAR, CRE_DT, 120) AS CRE_DT
                   , MOLD_NO
                   , CHNL_CD
                FROM TB_PDA_MOLD_INAUD
                 WHERE 1 = 1         
                   AND CHNL_CD = #CHNL_CD#
                   AND MOLD_NO = #MOLD_NO#
               ) T1       
        WHERE 1 = 1
          AND RN <![CDATA[<=]]> 20
    </select>
    
  <insert id="P04InsertDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
    INSERT INTO TB_PDA_MOLD_INAUD
    (
        CHNL_CD
      , INAUD_NO
      , MOLD_NO
      , EQ_NO
      , IO_CD
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT   
    ) 
    VALUES
    (
        #CHNL_CD#
      , FORMAT(GETDATE(),'yyyyMMddHHmmssffff')
      , #MOLD_NO#
      , #EQ_NO#
      , #IO_CD#
      , #CRE_USR_ID#
      , GETDATE()
      , #UPD_USR_ID#
      , GETDATE()
    ) 
    </insert>
    
    <update id="P04UpdateDtl" parameterClass="ModelsLibrary.Pda.PdaVo">
    UPDATE TB_PDA_MOLD_EQ_MAP
       SET MOLD_NO = #MOLD_NO# 
     WHERE 1 = 1
       AND CHNL_CD = #CHNL_CD#
       AND EQ_NO   = #EQ_NO#
    </update>

	  
	<!--외주 출고-->
    <select id="P40SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
            SELECT  CONVERT(VARCHAR, T1.INAUD_DT, 120) AS INAUD_DT 
                 , T1.INSRL_NO   AS SL_RLSE_NO    
                 , '외주입고'   AS ROUT_NM  
                 , T1.CO_CD        
                 , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD)  AS CO_NM 
                 , T6.SCM_RLSE_NO   AS PUR_ORD_NO
                 , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T7.ITM_CD)  AS ITM_NM 
                 , T2.ITM_CD  AS CMPO_NO   
                 , T8.ITM_NM  AS CMPO_NM   
                 , T8.ITM_SZ_NM            
				 , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T8.UOM_CD) AS UOM_NM   
                 , T2.INAUD_QTY      AS PUR_QTY      
				 , 0 AS IN_QTY
              FROM TB_INAUD_MAST T1
                 , TB_INAUD_DTL  T2 
                 , TB_INAUD_TMP  T3
                 , TB_SCM_RLSE   T4
                 , TB_SCM_RLSE_ESTM  T5
                 , TB_SCM_PUR        T6
                 , TB_SCM_ORD_RLSE   T7
                 , TB_CD_ITM         T8
				 , TB_SCM_RLSE_DTL   T9
             WHERE 1 = 1
               AND T1.CHNL_CD     = #CHNL_CD#
               AND T1.CHNL_CD     = T2.CHNL_CD
               AND T1.CHNL_CD     = T3.CHNL_CD
               AND T1.CHNL_CD     = T4.CHNL_CD
               AND T1.CHNL_CD     = T5.CHNL_CD
               AND T1.CHNL_CD     = T6.CHNL_CD
               AND T1.CHNL_CD     = T7.CHNL_CD
               AND T1.CHNL_CD     = T8.CHNL_CD
               AND T1.INSRL_NO    = T1.INSRL_NO
               AND T1.IO_CD       = 'I'    
               AND T2.INAUD_CD    = 'RGH'  
               AND T2.ORD_NO      = T3.INAUD_TMP_NO
               AND T2.ORD_SEQ     = T3.INAUD_TMP_SEQ
               AND T3.PUR_ORD_NO  = T4.SCM_SPL_RLSE_NO
               AND T4.SCM_RLSE_NO = T5.SCM_RLSE_NO
               AND T4.SCM_RLSE_SEQ = T5.SCM_RLSE_SEQ
               AND T5.SCM_PUR_NO    = T6.SCM_PUR_NO
               AND T5.SCM_PUR_SEQ   = T6.SCM_PUR_SEQ
               AND T6.SCM_RLSE_NO = T7.SCM_RLSE_NO
			   AND T4.SCM_SPL_RLSE_NO = T9.SCM_SPL_RLSE_NO 
			   AND T2.INSRL_NO = T8.ITM_CD
			<isNotNull property="GBN" >
                AND T9.SCM_GRP_BX_NO    = #GBN#
	        </isNotNull>
               <!--AND T4.SCM_SPL_RLSE_NO   = dbo.FN_splitValue(@barNo, '-', 1) + '-' + dbo.FN_splitValue(@barNo, '-', 2)  AND T5.SCM_SPL_RLSE_NO + '-' + dbo.F_RPAD(T6.SCM_BX_SEQ, 3, '0')    = @barNo   개별--> 
               AND NOT EXISTS ( SELECT 'X'
                                  FROM TB_INAUD_DTL X
                                 WHERE 1 = 1
                                   AND T1.CHNL_CD   = X.CHNL_CD
                                   AND T2.INSRL_NO  = X.ORD_NO 
                                   AND T2.INSRL_SEQ = X.INSRL_SEQ
                                   AND X.INAUD_CD   = 'IGH'  
                               )  
    </select>



	<!--외주 입고-->
	<select id="P50SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
        SELECT   T1.SCM_PUR_NO       AS SCM_PUR_NO 
               , T1.SCM_PUR_SEQ      AS SCM_PUR_SEQ
               , T1.SCM_ROUT_CD      AS ROUT_CD
			   , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.SCM_ROUT_CD) AS ROUT_NM
               , T1.SCM_PUR_CO_CD    AS CO_CD 
			   , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD,T1.SCM_PUR_CO_CD)  AS CO_NM 
               , CONVERT(VARCHAR, T2.SCM_RLSE_DT, 120) AS SCM_RLSE_DT 
               , T1.SCM_PUR_ITM_CD   AS ITM_CD 
               , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.SCM_PUR_ITM_CD) AS ITM_NM 
			   , dbo.CD_ITEM_UOM_FNC(T1.CHNL_CD, T1.SCM_PUR_ITM_CD) AS UOM_CD 
               , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', dbo.CD_ITEM_UOM_FNC(#CHNL_CD#, T1.SCM_PUR_ITM_CD)) AS UOM_NM
               , T2.SCM_RLSE_QTY    AS PUR_QTY 
               , T1.SCM_RLSE_NO     AS SCM_RLSE_NO 
               , T3.SCM_GRP_BX_NO   AS SCM_GRP_BX_NO 
               , T3.SCM_BX_SEQ      AS SCM_BX_SEQ   
               , T3.SCM_BX_QTY      AS IN_QTY   
			   , T1.CHNL_CD 
			   , T3.SCM_SPL_RLSE_NO + '-' + RIGHT('000' + CONVERT(VARCHAR, T3.SCM_BX_SEQ),3) AS SCM_SER_BX_NO
			   , 'RGH' AS GBN
			   , #USR_ID# AS USR_ID
			   , T2.SCM_SPL_RLSE_NO AS CONN_NO
               , T2.SCM_RLSE_NO     AS PUR_ORD_NO
               , T2.SCM_RLSE_SEQ    AS PUR_ORD_SEQ
          FROM TB_SCM_PUR T1
              ,TB_SCM_RLSE T2 
              ,TB_SCM_RLSE_DTL T3 
              ,TB_SCM_RLSE_ESTM T4
         WHERE 1 = 1 
           AND T1.CHNL_CD           = T2.CHNL_CD
           AND T1.CHNL_CD           = T3.CHNL_CD 
           AND T1.CHNL_CD           = T4.CHNL_CD
           AND T1.CHNL_CD           = #CHNL_CD#
           AND T1.SCM_PUR_NO        = T4.SCM_PUR_NO
           AND T1.SCM_PUR_SEQ       = T4.SCM_PUR_SEQ
           AND T4.SCM_RLSE_NO       = T2.SCM_RLSE_NO
           AND T4.SCM_RLSE_SEQ      = T2.SCM_RLSE_SEQ
           AND T2.SCM_SPL_RLSE_NO   = T3.SCM_SPL_RLSE_NO 
           AND T3.SCM_GRP_BX_NO     = #SCM_GRP_BX_NO#
		   AND NOT EXISTS (SELECT 'X' FROM TB_INAUD_HIS X WHERE 1 = 1 AND X.ORD_NO = T2.SCM_RLSE_NO AND X.ORD_SEQ = T2.SCM_RLSE_SEQ)
	</select>

	  <select id="SelectTmpInsrlNo" resultClass="string">
		  SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'ST', '001') FROM cpy_t WHERE NO = 1
	  </select>

	  <update id="UpdateTmpInsrlNo" parameterClass="ModelsLibrary.Pda.PdaVo">
		  UPDATE TB_SYS_NO_FMT
		    SET LST_FMT_NO  = #LST_FMT_NO#
		  WHERE TBL_ID    = 'ST'
		    AND AREA_CD   =  '001'
		    AND DELT_FLG  = 'N'
		    AND CHNL_CD   =  #CHNL_CD#
	  </update>
	  
    <insert id="P50InsertMst" parameterClass="ModelsLibrary.Pda.PdaVo">
		<!--INSERT INTO TB_INAUD_HIS
		(
		      CHNL_CD
		    , AREA_CD
		    , INAUD_DT
		    , INAUD_TP_CD
		    , IO_CD
		    , FM_LOC_CD
		    , TO_LOC_CD
		    , CO_CD
		    , ITM_CD
		    , ITM_QTY
		    , ITM_PRC
		    , ORD_NO
		    , ORD_SEQ
		    , DELT_FLG
		    , CRE_USR_ID
		    , CRE_DT
		    , CONN_NO
		    , CONN_SEQ
			, ROUT_CD
		)
		VALUES
		(
		      #CHNL_CD#
		    , (SELECT TOP 1 X.EMPE_PLC_NM FROM TB_SYS_USR AS X WHERE 1=1 AND CHNL_CD = #CHNL_CD# AND USR_ID = #USR_ID# )
		    , GETDATE()
		    , #GBN#
		    , 'I'
		    , '300'
		    , '500'
		    , #CO_CD#
		    , #ITM_CD#
		    , #IN_QTY#
		    , 0
		    , #PUR_ORD_NO#
		    , #PUR_ORD_SEQ#
		    , 'N'
		    , #USR_ID#
		    , GETDATE()
		    , #CONN_NO#
		    , #CONN_SEQ#
			, #ROUT_CD#
		)-->
	INSERT INTO TB_INAUD_TMP 
	(
          CHNL_CD 
        , INAUD_TMP_NO
        , INAUD_TMP_SEQ
        , PUR_ORD_NO
        , PUR_ORD_SEQ
        , CO_CD
        , LOC_CD
        , ITM_CD
        , ITM_QTY
        , CRE_USR_ID
        , CRE_DT
        , OK_FLG
        , INSP_FLG
        , AREA_CD
        , UPD_USR_ID
        , UPD_DT
        , INAUD_DT
        , UOM_CD
        , GRP_SER_NO
        , STK_SER_NO
        , ROUT_CD
		, LOT_NO
    )
      SELECT  #CHNL_CD#
             ,#LST_FMT_NO#
             ,(SELECT ISNULL(MAX(INAUD_TMP_SEQ), 0) + 1 FROM TB_INAUD_TMP WHERE CHNL_CD = #CHNL_CD# AND INAUD_TMP_NO = #LST_FMT_NO#)
             ,T1.SCM_PUR_NO
             ,T1.SCM_PUR_SEQ
             ,T1.SCM_PUR_CO_CD
             ,'100'
             ,T1.SCM_PUR_ITM_CD
             ,T3.SCM_BX_QTY
             ,'ANP01'
             ,GETDATE()
             ,'N'
             ,'N'
             ,'001'
             ,T2.CRE_USR_ID
             ,GETDATE()
             ,GETDATE()
             ,T5.UOM_CD
             ,T3.SCM_GRP_BX_NO
             ,T3.SCM_SPL_RLSE_NO + '-' + RIGHT('000' + CONVERT(VARCHAR, T3.SCM_BX_SEQ),3)
             ,T1.SCM_ROUT_CD
			 ,T3.SCM_GRP_BX_NO AS LOT_NO
         FROM TB_SCM_PUR T1
             ,TB_SCM_RLSE T2 
             ,TB_SCM_RLSE_DTL T3 
             ,TB_SCM_RLSE_ESTM T4
             ,TB_CD_ITM T5
        WHERE 1 = 1 
          AND T1.CHNL_CD           = T2.CHNL_CD
          AND T1.CHNL_CD           = T3.CHNL_CD 
          AND T1.CHNL_CD           = T4.CHNL_CD
          AND T1.CHNL_CD           = T5.CHNL_CD 
          AND T1.CHNL_CD           = #CHNL_CD#
          AND T1.SCM_PUR_NO        = T4.SCM_PUR_NO
          AND T1.SCM_PUR_SEQ       = T4.SCM_PUR_SEQ
          AND T1.SCM_PUR_ITM_CD    = T5.ITM_CD
          AND T4.SCM_RLSE_NO       = T2.SCM_RLSE_NO
          AND T4.SCM_RLSE_SEQ      = T2.SCM_RLSE_SEQ
          AND T2.SCM_SPL_RLSE_NO   = T3.SCM_SPL_RLSE_NO 
          AND T1.SCM_PUR_CO_CD NOT IN ('ANP01')
		  AND T3.SCM_SPL_RLSE_NO + '-' + RIGHT('000' + CONVERT(VARCHAR, T3.SCM_BX_SEQ),3) = #SCM_SER_BX_NO#
	</insert>
	  
	  
	<!--외주 출고-->
	<select id="P51SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
		 SELECT 
		     T1.ORD_NO AS PUR_ORD_NO
           , T1.ORD_SEQ AS PUR_ORD_SEQ
           , CONVERT(VARCHAR,T1.CRE_DT,120) AS CRE_DT
           , T1.ITM_CD AS ITM_CD
           , T3.ITM_NM AS ITM_NM
           <!--, T1.INAUD_QTY AS IN_QTY-->
		   , T2.ITM_QTY AS IN_QTY
           , T1.ROUT_CD AS ROUT_CD
           , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD) AS ROUT_NM
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_NO) AS CO_NM
           , T1.CO_NO AS CO_CD
           <!--, T1.INAUD_CD AS GBN-->
           , dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'R', T1.SL_ORD_NO, T1.ITM_CD) AS NXT_ROUT_CD
           , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'R', T1.SL_ORD_NO, T1.ITM_CD)) AS NXT_ROUT_NM
           , dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'C',T1.SL_ORD_NO, T1.ITM_CD) AS NXT_CO_CD
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'C',T1.SL_ORD_NO, T1.ITM_CD)) AS NXT_CO_NM
		   , T2.GRP_SER_NO AS SCM_GRP_BX_NO
		   , T2.STK_SER_NO AS SCM_SER_BX_NO
		   , 'IGH' AS GBN
		   , #USR_ID# AS USR_ID
		   , T1.CHNL_CD
       FROM TB_INAUD_DTL T1
          , TB_CD_STK_SER T2 
          , TB_CD_ITM T3
      WHERE 1 = 1 
        AND T1.CHNL_CD = T2.CHNL_CD
        AND T1.CHNL_CD = T3.CHNL_CD
        AND T1.ITM_CD = T3.ITM_CD
        AND T1.CHNL_CD = #CHNL_CD#
        AND T1.ORD_NO = T2.PUR_ORD_NO 
        AND T1.INAUD_CD IN ('RGP')
		AND T2.GRP_SER_NO = #SCM_GRP_BX_NO#
		AND NOT EXISTS (SELECT 'X' FROM TB_INAUD_HIS X WHERE 1 = 1 AND X.ORD_NO = T1.ORD_NO AND X.ORD_SEQ = T1.ORD_SEQ)
      UNION
      SELECT T1.ORD_NO AS PUR_ORD_NO
           , T1.ORD_SEQ AS PUR_ORD_SEQ
           , CONVERT(VARCHAR,T1.CRE_DT,120) AS CRE_DT
           , T1.ITM_CD AS ITM_CD
           , T3.ITM_NM AS ITM_NM
           , T1.INAUD_QTY AS IN_QTY
           , T1.ROUT_CD AS ROUT_CD
           , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD) AS ROUT_NM
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_NO) AS CO_NM
           , T1.CO_NO AS CO_CD
           <!--, T1.INAUD_CD AS GBN-->
           , dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'R', T1.SL_ORD_NO, T1.ITM_CD) AS NXT_ROUT_CD
           , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'R', T1.SL_ORD_NO, T1.ITM_CD)) AS NXT_ROUT_NM
           , dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'C',T1.SL_ORD_NO, T1.ITM_CD) AS NXT_CO_CD
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, dbo.FF_SCM_NXT_INFO(T1.CHNL_CD, 'C',T1.SL_ORD_NO, T1.ITM_CD)) AS NXT_CO_NM
		   , T2.SCM_GRP_BX_NO
		   , T2.SCM_SPL_RLSE_NO + '-' + RIGHT('000' + CONVERT(VARCHAR, T2.SCM_BX_SEQ),3) AS SCM_SER_BX_NO
		   , 'IGH' AS GBN
		   , #USR_ID# AS USR_ID
		   , T1.CHNL_CD
        FROM TB_INAUD_DTL T1
           , TB_SCM_RLSE_DTL T2
           , TB_CD_ITM T3
       WHERE 1 = 1
         AND T1.CHNL_CD = T2.CHNL_CD 
         AND T1.CHNL_CD = T3.CHNL_CD
         AND T1.CHNL_CD = #CHNL_CD#
         AND T1.ITM_CD = T3.ITM_CD
         AND T1.ORD_NO = T2.SCM_SPL_RLSE_NO
         AND T2.SCM_SPL_RLSE_NO = T1.ORD_NO
         AND T1.INAUD_CD IN ('RGH')
		 AND T2.SCM_GRP_BX_NO = #SCM_GRP_BX_NO#
		 AND NOT EXISTS (SELECT 'X' FROM TB_INAUD_HIS X WHERE 1 = 1 AND X.ORD_NO = T1.ORD_NO AND X.ORD_SEQ = T1.ORD_SEQ)
		 
	</select>
	
	<insert id="P51InsertMst" parameterClass="ModelsLibrary.Pda.PdaVo">
		INSERT INTO TB_INAUD_HIS
		(
		      CHNL_CD
		    , AREA_CD
		    , INAUD_DT
		    , INAUD_TP_CD
		    , IO_CD
		    , FM_LOC_CD
		    , TO_LOC_CD
		    , CO_CD
		    , ITM_CD
		    , ITM_QTY
		    , ITM_PRC
		    , ORD_NO
		    , ORD_SEQ
		    , DELT_FLG
		    , CRE_USR_ID
		    , CRE_DT
		    , CONN_NO
		    , CONN_SEQ
			, ROUT_CD
		)
		VALUES
		(
		      #CHNL_CD#
		    , (SELECT TOP 1 X.EMPE_PLC_NM FROM TB_SYS_USR AS X WHERE 1=1 AND CHNL_CD = #CHNL_CD# AND USR_ID = #USR_ID# )
		    , GETDATE()
		    , 'IGH'
		    , 'O'
		    , '300'
		    , '500'
		    , #NXT_CO_CD#
		    , #ITM_CD#
		    , #IN_QTY#
		    , 0
		    , #PUR_ORD_NO#
		    , #PUR_ORD_SEQ#
		    , 'N'
		    , #USR_ID#
		    , GETDATE()
		    , #CONN_NO#
		    , #CONN_SEQ#
			, #ROUT_CD#
		)
	</insert>
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
    <!--인원 현황--><!--
    <select id="P10SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
        SELECT  
            ISNULL(dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-051', T1.EMP_LOC_CD), '기타') AS GBN
          , T1.EMP_LOC_CD
          , MAX(T1.CHNL_CD) AS CHNL_CD
          , COUNT(*) AS RN
          , MAX(#FM_DT#) AS FM_DT 
          , MAX(#TO_DT#) AS TO_DT
        FROM TB_SYS_USR AS T1 LEFT OUTER JOIN  TB_SYS_WRK_RPT  AS T2  ON( 
                                                                            T1.CHNL_CD = T2.CHNL_CD 
                                                                        AND T1.USR_ID = T2.EMPE_ID 
                                                                        AND CONVERT(DATE, T2.WRK_DT) >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
                                                                        AND CONVERT(DATE, T2.WRK_DT) <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME) )
        WHERE 1=1
          AND T1.CHNL_CD    = #CHNL_CD#
          AND T1.TM_PAY_FLG = 'Y'
          AND T2.WRK_DT IS NOT NULL
        GROUP BY dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-051', T1.EMP_LOC_CD), T1.EMP_LOC_CD
    </select>

    
    <select id="P10SelectDtlList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
       SELECT  
             ISNULL(dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-051', T1.EMP_LOC_CD), '기타') AS EMP_LOC_NM
           , T1.EMP_LOC_CD
           , T1.USR_ID
           , T1.USR_N1ST_NM
           , T1.GRP_ID
           , ISNULL((SELECT GRP_NM FROM TB_SYS_GRP AS A WHERE 1=1 AND A.CHNL_CD = T1.CHNL_CD AND A.GRP_ID = T1.GRP_ID), '')  AS GRP_NM
           , T1.CELL_PHN_NO AS PHN_NO
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'G-001', OFC_PSN_CD) AS OFC_PSN_NM
           , T1.USR_IMG
        FROM TB_SYS_USR AS T1 LEFT OUTER JOIN  TB_SYS_WRK_RPT  AS T2  ON(  
                                                                              T1.CHNL_CD  = T2.CHNL_CD 
                                                                          AND T1.USR_ID   = T2.EMPE_ID 
                                                                          AND CONVERT(DATE, T2.WRK_DT) >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
                                                                          AND CONVERT(DATE, T2.WRK_DT) <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME) 
                                                                        )
        WHERE 1=1
          AND T1.CHNL_CD        = #CHNL_CD#
          AND T1.TM_PAY_FLG     = 'Y'
          AND T2.WRK_DT IS NOT NULL
          AND T1.EMP_LOC_CD     = #EMP_LOC_CD#
    </select>
    
     --><!--월-경영정보--><!--
      <select id="P11SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
         SELECT '영업' AS GBN
             , CAR_TP_NM
             , SL_ITM_AMT
             , NULL AS N3RD_ROUT_QTY
             , NULL AS N4TH_ROUT_QTY
         FROM(
            SELECT T1.ITM_CD AS 품번      
                 , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, 'G', T2.N1ST_ITM_GRP_CD) AS CAR_TP_NM 
                 , SUM(T1.INAUD_AMT) AS SL_ITM_AMT 
              FROM TB_INAUD_DTL T1
                 , TB_CD_ITM    T2
             WHERE 1 = 1 
               AND T1.CHNL_CD = #CHNL_CD#
               AND T1.CHNL_CD = T2.CHNL_CD
               AND T1.ITM_CD = T2.ITM_CD
               AND T1.INAUD_CD = 'IGS'
               AND T1.CRE_DT  >=  CAST(#FM_DT# + '01' + ' 00:00:00' AS DATETIME)
               AND T1.CRE_DT  <![CDATA[<=]]>  CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY( CAST(#FM_DT# + '01' + ' 00:00:00' AS DATETIME)), 112) + ' 23:59:59' AS DATETIME)
               AND T1.INAUD_AMT > 0
          GROUP BY T1.ITM_CD
                 , T1.CHNL_CD
                 , T2.N1ST_ITM_GRP_CD
         ) T1
        UNION ALL
        SELECT '생산' AS GBN
             , CONVERT(VARCHAR, CONVERT(INT, ISNULL(SUM(CASE WHEN T3.SUB_CD = '프레스' THEN T1.ITM_QTY END), 0)))   AS N1ST_ROUT_QTY 
             , ISNULL(SUM(CASE WHEN T3.SUB_CD = '포밍' THEN T1.ITM_QTY END), 0)    AS N2ND_ROUT_QTY 
             , ISNULL(SUM(CASE WHEN T3.SUB_CD = '후가공' THEN T1.ITM_QTY END), 0)    AS N3RD_ROUT_QTY 
             , ISNULL(SUM(CASE WHEN T3.SUB_CD = '내경정삭' THEN T1.ITM_QTY END), 0)  AS N4TH_ROUT_QTY 
              
          FROM TB_FPRF_N2ND_STEP_ROUT T1
              ,TB_PROD_ROUT_ITM_MAP T2
              ,TB_PROD_ROUT T3
         WHERE 1 = 1
           AND T1.CHNL_CD = T2.CHNL_CD
           AND T1.CHNL_CD = T3.CHNL_CD
           AND T1.CHNL_CD = #CHNL_CD#
           AND T1.ROUT_ITM_CD = T2.ROUT_ITM_CD
           AND T2.ROUT_CD     = T3.ROUT_CD
           AND T1.MAKE_DT >= CAST(#FM_DT# + '01' + ' 00:00:00' AS DATETIME)
           AND T1.MAKE_DT<![CDATA[<=]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY( CAST(#FM_DT# + '01' + ' 00:00:00' AS DATETIME)), 112) + ' 23:59:59' AS DATETIME)
        UNION ALL  
        SELECT '구매'
             , NULL AS CAR_TP_NM
             , SUM(INAUD_AMT) AS SL_ITM_AMT
             , NULL AS N3RD_ROUT_QTY
             , NULL AS N4TH_ROUT_QTY
          FROM TB_INAUD_MAST T1
             , TB_INAUD_DTL  T2
         WHERE 1 = 1
           AND T1.CHNL_CD = T2.CHNL_CD
           AND T1.INSRL_NO = T2.INSRL_NO
           AND T1.INAUD_DT >= CAST(#FM_DT# + '01' + ' 00:00:00' AS DATETIME)
           AND T1.INAUD_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY( CAST(#FM_DT# + '01' + ' 00:00:00' AS DATETIME)), 112) + ' 23:59:59' AS DATETIME)
           AND INAUD_CD IN ('RGM', 'RGU')
    </select>
    
    
      --><!--일-경영정보--><!--
      <select id="P12SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
        SELECT '영업' AS GBN
             , CAR_TP_NM
             , SL_ITM_AMT
             , NULL  AS N3RD_ROUT_QTY
             , NULL  AS N4TH_ROUT_QTY
         FROM(
            SELECT T1.ITM_CD AS 품번      
                 , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, 'G', T2.N1ST_ITM_GRP_CD) AS CAR_TP_NM 
                 , SUM(T1.INAUD_AMT) AS SL_ITM_AMT 
              FROM TB_INAUD_DTL T1
                 , TB_CD_ITM    T2
             WHERE 1 = 1 
               AND T1.CHNL_CD = #CHNL_CD#
               AND T1.CHNL_CD = T2.CHNL_CD
               AND T1.ITM_CD = T2.ITM_CD
               AND T1.INAUD_CD = 'IGS'
               AND T1.CRE_DT  >=  CAST(CONVERT(VARCHAR(8), CAST(#FM_DT# AS DATETIME) , 112) + ' 00:00:00' AS DATETIME) 
               AND T1.CRE_DT  <![CDATA[<=]]>  CAST(CONVERT(VARCHAR(8), CAST(#FM_DT# AS DATETIME) , 112) + ' 23:59:59' AS DATETIME) 
               AND T1.INAUD_AMT > 0
          GROUP BY T1.ITM_CD
                 , T1.CHNL_CD
                 , T2.N1ST_ITM_GRP_CD
         ) T1
        UNION ALL
        SELECT '생산' AS GBN
             , CONVERT(VARCHAR, CONVERT(INT, ISNULL(SUM(CASE WHEN T3.SUB_CD = '프레스' THEN T1.ITM_QTY END), 0)))   AS N1ST_ROUT_QTY 
             , ISNULL(SUM(CASE WHEN T3.SUB_CD = '포밍' THEN T1.ITM_QTY END), 0)    AS N2ND_ROUT_QTY 
             , ISNULL(SUM(CASE WHEN T3.SUB_CD = '후가공' THEN T1.ITM_QTY END), 0)    AS N3RD_ROUT_QTY 
             , ISNULL(SUM(CASE WHEN T3.SUB_CD = '내경정삭' THEN T1.ITM_QTY END), 0)  AS N4TH_ROUT_QTY 
          FROM TB_FPRF_N2ND_STEP_ROUT T1
              ,TB_PROD_ROUT_ITM_MAP T2
              ,TB_PROD_ROUT T3
         WHERE 1 = 1
           AND T1.CHNL_CD = T2.CHNL_CD
           AND T1.CHNL_CD = T3.CHNL_CD
           AND T1.CHNL_CD = #CHNL_CD#
           AND T1.ROUT_ITM_CD = T2.ROUT_ITM_CD
           AND T2.ROUT_CD     = T3.ROUT_CD
           AND T1.MAKE_DT >= CAST(CONVERT(VARCHAR(8), CAST(#FM_DT# AS DATETIME) , 112) + ' 00:00:00' AS DATETIME) 
           AND T1.MAKE_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR(8), CAST(#FM_DT# AS DATETIME) , 112) + ' 23:59:59' AS DATETIME) 
        UNION ALL  
        SELECT '구매'
             , NULL AS CAR_TP_NM
             , SUM(INAUD_AMT) AS SL_ITM_AMT
             , NULL AS N3RD_ROUT_QTY
             , NULL AS N4TH_ROUT_QTY
          FROM TB_INAUD_MAST T1
             , TB_INAUD_DTL  T2
         WHERE 1 = 1
           AND T1.CHNL_CD = T2.CHNL_CD
           AND T1.INSRL_NO = T2.INSRL_NO
           AND T1.INAUD_DT >= CAST(CONVERT(VARCHAR(8), CAST(#FM_DT# AS DATETIME), 112) + ' 00:00:00' AS DATETIME) 
           AND T1.INAUD_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR(8), CAST(#FM_DT# AS DATETIME), 112) + ' 23:59:59' AS DATETIME) 
           AND INAUD_CD IN ('RGM', 'RGU')
    </select>
    

  --><!--공지 사항--><!--
    <select id="P00SelectMstList" parameterClass="ModelsLibrary.Pda.PdaVo" resultClass="ModelsLibrary.Pda.PdaVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY CRE_DT) AS RN 
           , TIT_DESC
           , dbo.USR_NM_FNC(#CHNL_CD#, UPD_USR_ID) AS UPD_USR_NM
           , UPD_USR_ID
           , CONVERT(VARCHAR, UPD_DT, 120) AS UPD_DT
           , SUBJ_DESC
           , FILE_NM
           , NTC_FILE
      FROM  TB_SYS_NTC
        WHERE 1=1
          AND CHNL_CD = #CHNL_CD#
          AND NTC_CLSS_CD =  'A'
          AND NTC_CD =  'A'
      ORDER BY UPD_DT DESC
    </select>-->







  </statements>
</sqlMap>