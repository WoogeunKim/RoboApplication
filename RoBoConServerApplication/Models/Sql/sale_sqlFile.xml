<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="sale" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <statements>
    <!-- S2211 수주 등록-->
    <select id="S2211SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT
          ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_NO) AS RN
        , T1.SL_RLSE_NO
        , CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 120) AS SL_RLSE_DT
        , (T1.SL_RLSE_NO + ' / ' + dbo.USR_NM_FNC(T1.CHNL_CD, T1.CRE_USR_ID))  AS SL_RLSE_NM
        , dbo.USR_NM_FNC(T1.CHNL_CD, MAX(T1.UPD_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO)) AS SL_NM
        , T1.SL_CO_CD
        , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS SL_CO_NM
        , dbo.CD_COMPANY_GRD_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS SL_CO_GRD_NM
        , (SELECT X.HDQTR_PHN_NO FROM TB_CD_CO AS X WHERE 1=1 AND X.CHNL_CD = t1.CHNL_CD AND X.CO_NO = SL_CO_CD) AS HDQTR_PHN_NO
        , (SELECT X.HDQTR_FAX_NO FROM TB_CD_CO AS X WHERE 1=1 AND X.CHNL_CD = T1.CHNL_CD AND X.CO_NO = SL_CO_CD) AS HDQTR_FAX_NO
        , T1.SL_AREA_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-002', T1.SL_AREA_CD) AS SL_AREA_NM
        , T1.SL_TRSP_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-025', T1.SL_TRSP_CD) AS SL_TRSP_NM
        , T1.SL_TRSP_AREA_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-009', T1.SL_TRSP_AREA_CD) AS SL_TRSP_AREA_NM
        , T1.SL_TRSP_TM_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-027', T1.SL_TRSP_TM_CD) AS SL_TRSP_TM_NM
        , T1.SL_TRSP_VEH_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-028', T1.SL_TRSP_VEH_CD) AS SL_TRSP_VEH_NM
        , T1.SL_CO_RLSE_FLG
        , T1.SL_RLSE_FLG
        , T1.SL_NXT_CLZ_FLG
        , T1.SL_RMK
        , dbo.USR_NM_FNC(T1.CHNL_CD, T1.CRE_USR_ID) AS RGST_USR_NM
        , T1.PCK_FLG
        , T1.RCV_PPR_FLG
        , T1.PCK_DEST_PHN_NO
        , T1.PCK_DEST_ADDR
        , T1.PCK_DEST_RMK
        , dbo.FF_SL_ORD_CLZ_FLG(T1.CHNL_CD, T1.SL_RLSE_NO) AS CLZ_FLG
        , CONVERT(VARCHAR(10), T1.NXT_MON_DT, 120) AS NXT_MON_DT
        , T1.ADD_FLG
        , CONVERT(VARCHAR, (MAX(T1.CRE_DT)      OVER (PARTITION BY T1.SL_RLSE_NO)), 121)     AS CRE_DT
        , MAX(T1.CRE_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO) AS CRE_US_ID
        , CONVERT(VARCHAR, (MAX(T1.UPD_DT)      OVER (PARTITION BY T1.SL_RLSE_NO)), 121)     AS UPD_DT
        , MAX(T1.UPD_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO) AS UPD_US_ID
        , (SELECT SUM(ROUND(X.SL_ITM_AMT, 0)) FROM TB_SL_RLSE_DTL AS X WHERE 1=1 AND X.SL_RLSE_NO = T1.SL_RLSE_NO AND X.CHNL_CD = T1.CHNL_CD) AS SL_ITM_AMT
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-011', T2.PAY_TP_CD) AS PAY_TP_NM
        , T1.CHNL_CD
        , CONVERT(VARCHAR, T1.DUE_DT, 23) AS DUE_DT
      FROM TB_SL_RLSE T1
         , TB_CD_CO T2
      WHERE 1=1
        AND T1.CHNL_CD     = #CHNL_CD#
        AND T1.CHNL_CD     = T2.CHNL_CD
        AND T1.SL_RLSE_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
        AND T1.SL_RLSE_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
        AND T1.SL_CO_CD = T2.CO_NO
      <isNotNull property="AREA_CD">
        AND T1.SL_AREA_CD = #AREA_CD#
      </isNotNull>
    </select>

    <!-- Service -->
    <select id="S2211SelectJbNo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'SOP', #SL_AREA_CD#) AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
    </select>

    <update id="S2211UpdateJbNo" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SYS_NO_FMT
        SET 
            LST_FMT_NO  = #SL_RLSE_NO#
          WHERE TBL_ID  = 'SOP'
            AND CHNL_CD = #CHNL_CD#
            AND AREA_CD = #SL_AREA_CD#
    </update>

  <!--
    <select id="S2211SelectLmtCheck" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="string">
      SELECT ISNULL(dbo.FF_SL_CO_LMT_OK(#CHNL_CD#, #CO_CD#, CONVERT(VARCHAR(8), GETDATE(), 112)), '') AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
    </select>
  -->
  <!--
    <statement id="ProcS2211" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_releasedcupdateprc #CHNL_CD#, #SL_RLSE_NO#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>
    -->

    <!-- 출하의뢰등록 마감해제 프로시져
    <statement id="ProcS2211Delete" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_del_bill #CHNL_CD#, #SL_RLSE_NO#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>
    -->
    
    <insert id="S2211InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_SL_RLSE
      (
            CHNL_CD
          , SL_RLSE_NO
          , SL_RLSE_DT
          , SL_CO_CD
          , SL_AREA_CD
          , SL_TRSP_CD
          , SL_TRSP_AREA_CD
          , SL_TRSP_TM_CD
          , SL_TRSP_VEH_CD
          , SL_CO_RLSE_FLG
          , SL_RLSE_FLG
          , SL_NXT_CLZ_FLG
          , SL_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , PCK_FLG
          , PCK_DEST_PHN_NO
          , PCK_DEST_ADDR
          , PCK_DEST_RMK
          , RCV_PPR_FLG
          , NXT_MON_DT
          , DUE_DT
      )
      VALUES
      (
            #CHNL_CD#
          ,	#SL_RLSE_NO#
          , #SL_RLSE_DT#
          , #SL_CO_CD#
          , #SL_AREA_CD#
          , #SL_TRSP_CD#
          , #SL_TRSP_AREA_CD#
          , #SL_TRSP_TM_CD#
          , #SL_TRSP_VEH_CD#
          , #SL_CO_RLSE_FLG#
          , #SL_RLSE_FLG#
          , #SL_NXT_CLZ_FLG#
          , #SL_RMK#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          , #PCK_FLG#
          , #PCK_DEST_PHN_NO#
          , #PCK_DEST_ADDR#
          , #PCK_DEST_RMK#
          , #RCV_PPR_FLG#
          , #NXT_MON_DT#
          , #DUE_DT#
      )
    </insert>

    <!--
    <insert id="S2211InsertCopyMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        INSERT INTO TB_SL_JB_MST (
        JB_NO
        , JB_NM
        , JB_CTRT_DT
        , SL_CO_NO
        , SL_DUE_DT
        , RGST_USR_ID
        , CLZ_FLG
        , JB_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        )
        SELECT #JB_NO#                          AS JB_NO
        , #JB_NM#                          AS JB_NM
        , CONVERT(DATETIME, #JB_CTRT_DT#)  AS JB_CTRT_DT
        , #SL_CO_NO#                       AS SL_CO_NO
        , CONVERT(DATETIME, #SL_DUE_DT#)   AS SL_DUE_DT
        , #RGST_USR_ID#                    AS RGST_USR_ID
        , #CLZ_FLG#                        AS CLZ_FLG
        , #JB_RMK#                         AS JB_RMK
        , #CRE_USR_ID#                     AS CRE_USR_ID
        , GETDATE()                        AS CRE_DT
        , #UPD_USR_ID#                     AS UPD_USR_ID
        , GETDATE()                        AS UPD_DT
        FROM TB_SL_JB_MST
        WHERE JB_NO = #CP_JB_NO#
      </insert>
      -->
    
      <update id="S2211UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_SL_RLSE
          SET
              SL_RLSE_DT       = #SL_RLSE_DT#
            , SL_CO_CD         = #SL_CO_CD#
            , SL_AREA_CD       = #SL_AREA_CD#
            , SL_TRSP_TM_CD    = #SL_TRSP_TM_CD#
            , SL_TRSP_CD       = #SL_TRSP_CD#
            , SL_TRSP_AREA_CD  = #SL_TRSP_AREA_CD#
            , SL_TRSP_VEH_CD   = #SL_TRSP_VEH_CD#
            , SL_CO_RLSE_FLG   = #SL_CO_RLSE_FLG#
            , SL_RLSE_FLG      = #SL_RLSE_FLG#
            , SL_NXT_CLZ_FLG   = #SL_NXT_CLZ_FLG#
            , UPD_USR_ID       = #UPD_USR_ID#
            , UPD_DT           = GETDATE()
            , SL_RMK           = #SL_RMK#
            , PCK_FLG          = #PCK_FLG#
            , PCK_DEST_PHN_NO  = #PCK_DEST_PHN_NO#
            , PCK_DEST_ADDR    = #PCK_DEST_ADDR#
            , PCK_DEST_RMK     = #PCK_DEST_RMK#
            , RCV_PPR_FLG      = #RCV_PPR_FLG#
            , NXT_MON_DT       = #NXT_MON_DT#
            , DUE_DT           = #DUE_DT#
            <isNotNull property="ADD_FLG">
              , ADD_FLG        = #ADD_FLG#
            </isNotNull>
        WHERE SL_RLSE_NO    = #SL_RLSE_NO#
          AND CHNL_CD       = #CHNL_CD#
      </update>

      <delete id="S2211DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        DELETE FROM TB_SL_RLSE
          WHERE SL_RLSE_NO    = #SL_RLSE_NO#
            AND CHNL_CD       = #CHNL_CD#
      </delete>

      <select id="S2211SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_SEQ) AS RN
          , CASE WHEN DC_PRC_VAL  <![CDATA[<>]]>  SL_ITM_PRC_VAL THEN 1 ELSE 0 END AS DC_CHK
          , SL_ITM_CD
          , ITM_NM
          , ITM_SZ_NM
          , CONVERT(BIGINT, ISNULL(SL_ITM_QTY, 0))      AS SL_ITM_QTY
          , SL_ITM_WGT
          , CONVERT(FLOAT, ISNULL(SL_ITM_PRC_VAL, 0.0)) AS SL_ITM_PRC_VAL
          , CONVERT(FLOAT, ISNULL(DC_PRC_VAL, 0.0))     AS DC_PRC_VAL
          , CONVERT(BIGINT, ISNULL(SL_ITM_AMT, 0))      AS SL_ITM_AMT
          , SL_ITM_RMK
          , CHNL_CD
          , N1ST_ITM_GRP_NM
        FROM (
          SELECT T1.SL_ITM_CD
            , T2.ITM_NM
            , T2.ITM_SZ_NM
            , T1.SL_ITM_QTY
            , T1.SL_ITM_PRC_VAL
            , T1.SL_ITM_PRC_DC_VAL AS DC_PRC_VAL
            , T1.SL_ITM_AMT
            , T1.SL_ITM_RMK
            , T1.SL_RLSE_NO
            , T1.SL_RLSE_SEQ
            , ROUND(T1.SL_ITM_QTY * T2.UOM_WGT, 0) AS SL_ITM_WGT
            , T1.CHNL_CD
            , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
          FROM TB_SL_RLSE_DTL T1
            , TB_CD_ITM      T2
          WHERE 1 = 1
            AND T1.SL_RLSE_NO = #SL_RLSE_NO#
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.CHNL_CD    = T2.CHNL_CD
            AND T1.SL_ITM_CD = T2.ITM_CD
            AND T1.SL_ITM_QTY <![CDATA[<>]]>  0
          <isNotNull property="SL_RLSE_SEQ">
            AND T1.SL_RLSE_SEQ = #SL_RLSE_SEQ#
          </isNotNull>
        ) T1
      </select>

    <!--left1List -->
    <select id="S2211SelectSubLeftDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT T2.ITM_GRP_CD      AS N1ST_ITM_GRP_CD
           , T2.ITM_GRP_NM      AS N1ST_ITM_GRP_NM
           , T1.ITM_GRP_CD      AS N2ND_ITM_GRP_CD
           , T1.ITM_GRP_NM      AS N2ND_ITM_GRP_NM
           , #ITM_GRP_CLSS_CD#  AS ITM_GRP_CLSS_CD
           , #CHNL_CD#          AS CHNL_CD
      FROM TB_CD_ITM_GRP  T1
        , (
            SELECT 'A'  AS GBN
                , ITM_GRP_CD
                , ITM_GRP_NM
                , PRNT_ITM_GRP_CD
            FROM TB_CD_ITM_GRP
              WHERE 1 = 1
              AND CHNL_CD         = #CHNL_CD#
              AND PRNT_ITM_GRP_CD = 'T'
              AND ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
          ) T2
      WHERE 1 = 1
          AND T1.CHNL_CD         = #CHNL_CD#
          AND T1.PRNT_ITM_GRP_CD = T2.ITM_GRP_CD
          AND T1.PRNT_ITM_GRP_CD <![CDATA[<>]]> 'T'
          AND ITM_GRP_CLSS_CD    = #ITM_GRP_CLSS_CD#
    </select>
    
    <!--right2List -->
    <select id="S2211SelectSubDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
	 SELECT RN
          , CASE WHEN DC_PRC_VAL  <![CDATA[<>]]>  SL_ITM_PRC_VAL THEN 1 ELSE 0 END AS DC_CHK
          , SL_ITM_CD
          , SL_ITM_CD AS ITM_CD
          , ITM_NM
          , ITM_SZ_NM
          , CONVERT(BIGINT, ISNULL(SL_ITM_QTY, '0')) AS SL_ITM_QTY
          , CONVERT(BIGINT, ROUND(ISNULL(SL_ITM_QTY, 0) * UOM_WGT, 0) ) AS SL_ITM_WGT
          , CONVERT(FLOAT, ISNULL(SL_ITM_PRC_VAL, 0)) AS SL_ITM_PRC_VAL
          , CONVERT(FLOAT, ISNULL(DC_PRC_VAL, 0)) AS DC_PRC_VAL
          , CONVERT(BIGINT, ISNULL(SL_ITM_AMT, 0)) AS  SL_ITM_AMT
          , SL_ITM_RMK
          , UOM_WGT
          , SL_ITM_WGT
          , SL_RLSE_SEQ
          , SL_RLSE_NO
          , T1.N1ST_ITM_SZ_NM
          , T1.N2ND_ITM_SZ_NM
          , T1.N3RD_ITM_SZ_NM
          , CHNL_CD
          , CRE_USR_ID
          , UPD_USR_ID
        FROM (
            SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_SEQ) AS RN
                , T1.SL_ITM_CD
                , T2.ITM_NM
                , T2.ITM_SZ_NM
                , T1.SL_ITM_QTY
                , T1.SL_ITM_PRC_VAL
                , T1.SL_ITM_PRC_DC_VAL AS DC_PRC_VAL
                , T1.SL_ITM_AMT
                , T1.SL_ITM_RMK
                , T1.SL_RLSE_SEQ
                , T1.SL_RLSE_NO
                , T1.N1ST_ITM_SZ_NM
                , T1.N2ND_ITM_SZ_NM
                , T1.N3RD_ITM_SZ_NM
                , T2.UOM_WGT
                , T1.SL_ITM_WGT
                , T1.CHNL_CD
                , T1.CRE_USR_ID
                , T1.UPD_USR_ID
            FROM TB_SL_RLSE_DTL T1
                , TB_CD_ITM      T2
            WHERE 1 = 1
                AND T1.CHNL_CD    = #CHNL_CD#
                AND T1.CHNL_CD    = T2.CHNL_CD
                AND SL_RLSE_NO    = #SL_RLSE_NO#
                AND T1.SL_ITM_CD  = T2.ITM_CD
                AND T1.SL_ITM_QTY > 0
        ) T1
        <!--SELECT RN
          , CASE WHEN DC_PRC_VAL  <![CDATA[<>]]>  SL_ITM_PRC_VAL THEN 1 ELSE 0 END AS DC_CHK
          , SL_ITM_CD
          , SL_ITM_CD AS ITM_CD
          , ITM_NM
          , ITM_SZ_NM
          , CONVERT(BIGINT, ISNULL(SL_ITM_QTY, '0')) AS SL_ITM_QTY
          , CONVERT(BIGINT, ROUND(ISNULL(SL_ITM_QTY, 0) * UOM_WGT, 0) ) AS SL_ITM_WGT
          , CONVERT(FLOAT, ISNULL(SL_ITM_PRC_VAL, 0)) AS SL_ITM_PRC_VAL
          , CONVERT(FLOAT, ISNULL(DC_PRC_VAL, 0)) AS DC_PRC_VAL
          , CONVERT(BIGINT, ISNULL(SL_ITM_AMT, 0)) AS  SL_ITM_AMT
          , SL_ITM_RMK
          , UOM_WGT
          , SL_RLSE_SEQ
          , SL_RLSE_NO
          , CHNL_CD
          , CRE_USR_ID
          , UPD_USR_ID
        FROM (
            SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_SEQ) AS RN
                , T1.SL_ITM_CD
                , T2.ITM_NM
                , T2.ITM_SZ_NM
                , T1.SL_ITM_QTY
                , T1.SL_ITM_PRC_VAL
                , T1.SL_ITM_PRC_DC_VAL AS DC_PRC_VAL
                , T1.SL_ITM_AMT
                , T1.SL_ITM_RMK
                , T1.SL_RLSE_SEQ
                , T1.SL_RLSE_NO
                , T2.UOM_WGT
                , T1.CHNL_CD
                , T1.CRE_USR_ID
                , T1.UPD_USR_ID
            FROM TB_SL_RLSE_DTL T1
                , TB_CD_ITM      T2
            WHERE 1 = 1
                AND T1.CHNL_CD    = #CHNL_CD#
                AND T1.CHNL_CD    = T2.CHNL_CD
                AND SL_RLSE_NO    = #SL_RLSE_NO#
                AND T1.SL_ITM_CD  = T2.ITM_CD
                AND T1.SL_ITM_QTY > 0
        ) T1-->
      </select>

      <!--ViewGridRight1-->
    <select id="S2211SelectSubItmDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT  T1.ITM_CD
            , T1.ITM_NM
            , T1.ITM_SZ_NM
            , T1.STK_A_QTY
            , T1.TMP_A_QTY
            , T1.UOM_NM
            , T1.SL_ITM_PRC_VAL
            , T1.PROD_LOC_NM
            , T1.CHNL_CD
      FROM (
          SELECT T1.ITM_CD
              , T2.ITM_NM
              , T2.ITM_SZ_NM
              , T2.UOM_CD
              , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD)   AS UOM_NM
              , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_QTY END), 0) AS STK_A_QTY
              , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_TMP_QTY END ), 0) AS TMP_A_QTY
              , MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.SL_ITM_PRC_VAL END      ) AS SL_ITM_PRC_VAL
              , MAX(dbo.FF_ITM_LOC_NM(T1.CHNL_CD, '001', T1.ITM_CD))  AS PROD_LOC_NM
              , T1.CHNL_CD
          FROM TB_INVT_DLY_STK  T1
              , TB_CD_ITM     T2
          WHERE 1 = 1
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.ITM_CD     = T2.ITM_CD
            AND T1.CHNL_CD    = T2.CHNL_CD
          <isNotNull property="ITM_GRP_CLSS_CD" >
            AND T2.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
          </isNotNull>
          <isNotNull property="N1ST_ITM_GRP_CD" >
            AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
          </isNotNull>
          <isNotNull property="N2ND_ITM_GRP_CD" >
            AND T2.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
          </isNotNull>
          <isNotNull property="HD_LEN_CD" >
            AND T2.HD_LEN_CD       = #HD_LEN_CD#
          </isNotNull>
          <isNotNull property="ITM_CD" >
            AND T2.ITM_CD           LIKE  #ITM_CD# + '%'
          </isNotNull>
          GROUP BY T1.CHNL_CD
          , T1.ITM_CD
          , T2.ITM_NM
          , T2.ITM_SZ_NM
          , T2.UOM_CD
      ) T1
      ORDER BY T1.ITM_CD
    </select>
    
    <!--
      <select id="S2211SelectQuickDtl" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT MD_PER_QTY
        , PK_PER_QTY
        , #SL_ITM_QTY#
        , dbo.FF_SL_RLSE_PRC(CHNL_CD, #AREA_CD#, ITM_CD, GETDATE())  AS SL_ITM_PRC_VAL
        FROM TB_CD_ITM
        WHERE ITM_CD = #ITM_CD#
        AND CHNL_CD   = #CHNL_CD#
      </select>
      -->

      <insert id="S2211InsertDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
        INSERT INTO TB_SL_RLSE_DTL
        (
          CHNL_CD
        , SL_RLSE_NO
        , SL_RLSE_SEQ
        , SL_ITM_CD
        , SL_ITM_PRC_VAL
        , SL_ITM_PRC_DC_VAL
        , SL_ITM_QTY
        , SL_ITM_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        )
        SELECT T1.CHNL_CD
        , #SL_RLSE_NO#
        , T2.SL_RLSE_SEQ
        , T1.ITM_CD
        , dbo.FF_SL_RLSE_PRC(T1.CHNL_CD, T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT) AS SL_ITM_PRC_VAL
        , dbo.FF_SL_RLSE_PRC(T1.CHNL_CD, T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT) AS SL_ITM_PRC_DC_VAL
        , #SL_ITM_QTY#
        , #SL_ITM_RMK#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
        FROM TB_CD_ITM T1
        , (
        SELECT SL_AREA_CD
        , SL_CO_CD
        , SL_RLSE_DT
        , ISNULL(MAX(T2.SL_RLSE_SEQ) + 1, 1)  AS SL_RLSE_SEQ
        FROM TB_SL_RLSE T1 LEFT OUTER JOIN TB_SL_RLSE_DTL T2
        ON ( T1.SL_RLSE_NO = T2.SL_RLSE_NO
        AND T2.CHNL_CD = #CHNL_CD# )
        WHERE 1 = 1
        AND T1.SL_RLSE_NO = #SL_RLSE_NO#
        AND T1.CHNL_CD    = #CHNL_CD#
        GROUP BY SL_AREA_CD
        , SL_CO_CD
        , SL_RLSE_DT
        ) T2
        WHERE T1.ITM_CD = #ITM_CD#
        AND T1.CHNL_CD = #CHNL_CD#
      </insert>

    <!--
        <insert id="S2211InsertQuickDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
          INSERT INTO TB_SL_RLSE_DTL
          (
          CHNL_CD#
          , SL_RLSE_NO
          , SL_RLSE_SEQ
          , SL_ITM_CD
          , SL_ITM_PRC_VAL
          , SL_ITM_PRC_DC_VAL
          , SL_ITM_QTY
          , SL_ITM_AMT
          , SL_ITM_TAX_AMT
          , SL_ITM_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          )
          SELECT
          T1.CHNL_CD
          , #SL_RLSE_NO#
          , T2.SL_RLSE_SEQ
          , T1.ITM_CD
          , dbo.FF_SL_RLSE_PRC(T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT) AS SL_ITM_PRC_VAL
          , 0
          , #SL_ITM_QTY#
          , ROUND(#SL_ITM_QTY# * dbo.FF_SL_RLSE_PRC(T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT), 0)
          , ROUND(ROUND(#SL_ITM_QTY# * dbo.FF_SL_RLSE_PRC(T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT), 1) * 0.1, 0)
          , #SL_ITM_RMK#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          FROM TB_CD_ITM T1
          , (
          SELECT SL_AREA_CD
          , SL_CO_CD
          , SL_RLSE_DT
          , ISNULL(MAX(T2.SL_RLSE_SEQ) + 1, 1)  AS SL_RLSE_SEQ
          FROM TB_SL_RLSE T1 LEFT OUTER JOIN TB_SL_RLSE_DTL T2
          ON ( T1.SL_RLSE_NO = T2.SL_RLSE_NO
          AND T2.CHNL_CD    = #CHNL_CD#)
          WHERE 1 = 1
          AND T1.SL_RLSE_NO = #SL_RLSE_NO#
          AND T1.CHNL_CD    = #CHNL_CD#
          GROUP BY SL_AREA_CD
          , SL_CO_CD
          , SL_RLSE_DT
          ) T2
          WHERE T1.ITM_CD = #ITM_CD#
          AND T1.CHNL_CD = #CHNL_CD#
        </insert>
        -->

        <update id="S2211UpdateDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
          UPDATE TB_SL_RLSE_DTL
          SET
          UPD_USR_ID        = #UPD_USR_ID#
          , UPD_DT            = GETDATE()
          <isNotNull property="SL_ITM_RMK">
            , SL_ITM_RMK        = #SL_ITM_RMK#
          </isNotNull>
          <isNotNull property="SL_ITM_QTY">
            , SL_ITM_QTY        = #SL_ITM_QTY#
            , SL_ITM_AMT        = ROUND(#SL_ITM_QTY# * CAST(SL_ITM_PRC_DC_VAL AS FLOAT), 0)
            , SL_ITM_TAX_AMT    = ROUND(ROUND(#SL_ITM_QTY# * CAST(SL_ITM_PRC_DC_VAL AS FLOAT), 1) * 0.1, 0)
          </isNotNull>
          <isNotNull property="SL_ITM_AMT">
            , SL_ITM_AMT        = #SL_ITM_AMT#
            , SL_ITM_TAX_AMT    = ROUND(ROUND(SL_ITM_QTY * CAST(SL_ITM_PRC_DC_VAL AS FLOAT), 1) * 0.1, 0)
          </isNotNull>
          <isNotNull property="CHPT_CLZ_FLG">
            , CHPT_CLZ_FLG        = #CHPT_CLZ_FLG#
          </isNotNull>
          <isNotNull property="SL_ITM_PRC_DC_VAL">
            , SL_ITM_PRC_DC_VAL = #SL_ITM_PRC_DC_VAL#
            , SL_ITM_AMT        = ROUND(SL_ITM_QTY * CAST(#SL_ITM_PRC_DC_VAL# AS FLOAT), 0)
            , SL_ITM_TAX_AMT    = ROUND(ROUND(SL_ITM_QTY * CAST(#SL_ITM_PRC_DC_VAL# AS FLOAT), 1) * 0.1, 0)
            , SL_ITM_PRC_DC_RT  = #SL_ITM_PRC_DC_RT#
          </isNotNull>
          WHERE SL_RLSE_NO  = #SL_RLSE_NO#
          AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
          AND CHNL_CD     = #CHNL_CD#

        </update>

      <!--
        <update id="S2211UpdateDtlQty" parameterClass="ModelsLibrary.Sale.SaleVo">
          UPDATE TB_SL_RLSE_DTL
          SET  SL_ITM_QTY       = #SL_ITM_QTY#
          , SL_ITM_RMK       = #SL_ITM_RMK#
          , SL_ITM_AMT       = ROUND(#SL_ITM_QTY# * SL_ITM_PRC_DC_VAL, 0)
          , SL_ITM_TAX_AMT   = ROUND(#SL_ITM_QTY# * SL_ITM_PRC_DC_VAL * 0.1, 0)
          WHERE 1 = 1
          AND SL_RLSE_NO    = #SL_RLSE_NO#
          AND SL_RLSE_SEQ   = #SL_RLSE_SEQ#
          AND CHNL_CD       = #CHNL_CD#
        </update>
        -->

        <!--
        <select id="S2211DeleteDtlCheck" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
          SELECT COUNT(SL_RLSE_NO) AS RN FROM TB_SL_RLSE_MAP WHERE 1=1 AND SL_RLSE_NO = #SL_RLSE_NO# AND CHNL_CD = #CHNL_CD#
        </select>
        -->

        <delete id="S2211DeleteDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
          DELETE FROM TB_SL_RLSE_DTL
          WHERE 1 = 1
          AND CHNL_CD = #CHNL_CD#
          AND SL_RLSE_NO = #SL_RLSE_NO#
          <isNotNull property="SL_RLSE_SEQ">
            AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
          </isNotNull>
        </delete>
    
    <!--
     <select id="S2211SelectSubDtlResult" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT #SL_ITM_QTY#            AS SL_ITM_QTY
        , MD_QTY
        , PK_QTY
        , #SL_ITM_QTY# - ((MD_QTY * MD_PER_QTY) + (PK_QTY * PK_PER_QTY)) AS SL_ITM_RMN_QTY
        , #SL_ITM_QTY# * UOM_WGT AS SL_ITM_WGT
        FROM (
        SELECT CASE WHEN MD_PER_QTY = 0 THEN 0 ELSE FLOOR(#SL_ITM_QTY# / MD_PER_QTY)  END  AS MD_QTY
        , CASE WHEN PK_PER_QTY = 0 THEN 0
        WHEN MD_PER_QTY = 0 THEN 0
        ELSE  FLOOR((#SL_ITM_QTY# - (MD_PER_QTY * FLOOR(#SL_ITM_QTY# / MD_PER_QTY))) / PK_PER_QTY)
        END  AS PK_QTY
        , MD_PER_QTY
        , PK_PER_QTY
        , UOM_WGT
        FROM TB_CD_ITM
        WHERE ITM_CD = #SL_ITM_CD#
        AND CHNL_CD   = #CHNL_CD#
        ) T1
      </select>

      <select id="S2211SelectSubDtlResult2" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT ISNULL( MD_QTY * MD_PER_QTY, 0) + ISNULL(PK_QTY * PK_PER_QTY, 0) + ISNULL(SL_ITM_RMN_QTY, 0) AS SL_ITM_QTY
        , (ISNULL( MD_QTY * MD_PER_QTY, 0) + ISNULL(PK_QTY * PK_PER_QTY, 0) + ISNULL(SL_ITM_RMN_QTY, 0)) * UOM_WGT AS SL_ITM_WGT
        FROM (
        SELECT MD_PER_QTY
        , PK_PER_QTY
        , #MD_QTY# AS MD_QTY
        , ( CASE WHEN PK_PER_QTY = 0 THEN 0 ELSE #PK_QTY# END ) AS PK_QTY
        , #SL_ITM_RMN_QTY# AS SL_ITM_RMN_QTY
        , UOM_WGT
        FROM TB_CD_ITM
        WHERE ITM_CD    = #SL_ITM_CD#
        AND CHNL_CD   = #CHNL_CD#
        ) T1
      </select>
      -->
    
    <!-- 프로시저 -->
    <statement id="ProcS2211" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_releasedcupdateprc #CHNL_CD#, #SL_RLSE_NO#, #CRE_USR_ID#, @RTN OUTPUT
      select @RTN AS R_value
    </statement>
      <!-- S2211 수주 등록-->
    
    
    
     <!-- S22111 배차 관리-->
    <select id="S22111SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT
          ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_NO) AS RN
        , T1.SL_RLSE_NO
        , CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 120) AS SL_RLSE_DT
        , (T1.SL_RLSE_NO + ' / ' + dbo.USR_NM_FNC(T1.CHNL_CD, T1.CRE_USR_ID))  AS SL_RLSE_NM
        , dbo.USR_NM_FNC(T1.CHNL_CD, MAX(T1.UPD_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO)) AS SL_NM
        , T1.SL_CO_CD
        , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS SL_CO_NM
        , dbo.CD_COMPANY_GRD_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS SL_CO_GRD_NM
        , (SELECT X.HDQTR_PHN_NO FROM TB_CD_CO AS X WHERE 1=1 AND X.CHNL_CD = t1.CHNL_CD AND X.CO_NO = SL_CO_CD) AS HDQTR_PHN_NO
        , (SELECT X.HDQTR_FAX_NO FROM TB_CD_CO AS X WHERE 1=1 AND X.CHNL_CD = T1.CHNL_CD AND X.CO_NO = SL_CO_CD) AS HDQTR_FAX_NO
        , T1.SL_AREA_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-002', T1.SL_AREA_CD) AS SL_AREA_NM
        , T1.SL_TRSP_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-025', T1.SL_TRSP_CD) AS SL_TRSP_NM
        , T1.SL_TRSP_AREA_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-009', T1.SL_TRSP_AREA_CD) AS SL_TRSP_AREA_NM
        , T1.SL_TRSP_TM_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-027', T1.SL_TRSP_TM_CD) AS SL_TRSP_TM_NM
        , T1.SL_TRSP_VEH_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-028', T1.SL_TRSP_VEH_CD) AS SL_TRSP_VEH_NM
        , T1.SL_CO_RLSE_FLG
        , T1.SL_RLSE_FLG
        , T1.SL_NXT_CLZ_FLG
        , T1.SL_RMK
        , dbo.USR_NM_FNC(T1.CHNL_CD, T1.CRE_USR_ID) AS RGST_USR_NM
        , T1.PCK_FLG
        , T1.RCV_PPR_FLG
        , T1.PCK_DEST_PHN_NO
        , T1.PCK_DEST_ADDR
        , T1.PCK_DEST_RMK
        , dbo.FF_SL_ORD_CLZ_FLG(T1.CHNL_CD, T1.SL_RLSE_NO) AS CLZ_FLG
        , CONVERT(VARCHAR(10), T1.NXT_MON_DT, 120) AS NXT_MON_DT
        , T1.ADD_FLG
        , CONVERT(VARCHAR, (MAX(T1.CRE_DT)      OVER (PARTITION BY T1.SL_RLSE_NO)), 121)     AS CRE_DT
        , MAX(T1.CRE_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO) AS CRE_US_ID
        , CONVERT(VARCHAR, (MAX(T1.UPD_DT)      OVER (PARTITION BY T1.SL_RLSE_NO)), 121)     AS UPD_DT
        , MAX(T1.UPD_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO) AS UPD_US_ID
        , (SELECT SUM(ROUND(X.SL_ITM_AMT, 0)) FROM TB_SL_RLSE_DTL AS X WHERE 1=1 AND X.SL_RLSE_NO = T1.SL_RLSE_NO AND X.CHNL_CD = T1.CHNL_CD) AS SL_ITM_AMT
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-011', T2.PAY_TP_CD) AS PAY_TP_NM
        , T1.CHNL_CD
        , CONVERT(VARCHAR, T1.DUE_DT, 23) AS DUE_DT
      FROM TB_SL_RLSE T1
         , TB_CD_CO T2
      WHERE 1=1
        AND T1.CHNL_CD     = #CHNL_CD#
        AND T1.CHNL_CD     = T2.CHNL_CD
        AND T1.SL_RLSE_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
        AND T1.SL_RLSE_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
        AND T1.SL_CO_CD = T2.CO_NO
      <isNotNull property="AREA_CD">
        AND T1.SL_AREA_CD = #AREA_CD#
      </isNotNull>
    </select>

    <!-- Service -->
    <select id="S22111SelectJbNo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'SOP', #SL_AREA_CD#) AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
    </select>

    <update id="S22111UpdateJbNo" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SYS_NO_FMT
        SET 
            LST_FMT_NO  = #SL_RLSE_NO#
          WHERE TBL_ID  = 'SOP'
            AND CHNL_CD = #CHNL_CD#
            AND AREA_CD = #SL_AREA_CD#
    </update>

  <!--
    <select id="S22111SelectLmtCheck" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="string">
      SELECT ISNULL(dbo.FF_SL_CO_LMT_OK(#CHNL_CD#, #CO_CD#, CONVERT(VARCHAR(8), GETDATE(), 112)), '') AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
    </select>
  -->
  <!--
    <statement id="ProcS22111" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_releasedcupdateprc #CHNL_CD#, #SL_RLSE_NO#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>
    -->

    <!-- 출하의뢰등록 마감해제 프로시져
    <statement id="ProcS22111Delete" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_del_bill #CHNL_CD#, #SL_RLSE_NO#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>
    -->
    
    <insert id="S22111InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_SL_RLSE
      (
            CHNL_CD
          , SL_RLSE_NO
          , SL_RLSE_DT
          , SL_CO_CD
          , SL_AREA_CD
          , SL_TRSP_CD
          , SL_TRSP_AREA_CD
          , SL_TRSP_TM_CD
          , SL_TRSP_VEH_CD
          , SL_CO_RLSE_FLG
          , SL_RLSE_FLG
          , SL_NXT_CLZ_FLG
          , SL_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , PCK_FLG
          , PCK_DEST_PHN_NO
          , PCK_DEST_ADDR
          , PCK_DEST_RMK
          , RCV_PPR_FLG
          , NXT_MON_DT
          , DUE_DT
      )
      VALUES
      (
            #CHNL_CD#
          ,	#SL_RLSE_NO#
          , #SL_RLSE_DT#
          , #SL_CO_CD#
          , #SL_AREA_CD#
          , #SL_TRSP_CD#
          , #SL_TRSP_AREA_CD#
          , #SL_TRSP_TM_CD#
          , #SL_TRSP_VEH_CD#
          , #SL_CO_RLSE_FLG#
          , #SL_RLSE_FLG#
          , #SL_NXT_CLZ_FLG#
          , #SL_RMK#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          , #PCK_FLG#
          , #PCK_DEST_PHN_NO#
          , #PCK_DEST_ADDR#
          , #PCK_DEST_RMK#
          , #RCV_PPR_FLG#
          , #NXT_MON_DT#
          , #DUE_DT#
      )
    </insert>

    <!--
    <insert id="S22111InsertCopyMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        INSERT INTO TB_SL_JB_MST (
        JB_NO
        , JB_NM
        , JB_CTRT_DT
        , SL_CO_NO
        , SL_DUE_DT
        , RGST_USR_ID
        , CLZ_FLG
        , JB_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        )
        SELECT #JB_NO#                          AS JB_NO
        , #JB_NM#                          AS JB_NM
        , CONVERT(DATETIME, #JB_CTRT_DT#)  AS JB_CTRT_DT
        , #SL_CO_NO#                       AS SL_CO_NO
        , CONVERT(DATETIME, #SL_DUE_DT#)   AS SL_DUE_DT
        , #RGST_USR_ID#                    AS RGST_USR_ID
        , #CLZ_FLG#                        AS CLZ_FLG
        , #JB_RMK#                         AS JB_RMK
        , #CRE_USR_ID#                     AS CRE_USR_ID
        , GETDATE()                        AS CRE_DT
        , #UPD_USR_ID#                     AS UPD_USR_ID
        , GETDATE()                        AS UPD_DT
        FROM TB_SL_JB_MST
        WHERE JB_NO = #CP_JB_NO#
      </insert>
      -->
    
      <update id="S22111UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_SL_RLSE
          SET
              SL_RLSE_DT       = #SL_RLSE_DT#
            , SL_CO_CD         = #SL_CO_CD#
            , SL_AREA_CD       = #SL_AREA_CD#
            , SL_TRSP_TM_CD    = #SL_TRSP_TM_CD#
            , SL_TRSP_CD       = #SL_TRSP_CD#
            , SL_TRSP_AREA_CD  = #SL_TRSP_AREA_CD#
            , SL_TRSP_VEH_CD   = #SL_TRSP_VEH_CD#
            , SL_CO_RLSE_FLG   = #SL_CO_RLSE_FLG#
            , SL_RLSE_FLG      = #SL_RLSE_FLG#
            , SL_NXT_CLZ_FLG   = #SL_NXT_CLZ_FLG#
            , UPD_USR_ID       = #UPD_USR_ID#
            , UPD_DT           = GETDATE()
            , SL_RMK           = #SL_RMK#
            , PCK_FLG          = #PCK_FLG#
            , PCK_DEST_PHN_NO  = #PCK_DEST_PHN_NO#
            , PCK_DEST_ADDR    = #PCK_DEST_ADDR#
            , PCK_DEST_RMK     = #PCK_DEST_RMK#
            , RCV_PPR_FLG      = #RCV_PPR_FLG#
            , NXT_MON_DT       = #NXT_MON_DT#
            , DUE_DT           = #DUE_DT#
            <isNotNull property="ADD_FLG">
              , ADD_FLG        = #ADD_FLG#
            </isNotNull>
        WHERE SL_RLSE_NO    = #SL_RLSE_NO#
          AND CHNL_CD       = #CHNL_CD#
      </update>

      <delete id="S22111DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        DELETE FROM TB_SL_RLSE
          WHERE SL_RLSE_NO    = #SL_RLSE_NO#
            AND CHNL_CD       = #CHNL_CD#
      </delete>

      <select id="S22111SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_SEQ) AS RN
          , CASE WHEN DC_PRC_VAL  <![CDATA[<>]]>  SL_ITM_PRC_VAL THEN 1 ELSE 0 END AS DC_CHK
          , SL_ITM_CD
          , ITM_NM
          , ITM_SZ_NM
          , CONVERT(BIGINT, ISNULL(SL_ITM_QTY, 0))      AS SL_ITM_QTY
          , SL_ITM_WGT
          , CONVERT(FLOAT, ISNULL(SL_ITM_PRC_VAL, 0.0)) AS SL_ITM_PRC_VAL
          , CONVERT(FLOAT, ISNULL(DC_PRC_VAL, 0.0))     AS DC_PRC_VAL
          , CONVERT(BIGINT, ISNULL(SL_ITM_AMT, 0))      AS SL_ITM_AMT
          , SL_ITM_RMK
          , CHNL_CD
          , N1ST_ITM_GRP_NM
        FROM (
          SELECT T1.SL_ITM_CD
            , T2.ITM_NM
            , T2.ITM_SZ_NM
            , T1.SL_ITM_QTY
            , T1.SL_ITM_PRC_VAL
            , T1.SL_ITM_PRC_DC_VAL AS DC_PRC_VAL
            , T1.SL_ITM_AMT
            , T1.SL_ITM_RMK
            , T1.SL_RLSE_NO
            , T1.SL_RLSE_SEQ
            , ROUND(T1.SL_ITM_QTY * T2.UOM_WGT, 0) AS SL_ITM_WGT
            , T1.CHNL_CD
            , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
          FROM TB_SL_RLSE_DTL T1
            , TB_CD_ITM      T2
          WHERE 1 = 1
            AND T1.SL_RLSE_NO = #SL_RLSE_NO#
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.CHNL_CD    = T2.CHNL_CD
            AND T1.SL_ITM_CD = T2.ITM_CD
            AND T1.SL_ITM_QTY <![CDATA[<>]]>  0
          <isNotNull property="SL_RLSE_SEQ">
            AND T1.SL_RLSE_SEQ = #SL_RLSE_SEQ#
          </isNotNull>
        ) T1
      </select>

    <!--left1List -->
    <select id="S22111SelectSubLeftDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT T2.ITM_GRP_CD      AS N1ST_ITM_GRP_CD
           , T2.ITM_GRP_NM      AS N1ST_ITM_GRP_NM
           , T1.ITM_GRP_CD      AS N2ND_ITM_GRP_CD
           , T1.ITM_GRP_NM      AS N2ND_ITM_GRP_NM
           , #ITM_GRP_CLSS_CD#  AS ITM_GRP_CLSS_CD
           , #CHNL_CD#          AS CHNL_CD
      FROM TB_CD_ITM_GRP  T1
        , (
            SELECT 'A'  AS GBN
                , ITM_GRP_CD
                , ITM_GRP_NM
                , PRNT_ITM_GRP_CD
            FROM TB_CD_ITM_GRP
              WHERE 1 = 1
              AND CHNL_CD         = #CHNL_CD#
              AND PRNT_ITM_GRP_CD = 'T'
              AND ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
          ) T2
      WHERE 1 = 1
          AND T1.CHNL_CD         = #CHNL_CD#
          AND T1.PRNT_ITM_GRP_CD = T2.ITM_GRP_CD
          AND T1.PRNT_ITM_GRP_CD <![CDATA[<>]]> 'T'
          AND ITM_GRP_CLSS_CD    = #ITM_GRP_CLSS_CD#
    </select>
    
    <!--right2List -->
    <select id="S22111SelectSubDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT RN
          , CASE WHEN DC_PRC_VAL  <![CDATA[<>]]>  SL_ITM_PRC_VAL THEN 1 ELSE 0 END AS DC_CHK
          , SL_ITM_CD
          , SL_ITM_CD AS ITM_CD
          , ITM_NM
          , ITM_SZ_NM
          , CONVERT(BIGINT, ISNULL(SL_ITM_QTY, '0')) AS SL_ITM_QTY
          , CONVERT(BIGINT, ROUND(ISNULL(SL_ITM_QTY, 0) * UOM_WGT, 0) ) AS SL_ITM_WGT
          , CONVERT(FLOAT, ISNULL(SL_ITM_PRC_VAL, 0)) AS SL_ITM_PRC_VAL
          , CONVERT(FLOAT, ISNULL(DC_PRC_VAL, 0)) AS DC_PRC_VAL
          , CONVERT(BIGINT, ISNULL(SL_ITM_AMT, 0)) AS  SL_ITM_AMT
          , SL_ITM_RMK
          , UOM_WGT
          , SL_RLSE_SEQ
          , SL_RLSE_NO
          , CHNL_CD
          , CRE_USR_ID
          , UPD_USR_ID
        FROM (
            SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_SEQ) AS RN
                , T1.SL_ITM_CD
                , T2.ITM_NM
                , T2.ITM_SZ_NM
                , T1.SL_ITM_QTY
                , T1.SL_ITM_PRC_VAL
                , T1.SL_ITM_PRC_DC_VAL AS DC_PRC_VAL
                , T1.SL_ITM_AMT
                , T1.SL_ITM_RMK
                , T1.SL_RLSE_SEQ
                , T1.SL_RLSE_NO
                , T2.UOM_WGT
                , T1.CHNL_CD
                , T1.CRE_USR_ID
                , T1.UPD_USR_ID
            FROM TB_SL_RLSE_DTL T1
                , TB_CD_ITM      T2
            WHERE 1 = 1
                AND T1.CHNL_CD    = #CHNL_CD#
                AND T1.CHNL_CD    = T2.CHNL_CD
                AND SL_RLSE_NO    = #SL_RLSE_NO#
                AND T1.SL_ITM_CD  = T2.ITM_CD
                AND T1.SL_ITM_QTY > 0
        ) T1
      </select>

      <!--ViewGridRight1-->
    <select id="S22111SelectSubItmDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT  T1.ITM_CD
            , T1.ITM_NM
            , T1.ITM_SZ_NM
            , T1.STK_A_QTY
            , T1.TMP_A_QTY
            , T1.UOM_NM
            , T1.SL_ITM_PRC_VAL
            , T1.PROD_LOC_NM
            , T1.CHNL_CD
      FROM (
          SELECT T1.ITM_CD
              , T2.ITM_NM
              , T2.ITM_SZ_NM
              , T2.UOM_CD
              , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD)   AS UOM_NM
              , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_QTY END), 0) AS STK_A_QTY
              , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_TMP_QTY END ), 0) AS TMP_A_QTY
              , MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.SL_ITM_PRC_VAL END      ) AS SL_ITM_PRC_VAL
              , MAX(dbo.FF_ITM_LOC_NM(T1.CHNL_CD, '001', T1.ITM_CD))  AS PROD_LOC_NM
              , T1.CHNL_CD
          FROM TB_INVT_DLY_STK  T1
              , TB_CD_ITM     T2
          WHERE 1 = 1
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.ITM_CD     = T2.ITM_CD
            AND T1.CHNL_CD    = T2.CHNL_CD
          <isNotNull property="ITM_GRP_CLSS_CD" >
            AND T2.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
          </isNotNull>
          <isNotNull property="N1ST_ITM_GRP_CD" >
            AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
          </isNotNull>
          <isNotNull property="N2ND_ITM_GRP_CD" >
            AND T2.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
          </isNotNull>
          <isNotNull property="HD_LEN_CD" >
            AND T2.HD_LEN_CD       = #HD_LEN_CD#
          </isNotNull>
          <isNotNull property="ITM_CD" >
            AND T2.ITM_CD           LIKE  #ITM_CD# + '%'
          </isNotNull>
          GROUP BY T1.CHNL_CD
          , T1.ITM_CD
          , T2.ITM_NM
          , T2.ITM_SZ_NM
          , T2.UOM_CD
      ) T1
      ORDER BY T1.ITM_CD
    </select>
    
    <!--
      <select id="S22111SelectQuickDtl" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT MD_PER_QTY
        , PK_PER_QTY
        , #SL_ITM_QTY#
        , dbo.FF_SL_RLSE_PRC(CHNL_CD, #AREA_CD#, ITM_CD, GETDATE())  AS SL_ITM_PRC_VAL
        FROM TB_CD_ITM
        WHERE ITM_CD = #ITM_CD#
        AND CHNL_CD   = #CHNL_CD#
      </select>
      -->

      <insert id="S22111InsertDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
        INSERT INTO TB_SL_RLSE_DTL
        (
          CHNL_CD
        , SL_RLSE_NO
        , SL_RLSE_SEQ
        , SL_ITM_CD
        , SL_ITM_PRC_VAL
        , SL_ITM_PRC_DC_VAL
        , SL_ITM_QTY
        , SL_ITM_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        )
        SELECT T1.CHNL_CD
        , #SL_RLSE_NO#
        , T2.SL_RLSE_SEQ
        , T1.ITM_CD
        , dbo.FF_SL_RLSE_PRC(T1.CHNL_CD, T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT) AS SL_ITM_PRC_VAL
        , dbo.FF_SL_RLSE_PRC(T1.CHNL_CD, T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT) AS SL_ITM_PRC_DC_VAL
        , #SL_ITM_QTY#
        , #SL_ITM_RMK#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
        FROM TB_CD_ITM T1
        , (
        SELECT SL_AREA_CD
        , SL_CO_CD
        , SL_RLSE_DT
        , ISNULL(MAX(T2.SL_RLSE_SEQ) + 1, 1)  AS SL_RLSE_SEQ
        FROM TB_SL_RLSE T1 LEFT OUTER JOIN TB_SL_RLSE_DTL T2
        ON ( T1.SL_RLSE_NO = T2.SL_RLSE_NO
        AND T2.CHNL_CD = #CHNL_CD# )
        WHERE 1 = 1
        AND T1.SL_RLSE_NO = #SL_RLSE_NO#
        AND T1.CHNL_CD    = #CHNL_CD#
        GROUP BY SL_AREA_CD
        , SL_CO_CD
        , SL_RLSE_DT
        ) T2
        WHERE T1.ITM_CD = #ITM_CD#
        AND T1.CHNL_CD = #CHNL_CD#
      </insert>

    <!--
        <insert id="S22111InsertQuickDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
          INSERT INTO TB_SL_RLSE_DTL
          (
          CHNL_CD#
          , SL_RLSE_NO
          , SL_RLSE_SEQ
          , SL_ITM_CD
          , SL_ITM_PRC_VAL
          , SL_ITM_PRC_DC_VAL
          , SL_ITM_QTY
          , SL_ITM_AMT
          , SL_ITM_TAX_AMT
          , SL_ITM_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          )
          SELECT
          T1.CHNL_CD
          , #SL_RLSE_NO#
          , T2.SL_RLSE_SEQ
          , T1.ITM_CD
          , dbo.FF_SL_RLSE_PRC(T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT) AS SL_ITM_PRC_VAL
          , 0
          , #SL_ITM_QTY#
          , ROUND(#SL_ITM_QTY# * dbo.FF_SL_RLSE_PRC(T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT), 0)
          , ROUND(ROUND(#SL_ITM_QTY# * dbo.FF_SL_RLSE_PRC(T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT), 1) * 0.1, 0)
          , #SL_ITM_RMK#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          FROM TB_CD_ITM T1
          , (
          SELECT SL_AREA_CD
          , SL_CO_CD
          , SL_RLSE_DT
          , ISNULL(MAX(T2.SL_RLSE_SEQ) + 1, 1)  AS SL_RLSE_SEQ
          FROM TB_SL_RLSE T1 LEFT OUTER JOIN TB_SL_RLSE_DTL T2
          ON ( T1.SL_RLSE_NO = T2.SL_RLSE_NO
          AND T2.CHNL_CD    = #CHNL_CD#)
          WHERE 1 = 1
          AND T1.SL_RLSE_NO = #SL_RLSE_NO#
          AND T1.CHNL_CD    = #CHNL_CD#
          GROUP BY SL_AREA_CD
          , SL_CO_CD
          , SL_RLSE_DT
          ) T2
          WHERE T1.ITM_CD = #ITM_CD#
          AND T1.CHNL_CD = #CHNL_CD#
        </insert>
        -->

        <update id="S22111UpdateDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
          UPDATE TB_SL_RLSE_DTL
          SET
          UPD_USR_ID        = #UPD_USR_ID#
          , UPD_DT            = GETDATE()
          <isNotNull property="SL_ITM_RMK">
            , SL_ITM_RMK        = #SL_ITM_RMK#
          </isNotNull>
          <isNotNull property="SL_ITM_QTY">
            , SL_ITM_QTY        = #SL_ITM_QTY#
            , SL_ITM_AMT        = ROUND(#SL_ITM_QTY# * CAST(SL_ITM_PRC_DC_VAL AS FLOAT), 0)
            , SL_ITM_TAX_AMT    = ROUND(ROUND(#SL_ITM_QTY# * CAST(SL_ITM_PRC_DC_VAL AS FLOAT), 1) * 0.1, 0)
          </isNotNull>
          <isNotNull property="SL_ITM_AMT">
            , SL_ITM_AMT        = #SL_ITM_AMT#
            , SL_ITM_TAX_AMT    = ROUND(ROUND(SL_ITM_QTY * CAST(SL_ITM_PRC_DC_VAL AS FLOAT), 1) * 0.1, 0)
          </isNotNull>
          <isNotNull property="CHPT_CLZ_FLG">
            , CHPT_CLZ_FLG        = #CHPT_CLZ_FLG#
          </isNotNull>
          <isNotNull property="SL_ITM_PRC_DC_VAL">
            , SL_ITM_PRC_DC_VAL = #SL_ITM_PRC_DC_VAL#
            , SL_ITM_AMT        = ROUND(SL_ITM_QTY * CAST(#SL_ITM_PRC_DC_VAL# AS FLOAT), 0)
            , SL_ITM_TAX_AMT    = ROUND(ROUND(SL_ITM_QTY * CAST(#SL_ITM_PRC_DC_VAL# AS FLOAT), 1) * 0.1, 0)
            , SL_ITM_PRC_DC_RT  = #SL_ITM_PRC_DC_RT#
          </isNotNull>
          WHERE SL_RLSE_NO  = #SL_RLSE_NO#
          AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
          AND CHNL_CD     = #CHNL_CD#

        </update>

      <!--
        <update id="S22111UpdateDtlQty" parameterClass="ModelsLibrary.Sale.SaleVo">
          UPDATE TB_SL_RLSE_DTL
          SET  SL_ITM_QTY       = #SL_ITM_QTY#
          , SL_ITM_RMK       = #SL_ITM_RMK#
          , SL_ITM_AMT       = ROUND(#SL_ITM_QTY# * SL_ITM_PRC_DC_VAL, 0)
          , SL_ITM_TAX_AMT   = ROUND(#SL_ITM_QTY# * SL_ITM_PRC_DC_VAL * 0.1, 0)
          WHERE 1 = 1
          AND SL_RLSE_NO    = #SL_RLSE_NO#
          AND SL_RLSE_SEQ   = #SL_RLSE_SEQ#
          AND CHNL_CD       = #CHNL_CD#
        </update>
        -->

        <!--
        <select id="S22111DeleteDtlCheck" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
          SELECT COUNT(SL_RLSE_NO) AS RN FROM TB_SL_RLSE_MAP WHERE 1=1 AND SL_RLSE_NO = #SL_RLSE_NO# AND CHNL_CD = #CHNL_CD#
        </select>
        -->

        <delete id="S22111DeleteDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
          DELETE FROM TB_SL_RLSE_DTL
          WHERE 1 = 1
          AND CHNL_CD = #CHNL_CD#
          AND SL_RLSE_NO = #SL_RLSE_NO#
          <isNotNull property="SL_RLSE_SEQ">
            AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
          </isNotNull>
        </delete>
    
    <!--
     <select id="S22111SelectSubDtlResult" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT #SL_ITM_QTY#            AS SL_ITM_QTY
        , MD_QTY
        , PK_QTY
        , #SL_ITM_QTY# - ((MD_QTY * MD_PER_QTY) + (PK_QTY * PK_PER_QTY)) AS SL_ITM_RMN_QTY
        , #SL_ITM_QTY# * UOM_WGT AS SL_ITM_WGT
        FROM (
        SELECT CASE WHEN MD_PER_QTY = 0 THEN 0 ELSE FLOOR(#SL_ITM_QTY# / MD_PER_QTY)  END  AS MD_QTY
        , CASE WHEN PK_PER_QTY = 0 THEN 0
        WHEN MD_PER_QTY = 0 THEN 0
        ELSE  FLOOR((#SL_ITM_QTY# - (MD_PER_QTY * FLOOR(#SL_ITM_QTY# / MD_PER_QTY))) / PK_PER_QTY)
        END  AS PK_QTY
        , MD_PER_QTY
        , PK_PER_QTY
        , UOM_WGT
        FROM TB_CD_ITM
        WHERE ITM_CD = #SL_ITM_CD#
        AND CHNL_CD   = #CHNL_CD#
        ) T1
      </select>

      <select id="S2211SelectSubDtlResult2" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT ISNULL( MD_QTY * MD_PER_QTY, 0) + ISNULL(PK_QTY * PK_PER_QTY, 0) + ISNULL(SL_ITM_RMN_QTY, 0) AS SL_ITM_QTY
        , (ISNULL( MD_QTY * MD_PER_QTY, 0) + ISNULL(PK_QTY * PK_PER_QTY, 0) + ISNULL(SL_ITM_RMN_QTY, 0)) * UOM_WGT AS SL_ITM_WGT
        FROM (
        SELECT MD_PER_QTY
        , PK_PER_QTY
        , #MD_QTY# AS MD_QTY
        , ( CASE WHEN PK_PER_QTY = 0 THEN 0 ELSE #PK_QTY# END ) AS PK_QTY
        , #SL_ITM_RMN_QTY# AS SL_ITM_RMN_QTY
        , UOM_WGT
        FROM TB_CD_ITM
        WHERE ITM_CD    = #SL_ITM_CD#
        AND CHNL_CD   = #CHNL_CD#
        ) T1
      </select>
      -->
    
    <!-- 프로시저 -->
    <statement id="ProcS22111" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_releasedcupdateprc #CHNL_CD#, #SL_RLSE_NO#, #CRE_USR_ID#, @RTN OUTPUT
      select @RTN AS R_value
    </statement>
      <!-- S22111 배차 관리-->
    
    
  <!-- S2212 출고처리-->
  <select id="S2212SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
				SELECT  RN 
			, PCK_NM 
			, RLSE_CMD_NO 
			, RLSE_CMD_SEQ
			, SL_TRSP_AREA_CD
			, SL_TRSP_AREA_NM
			, SL_TRSP_TM_CD
			, SL_TRSP_TM_NM  
			, SL_TRSP_CD
			, SL_TRSP_NM
			, SL_TRSP_VEH_CD
			, SL_TRSP_VEH_NM 
			, ITM_KNT   
			, SL_ITM_WGT
			, SL_ITM_AMT
			, RLSE_PRT_FLG  
			, SL_RLSE_NO
			, CLZ_FLG 
      , #CRE_USR_ID# AS CRE_USR_ID
  FROM (
				SELECT  RN 
							, PCK_NM 
							, T1.RLSE_CMD_NO 
							, T1.RLSE_CMD_SEQ
							, SL_TRSP_AREA_CD
							, SL_TRSP_AREA_NM
							, SL_TRSP_TM_CD
							, SL_TRSP_TM_NM  
							, SL_TRSP_CD
							, SL_TRSP_NM
							, SL_TRSP_VEH_CD
							, SL_TRSP_VEH_NM 
							, ITM_KNT   
							, SL_ITM_WGT
							, CONVERT(BIGINT, ISNULL(SL_ITM_AMT, 0))       AS SL_ITM_AMT
							, RLSE_PRT_FLG
							, SL_RLSE_NO
							, dbo.FF_RLSE_CLZ_FLG(#CHNL_CD#, T1.RLSE_CMD_NO, T1.RLSE_CMD_SEQ) AS CLZ_FLG 
				FROM ( 
							SELECT   T1.SL_RLSE_NO
									, T2.RLSE_CMD_NO     
									, T2.RLSE_CMD_SEQ    
									, T1.SL_TRSP_AREA_CD 
									, T1.SL_TRSP_TM_CD
									, T1.SL_TRSP_CD
									, T1.SL_TRSP_VEH_CD
									, dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-009', T1.SL_TRSP_AREA_CD)  AS SL_TRSP_AREA_NM
									, dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-027',  T1.SL_TRSP_TM_CD)   AS SL_TRSP_TM_NM  
									, dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-025',  T1.SL_TRSP_CD)      AS SL_TRSP_NM     
									, dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-028',  T1.SL_TRSP_VEH_CD)  AS SL_TRSP_VEH_NM 
									, T1.SL_RMK
									, ROW_NUMBER() OVER (PARTITION BY  T2.RLSE_CMD_NO, T2.RLSE_CMD_SEQ ORDER BY T2.SL_RLSE_NO, T2.SL_RLSE_SEQ) AS RN 
									, COUNT(*) OVER (PARTITION BY  T2.RLSE_CMD_NO, T2.RLSE_CMD_SEQ ) AS ITM_KNT  
									, SUM(T2.SL_ITM_QTY * T3.UOM_WGT) OVER (PARTITION BY  T2.RLSE_CMD_NO, T2.RLSE_CMD_SEQ ) AS SL_ITM_WGT
									, SUM(ROUND(T2.SL_ITM_AMT, 0)) OVER (PARTITION BY  T2.RLSE_CMD_NO, T2.RLSE_CMD_SEQ ) AS SL_ITM_AMT
									, CASE WHEN T1.PCK_FLG = 'P' THEN '팔레트' 
												 WHEN T1.PCK_FLG = 'R' THEN '인수증'  END PCK_NM
									, MIN(T2.RLSE_PRT_FLG) OVER (PARTITION BY T2.RLSE_CMD_NO, T2.RLSE_CMD_SEQ)  AS RLSE_PRT_FLG
								FROM  TB_SL_RLSE      T1
										, TB_SL_RLSE_DTL  T2
										, TB_CD_ITM       T3
							 WHERE 1 = 1 
								 AND T1.SL_RLSE_NO = T2.SL_RLSE_NO
                 AND T1.CHNL_CD    = T2.CHNL_CD
                 AND T1.CHNL_CD    = #CHNL_CD#                 
								 AND T2.SL_ITM_CD  = T3.ITM_CD
                 AND T2.SL_ITM_QTY <![CDATA[<>]]> 0 
                 AND T1.ADD_FLG        = 'N'
							<isEqual property="RLSE_CMD_NO" compareValue="N"> 
								 AND T2.RLSE_CMD_NO  IS NULL                
							</isEqual>
							<isEqual property="RLSE_CMD_NO" compareValue="Y"> 
								 AND T2.RLSE_CMD_NO  IS NOT NULL            
							</isEqual>
								 AND T1.SL_AREA_CD            = #SL_AREA_CD#  
								 AND T1.SL_RLSE_DT            >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
								 AND T1.SL_RLSE_DT  <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)    
								<isNotNull property="SL_TRSP_AREA_CD">
								 AND T1.SL_TRSP_AREA_CD       = #SL_TRSP_AREA_CD# 
								</isNotNull>
								<isNotNull property="SL_TRSP_TM_CD">
								 AND T1.SL_TRSP_TM_CD         = #SL_TRSP_TM_CD#   
								</isNotNull>
								<isNotNull property="SL_TRSP_CD">
								 AND T1.SL_TRSP_CD            = #SL_TRSP_CD#           
								</isNotNull>
								<isNotNull property="SL_TRSP_VEH_CD">
								 AND T1.SL_TRSP_VEH_CD        = #SL_TRSP_VEH_CD#   
								</isNotNull>
								<isNotNull property="SL_CO_CD">
									AND T1.SL_CO_CD             = #SL_CO_CD#
								</isNotNull>
							 ) T1 
				 WHERE 1 = 1
					 AND RN = 1
                UNION ALL
                SELECT 9            AS RN 
                 , MAX(CASE WHEN T1.PCK_FLG = 'P' THEN '팔레트' 
			 		                  WHEN T1.PCK_FLG = 'R' THEN '인수증' END) PCK_NM
                 , MAX('DO' + SUBSTRING(CONVERT(VARCHAR(8), T1.SL_RLSE_DT, 112), 3, 8))       AS RLSE_CMD_NO
                 , 99           AS RLSE_CMD_SEQ
                 , 'XX'         AS SL_TRSP_AREA_CD
                 , '추가'       AS SL_TRSP_AREA_NM
                 , NULL         AS SL_TRSP_TM_CD
                 , NULL         AS SL_TRSP_TM_NM
                 , NULL         AS SL_TRSP_CD
                 , NULL         AS SL_TRSP_NM
                 , NULL         AS SL_TRSP_VEH_CD
                 , NULL         AS SL_TRSP_VEH_NM
                 , COUNT(*)     AS ITM_KNT
                 , SUM(T2.SL_ITM_QTY * T3.UOM_WGT) AS SL_ITM_WGT
                 , SUM(T2.SL_ITM_AMT)              AS SL_ITM_AMT
                 , MIN(T1.RLSE_PRT_FLG)  AS RLSE_PRT_FLG  
                 , MAX(T1.SL_RLSE_NO)              AS SL_RLSE_NO
                 , MAX(dbo.FF_RLSE_CLZ_FLG_NEW(T1.CHNL_CD, T1.SL_RLSE_NO)) AS CLZ_FLG
              FROM TB_SL_RLSE       T1
                 , TB_SL_RLSE_DTL   T2
                 , TB_CD_ITM        T3
              WHERE 1 = 1
                AND T1.SL_RLSE_NO     = T2.SL_RLSE_NO
                AND T2.SL_ITM_CD      = T3.ITM_CD
                AND T1.ADD_FLG        = 'Y'
                AND T1.SL_AREA_CD            = #SL_AREA_CD#  
								AND T1.SL_RLSE_DT            >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
								AND T1.SL_RLSE_DT  <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)   
    ) T1     
 WHERE 1 = 1 
   AND ITM_KNT > 0 
  ORDER BY T1.SL_TRSP_AREA_CD 
				, T1.RLSE_CMD_NO 
				, T1.RLSE_CMD_SEQ   
		</select>

  <select id="S2212SelectDtlCoCdList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
			SELECT  SL_CO_CD        
						, SL_CO_NM     
						, CO_GRD_CD
						, SUM(SL_ITM_AMT) AS SL_ITM_AMT   
						, CASE WHEN RLSE_FLG_KNT  > 0 THEN 'N' 
									 ELSE 'Y' END AS RLSE_PRT_FLG
			FROM (
							SELECT T1.SL_CO_CD
									 , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS SL_CO_NM 
									 , SUM(CASE WHEN ISNULL(T2.RLSE_PRT_FLG, 'N') = 'Y' THEN 0 ELSE 1 END) OVER (
										 PARTITION BY T1.SL_CO_CD) AS RLSE_FLG_KNT
									 , T1.SL_RLSE_NO
									 , T2.SL_RLSE_SEQ
									 , T2.SL_ITM_QTY
									 , T2.SL_ITM_AMT
									 , dbo.FF_ITM_TP_QTY(T1.CHNL_CD,  T2.SL_ITM_CD , T2.SL_ITM_QTY, 'A') AS MD_QTY
									 , dbo.FF_CD_CO_GRD_NM(T1.CHNL_CD, T1.SL_CO_CD) AS CO_GRD_CD
								FROM TB_SL_RLSE       T1
									 , TB_SL_RLSE_DTL   T2
							 WHERE 1 = 1  
								 AND T1.SL_RLSE_NO      = T2.SL_RLSE_NO
                 AND T1.CHNL_CD         = T2.CHNL_CD
                 AND T1.CHNL_CD         = #CHNL_CD#
                 AND T2.SL_ITM_QTY      <![CDATA[<>]]> 0 
                 AND T1.ADD_FLG         = 'N' 
								 AND T2.RLSE_CMD_NO     = #RLSE_CMD_NO#
								 AND T2.RLSE_CMD_SEQ    = #RLSE_CMD_SEQ#
							) T1
					GROUP BY  SL_CO_CD        
									, SL_CO_NM     
									, CO_GRD_CD  
									, CASE WHEN RLSE_FLG_KNT  > 0 THEN 'N' 
												 ELSE 'Y' END     
        UNION ALL
	        SELECT  SL_CO_CD        
				        , SL_CO_NM     
				        , CO_GRD_CD
				        , SUM(SL_ITM_AMT) AS SL_ITM_AMT   
				        , CASE WHEN RLSE_FLG_KNT  > 0 THEN 'N' 
							         ELSE 'Y' END AS RLSE_PRT_FLG
	        FROM (
					        SELECT T1.SL_CO_CD
							         , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS SL_CO_NM 
							         , SUM(CASE WHEN ISNULL(T2.RLSE_PRT_FLG, 'N') = 'Y' THEN 0 ELSE 1 END) OVER (
								         PARTITION BY T1.SL_CO_CD) AS RLSE_FLG_KNT
							         , T1.SL_RLSE_NO
							         , T2.SL_RLSE_SEQ
							         , T2.SL_ITM_QTY
							         , T2.SL_ITM_AMT
							         , dbo.FF_ITM_TP_QTY( T1.CHNL_CD, T2.SL_ITM_CD , T2.SL_ITM_QTY, 'A') AS MD_QTY
							         , dbo.FF_CD_CO_GRD_NM(T1.CHNL_CD, T1.SL_CO_CD) AS CO_GRD_CD
						        FROM TB_SL_RLSE       T1
							         , TB_SL_RLSE_DTL   T2
					         WHERE 1 = 1
						         AND T1.SL_RLSE_NO      = T2.SL_RLSE_NO
                     AND T1.CHNL_CD         = T2.CHNL_CD
                     AND T1.CHNL_CD         = #CHNL_CD#                     
                     AND T2.SL_ITM_QTY     <![CDATA[<>]]> 0 
                     AND T1.ADD_FLG         = 'Y'
						         AND T2.RLSE_CMD_NO     = #RLSE_CMD_NO#
                     AND T2.RLSE_CMD_SEQ    = #RLSE_CMD_SEQ#
					        ) T1
			        GROUP BY  SL_CO_CD        
							        , SL_CO_NM     
							        , CO_GRD_CD  
							        , CASE WHEN RLSE_FLG_KNT  > 0 THEN 'N' 
										         ELSE 'Y' END     
			        ORDER BY   SL_CO_NM 
		</select>

	<select id="S2212SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
	    SELECT (T2.SL_RLSE_NO
              + ' | 등록 시간 : ' + CONVERT(VARCHAR, (MAX(T2.CRE_DT)      OVER (PARTITION BY T1.SL_RLSE_NO)), 120)
              + ' / ' +   dbo.USR_NM_FNC(T1.CHNL_CD,  MAX(T2.CRE_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO) )
              + ' | 수정 시간 : ' + CONVERT(VARCHAR, (MAX(T2.UPD_DT)      OVER (PARTITION BY T1.SL_RLSE_NO)), 120)
              + ' / ' +  dbo.USR_NM_FNC(T1.CHNL_CD, MAX(T2.UPD_USR_ID)  OVER (PARTITION BY T1.SL_RLSE_NO) ))
              + ' / ' +  MAX(ISNULL(T1.SL_RMK, '')) OVER (PARTITION BY T1.SL_RLSE_NO)  AS GBN
            , T2.SL_RLSE_NO
            , T2.SL_RLSE_SEQ
            , T3.ITM_CD
            , T3.ITM_NM
            , T3.ITM_SZ_NM
            , dbo.FF_ITM_TP_QTY(T1.CHNL_CD, T3.ITM_CD, T2.SL_ITM_QTY, 'A')    AS MD_QTY
            , T2.SL_ITM_QTY
            , T2.SL_ITM_PRC_DC_VAL      
						, T2.SL_ITM_AMT  
						, SL_ITM_RMK  AS SL_RMK
						, T2.RLSE_PRT_FLG 
						, T2.BIL_PRT_FLG
            , ISNULL(T2.SL_ITM_PRC_DC_RT, 0) AS SL_ITM_PRC_DC_RT
            , ISNULL(T2.SL_ITM_PRC_VAL, 0) AS SL_ITM_PRC_VAL
            , T2.SL_ITM_ORI_PRC
            , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM 
					FROM TB_SL_RLSE      T1
						, TB_SL_RLSE_DTL   T2
						, TB_CD_ITM      T3
				WHERE 1 = 1
					AND T1.SL_RLSE_NO      = T2.SL_RLSE_NO
          AND T1.CHNL_CD         = T2.CHNL_CD
          AND T1.CHNL_CD         = #CHNL_CD#
          AND T2.CHNL_CD         = T3.CHNL_CD
					AND T2.SL_ITM_CD       = T3.ITM_CD
          AND T2.SL_ITM_QTY      <![CDATA[<>]]> 0 
					AND T2.RLSE_CMD_NO     = #RLSE_CMD_NO#
					AND T2.RLSE_CMD_SEQ    = #RLSE_CMD_SEQ#
					AND T1.SL_CO_CD        = #SL_CO_CD#
				<isNotNull property="RLSE_PRT_FLG">
					 AND T2.RLSE_PRT_FLG    = #RLSE_PRT_FLG#
				</isNotNull>
		</select>
    
    
    <!-- 프로시저 -->
    <statement id="ProcS2212" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_salebillcreate #CHNL_CD#, #RLSE_CMD_NO#, #RLSE_CMD_SEQ#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>

    <!-- 거래명세서 -->
    <select id="S2212SelectReportList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      WITH BON_TMP AS (
      SELECT 'B'  AS GBN
      , CO_RGST_NO
      , CO_NM
      , PRSD_NM
      , HDQTR_ADDR
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-002', N1ST_BIZ_COND_CD)  AS N1ST_BIZ_COND_NM
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-003', N1ST_BZTP_CD)      AS N1ST_BZTP_NM
      , HDQTR_PHN_NO
      , HDQTR_FAX_NO
      FROM TB_CD_CO
      WHERE 1 = 1
      AND CHNL_CD  = #CHNL_CD#
      AND CO_NO    = (SELECT CLSS_DESC
      FROM TB_SYS_CLSS_CD
      WHERE 1 = 1
      AND CHNL_CD    = #CHNL_CD#
      AND CLSS_CD    = '001'
      AND CLSS_TP_CD = 'S100')
      ), CUST_TMP AS (
      SELECT 'C' AS GBN
      , CO_RGST_NO
      , CO_NM
      , PRSD_NM
      , HDQTR_ADDR
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-002', N1ST_BIZ_COND_CD)  AS N1ST_BIZ_COND_NM
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-003', N1ST_BZTP_CD)      AS N1ST_BZTP_NM
      , HDQTR_PHN_NO
      , HDQTR_FAX_NO
      FROM TB_CD_CO
      WHERE 1 = 1
      AND CHNL_CD = #CHNL_CD#
      <isNotNull property="SL_RLSE_NO">
        AND CO_NO = (SELECT SL_CO_CD FROM TB_SL_RLSE WHERE CHNL_CD = #CHNL_CD# AND SL_RLSE_NO = #SL_RLSE_NO#)
      </isNotNull>
      <isNotNull property="RLSE_CMD_NO">
        AND CO_NO =
        (
        SELECT MAX(SL_CO_CD)
        FROM TB_SL_RLSE        T1
        , TB_SL_RLSE_DTL    T2
        WHERE T2.RLSE_CMD_NO  = #RLSE_CMD_NO#
        AND T2.RLSE_CMD_SEQ = #RLSE_CMD_SEQ#
        AND T1.SL_CO_CD     = #SL_CO_CD#
        AND T1.CHNL_CD = T2.CHNL_CD
        AND T1.CHNL_CD = #CHNL_CD#
        )
      </isNotNull>
      )
      SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_NO) AS RN
      , T3.CO_RGST_NO					AS B_CO_RGST_NO
      , T3.CO_NM              AS B_CO_NM
      , T3.PRSD_NM            AS B_PRSD_NM
      , T3.HDQTR_ADDR         AS B_HDQTR_ADDR
      , T3.N1ST_BIZ_COND_NM   AS B_N1ST_BIZ_COND_NM
      , T3.N1ST_BZTP_NM       AS B_N1ST_BZTP_NM
      , T3.HDQTR_PHN_NO       AS B_HDQTR_PHN_NO
      , T3.HDQTR_FAX_NO       AS B_HDQTR_FAX_NO
      , T4.CO_RGST_NO         AS C_CO_RGST_NO
      , T4.CO_NM              AS C_CO_NM
      , T4.PRSD_NM            AS C_PRSD_NM
      , T4.HDQTR_ADDR         AS C_HDQTR_ADDR
      , T4.N1ST_BIZ_COND_NM   AS C_N1ST_BIZ_COND_NM
      , T4.N1ST_BZTP_NM       AS C_N1ST_BZTP_NM
      , T4.HDQTR_PHN_NO       AS C_HDQTR_PHN_NO
      , T4.HDQTR_FAX_NO       AS C_HDQTR_FAX_NO
      , T1.SL_RMK  AS SL_BIL_RMK
      , T5.ITM_NM
      , T5.ITM_SZ_NM
      , T2.SL_ITM_QTY
      , T2.SL_ITM_PRC_DC_VAL
      , ISNULL(T2.SL_ITM_AMT, 0) AS SL_ITM_AMT
      , ISNULL(T2.SL_ITM_TAX_AMT, 0) AS SL_ITM_TAX_AMT
      , dbo.FF_ITM_TP_QTY(#CHNL_CD#, T5.ITM_CD, T2.SL_ITM_QTY, 'A') AS MD_QTY
      , CONVERT(VARCHAR, GETDATE(), 120)  AS PRN_DT
      , T1.SL_RLSE_NO + '-' + dbo.USR_SGN_NM_FNC(#CHNL_CD#, #CRE_USR_ID#) AS CRE_USR_NM
      , ISNULL(T1.SL_NXT_CLZ_FLG, 'N') AS SL_NXT_CLZ_FLG
      , CONVERT(VARCHAR, T1.NXT_MON_DT, 23) AS NXT_MON_DT
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T5.UOM_CD) AS UOM_NM
      , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T5.ITM_GRP_CLSS_CD, T5.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM 
      FROM TB_SL_RLSE      T1
      , TB_SL_RLSE_DTL  T2
      , BON_TMP        T3
      , CUST_TMP       T4
      , TB_CD_ITM      T5
      WHERE 1 = 1
      and T1.CHNL_CD     = #CHNL_CD#
      AND T1.CHNL_CD     = T2.CHNL_CD
      AND T1.CHNL_CD     = T5.CHNL_CD
      AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
      AND T2.SL_ITM_CD   = T5.ITM_CD
      AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0
      <isNotNull property="SL_RLSE_NO">
        AND T1.SL_RLSE_NO  = #SL_RLSE_NO#
      </isNotNull>

      <isNotNull property="RLSE_CMD_NO">
        AND T2.RLSE_CMD_NO = #RLSE_CMD_NO#
      </isNotNull>
      <isNotNull property="RLSE_CMD_SEQ">
        AND T2.RLSE_CMD_SEQ = #RLSE_CMD_SEQ#
      </isNotNull>
      <isNotNull property="SL_CO_CD">
        AND T1.SL_CO_CD = #SL_CO_CD#
      </isNotNull>
    </select>

    <!-- S2212 출고처리-->

    
    <!-- S2213 출고마감 -->
    <select id="S2213SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT T1.SL_BIL_NO
      , T1.SL_CO_CD
      , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS  SL_CO_NM
      , COUNT(*)  BIL_KNT
      , SUM(T2.SL_ITM_AMT) AS SL_ITM_SUM_AMT
      , T1.PRN_FLG
      , #CRE_USR_ID# AS  CRE_USR_ID
      , T1.CHNL_CD
      FROM TB_SL_BIL      T1
      , TB_SL_BIL_DTL  T2
      WHERE T1.SL_BIL_NO = T2.SL_BIL_NO
      AND T1.CHNL_CD   = T2.CHNL_CD
      AND T1.CHNL_CD   = #CHNL_CD#
      AND T1.SL_BIL_DT >=  CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)
      AND T1.SL_BIL_DT <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
      <isNotNull property="SL_AREA_CD">
        AND T1.SL_AREA_CD = #SL_AREA_CD#
      </isNotNull>
      GROUP BY T1.CHNL_CD
      , T1.SL_BIL_NO
      , T1.SL_CO_CD
      , T1.PRN_FLG
    </select>


    <select id="S2213SelectMstView" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT T1.SL_BIL_NO
      , CONVERT(VARCHAR(10), T1.SL_BIL_DT, 120) AS SL_BIL_DT
      , T1.SL_AREA_CD
      , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-002',  T1.SL_AREA_CD) AS AREA_NM
      , T1.SL_CO_CD
      , T2.CO_NM
      , T1.SL_BIL_RMK
      , dbo.FF_BIL_AMT_VAL(T1.CHNL_CD, T1.SL_BIL_NO, 'A')  AS SL_BIL_AMT
      , dbo.FF_BIL_AMT_VAL(T1.CHNL_CD, T1.SL_BIL_NO, 'B')  AS SL_BIL_TAX_AMT
      , dbo.CD_COMPANY_GRD_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS CO_GRD_CD
      , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-009',  T2.SL_AREA_CD) AS SL_AREA_NM
      , T2.HDQTR_PHN_NO
      , T2.HDQTR_FAX_NO
      , T2.HDQTR_ADDR
      , T1.SL_NXT_CLZ_FLG
      , T1.CLZ_FLG
      , CONVERT(VARCHAR(10), T1.CRE_DT, 120)  AS PRN_DT
      , CONVERT(VARCHAR(10), T1.UPD_DT, 120)  AS UPD_DT
      FROM TB_SL_BIL T1
      LEFT OUTER JOIN TB_SL_BIL_PRN T3 ON
      (
      T1.SL_BIL_NO = T3.SL_BIL_NO
      AND T1.CHNL_CD = T3.CHNL_CD
      )
      , TB_CD_CO  T2
      WHERE T1.SL_CO_CD = T2.CO_NO
      AND T1.CHNL_CD  = #CHNL_CD#
      AND T1.SL_BIL_NO = #SL_BIL_NO#
    </select>


    <select id="S2213SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT T2.SL_BIL_SEQ
      , T2.SL_ITM_CD
      , T3.ITM_NM
      , T3.ITM_SZ_NM
      , dbo.FF_ITM_TP_QTY(T1.CHNL_CD, T2.SL_ITM_CD, T2.SL_ITM_QTY, 'A') AS MD_QTY
      , dbo.FF_ITM_TP_QTY(T1.CHNL_CD, T2.SL_ITM_CD, T2.SL_ITM_QTY, 'B') AS PK_QTY
      , dbo.FF_ITM_TP_QTY(T1.CHNL_CD, T2.SL_ITM_CD, T2.SL_ITM_QTY, 'C') AS RMN_QTY
      , T2.SL_ITM_QTY
      , dbo.FF_PUR_ITM_PRC(T1.CHNL_CD, T2.SL_ITM_CD, T1.SL_BIL_DT)  AS PUR_ITM_PRC
      , T2.SL_ITM_PRC_VAL
      , T2.SL_ITM_PRC_DC_VAL
      , T2.SL_ITM_AMT
      , T2.SL_ITM_TAX_AMT
      , T2.SL_ITM_RMK
      , ISNULL(T2.SL_ITM_PRC_DC_RT, 0) AS SL_ITM_PRC_DC_RT
      FROM TB_SL_BIL      T1
      , TB_SL_BIL_DTL  T2
      , TB_CD_ITM      T3
      WHERE 1 = 1
      AND T1.CHNL_CD = #CHNL_CD#
      AND T1.CHNL_CD   = T2.CHNL_CD
      AND T1.CHNL_CD   = T3.CHNL_CD
      AND T1.SL_BIL_NO = T2.SL_BIL_NO
      AND T2.SL_ITM_CD = T3.ITM_CD
      AND T1.SL_BIL_NO = #SL_BIL_NO#
    </select>
    <!-- S2213 출고마감 -->


    <!-- 수금 관리 -->
    <select id="S2221SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT CLT_BIL_NO
      , CONVERT(VARCHAR, CLT_BIL_DT, 23) AS CLT_BIL_DT
      , AREA_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', AREA_CD) AS AREA_NM
      , CLT_CO_CD
      , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, CLT_CO_CD) AS CLT_CO_NM
      , CLT_USR_NM
      , CLT_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-034', CLT_CD) AS CLT_NM
      , CLT_RMN_AMT
      , CLT_AMT - CLT_RMN_AMT AS CLT_DC_AMT
      , CLT_AMT
      , CLT_DC_RT
      , CLT_BIL_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-035', CLT_BIL_CD) AS CLT_BIL_NM
      , BANK_ACCT_CD
      , BANK_ACCT_NM
      , BIL_TP_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-036', BIL_TP_CD) AS BIL_TP_NM
      , BIL_ACCT_NO
      , CONVERT(VARCHAR, BIL_ST_DT, 23) AS BIL_ST_DT
      , CONVERT(VARCHAR, BIL_END_DT, 23) AS BIL_END_DT
      , BIL_USR_NM
      , BIL_BANK_NM
      , BIL_IN_NO
      , BIL_RMK_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-037', BIL_RMK_CD) AS BIL_RMK_NM
      , BIL_RMK
      , CHNL_CD
      FROM TB_SL_CLT_BIL
      WHERE 1 = 1
      AND CHNL_CD     = #CHNL_CD#
      <isNotNull property="BANK_ACCT_CD">
          AND BANK_ACCT_CD = #BANK_ACCT_CD#
        </isNotNull>
        <isNotNull property="AREA_CD">
          AND AREA_CD = #AREA_CD#
        </isNotNull>
        <isNotNull property="FM_DT">
          AND CLT_BIL_DT >=  CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)
          AND CLT_BIL_DT <![CDATA[ <= ]]>  CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
        </isNotNull>
    </select>

    <select id="S2221SelectCltRmnAmt" resultClass="string">
      SELECT CONVERT(VARCHAR, dbo.FF_SL_CLT_RMN_AMT(#CHNL_CD#, #CLT_CO_CD#)) AS LST_FMT_NO FROM CPY_T WHERE NO = 1
    </select>
    
    <!-- Service -->
    <select id="S2221SelectCltBilNo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'REQ', #AREA_CD#) AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
    </select>

    <update id="S2221UpdateCltBilNo" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SYS_NO_FMT
      SET LST_FMT_NO  = #CLT_BIL_NO#
      WHERE TBL_ID    = 'REQ'
      AND AREA_CD     = #AREA_CD#
      AND CHNL_CD     = #CHNL_CD#
    </update>


    <insert id="S2221InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_SL_CLT_BIL
      (     
        CLT_BIL_NO
      , CLT_BIL_DT
      , AREA_CD
      , CLT_CO_CD
      , CLT_USR_NM
      , CLT_CD
      , CLT_AMT
      , CLT_DC_RT
      , CLT_BIL_CD
      , BANK_ACCT_CD
      , BANK_ACCT_NM
      , BIL_TP_CD
      , BIL_ACCT_NO
      , BIL_ST_DT
      , BIL_END_DT
      , BIL_USR_NM
      , BIL_BANK_NM
      , BIL_IN_NO
      , BIL_RMK_CD
      , BIL_RMK
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
      , CLT_RMN_AMT
      , CHNL_CD
      ) VALUES (
        #CLT_BIL_NO#
      , #CLT_BIL_DT#
      , #AREA_CD#
      , #CLT_CO_CD#
      , #CLT_USR_NM#
      , #CLT_CD#
      , #CLT_AMT#
      , #CLT_DC_RT#
      , #CLT_BIL_CD#
      , #BANK_ACCT_CD#
      , #BANK_ACCT_NM#
      , #BIL_TP_CD#
      , #BIL_ACCT_NO#
      , #BIL_ST_DT#
      , #BIL_END_DT#
      , #BIL_USR_NM#
      , #BIL_BANK_NM#
      , #BIL_IN_NO#
      , #BIL_RMK_CD#
      , #BIL_RMK#
      , #CRE_USR_ID#
      , GETDATE()
      , #UPD_USR_ID#
      , GETDATE()
      , #CLT_RMN_AMT#
      , #CHNL_CD#
      )
    </insert>

    <update id="S2221UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_CLT_BIL
      SET
          CLT_BIL_DT   = #CLT_BIL_DT#
        , AREA_CD      = #AREA_CD#
        , CLT_CO_CD    = #CLT_CO_CD#
        , CLT_USR_NM   = #CLT_USR_NM#
        , CLT_CD       = #CLT_CD#
        , CLT_AMT      = #CLT_AMT#
        , CLT_DC_RT    = #CLT_DC_RT#
        , CLT_BIL_CD   = #CLT_BIL_CD#
        , BANK_ACCT_CD = #BANK_ACCT_CD#
        , BANK_ACCT_NM = #BANK_ACCT_NM#
        , BIL_TP_CD    = #BIL_TP_CD#
        , BIL_ACCT_NO  = #BIL_ACCT_NO#
        , BIL_ST_DT    = #BIL_ST_DT#
        , BIL_END_DT   = #BIL_END_DT#
        , BIL_USR_NM   = #BIL_USR_NM#
        , BIL_BANK_NM  = #BIL_BANK_NM#
        , BIL_IN_NO    = #BIL_IN_NO#
        , BIL_RMK_CD   = #BIL_RMK_CD#
        , BIL_RMK      = #BIL_RMK#
        , UPD_USR_ID   = #UPD_USR_ID#
        , UPD_DT       = GETDATE()
        , CLT_RMN_AMT  = #CLT_RMN_AMT#
      WHERE CLT_BIL_NO = #CLT_BIL_NO#
        AND CHNL_CD = #CHNL_CD#
    </update>

    <delete id="S2221DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE FROM TB_SL_CLT_BIL
        WHERE 1=1
          AND CLT_BIL_NO = #CLT_BIL_NO#
          AND CHNL_CD = #CHNL_CD#
    </delete>
    <!-- 수금 관리 -->


  <!-- 상계 처리 -->
		<select id="S2222SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
			SELECT  CLT_BIL_DELT_NO      
					, CONVERT(VARCHAR, CLT_BIL_DELT_DT, 23) AS CLT_BIL_DELT_DT 
					, AREA_CD
					, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', AREA_CD) AS AREA_NM 
					, CLT_CO_CD
					, dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, CLT_CO_CD) AS CLT_CO_NM
					, CLT_USR_NM
					, CLT_CD
					, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-034', CLT_CD) AS CLT_NM    
          , dbo.FF_SL_CLT_RMN_AMT(#CHNL_CD#, CLT_CO_CD) AS CLT_RMN_AMT
					, CLT_DELT_AMT 
					, CLT_BIL_CD
					, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-035', CLT_BIL_CD) AS CLT_BIL_NM  
					, CLT_DELT_RMK  
					, BIL_IN_NO
          , CHNL_CD
			FROM TB_SL_CLT_DELT_BIL
				WHERE 1 = 1
          AND CHNL_CD = #CHNL_CD#
			<isNotNull property="AREA_CD">
				  AND AREA_CD = #AREA_CD#
			</isNotNull>
			<isNotNull property="FM_DT">
				  AND CLT_BIL_DELT_DT >=  CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)  
				  AND CLT_BIL_DELT_DT <![CDATA[ <= ]]>  CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
			</isNotNull>
		</select>
		
			<!-- Service -->
		<select id="S2222SelectCltBilDeltNo" resultClass="string">
			SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'NEG', #AREA_CD#) AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
		</select>

		<update id="S2222UpdateCltBilDeltNo" parameterClass="ModelsLibrary.Sale.SaleVo">
			UPDATE TB_SYS_NO_FMT
				SET LST_FMT_NO  = #CLT_BIL_DELT_NO#
			 WHERE TBL_ID     = 'NEG'
					AND AREA_CD   = #AREA_CD#
          AND CHNL_CD   = #CHNL_CD#
		</update>
		
		
		<insert id="S2222InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			INSERT INTO TB_SL_CLT_DELT_BIL
			(
					 CLT_BIL_DELT_NO
				 , AREA_CD
				 , CLT_BIL_DELT_DT
				 , CLT_CO_CD
				 , CLT_USR_NM
				 , CLT_CD
				 , CLT_DELT_AMT
				 , CLT_BIL_CD
				 , BIL_IN_NO
				 , CLT_DELT_RMK
				 , CRE_USR_ID
				 , CRE_DT
				 , UPD_USR_ID
				 , UPD_DT
         , CHNL_CD
		 ) VALUES (
					 #CLT_BIL_DELT_NO#
				 , #AREA_CD#
				 , #CLT_BIL_DELT_DT#
				 , #CLT_CO_CD#
				 , #CLT_USR_NM#
				 , #CLT_CD#
				 , #CLT_DELT_AMT#
				 , #CLT_BIL_CD#
				 , #BIL_IN_NO#
				 , #CLT_DELT_RMK#
				 , #CRE_USR_ID#
				 , GETDATE()
				 , #UPD_USR_ID#
				 , GETDATE()
         , #CHNL_CD#
		 )
		</insert>   
		
		<update id="S2222UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
		 UPDATE TB_SL_CLT_DELT_BIL
			 SET
					AREA_CD            = #AREA_CD#
				, CLT_BIL_DELT_DT    = #CLT_BIL_DELT_DT#
				, CLT_CO_CD          = #CLT_CO_CD#
				, CLT_USR_NM         = #CLT_USR_NM#
				, CLT_CD             = #CLT_CD#
				, CLT_DELT_AMT       = #CLT_DELT_AMT#
				, CLT_BIL_CD         = #CLT_BIL_CD#
				, BIL_IN_NO          = #BIL_IN_NO#
				, CLT_DELT_RMK       = #CLT_DELT_RMK#
				, UPD_USR_ID         = #UPD_USR_ID#
				, UPD_DT             = GETDATE()
			WHERE CLT_BIL_DELT_NO = #CLT_BIL_DELT_NO#
         AND CHNL_CD        = #CHNL_CD#
		</update>

		<delete id="S2222DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			DELETE FROM TB_SL_CLT_DELT_BIL
				WHERE 1=1
					AND CLT_BIL_DELT_NO = #CLT_BIL_DELT_NO#
          AND CHNL_CD         = #CHNL_CD#
		</delete>
		  <!-- 상계 처리 -->


    <!-- 세금계산서발행 - 건별(Home Tax) -->
    <select id="S22313SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT '매출'AS GBN
        , T1.SL_CO_CD           AS CO_CD
        , T2.CO_NM
        , SUM(T1.SL_AMT) +  dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(T1.SL_AMT) * 0.1, 0))        AS SL_SUM_AMT
        , 0                     AS SL_DC_AMT
        , SUM(T1.SL_AMT)        AS SL_AMT
        , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(T1.SL_AMT) * 0.1, 0)
        + ISNULL(MAX(dbo.FF_SL_HTAX_ADJ_TAX(#CHNL_CD#, SL_YRMON, T1.SL_CO_CD, T1.BIL_CD)), 0))              AS SL_TAX_AMT
        , MAX(CONVERT(nVARCHAR(10),  dbo.SYS_LAST_DAY(CAST(T1.SL_YRMON + '01' + ' 00:00:00' AS DATETIME)) , 121)) AS CRE_DT
        , MAX(T1.ITM_NM) + CASE WHEN COUNT(T1.SL_BIL_NO) = 1 THEN '' ELSE '외 ' + CAST( COUNT(T1.SL_BIL_NO) - 1 AS VARCHAR) + '건' END SL_BIL_RMK
        , MAX(T1.SL_BIL_NO)        AS SL_BIL_NO
        , MAX(T1.CLZ_FLG)       AS CLZ_FLG
        , MAX(T1.GRP_BIL_NO)    AS GRP_BIL_NO
        , T1.SL_YRMON
      FROM TB_SL_ELTR_BIL T1
          , TB_CD_CO       T2
      WHERE 1 = 1
        AND T1.CHNL_CD  = T2.CHNL_CD
        AND T1.CHNL_CD  = #CHNL_CD#
        AND T1.SL_CO_CD = T2.CO_NO
        AND T1.AREA_CD  = #AREA_CD#
        AND SL_YRMON    = #SL_DC_YRMON#
        AND SL_CLSS_CD  = 'A'
      <isNotNull property="BIL_CD">
        AND T1.BIL_CD   = #BIL_CD#
      </isNotNull>
      <isNotNull property="CLZ_FLG">
        AND T1.CLZ_FLG   = #CLZ_FLG#
      </isNotNull>
      GROUP BY T1.SL_CO_CD
        , T2.CO_NM
        , T1.GRP_BIL_NO
        , SL_CLSS_CD
        , T1.SL_YRMON
      HAVING (SUM(T1.SL_AMT) <![CDATA[ <> ]]> 0)
      UNION ALL
      SELECT '수금할인' AS GBN
          , T1.SL_CO_CD           AS CO_CD
          , T2.CO_NM
          , SUM(T1.SL_AMT) + dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, SUM(T1.SL_TAX_AMT))         AS SL_SUM_AMT
          , 0                     AS SL_DC_AMT
          , SUM(T1.SL_AMT)        AS SL_AMT
          , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, SUM(T1.SL_TAX_AMT))    AS SL_TAX_AMT
          , MAX(CONVERT(nVARCHAR(10),  dbo.SYS_LAST_DAY(CAST(T1.SL_YRMON + '01' + ' 00:00:00' AS DATETIME)) , 121)) AS CRE_DT
          , MAX(T1.ITM_NM) + CASE WHEN COUNT(T1.SL_BIL_NO) = 1 THEN '' ELSE '외 ' + CAST( COUNT(T1.SL_BIL_NO) - 1 AS VARCHAR) + '건' END SL_BIL_RMK
          , MAX(T1.SL_BIL_NO)        AS SL_BIL_NO
          , MAX(T1.CLZ_FLG)       AS CLZ_FLG
          , MAX(T1.GRP_BIL_NO)    AS GRP_BIL_NO
          , T1.SL_YRMON
      FROM TB_SL_ELTR_BIL T1
          , TB_CD_CO       T2
      WHERE 1 = 1
        AND T1.CHNL_CD  = T2.CHNL_CD
        AND T1.CHNL_CD  = #CHNL_CD#
        AND T1.SL_CO_CD = T2.CO_NO
        AND T1.AREA_CD  = #AREA_CD#
        AND SL_YRMON    = #SL_DC_YRMON#
        AND SL_CLSS_CD  = 'B'
      <isNotNull property="BIL_CD">
        AND T1.BIL_CD   = #BIL_CD#
      </isNotNull>
      <isNotNull property="CLZ_FLG">
        AND T1.CLZ_FLG   = #CLZ_FLG#
      </isNotNull>
      GROUP BY T1.SL_CO_CD
          , T2.CO_NM
          , T1.GRP_BIL_NO
          , SL_CLSS_CD
          , T1.SL_BIL_NO
          , T1.SL_YRMON
      HAVING (SUM(T1.SL_AMT) <![CDATA[ <> ]]> 0)
    </select>

    <delete id="S22313DeleteDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE  FROM TB_SL_ELTR_BIL
        WHERE 1 = 1
          AND CHNL_CD    = #CHNL_CD#
          AND SL_YRMON   = #SL_YRMON#
          AND SL_CO_CD   = #CO_CD#
          AND SL_CLSS_CD = #SL_CLSS_CD#
          AND AREA_CD    = #AREA_CD#
          AND BIL_CD     = #BIL_CD#
        <isNotNull property="GRP_BIL_NO">
          AND GRP_BIL_NO = #GRP_BIL_NO#
        </isNotNull>
          AND CLZ_FLG    = 'N'
    </delete>

    <select id="S22313SelectExcelList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      WITH TMP AS (
      SELECT '001'    AS AREA_CD
      , CO_NO   AS SL_CO_CD
      , 'A'    AS SL_CLSS_CD
      , AMT     AS SL_AMT
      , T1.TAX  AS SL_TAX_AMT
      , 1       AS SL_KNT
      , '수금할인' AS ITM_NM
      , '수금할인' AS SL_BIL_RMK
      FROM TB_IF_A T1
      WHERE 1 = 0
      UNION ALL
      SELECT T1.AREA_CD
      , T1.SL_CO_CD
      , T1.SL_CLSS_CD
      , SUM(SL_AMT)        AS SL_AMT
      , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(SL_AMT)  * 0.1, 0))    AS SL_TAX_AMT
      , COUNT(SL_BIL_NO)   AS SL_KNT
      , MAX(ITM_NM)        AS ITM_NM
      , MAX(T1.ITM_NM) + CASE WHEN COUNT(T1.SL_BIL_NO) = 1 THEN ''
      ELSE '외 ' + CAST( COUNT(T1.SL_BIL_NO) - 1 AS VARCHAR) + '건' END SL_BIL_RMK
      FROM TB_SL_ELTR_BIL  T1
      WHERE 1 = 1
      AND T1.CHNL_CD    = #CHNL_CD#
      AND T1.AREA_CD    = #AREA_CD#
      AND T1.SL_YRMON   = #SL_DC_YRMON#
      AND T1.BIL_CD     = #BIL_CD#
      AND T1.SL_CLSS_CD  = 'A'
      <isNotNull property="GRP_BIL_NO">
        AND T1.GRP_BIL_NO  = #GRP_BIL_NO#
      </isNotNull>
      <isNotNull property="CLZ_FLG">
        AND T1.CLZ_FLG   = #CLZ_FLG#
      </isNotNull>
      GROUP BY T1.SL_CO_CD
      , T1.AREA_CD
      , T1.SL_CLSS_CD
      HAVING (SUM(SL_AMT) <![CDATA[ <> ]]> 0 )
      UNION ALL
      SELECT T1.AREA_CD
      , T1.SL_CO_CD
      , T1.SL_CLSS_CD
      , SUM(SL_AMT)        AS SL_AMT
      , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, SUM(SL_TAX_AMT))    AS SL_TAX_AMT
      , COUNT(SL_BIL_NO)   AS SL_KNT
      , MAX(ITM_NM)        AS ITM_NM
      , MAX(T1.ITM_NM) + CASE WHEN COUNT(T1.SL_BIL_NO) = 1 THEN ''
      ELSE '외 ' + CAST( COUNT(T1.SL_BIL_NO) - 1 AS VARCHAR) + '건' END SL_BIL_RMK
      FROM TB_SL_ELTR_BIL  T1
      WHERE 1 = 1
      AND T1.CHNL_CD    = #CHNL_CD#
      AND T1.AREA_CD    = #AREA_CD#
      AND T1.SL_YRMON   = #SL_DC_YRMON#
      AND T1.BIL_CD     = #BIL_CD#
      AND T1.SL_CLSS_CD  = 'B'
      <isNotNull property="GRP_BIL_NO">
        AND T1.GRP_BIL_NO  = #GRP_BIL_NO#
      </isNotNull>
      <isNotNull property="CLZ_FLG">
        AND T1.CLZ_FLG   = #CLZ_FLG#
      </isNotNull>
      GROUP BY T1.SL_CO_CD
      , T1.AREA_CD
      , T1.SL_CLSS_CD
      , T1.SL_BIL_NO
      HAVING (SUM(SL_AMT) <![CDATA[ <> ]]> 0 )
      )
      SELECT    '01'  AS XLS_A
      , CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST( #SL_DC_YRMON#+'01' AS  DATETIME) ), 112)  AS XLS_B
      , dbo.FF_SP_RMV(T2.CO_RGST_NO) AS XLS_C
      , ''            AS XLS_D
      , T2.CO_NM      AS XLS_E
      , T2.PRSD_NM    AS XLS_F
      , T2.HDQTR_ADDR AS XLS_G
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-002', T2.N1ST_BIZ_COND_CD) AS XLS_H
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-003', T2.N1ST_BZTP_CD ) AS XLS_I
      , T2.TAX_MAN_EML AS XLS_J
      , dbo.FF_SP_RMV(T3.CO_RGST_NO) AS XLS_K
      , ''            AS XLS_L
      , T3.CO_NM      AS XLS_M
      , T3.PRSD_NM    AS XLS_N
      , T3.HDQTR_ADDR AS XLS_O
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-002', T3.N1ST_BIZ_COND_CD) AS XLS_P
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-003', T3.N1ST_BZTP_CD )    AS XLS_Q
      , T3.TAX_MAN_EML  AS XLS_R
      , ''              AS XLS_S
      , SL_AMT          AS XLS_T
      , SL_TAX_AMT      AS XLS_U
      , ''              AS XLS_V
      , DATENAME(DD, dbo.SYS_LAST_DAY(CAST( #SL_DC_YRMON#+'01' AS  DATETIME) )) AS XLS_W
      , T1.SL_BIL_RMK   AS XLS_X
      , ''              AS XLS_Y
      , ''              AS XLS_Z
      , ''              AS XLS_AA
      , SL_AMT          AS XLS_AB
      , SL_TAX_AMT      AS XLS_AC
      , ''              AS XLS_AD
      , ''              AS XLS_AE
      , ''              AS XLS_AF
      , ''              AS XLS_AG
      , ''              AS XLS_AH
      , ''              AS XLS_AI
      , ''              AS XLS_AJ
      , ''              AS XLS_AK
      , ''              AS XLS_AL
      , ''              AS XLS_AM
      , ''              AS XLS_AN
      , ''              AS XLS_AO
      , ''              AS XLS_AP
      , ''              AS XLS_AQ
      , ''              AS XLS_AR
      , ''              AS XLS_AS
      , ''              AS XLS_AT
      , ''              AS XLS_AU
      , ''              AS XLS_AV
      , ''              AS XLS_AW
      , ''              AS XLS_AX
      , ''              AS XLS_AY
      , ''              AS XLS_AZ
      , ''              AS XLS_BA
      , ''              AS XLS_BB
      , ''              AS XLS_BC
      , ''              AS XLS_BD
      , ''              AS XLS_BE
      , ''              AS XLS_BF
      , '02'            AS XLS_BG
      FROM TMP              T1
      , TB_CD_CO         T2
      , TB_CD_CO         T3
      WHERE 1 = 1
      AND T2.CHNL_CD    = #CHNL_CD#
      AND T2.CHNL_CD    = T3.CHNL_CD
      AND T1.SL_CO_CD   = T3.CO_NO
      AND T2.CO_NO      = ( SELECT CLSS_DESC
      FROM TB_SYS_CLSS_CD
      WHERE 1 = 1
      AND CHNL_CD    = #CHNL_CD#
      AND CLSS_TP_CD = 'S100'
      AND CLSS_CD    = T1.AREA_CD )
      AND T1.AREA_CD       = T2.AREA_CD
    </select>

    <update id="S22313UpdateExcel" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_ELTR_BIL
          SET CLZ_FLG = #CLZ_FLG#
        WHERE 1 = 1
          AND AREA_CD    = #AREA_CD#
          AND SL_YRMON   = #SL_DC_YRMON#
          AND BIL_CD     = #BIL_CD#
          AND CHNL_CD    = #CHNL_CD#
      <isNotNull property="GRP_BIL_NO">
          AND GRP_BIL_NO  = #GRP_BIL_NO#
      </isNotNull>
    </update>


    <!-- 계산서 생성 - 건별 팝업 조회 (Home Tax) -->
    <select id="S22313SelectBillList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT  CHK_FLG
      , SL_BIL_DT
      , CASE WHEN GBN = 'A' THEN '매출' ELSE '수금할인' END AS GBN
      , SL_BIL_NO
      , SL_AMT
      , dbo.FF_TAX_VAL(#CHNL_CD#, CO_NO, ROUND(SL_AMT * 0.1, 0))  AS  SL_TAX_AMT
      , CASE WHEN GBN = 'B' THEN '수금할인' ELSE ITM_NM +  (CASE WHEN KNT - 1 = 0 THEN '' ELSE ' 외 ' + CAST(KNT - 1 AS VARCHAR) + '건' END) END AS SL_RMK
      , #CHNL_CD#       AS CHNL_CD
      , #AREA_CD#       AS AREA_CD
      , #SL_DC_YRMON#   AS SL_DC_YRMON
      , #CO_CD#         AS CO_CD
      , #CRE_USR_ID#    AS CRE_USR_ID
      FROM (
      SELECT  'Y'                 AS CHK_FLG
      , GBN
      , AREA_NM
      , PAY_TP_NM
      , CO_NO
      , CO_NM
      , SL_BIL_NO
      , SL_BIL_DT
      , SUM(SL_ITM_AMT)     AS SL_AMT
      , SUM(SL_ITM_TAX_AMT) AS SL_TAX_AMT
      , COUNT(ITM_NM)       AS KNT
      , MAX(ITM_NM)         AS ITM_NM
      FROM (
      SELECT 'B' AS GBN
      , T1.SL_AREA_CD    AS AREA_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD)  AS AREA_NM
      , T1.SL_BIL_NO
      , T2.SL_ITM_AMT
      , T2.SL_ITM_TAX_AMT
      , CASE WHEN PAY_TP_CD = '1' THEN '외상' ELSE '현금' END AS PAY_TP_NM
      , T3.CO_NO
      , T3.CO_NM
      , T4.ITM_NM
      , CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121) AS SL_BIL_DT
      FROM TB_SL_BIL      T1
      , TB_SL_BIL_DTL  T2
      , TB_CD_CO       T3
      , TB_CD_ITM   T4
      WHERE 1 = 1
      AND T1.CHNL_CD   = #CHNL_CD#
      AND T1.CHNL_CD   = T2.CHNL_CD
      AND T1.CHNL_CD   = T3.CHNL_CD
      AND T1.CHNL_CD   = T4.CHNL_CD
      AND T1.SL_BIL_NO = T2.SL_BIL_NO
      AND T1.SL_CO_CD  = T3.CO_NO
      AND T2.SL_ITM_CD = T4.ITM_CD
      AND T1.SL_BIL_DT >= CAST(#SL_DC_YRMON#+'01'+ ' 00:00:00' AS DATETIME)
      AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST(#SL_DC_YRMON# + '01' AS DATETIME)), 112) +  ' 23:59:59' AS DATETIME)
      AND T2.CLT_BIL_NO IS NOT NULL
      AND T1.SL_CO_CD  NOT IN ('11030', '15322', '15525', '25276', '20578', '20577', '30001', '30002', '15855')
      AND T1.SL_AREA_CD = #AREA_CD#
      AND T1.SL_CO_CD   = #SL_CO_CD#
      UNION ALL
      SELECT 'A' AS GBN
      , T1.SL_AREA_CD    AS AREA_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD)  AS AREA_NM
      , T1.SL_BIL_NO
      , T2.SL_ITM_AMT
      , T2.SL_ITM_TAX_AMT
      , CASE WHEN PAY_TP_CD = '1' THEN '외상' ELSE '현금' END AS PAY_TP_NM
      , T3.CO_NO
      , T3.CO_NM
      , T4.ITM_NM
      , CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121) AS SL_BIL_DT
      FROM TB_SL_BIL      T1
      , TB_SL_BIL_DTL  T2
      , TB_CD_CO       T3
      , TB_CD_ITM   T4
      WHERE 1 = 1
      AND T1.CHNL_CD   = #CHNL_CD#
      AND T1.CHNL_CD   = T2.CHNL_CD
      AND T1.CHNL_CD   = T3.CHNL_CD
      AND T1.CHNL_CD   = T4.CHNL_CD
      AND T1.SL_BIL_NO = T2.SL_BIL_NO
      AND T1.SL_CO_CD  = T3.CO_NO
      AND T2.SL_ITM_CD = T4.ITM_CD
      AND T1.SL_BIL_DT >= CAST(#SL_DC_YRMON#+'01'+ ' 00:00:00' AS DATETIME)
      AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST(#SL_DC_YRMON# + '01' AS DATETIME)), 112) +  ' 23:59:59' AS DATETIME)
      AND T2.CLT_BIL_NO IS NULL
      AND T1.SL_CO_CD  NOT IN ('11030', '15322', '15525', '25276', '20578', '20577', '30001', '30002', '15855')
      AND T1.SL_AREA_CD = #AREA_CD#
      AND T1.SL_CO_CD   = #SL_CO_CD#
      ) T1
      WHERE NOT EXISTS (SELECT 'X'
      FROM TB_SL_ELTR_BIL X
      WHERE 1 = 1
      AND T1.SL_BIL_NO = X.SL_BIL_NO
      AND X.CHNL_CD    = #CHNL_CD#)
      GROUP BY  AREA_NM
      , PAY_TP_NM
      , CO_NO
      , CO_NM
      , SL_BIL_NO
      , GBN
      , SL_BIL_DT
      ) T1
    </select>

     <!-- 건별(Home Tax) -->
    <statement id="ProcS22313" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_sl_bill_crt #CHNL_CD#, #AREA_CD#, #SL_DC_YRMON# , #CO_CD#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>
    <!-- 세금계산서발행 - 건별(Home Tax) -->


    <!-- 일괄(Home Tax) - 일괄 팝업 조회 (Home Tax) -->
    <select id="S2225SelectBillList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT CHK_FLG
      , AREA_NM
      , PAY_TP_NM
      , CO_NO
      , CO_NM
      , SL_AREA_NM
      , COUNT(SL_BIL_NO) AS BIL_KNT
      , MAX(N1ST_FLG) AS N1ST_FLG
      , MAX(N2ND_FLG) AS N2ND_FLG
      , #CHNL_CD#       AS CHNL_CD
      , #AREA_CD#       AS AREA_CD
      , #SL_DC_YRMON#   AS SL_DC_YRMON
      , #CRE_USR_ID#    AS CRE_USR_ID
      , 'G' + replace(convert(varchar(8), GETDATE(), 112) + convert(varchar(8), GETDATE(), 114), ':','') AS BIL_NO
      FROM (
      SELECT  'Y' AS CHK_FLG
      , AREA_NM
      , PAY_TP_NM
      , CO_NO
      , CO_NM
      , SL_BIL_NO
      , SL_AREA_NM
      , MAX(CASE WHEN GBN = '일반' THEN 'Y' ELSE 'N' END) AS N1ST_FLG
      , MAX(CASE WHEN GBN = '수금할인' THEN 'Y' ELSE 'N' END) AS N2ND_FLG
      FROM (
      SELECT '수금할인' AS GBN
      , T1.SL_AREA_CD    AS AREA_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD)  AS AREA_NM
      , T1.SL_BIL_NO
      , T1.SL_BIL_DT
      , T2.SL_ITM_AMT
      , T2.SL_ITM_TAX_AMT
      , CASE WHEN PAY_TP_CD = '1' THEN '외상' ELSE '현금' END AS PAY_TP_NM
      , T3.CO_NO
      , T3.CO_NM
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', T3.SL_AREA_CD)  AS SL_AREA_NM
      FROM TB_SL_BIL      T1
      , TB_SL_BIL_DTL  T2
      , TB_CD_CO       T3
      WHERE 1 = 1
      AND T1.CHNL_CD    = #CHNL_CD#
      AND T1.CHNL_CD    = T2.CHNL_CD
      AND T1.CHNL_CD    = T3.CHNL_CD
      AND T1.SL_BIL_NO = T2.SL_BIL_NO
      AND T1.SL_CO_CD  = T3.CO_NO
      AND T1.SL_BIL_DT >= CAST(#SL_DC_YRMON#+'01'+ ' 00:00:00' AS DATETIME)
      AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST(#SL_DC_YRMON# + '01' AS DATETIME)), 112) +  ' 23:59:59' AS DATETIME)
      AND T2.CLT_BIL_NO IS NOT NULL
      AND T1.SL_CO_CD  NOT IN ('11030', '15322', '15525', '25276', '20578', '20577', '30001', '30002', '15855')
      AND T1.SL_AREA_CD = #AREA_CD#
      UNION ALL
      SELECT '일반' AS GBN
      , T1.SL_AREA_CD    AS AREA_CD
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD)  AS AREA_NM
      , T1.SL_BIL_NO
      , T1.SL_BIL_DT
      , T2.SL_ITM_AMT
      , T2.SL_ITM_TAX_AMT
      , CASE WHEN PAY_TP_CD = '1' THEN '외상' ELSE '현금' END AS PAY_TP_NM
      , T3.CO_NO
      , T3.CO_NM
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', T3.SL_AREA_CD)  AS SL_AREA_NM
      FROM TB_SL_BIL      T1
      , TB_SL_BIL_DTL  T2
      , TB_CD_CO       T3
      WHERE 1 = 1
      AND T1.CHNL_CD    = #CHNL_CD#
      AND T1.CHNL_CD    = T2.CHNL_CD
      AND T1.CHNL_CD    = T3.CHNL_CD
      AND T1.SL_BIL_NO = T2.SL_BIL_NO
      AND T1.SL_CO_CD  = T3.CO_NO
      AND T1.SL_BIL_DT >= CAST(#SL_DC_YRMON#+'01'+ ' 00:00:00' AS DATETIME)
      AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST(#SL_DC_YRMON# + '01' AS DATETIME)), 112) +  ' 23:59:59' AS DATETIME)
      AND T2.CLT_BIL_NO IS NULL
      AND T1.SL_CO_CD  NOT IN ('11030', '15322', '15525', '25276', '20578', '20577', '30001', '30002', '15855')
      AND T1.SL_AREA_CD = #AREA_CD#
      ) T1
      WHERE NOT EXISTS (SELECT 'X'
      FROM TB_SL_ELTR_BIL X
      WHERE 1 = 1
      AND T1.SL_BIL_NO = X.SL_BIL_NO
      AND X.CHNL_CD    = #CHNL_CD#)
      GROUP BY  AREA_NM
      , PAY_TP_NM
      , CO_NO
      , CO_NM
      , SL_BIL_NO
      , SL_AREA_NM
      ) T1
      GROUP BY CHK_FLG
      , AREA_NM
      , PAY_TP_NM
      , CO_NO
      , CO_NM
      , SL_AREA_NM
    </select>
    
    <!-- 일괄(Home Tax) -->
    <statement id="ProcS2225" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN nVARCHAR(MAX)
      exec @RTN = sp_sl_bill_one_crt #CHNL_CD#, #AREA_CD#, #SL_DC_YRMON#, #BIL_NO#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>

    <select id="S2225SelectBillHistoryList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT CONVERT(VARCHAR(10), T2.SL_BIL_DT, 121)  AS SL_BIL_DT
        , T1.SL_BIL_NO
        , T1.SL_AMT
        , T1.SL_TAX_AMT
        , T1.SL_RMK
        , T1.SL_CO_CD
      FROM TB_SL_ELTR_BIL  T1
        , TB_SL_BIL       T2
      WHERE 1 = 1
        AND T1.CHNL_CD    = #CHNL_CD#
        AND T1.CHNL_CD    = T2.CHNL_CD
        AND T1.SL_BIL_NO  = T2.SL_BIL_NO
        AND AREA_CD       = #AREA_CD#
        AND SL_YRMON      = #SL_DC_YRMON#
        AND T1.SL_CO_CD   = #SL_CO_NO#
    </select>

    <!-- 세금계산서발행 - 일괄(Home Tax) -->


    <!-- 반품 등록 관리 -->
    <select id="S2217SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
       SELECT T1.AREA_CD
					 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.AREA_CD) AS AREA_NM 
					 , T1.SL_BIL_RTN_NO
					 , CONVERT(VARCHAR, T1.SL_BIL_RTN_DT, 23) AS SL_BIL_RTN_DT
					 , T1.SL_CO_CD
					 , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)  AS SL_CO_NM 
					 , T1.SL_ITM_RMK           
           , T1.RTN_AFT_DESC
           , T1.RTN_AFT_A_DESC
           , T1.RTN_AFT_B_DESC
           , T1.RTN_AFT_C_DESC
					 , T1.RTN_APRO_FLG
					 , T1.INV_USR_ID
					 , dbo.USR_NM_FNC(#CHNL_CD#, T1.INV_USR_ID) AS INV_USR_NM
					 , T1.OK_FLG    
					 , T1.SL_USR_ID 
					 , dbo.USR_NM_FNC(#CHNL_CD#, T1.SL_USR_ID) AS SL_USR_NM
           , T1.BIL_NO AS SL_BIL_NO
           , T1.MN_BIL_NO
           , T1.MODI_BIL_NO
           , T1.PS_RLSE_NO
           , T1.MN_RLSE_NO
           , T1.PRT_FLG
           , dbo.FF_SL_RTN_RLSE_NO(#CHNL_CD#, T1.SL_BIL_RTN_NO) AS SL_RLSE_NO
           , T1.CHNL_CD 
				FROM TB_SL_BIL_RTN T1
			 WHERE 1 = 1
          AND T1.CHNL_CD        = #CHNL_CD#
       		AND T1.SL_BIL_RTN_NO LIKE (CASE WHEN #GBN# = 'E' THEN 'E' ELSE 'Q' END) +'%'  
				  AND T1.SL_BIL_RTN_DT >=  CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)  
				  AND T1.SL_BIL_RTN_DT <![CDATA[ <= ]]>  CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
				<isNotNull property="AREA_CD">
					AND T1.AREA_CD   = #AREA_CD#
				</isNotNull>
    </select>

    <!-- Service -->
    <select id="S2217SelectSlBilRtnNo" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, #GBN#, #AREA_CD#) AS SL_BIL_RTN_NO  FROM CPY_T WHERE NO = 1
    </select>

    <update id="S2217UpdateSlBilRtnNo" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SYS_NO_FMT
        SET LST_FMT_NO = #SL_BIL_RTN_NO#
          WHERE TBL_ID    = #GBN#
            AND CHNL_CD  = #CHNL_CD#
            AND AREA_CD  = #AREA_CD#
    </update>

    <insert id="S2217InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_SL_BIL_RTN
      (   
        CHNL_CD
      , AREA_CD
      , SL_BIL_RTN_NO
      , SL_BIL_RTN_DT
      , SL_CO_CD
      , SL_ITM_RMK
      , RTN_APRO_FLG
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
      , RTN_AFT_DESC
      , RTN_AFT_A_DESC
      , RTN_AFT_B_DESC
      , RTN_AFT_C_DESC
      ) VALUES (
        #CHNL_CD#
      , #AREA_CD#
      , #SL_BIL_RTN_NO#
      , #SL_BIL_RTN_DT#
      , #SL_CO_CD#
      , #SL_ITM_RMK#
      , #RTN_APRO_FLG#
      , #CRE_USR_ID#
      , GETDATE()
      , #UPD_USR_ID#
      , GETDATE()
      , #RTN_AFT_DESC#
      , #RTN_AFT_A_DESC#
      , #RTN_AFT_B_DESC#
      , #RTN_AFT_C_DESC#
      )
    </insert>

    <update id="S2217UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_BIL_RTN
      SET
      UPD_USR_ID    = #UPD_USR_ID#
      , UPD_DT        = GETDATE()
      <isNotNull property="SL_CO_CD">
        , SL_CO_CD      = #SL_CO_CD#
      </isNotNull>
      <isNotNull property="SL_ITM_RMK">
        , SL_ITM_RMK    = #SL_ITM_RMK#
      </isNotNull>
      <isNotNull property="SL_USR_ID">
        , SL_USR_ID    = #SL_USR_ID#
      </isNotNull>
      <isNotNull property="INV_USR_ID">
        , INV_USR_ID    = #INV_USR_ID#
      </isNotNull>
      <isNotNull property="RTN_AFT_DESC">
        , RTN_AFT_DESC  = #RTN_AFT_DESC#
      </isNotNull>
      <isNotNull property="RTN_AFT_A_DESC">
        , RTN_AFT_A_DESC  = #RTN_AFT_A_DESC#
      </isNotNull>
      <isNotNull property="RTN_AFT_B_DESC">
        , RTN_AFT_B_DESC  = #RTN_AFT_B_DESC#
      </isNotNull>
      <isNotNull property="RTN_AFT_C_DESC">
        , RTN_AFT_C_DESC  = #RTN_AFT_C_DESC#
      </isNotNull>
      <isNotNull property="SL_BIL_RTN_DT">
        , SL_BIL_RTN_DT  = #SL_BIL_RTN_DT#
      </isNotNull>
      WHERE SL_BIL_RTN_NO     = #SL_BIL_RTN_NO#
        AND AREA_CD           = #AREA_CD#
        AND CHNL_CD           = #CHNL_CD#
    </update>

    <delete id="S2217DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE FROM TB_SL_BIL_RTN
        WHERE SL_BIL_RTN_NO = #SL_BIL_RTN_NO#
          AND AREA_CD         = #AREA_CD#
          AND CHNL_CD         = #CHNL_CD#
    </delete>

    <select id="S2217SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY SL_BIL_NO, T2.SL_BIL_SEQ) AS RN  
				, T1.SL_BIL_RTN_NO   
				, CONVERT(VARCHAR, T1.SL_BIL_RTN_DT, 23) AS SL_BIL_RTN_DT 
				, T1.SL_CO_CD
				, T3.CO_NM     
				, T1.SL_ITM_RMK
				, T2.SL_BIL_RTN_SEQ
				, T2.SL_BIL_NO     
				, T2.SL_BIL_SEQ
				, T2.SL_RTN_CD         
				, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-033', T2.SL_RTN_CD ) AS SL_RTN_NM 
				, T2.SL_BAD_ITM_CD
				, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'Q-002', T2.SL_BAD_ITM_CD)  AS SL_BAD_ITM_NM 
				, T2.SL_RTN_ITM_CD AS ITM_CD
				, T4.ITM_NM       
				, T4.ITM_SZ_NM    
				, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T4.UOM_CD ) AS UOM_NM  
				, T2.SL_RTN_ITM_QTY   
				, dbo.FF_ITM_TP_QTY(#CHNL_CD#, T4.ITM_CD, T2.SL_RTN_ITM_QTY, 'A')  AS MD_QTY   
				, T2.SL_RTN_ITM_RMK 
				, T2.SL_ITM_PRC_DC_VAL * T2.SL_RTN_ITM_QTY AS SL_RTN_ITM_AMT
				, T2.SL_RTN_ITM_TAX_AMT
				, (SELECT CONVERT(VARCHAR, MAX(SL_BIL_DT) , 23)  FROM TB_SL_BIL WHERE CHNL_CD = #CHNL_CD# AND SL_BIL_NO = T2.SL_BIL_NO) AS SL_BIL_DT  
				, SUBSTRING(dbo.FF_ITM_LOC_NM(#CHNL_CD#, T1.AREA_CD, T2.SL_RTN_ITM_CD), 1, 20) AS ITM_LOC_NM
        , T2.SL_ITM_PRC_VAL
        , T2.SL_ITM_DC_RTE
        , T2.SL_ITM_PRC_DC_VAL
        , T2.SL_ITM_PRC_VAL  * T2.SL_RTN_ITM_QTY AS SL_ITM_AMT
        , (SELECT CONVERT(VARCHAR, MAX(SL_BIL_DT) , 121)  FROM TB_SL_BIL WHERE 1 = 1 AND CHNL_CD = #CHNL_CD# AND SL_BIL_NO = T2.SL_BIL_NO) AS SL_BIL_DT_NM  
        , T1.CHNL_CD 
		FROM TB_SL_BIL_RTN      T1
				, TB_SL_BIL_RTN_DTL  T2
				, TB_CD_CO           T3
				, TB_CD_ITM          T4
		WHERE 1 = 1 
      AND T1.CHNL_CD         = #CHNL_CD#
      AND T1.CHNL_CD         = T2.CHNL_CD
      AND T1.CHNL_CD         = T3.CHNL_CD
      AND T1.CHNL_CD         = T4.CHNL_CD
			AND T1.SL_CO_CD        = T3.CO_NO
			AND T2.SL_RTN_ITM_CD   = T4.ITM_CD
			AND T1.SL_BIL_RTN_NO   = T2.SL_BIL_RTN_NO
			AND T1.SL_BIL_RTN_NO   = #SL_BIL_RTN_NO#
    </select>
    <select id="S2217SelectDtlPopupList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
			SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_BIL_NO) AS RN
					 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD) AS SL_AREA_NM
					 , T1.SL_AREA_CD 
					 , SL_CO_CD
					 , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)  AS SL_CO_NM 
					 , CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121) AS SL_BIL_DT_NM
					 , T3.ITM_CD
					 , T3.ITM_NM
					 , T3.ITM_SZ_NM
					 , '300'   AS SL_RTN_CD   
					 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-033', '300')  AS SL_RTN_NM  
					 , ''      AS SL_BAD_ITM_CD   
					 , ''      AS SL_BAD_ITM_NM 
					 , 0   AS SL_RTN_ITM_QTY
           , T2.SL_ITM_QTY AS TMP_ITM_QTY  
					 , T2.SL_ITM_QTY  - dbo.FF_SL_RTN_RMN_QTY(#CHNL_CD#, T2.SL_BIL_NO, T2.SL_BIL_SEQ)  AS SL_ITM_QTY     
					 , ''      AS SL_RTN_ITM_RMK 
					 , T2.SL_BIL_NO	
					 , T2.SL_BIL_SEQ
           , T2.SL_ITM_PRC_DC_VAL AS SL_ITM_PRC_VAL
           , 0.0     AS SL_ITM_DC_RTE
           , T2.SL_ITM_PRC_DC_VAL     
           , 0.0     AS SL_RTN_ITM_AMT
           , T2.SL_ITM_AMT 
           , T1.CHNL_CD 
				FROM TB_SL_BIL      T1
					 , TB_SL_BIL_DTL  T2
					 , TB_CD_ITM      T3
			 WHERE 1 = 1      
         AND T1.CHNL_CD         = #CHNL_CD#
         AND T1.CHNL_CD         = T2.CHNL_CD
         AND T1.CHNL_CD         = T3.CHNL_CD
				 AND T1.SL_BIL_NO = T2.SL_BIL_NO
				 AND T2.SL_ITM_CD = T3.ITM_CD
         AND T1.SL_BIL_CD <![CDATA[ <> ]]> 'R'
         AND T1.SL_CO_CD  = #SL_CO_CD#                                     
				 AND T1.SL_BIL_DT >=  CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)  
				 AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
         AND 0 <![CDATA[ < ]]> T2.SL_ITM_QTY -  dbo.FF_SL_RTN_RMN_QTY(#CHNL_CD#, T2.SL_BIL_NO, T2.SL_BIL_SEQ)
         AND T2.CLT_BIL_NO  IS  NULL
		</select>
    
		
		 <insert id="S2217InsertDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
				 INSERT INTO TB_SL_BIL_RTN_DTL (
              CHNL_CD
					  , SL_BIL_RTN_NO
						, SL_BIL_RTN_SEQ
						, SL_BIL_NO
						, SL_BIL_SEQ
						, SL_RTN_ITM_QTY
						, SL_RTN_CD
						, SL_BAD_ITM_CD
						, SL_RTN_ITM_CD
						, SL_RTN_ITM_RMK
						, CRE_USR_ID
						, CRE_DT
						, UPD_USR_ID
						, UPD_DT
            , SL_ITM_PRC_VAL
            , SL_ITM_DC_RTE
            , SL_ITM_PRC_DC_VAL   
            , SL_RTN_ITM_AMT  
            , SL_ITM_AMT
            , SL_RTN_ITM_TAX_AMT
					) VALUES (
              #CHNL_CD#
						, #SL_BIL_RTN_NO#
						, (SELECT  ISNULL(MAX(SL_BIL_RTN_SEQ), 0) + 1 FROM TB_SL_BIL_RTN_DTL WHERE 1 = 1 AND CHNL_CD = #CHNL_CD# AND SL_BIL_RTN_NO = #SL_BIL_RTN_NO#) 
						, #SL_BIL_NO#
						, #SL_BIL_SEQ#
						, #SL_RTN_ITM_QTY#
						, #SL_RTN_CD#	
						, #SL_BAD_ITM_CD#
						, #SL_RTN_ITM_CD#
						, #SL_RTN_ITM_RMK#
						, #CRE_USR_ID#
						, GETDATE()
						, #UPD_USR_ID#
						, GETDATE()
            , #SL_ITM_PRC_VAL#
            , #SL_ITM_DC_RTE#
            , #SL_ITM_PRC_DC_VAL#   
            , ROUND(#SL_RTN_ITM_QTY# * #SL_ITM_PRC_DC_VAL#, 0)
            , ROUND(#SL_RTN_ITM_QTY# * #SL_ITM_PRC_DC_VAL#, 0)
            , ROUND((#SL_RTN_ITM_QTY# * #SL_ITM_PRC_DC_VAL#) * 0.1, 0)
					)
		</insert>   
		
		<update id="S2217UpdateDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
			UPDATE TB_SL_BIL_RTN_DTL
				SET SL_BIL_NO           = #SL_BIL_NO#
					, SL_BIL_SEQ          = #SL_BIL_SEQ#
					, SL_RTN_ITM_QTY      = #SL_RTN_ITM_QTY#
					, SL_RTN_CD           = #SL_RTN_CD#
					, SL_RTN_ITM_CD       = #SL_RTN_ITM_CD#
					, SL_RTN_ITM_AMT      = ROUND(#SL_RTN_ITM_QTY# * #SL_ITM_PRC_DC_VAL#, 0)
					, SL_RTN_ITM_TAX_AMT  = ROUND((#SL_RTN_ITM_QTY# * #SL_ITM_PRC_DC_VAL#) * 0.1, 0)
					, SL_RTN_ITM_RMK      = #SL_RTN_ITM_RMK#
					, UPD_USR_ID          = #UPD_USR_ID#
					, UPD_DT              = GETDATE()
					, SL_BAD_ITM_CD       = #SL_BAD_ITM_CD#
          , SL_ITM_DC_RTE       = #SL_ITM_DC_RTE#
          , SL_ITM_PRC_DC_VAL   = #SL_ITM_PRC_DC_VAL#
          , SL_ITM_AMT          = ROUND(#SL_RTN_ITM_QTY# * #SL_ITM_PRC_DC_VAL#, 0)
				WHERE 1 = 1
          AND CHNL_CD           = #CHNL_CD#
          AND SL_BIL_RTN_NO     = #SL_BIL_RTN_NO#
					AND SL_BIL_RTN_SEQ    = #SL_BIL_RTN_SEQ#
		</update>

		<delete id="S2217DeleteDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
			DELETE FROM TB_SL_BIL_RTN_DTL
				WHERE 1 = 1
          AND CHNL_CD = #CHNL_CD#
          AND SL_BIL_RTN_NO     = #SL_BIL_RTN_NO#
				<isNotNull property="SL_BIL_RTN_SEQ">
					AND SL_BIL_RTN_SEQ    = #SL_BIL_RTN_SEQ#
				</isNotNull>
		</delete>
		
		 <statement id="ProcS2216Apply" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
				declare @RTN VARCHAR(MAX)
				exec @RTN = sp_saleReturnItem #CHNL_CD#, #SL_BIL_RTN_NO#, #CRE_USR_ID#
				select @RTN AS R_value
			</statement>

      <!-- 반품승인관리 승인해제 프로시져 -->
      <statement id="ProcS2216Delete" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
        declare @RTN VARCHAR(MAX)
        exec @RTN = sp_sale_return_del_prc #CHNL_CD#, #SL_BIL_RTN_NO#, #CRE_USR_ID#
        select @RTN AS R_value
      </statement>


    <!-- 수주현황 -->
		<select id="S2228SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
				 SELECT dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD)  AS AREA_NM     
						 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-025', T1.SL_TRSP_CD) AS SL_TRSP_NM       
						 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', SL_TRSP_AREA_CD) AS SL_TRSP_AREA_NM
						 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-027', SL_TRSP_TM_CD) AS SL_TRSP_TM_NM    
						 , T1.SL_RLSE_NO + '-' + dbo.F_RPAD(CAST( T2.SL_RLSE_SEQ AS VARCHAR), 2, '0') AS SL_RLSE_NO     
						 , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD) AS CO_NM     
						 , CONVERT(VARCHAR, T1.SL_RLSE_DT, 23) AS SL_RLSE_DT
						 , dbo.PUR_N1ST_GRP_NM_FNC(#CHNL_CD#,  T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM  
						 , dbo.PUR_N2ST_GRP_NM_FNC(#CHNL_CD#,  T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD, T3.N2ND_ITM_GRP_CD) AS N2ND_ITM_GRP_NM  
						 , T3.ITM_SZ_NM     
						 , T2.SL_ITM_QTY    
						 , T2.SL_ITM_QTY * T3.UOM_WGT  AS SL_ITM_WGT 
						 , T2.SL_ITM_PRC_VAL        
						 , T2.SL_ITM_PRC_DC_VAL
						 , T2.SL_ITM_AMT
						 , dbo.FF_RLSE_CLZ_FLG(#CHNL_CD#, T2.SL_RLSE_NO, T2.SL_RLSE_SEQ) AS CLZ_FLG  
						 , T3.ITM_CD
             , #CHNL_CD#  AS CHNL_CD             
					FROM TB_SL_RLSE       T1
						 , TB_SL_RLSE_DTL   T2 
						 , TB_CD_ITM        T3
				 WHERE 1 = 1
           AND T1.CHNL_CD     = #CHNL_CD#
           AND T1.CHNL_CD     = T2.CHNL_CD
           AND T1.CHNL_CD     = T3.CHNL_CD
					 AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
					 AND T2.SL_ITM_CD   = T3.ITM_CD
           AND T2.SL_ITM_QTY  > 0 
					<isNotNull property="SL_AREA_CD">
					 AND T1.SL_AREA_CD    = #SL_AREA_CD#
					</isNotNull>
					<isNotNull property="FM_DT">
					 AND T1.SL_RLSE_DT    >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
					 AND T1.SL_RLSE_DT    <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME) 
					</isNotNull>
					<isNotNull property="SL_CO_CD">
					 AND T1.SL_CO_CD  = #SL_CO_CD#
					</isNotNull>
		</select>

    
    
   <!-- 매출-일자별 원장   -->
			<select id="S2229SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        WITH TMP AS (
										SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, #SL_CO_CD#)  AS CO_NM 
												, SUBSTRING(#FM_DT#, 1, 4) + SUBSTRING(#FM_DT#, 5, 2) +'01'           AS SL_YRMON 
												, '(전일마감)'              AS GBN
												, ''                      AS ITM_NM
												, ''                      AS ITM_SZ_NM 
												, 0                       AS ITM_QTY
												, 0                       AS SL_PRC_VAL
												, T1.SL_AMT
												, T1.SL_CLT_AMT 
												, T1.SL_INIT_AMT      AS SL_INIT_AMT
												, ''                      AS SL_RMK 
												, 'A'                     AS ORD_CD
												, 0 AS INIT_COL
                        , ''  AS ITM_CD
										 FROM dbo.ufnGetPrvAmt(#CHNL_CD#, #FM_DT#, #TO_DT#, #SL_CO_CD#) T1
										UNION ALL
										SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
												 , CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121)  AS SL_YYMMDD
												 , CASE WHEN T1.SL_BIL_CD = 'S' THEN '판매출고' 
																WHEN T1.SL_BIL_CD = 'R' THEN '반품'  
                                WHEN T1.SL_BIL_CD = 'P' THEN '단가수정'   END AS GBN
												 , T3.ITM_NM
												 , T3.ITM_SZ_NM
												 , T2.SL_ITM_QTY
												 , T2.SL_ITM_PRC_DC_VAL
												 , T2.SL_ITM_AMT
												 , 0
												 , T2.SL_ITM_AMT 
												 , T2.SL_ITM_RMK
												 , 'B'
												, 0 AS INIT_COL         
                        , T3.ITM_CD
											FROM TB_SL_BIL      T1
												 , TB_SL_BIL_DTL  T2
												 , TB_CD_ITM      T3
											 WHERE 1 = 1
                         AND T1.CHNL_CD     = #CHNL_CD#
                         AND T1.CHNL_CD     = T2.CHNL_CD
                         AND T1.CHNL_CD     = T3.CHNL_CD                       
												 AND T1.SL_BIL_NO   = T2.SL_BIL_NO
												 AND T2.SL_ITM_CD   = T3.ITM_CD
											   <isNotNull property="SL_AREA_CD">
												 AND T1.SL_AREA_CD  = #SL_AREA_CD#
												 </isNotNull>
												<isNotNull property="SL_CO_CD">
													AND T1.SL_CO_CD    = #SL_CO_CD#
												 </isNotNull>
												 AND T1.SL_BIL_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
												 AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
												 AND T2.CLT_BIL_NO  IS NULL
                    UNION ALL                            
                    SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
												 , CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 121)  AS SL_YYMMDD
												 , '출하의뢰' AS GBN
												 , T3.ITM_NM
												 , T3.ITM_SZ_NM
												 , T2.SL_ITM_QTY
												 , T2.SL_ITM_PRC_DC_VAL
												 , T2.SL_ITM_AMT
												 , 0
												 , T2.SL_ITM_AMT 
												 , T2.SL_ITM_RMK
												 , 'B'
												, 0 AS INIT_COL 
                        , T3.ITM_CD
                      FROM TB_SL_RLSE       T1
                         , TB_SL_RLSE_DTL   T2
                         , TB_CD_ITM      T3
                     WHERE 1 = 1
                       AND T1.CHNL_CD     = #CHNL_CD#
                       AND T1.CHNL_CD     = T2.CHNL_CD
                       AND T1.CHNL_CD     = T3.CHNL_CD                     
                       AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                       AND T2.SL_ITM_CD   = T3.ITM_CD
                       AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0 
											   <isNotNull property="SL_AREA_CD">
												 AND T1.SL_AREA_CD  = #SL_AREA_CD#
												 </isNotNull>
												<isNotNull property="SL_CO_CD">
													AND T1.SL_CO_CD    = #SL_CO_CD#
												 </isNotNull>
                       AND T1.SL_RLSE_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                       AND T1.SL_RLSE_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                       AND T1.SL_NXT_CLZ_FLG = 'N' 
                       AND NOT EXISTS (SELECT 'X'
                                         FROM TB_SL_RLSE_MAP Z
                                        WHERE 1 = 1
                                          AND Z.CHNL_CD     = #CHNL_CD#
                                          AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                          AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )                                                
                  UNION ALL
                    SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
												 , CONVERT(VARCHAR(10), T1.NXT_MON_DT, 121)  AS SL_YYMMDD
												 , '이월' AS GBN
												 , T3.ITM_NM
												 , T3.ITM_SZ_NM
												 , T2.SL_ITM_QTY
												 , T2.SL_ITM_PRC_DC_VAL
												 , T2.SL_ITM_AMT
												 , 0
												 , T2.SL_ITM_AMT 
												 , T2.SL_ITM_RMK
												 , 'B'
												, 0 AS INIT_COL 
                        , T3.ITM_CD
                      FROM TB_SL_RLSE       T1
                         , TB_SL_RLSE_DTL   T2
                         , TB_CD_ITM      T3
                     WHERE 1 = 1
                       AND T1.CHNL_CD     = #CHNL_CD#
                       AND T1.CHNL_CD     = T2.CHNL_CD
                       AND T1.CHNL_CD     = T3.CHNL_CD
                       AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                       AND T2.SL_ITM_CD   = T3.ITM_CD
                       AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0 
											   <isNotNull property="SL_AREA_CD">
												 AND T1.SL_AREA_CD  = #SL_AREA_CD#
												 </isNotNull>
												<isNotNull property="SL_CO_CD">
													AND T1.SL_CO_CD    = #SL_CO_CD#
												 </isNotNull>
                       AND T1.NXT_MON_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                       AND T1.NXT_MON_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                       AND T1.SL_NXT_CLZ_FLG = 'Y' 
                       AND NOT EXISTS (SELECT 'X'
                                         FROM TB_SL_RLSE_MAP Z
                                        WHERE 1 = 1
                                          AND Z.CHNL_CD     = #CHNL_CD#
                                          AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                          AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )   
										UNION ALL
										 SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CLT_CO_CD)       AS CO_NM 
													, CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121)  AS SL_YYMMDD
													, CASE WHEN CLT_CD = #SL_AREA_CD# THEN  '수금' ELSE dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-034', CLT_CD) END 
													, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-034', CLT_CD) + 
														CASE WHEN CLT_BIL_CD IS NULL THEN '' ELSE
														'-' + ISNULL(dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-035', CLT_BIL_CD), ' ') END              AS ITM_CD
													, NULL  AS ITM_NM 
													, 0
													, 0 AS CLT_DC_RT
													, 0      
													, CLT_AMT
													, CLT_AMT * - 1 
													, BANK_ACCT_NM
													, 'D'
												, 0 AS INIT_COL          
                        , ''
											 FROM TB_SL_CLT_BIL T1
										 WHERE 1 = 1      
                       AND CHNL_CD = #CHNL_CD#
												 <isNotNull property="SL_AREA_CD">
												 AND T1.AREA_CD      = #SL_AREA_CD#
												 </isNotNull>
												<isNotNull property="SL_CO_CD">
												 AND T1.CLT_CO_CD    = #SL_CO_CD#
												</isNotNull>
												 AND T1.CLT_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
												 AND T1.CLT_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)  
                         AND T1.CLT_CD <![CDATA[ <> ]]> '105'
                    UNION ALL 
                       SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CLT_CO_CD)       AS CO_NM 
                  					, CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121)  AS SL_YYMMDD
                  					, CASE WHEN T1.BIL_RMK_CD = '102' THEN '잡수익' WHEN T1.BIL_RMK_CD = '101' THEN '단위절삭' ELSE  '상계처리' END 
                  					, NULL             AS ITM_CD
                  					, NULL             AS ITM_NM 
                  					, 0
                  					, CLT_DC_RT
                  					, 0      
                            , CASE WHEN T1.BIL_RMK_CD IN ('102', '101') THEN  CLT_AMT - CLT_RMN_AMT 
                                   ELSE CLT_AMT END 
                            , CASE WHEN T1.BIL_RMK_CD IN ('102', '101') THEN  CLT_AMT - CLT_RMN_AMT 
                                   ELSE CLT_AMT * - 1 END 
                  					, T1.BIL_RMK
                  					, 'D'
                  				, 0 AS INIT_COL
                          , ''
                  			 FROM TB_SL_CLT_BIL T1
                  		 WHERE 1 = 1
                         AND CHNL_CD = #CHNL_CD#
												 <isNotNull property="SL_AREA_CD">
												 AND T1.AREA_CD      = #SL_AREA_CD#
												 </isNotNull>
												<isNotNull property="SL_CO_CD">
												 AND T1.CLT_CO_CD    = #SL_CO_CD#
												</isNotNull>
												 AND T1.CLT_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
												 AND T1.CLT_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)  
                         AND T1.BIL_RMK_CD    IN ('101'    , '102',  '105')
										UNION ALL
                       SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CLT_CO_CD)       AS CO_NM 
                  					, CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121)  AS SL_YYMMDD
                  					, CASE WHEN T1.BIL_RMK_CD = '102' THEN '잡수익' ELSE  '차손금' END 
                  					, NULL             AS ITM_CD
                  					, NULL             AS ITM_NM 
                  					, 0
                  					, 0 AS CLT_DC_RT
                  					, 0      
                  					, CLT_AMT - CLT_RMN_AMT 
                  					, CLT_AMT - CLT_RMN_AMT
                  					, T1.BIL_RMK
                  					, 'D'
                  				, 0 AS INIT_COL
                          , ''
                  			 FROM TB_SL_CLT_BIL T1
                  		 WHERE 1 = 1     
                         AND CHNL_CD = #CHNL_CD#
												<isNotNull property="SL_AREA_CD">
												 AND T1.AREA_CD      = #SL_AREA_CD#
												</isNotNull>
												<isNotNull property="SL_CO_CD">
												 AND T1.CLT_CO_CD    = #SL_CO_CD#
												</isNotNull>
												 AND T1.CLT_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
												 AND T1.CLT_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)  
                         AND T1.BIL_RMK_CD    IN ('103' )   
        )
         SELECT RN
							 , CO_NM
							 , SL_YRMON
							 , GBN
							 , ITM_NM
							 , ITM_SZ_NM
							 , SL_RMK
							 , ITM_QTY
							 , SL_PRC
							 , SL_AMT
							 , SL_CLT_AMT
							 , RMN_AMT = SUM(SL_INIT_AMT) OVER (PARTITION BY CO_NM ORDER BY RN)  
               , ITM_CD
               , #CHNL_CD#  AS CHNL_CD             
						FROM (
					SELECT ROW_NUMBER() OVER (PARTITION BY CO_NM ORDER BY SL_YRMON, ORD_CD) AS RN 
							 , SL_YRMON
							 , GBN
							 , SL_RMK         
							 , ITM_NM
							 , ITM_SZ_NM
							 , ITM_QTY
							 , SL_PRC_VAL AS SL_PRC
							 , SL_AMT
							 , SL_CLT_AMT 
							 , SL_INIT_AMT
							 , CO_NM
               , ITM_CD
						FROM (
                  SELECT  CO_NM 
												, SL_YRMON 
												, GBN
												, ITM_NM
												, ITM_SZ_NM 
												, ITM_QTY
												, SL_PRC_VAL
												, SL_AMT
												, SL_CLT_AMT 
												, SL_INIT_AMT
												, SL_RMK 
												, ORD_CD
												, INIT_COL
                        , ITM_CD
                  FROM TMP                         
										UNION ALL
                      SELECT CO_NM
                           , SL_YYMMDD
                           , GBN
		                       , NULL
		                       , NULL
		                       , 0
		                       , 0
                           , SUM(SL_TAX_AMT)
                           , 0
                           , SUM(SL_TAX_AMT)
                           , ''
                           , 'F'
                           , 0  AS INIT_COL  
                           , ''
                        FROM (
                                     SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
										                       , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_BIL_DT) , 121)  AS SL_YYMMDD
										                       , '부가세'   AS GBN
										                       , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0))   AS SL_TAX_AMT
									                      FROM TB_SL_BIL      T1
										                       , TB_SL_BIL_DTL  T2
										                       , TB_CD_ITM      T3
									                       WHERE 1 = 1
                                           AND T1.CHNL_CD     = #CHNL_CD#
                                           AND T1.CHNL_CD     = T2.CHNL_CD
                                           AND T1.CHNL_CD     = T3.CHNL_CD
										                       AND T1.SL_BIL_NO   = T2.SL_BIL_NO
										                       AND T2.SL_ITM_CD   = T3.ITM_CD
										                       <isNotNull property="SL_AREA_CD">
										                       AND T1.SL_AREA_CD  = #SL_AREA_CD#
										                       </isNotNull>
										                      <isNotNull property="SL_CO_CD">
											                      AND T1.SL_CO_CD    = #SL_CO_CD#
										                       </isNotNull>
											                      AND T1.SL_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
											                      AND T1.SL_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)          
										                       AND T2.CLT_BIL_NO  IS NULL                                                           
								                      GROUP BY T1.SL_CO_CD
												                      , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_BIL_DT) , 121)
                                      UNION ALL                                      
                                        SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_CD)       AS CO_NM
                                             , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(CAST(SL_YRMON+ ' 00:00:00' AS DATETIME) ) , 121)  AS SL_YYMMDD
                                             , '부가세'   AS GBN
                                             , SL_TAX_AMT 
                                          FROM TB_SL_TAX_ADJ T1
                                         WHERE 1  = 1
                                           AND T1.CHNL_CD   = #CHNL_CD#
                                           AND T1.SL_YRMON  >= #FM_DT#                                          
                                           AND T1.SL_YRMON  <![CDATA[ <= ]]> #TO_DT#
										                       <isNotNull property="SL_CO_CD">
													                      AND T1.CO_CD    = #SL_CO_CD#
												                   </isNotNull>                                          
                                      UNION ALL        
                                          SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
												                       , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_RLSE_DT) , 121)  AS SL_YYMMDD
												                       , '부가세' AS GBN
												                       , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0)) 
                                            FROM TB_SL_RLSE       T1
                                               , TB_SL_RLSE_DTL   T2
                                               , TB_CD_ITM      T3
                                           WHERE 1 = 1
                                             AND T1.CHNL_CD     = #CHNL_CD#
                                             AND T1.CHNL_CD     = T2.CHNL_CD
                                             AND T1.CHNL_CD     = T3.CHNL_CD
                                             AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                                             AND T2.SL_ITM_CD   = T3.ITM_CD
                                             AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0 
											                       <isNotNull property="SL_AREA_CD">
												                       AND T1.SL_AREA_CD  = #SL_AREA_CD#
												                     </isNotNull> 
												                      <isNotNull property="SL_CO_CD">
													                      AND T1.SL_CO_CD    = #SL_CO_CD#
												                      </isNotNull> 
                                             AND T1.SL_RLSE_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                             AND T1.SL_RLSE_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                                             AND T1.SL_NXT_CLZ_FLG = 'N'
                                             AND NOT EXISTS (SELECT 'X'
                                                               FROM TB_SL_RLSE_MAP Z
                                                              WHERE 1 = 1
                                                                AND Z.CHNL_CD     = #CHNL_CD#
                                                                AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                                                AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )       
                                       GROUP BY T1.SL_CO_CD
												                      , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_RLSE_DT) , 121)
                                              
                                      UNION ALL        
                                          SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
												                       , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.NXT_MON_DT) , 121)  AS SL_YYMMDD
												                       , '부가세' AS GBN
                                               , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0)) 
                                            FROM TB_SL_RLSE       T1
                                               , TB_SL_RLSE_DTL   T2
                                               , TB_CD_ITM      T3
                                           WHERE 1 = 1
                                             AND T1.CHNL_CD     = #CHNL_CD#
                                             AND T1.CHNL_CD     = T2.CHNL_CD
                                             AND T1.CHNL_CD     = T3.CHNL_CD
                                             AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                                             AND T2.SL_ITM_CD   = T3.ITM_CD
                                             AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0 
											                       <isNotNull property="SL_AREA_CD">
												                     AND T1.SL_AREA_CD  = #SL_AREA_CD#
												                      </isNotNull> 
												                     <isNotNull property="SL_CO_CD"> 
													                   AND T1.SL_CO_CD    = #SL_CO_CD#
												                      </isNotNull> 
                                             AND T1.NXT_MON_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                             AND T1.NXT_MON_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                                             AND T1.SL_NXT_CLZ_FLG = 'Y' 
                                             AND NOT EXISTS (SELECT 'X'
                                                               FROM TB_SL_RLSE_MAP Z
                                                              WHERE 1 = 1
                                                                AND Z.CHNL_CD     = #CHNL_CD#
                                                                AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                                                AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )       
                                       GROUP BY T1.SL_CO_CD
												                      , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.NXT_MON_DT) , 121)                                              
                      ) T1  
                      GROUP BY CO_NM
                             , SL_YYMMDD
                             , GBN
								UNION ALL
								SELECT CO_NM
													 , SL_YYMMDD+'-' + '31'
													 , '(월계)' 
													 , ''                      AS ITM_NM
													 , ''                      AS ITM_SZ_NM 
													 , 0                       AS ITM_QTY
													 , 0                       AS SL_PRC_VAL     
													 , SUM(CASE WHEN GBN = 'A' THEN SL_AMT END) AS SL_AMT 
													 , SUM(CASE WHEN GBN = 'B' THEN SL_AMT END) AS CLT_AMT
													 , 0     AS SL_INIT_AMT
													 , ''                      AS SL_RMK 
													 , 'F'                     AS ORD_CD
													, 0 AS INIT_COL    
                          , ''
												FROM (
											SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
													 , SUBSTRING(CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121), 1, 7)  AS SL_YYMMDD
													 , 'A'  AS GBN
													 , SUM(T2.SL_ITM_AMT) +  dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ( ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0) )) AS SL_AMT
												FROM TB_SL_BIL      T1
													 , TB_SL_BIL_DTL  T2
													 , TB_CD_ITM      T3
												 WHERE 1 = 1
                           AND T1.CHNL_CD     = #CHNL_CD#
                           AND T1.CHNL_CD     = T2.CHNL_CD
                           AND T1.CHNL_CD     = T3.CHNL_CD
													 AND T1.SL_BIL_NO   = T2.SL_BIL_NO
													 AND T2.SL_ITM_CD   = T3.ITM_CD
													 <isNotNull property="SL_AREA_CD">
														 AND T1.SL_AREA_CD  = #SL_AREA_CD#
														</isNotNull> 
														<isNotNull property="SL_CO_CD">
															AND T1.SL_CO_CD    = #SL_CO_CD#
														 </isNotNull>
														 AND T1.SL_BIL_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
														 AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
													 AND T2.CLT_BIL_NO  IS NULL
											GROUP BY  T1.SL_CO_CD  
															, SUBSTRING(CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121), 1, 7)
                          UNION ALL
                    SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
													 , SUBSTRING(CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 121), 1, 7)  AS SL_YYMMDD
													 , 'A'  AS GBN
													 , SUM(T2.SL_ITM_AMT) +  dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ( ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0) )) AS SL_AMT
                      FROM TB_SL_RLSE       T1
                         , TB_SL_RLSE_DTL   T2
                         , TB_CD_ITM      T3
                     WHERE 1 = 1
                       AND T1.CHNL_CD     = #CHNL_CD#
                       AND T1.CHNL_CD     = T2.CHNL_CD
                       AND T1.CHNL_CD     = T3.CHNL_CD
                       AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                       AND T2.SL_ITM_CD   = T3.ITM_CD
                       AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0                        
											 <isNotNull property="SL_AREA_CD">
                         AND T1.SL_AREA_CD  = #SL_AREA_CD#
                       </isNotNull>	 
											 	<isNotNull property="SL_CO_CD">
													AND T1.SL_CO_CD    = #SL_CO_CD#
												</isNotNull> 
                       AND T1.SL_RLSE_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                       AND T1.SL_RLSE_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                       AND T1.SL_NXT_CLZ_FLG = 'N'
                       AND NOT EXISTS (SELECT 'X'
                                         FROM TB_SL_RLSE_MAP Z
                                        WHERE 1 = 1
                                          AND Z.CHNL_CD     = #CHNL_CD#
                                          AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                          AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )    
											GROUP BY  T1.SL_CO_CD  
															, SUBSTRING(CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 121), 1, 7)    
                  UNION ALL
                    SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
													 , SUBSTRING(CONVERT(VARCHAR(10), T1.NXT_MON_DT, 121), 1, 7)  AS SL_YYMMDD
													 , 'A'  AS GBN
													 , SUM(T2.SL_ITM_AMT) +  dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ( ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0) )) AS SL_AMT
                      FROM TB_SL_RLSE       T1
                         , TB_SL_RLSE_DTL   T2
                         , TB_CD_ITM      T3
                     WHERE 1 = 1
                       AND T1.CHNL_CD     = #CHNL_CD#
                       AND T1.CHNL_CD     = T2.CHNL_CD
                       AND T1.CHNL_CD     = T3.CHNL_CD
                       AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                       AND T2.SL_ITM_CD   = T3.ITM_CD
                       AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0                        
											 <isNotNull property="SL_AREA_CD">
                         AND T1.SL_AREA_CD  = #SL_AREA_CD#
                       	</isNotNull> 
											 	<isNotNull property="SL_CO_CD">
													AND T1.SL_CO_CD    = #SL_CO_CD#
												 </isNotNull>
                       AND T1.NXT_MON_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                       AND T1.NXT_MON_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                       AND T1.SL_NXT_CLZ_FLG = 'Y'  
                       AND NOT EXISTS (SELECT 'X'
                                         FROM TB_SL_RLSE_MAP Z
                                        WHERE 1 = 1
                                          AND Z.CHNL_CD     = #CHNL_CD#
                                          AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                          AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )    
											GROUP BY  T1.SL_CO_CD  
															, SUBSTRING(CONVERT(VARCHAR(10), T1.NXT_MON_DT, 121), 1, 7)                               
                          UNION ALL                                      
                             SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_CD)       AS CO_NM
                                  , SUBSTRING(CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(CAST(SL_YRMON+ ' 00:00:00' AS DATETIME) ) , 121), 1, 7)  AS SL_YYMMDD
                                  , 'A'  AS GBN
                                  , SL_TAX_AMT 
                              FROM TB_SL_TAX_ADJ T1
                              WHERE 1  = 1
                                AND T1.CHNL_CD    = #CHNL_CD#
                                AND T1.SL_YRMON  >= #FM_DT#                                          
                                AND T1.SL_YRMON  <![CDATA[ <= ]]> #TO_DT#
										            <isNotNull property="SL_CO_CD">
													          AND T1.CO_CD    = #SL_CO_CD#
												        </isNotNull>                             
											UNION ALL
											SELECT CO_NM
													 , SL_YYMMDD
													 , 'B'
													 , SUM(CLT_AMT) AS CLT_AMT
												FROM (
												SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CLT_CO_CD)       AS CO_NM 
															, SUBSTRING(CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121), 1, 7)  AS SL_YYMMDD        
															, CLT_AMT
													 FROM TB_SL_CLT_BIL T1
												 WHERE 1 = 1    
                           AND T1.CHNL_CD = #CHNL_CD#
													  <isNotNull property="SL_AREA_CD">
														 AND T1.AREA_CD      = #SL_AREA_CD#
														</isNotNull>
														<isNotNull property="SL_CO_CD">
														 AND T1.CLT_CO_CD    = #SL_CO_CD#
														</isNotNull>
														 AND T1.CLT_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
														 AND T1.CLT_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
												UNION ALL
												SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
														 , SUBSTRING(CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121), 1, 7)  AS SL_YYMMDD     
														 , (T2.SL_ITM_AMT  + T2.SL_ITM_TAX_AMT) * -1
													FROM TB_SL_BIL      T1
														 , TB_SL_BIL_DTL  T2
														 , TB_CD_ITM      T3
													 WHERE 1 = 1
                           AND T1.CHNL_CD     = #CHNL_CD#
                           AND T1.CHNL_CD     = T2.CHNL_CD
                           AND T1.CHNL_CD     = T3.CHNL_CD
														 AND T1.SL_BIL_NO   = T2.SL_BIL_NO
														 AND T2.SL_ITM_CD   = T3.ITM_CD
														<isNotNull property="SL_AREA_CD">	
															 AND T1.SL_AREA_CD  = #SL_AREA_CD#
														</isNotNull>	 
														<isNotNull property="SL_CO_CD">	
																AND T1.SL_CO_CD    = #SL_CO_CD#
														</isNotNull> 
															 AND T1.SL_BIL_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
															 AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
														 AND T2.CLT_BIL_NO IS NOT NULL                                            
													) T1       
											GROUP BY CO_NM
														 , SL_YYMMDD    
											) T1       
											GROUP BY CO_NM
													 , SL_YYMMDD
											UNION ALL
								SELECT CO_NM
													 , SL_YYMMDD+'-' + '31'
													 , '(누계)' 
													 , ''                      AS ITM_NM
													 , ''                      AS ITM_SZ_NM 
													 , 0                       AS ITM_QTY
													 , 0                       AS SL_PRC_VAL     
													 , SUM(CASE WHEN GBN = 'A' THEN SL_AMT END) AS SL_AMT 
													 , SUM(CASE WHEN GBN = 'B' THEN SL_AMT END) AS CLT_AMT
													 , 0     AS SL_INIT_AMT
													 , ''                      AS SL_RMK 
													 , 'G'                     AS ORD_CD
													, 0 AS INIT_COL     
                          , ''
												FROM (

														SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, CO_CD)  AS CO_NM 
																, SUBSTRING(SL_YRMON, 1, 4) +'-' +SUBSTRING(SL_YRMON, 5, 2)           AS SL_YYMMDD 
																, 'A'            AS GBN
																, T1.SL_INIT_AMT      AS SL_AMT
														 FROM TB_SL_CO_INIT_AMT T1
														WHERE 1 = 1
                            AND T1.CHNL_CD     = #CHNL_CD#
													<isNotNull property="SL_AREA_CD">
														AND T1.AREA_CD = #SL_AREA_CD#
													</isNotNull>
														AND SL_YRMON   = SUBSTRING(#FM_DT#, 1, 6)
													<isNotNull property="SL_CO_CD">
														AND CO_CD      = #SL_CO_CD#
													</isNotNull>
                      UNION ALL                            
											SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
													 , SUBSTRING(CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121), 1, 7)  AS SL_YYMMDD
													 , 'A'  AS GBN
													 , SUM(T2.SL_ITM_AMT) +  dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ( ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0) )) AS SL_AMT
												FROM TB_SL_BIL      T1
													 , TB_SL_BIL_DTL  T2
													 , TB_CD_ITM      T3
												 WHERE 1 = 1
                           AND T1.CHNL_CD     = #CHNL_CD#
                           AND T1.CHNL_CD     = T2.CHNL_CD
                           AND T1.CHNL_CD     = T3.CHNL_CD
													 AND T1.SL_BIL_NO   = T2.SL_BIL_NO
													 AND T2.SL_ITM_CD   = T3.ITM_CD
													<isNotNull property="SL_AREA_CD">
														 AND T1.SL_AREA_CD  = #SL_AREA_CD#
													</isNotNull>	 
													<isNotNull property="SL_CO_CD">	
															AND T1.SL_CO_CD    = #SL_CO_CD#
													</isNotNull> 
														 AND T1.SL_BIL_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
														 AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
													   AND T2.CLT_BIL_NO  IS NULL
											GROUP BY  T1.SL_CO_CD  
															, SUBSTRING(CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121), 1, 7)
                          UNION ALL                                      
                             SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_CD)       AS CO_NM
                                  , SUBSTRING(CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(CAST(SL_YRMON+ ' 00:00:00' AS DATETIME) ) , 121), 1, 7)  AS SL_YYMMDD
                                  , 'A'  AS GBN
                                  , SL_TAX_AMT 
                              FROM TB_SL_TAX_ADJ T1
                              WHERE 1  = 1
                                AND T1.CHNL_CD     = #CHNL_CD#
                                AND T1.SL_YRMON  >= #FM_DT#                                          
                                AND T1.SL_YRMON  <![CDATA[ <= ]]> #TO_DT#
										          <isNotNull property="SL_CO_CD">
													          AND T1.CO_CD    = #SL_CO_CD#
												       </isNotNull>                               
											UNION ALL
											SELECT CO_NM
													 , SL_YYMMDD
													 , 'B'
													 , SUM(CLT_AMT) AS CLT_AMT
												FROM (
												SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CLT_CO_CD)       AS CO_NM 
															, SUBSTRING(CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121), 1, 7)  AS SL_YYMMDD        
															, CLT_AMT
													 FROM TB_SL_CLT_BIL T1
												 WHERE 1 = 1             
                           AND T1.CHNL_CD     = #CHNL_CD#
													   <isNotNull property="SL_AREA_CD">
														 AND T1.AREA_CD      = #SL_AREA_CD#
														</isNotNull>
														<isNotNull property="SL_CO_CD">
														 AND T1.CLT_CO_CD    = #SL_CO_CD#
														</isNotNull>
														 AND T1.CLT_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
														 AND T1.CLT_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
												UNION ALL
												SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
														 , SUBSTRING(CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121), 1, 7)  AS SL_YYMMDD     
														 , (T2.SL_ITM_AMT  + T2.SL_ITM_TAX_AMT) * -1
													FROM TB_SL_BIL      T1
														 , TB_SL_BIL_DTL  T2
														 , TB_CD_ITM      T3
													 WHERE 1 = 1
                             AND T1.CHNL_CD     = #CHNL_CD#
                             AND T1.CHNL_CD     = T2.CHNL_CD
                             AND T1.CHNL_CD     = T3.CHNL_CD
														 AND T1.SL_BIL_NO   = T2.SL_BIL_NO
														 AND T2.SL_ITM_CD   = T3.ITM_CD
															<isNotNull property="SL_AREA_CD">
															 AND T1.SL_AREA_CD  = #SL_AREA_CD#
															 </isNotNull>
															<isNotNull property="SL_CO_CD">
																AND T1.SL_CO_CD    = #SL_CO_CD#
															 </isNotNull>
															 AND T1.SL_BIL_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
															 AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
														 AND T2.CLT_BIL_NO IS NOT NULL                                            
													) T1       
											GROUP BY CO_NM
														 , SL_YYMMDD    
											) T1       
											GROUP BY CO_NM
													 , SL_YYMMDD
						) T1       
					) T1    
			</select>
    
    
    <!-- S22122 외상매출원장 -->
		<select id="S22122SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
                  WITH TMP AS (
                          SELECT  SL_YYMMDD
                                , GBN
                                , ISNULL(SL_AMT, 0) AS SL_AMT
                                , dbo.FF_TAX_VAL(#CHNL_CD#, #SL_CO_CD#,  ISNULL(SL_TAX_AMT , 0)) AS SL_TAX_AMT
                                , ISNULL(SL_CLT_AMT , 0) AS SL_CLT_AMT 
                                , SL_BIL_NO
                                , RMN_AMT = SUM(SL_AMT - SL_CLT_AMT) OVER (PARTITION BY NULL ORDER BY RN)  
                                , SL_BIL_RMK
                            FROM (
                            SELECT SL_YYMMDD
                                , GBN
                                , SL_AMT
                                , SL_TAX_AMT
                                , SL_CLT_AMT      
                                , RMN_AMT
                                , ORD_CD
                                , SL_BIL_NO
                                , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY SL_YYMMDD, GBN , SL_BIL_NO) AS RN
                                , SL_BIL_RMK
                              FROM (
		                           SELECT SUBSTRING(SL_YRMON, 1, 4) + SUBSTRING(SL_YRMON, 5, 2) +'01'           AS SL_YYMMDD                     
												            , 'A1이월'             AS GBN
												            , T1.SL_INIT_AMT      AS SL_AMT
                                    , 0                   AS SL_TAX_AMT
                                    , 0                   AS SL_CLT_AMT
												            , 'A'                 AS ORD_CD
                                    , T1.SL_INIT_AMT      AS RMN_AMT												
												            , NULL                AS SL_BIL_NO 
												            , NULL                AS SL_BIL_RMK                         
										             FROM TB_SL_CO_INIT_AMT T1
										            WHERE 1 = 1
                                  AND T1.CHNL_CD     = #CHNL_CD#
														            AND T1.AREA_CD = #SL_AREA_CD#
														            AND SL_YRMON   = SUBSTRING(#FM_DT#, 1, 6)
														            AND CO_CD      = #SL_CO_CD#
										            UNION ALL
										            SELECT CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121)  AS SL_YYMMDD                    
												             , CASE WHEN T1.SL_BIL_CD = 'S' THEN 'B1판매' 
																            WHEN T1.SL_BIL_CD = 'R' THEN 'B2반품'  
                                            WHEN T1.SL_BIL_CD = 'P' THEN 'B3단가수정'   END AS GBN
                                     , SUM(T2.SL_ITM_AMT)  
                                     , 0
                                     , 0
												             , 'B'
                                     , SUM(T2.SL_ITM_AMT)  
                                     , T1.SL_BIL_NO
                                     , T1.SL_BIL_RMK
											            FROM TB_SL_BIL      T1
												             , TB_SL_BIL_DTL  T2
												             , TB_CD_ITM      T3
											             WHERE 1 = 1
                                     AND T1.CHNL_CD     = #CHNL_CD#
                                     AND T1.CHNL_CD     = T2.CHNL_CD
                                     AND T1.CHNL_CD     = T3.CHNL_CD
												             AND T1.SL_BIL_NO   = T2.SL_BIL_NO
												             AND T2.SL_ITM_CD   = T3.ITM_CD
												             AND T1.SL_AREA_CD  = #SL_AREA_CD#
													            AND T1.SL_CO_CD    = #SL_CO_CD#
												             AND T1.SL_BIL_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
												             AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
												             AND T2.CLT_BIL_NO  IS NULL
                                GROUP BY CONVERT(VARCHAR(10), T1.SL_BIL_DT, 121)  
  												             , CASE WHEN T1.SL_BIL_CD = 'S' THEN 'B1판매' 
  																            WHEN T1.SL_BIL_CD = 'R' THEN 'B2반품'  
                                              WHEN T1.SL_BIL_CD = 'P' THEN 'B3단가수정'   END 
                                       , T1.SL_BIL_NO
                                       , T1.SL_BIL_RMK   
                                UNION ALL     
                                SELECT CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 121)  AS SL_YYMMDD
												             , 'B1주문' AS GBN
                                     , SUM(T2.SL_ITM_AMT)  
                                     , 0
                                     , 0
												             , 'B'
                                     , SUM(T2.SL_ITM_AMT)  
                                     , T1.SL_RLSE_NO
                                     , T1.SL_RMK
                                  FROM TB_SL_RLSE       T1
                                     , TB_SL_RLSE_DTL   T2
                                     , TB_CD_ITM      T3
                                 WHERE 1 = 1
                                   AND T1.CHNL_CD     = #CHNL_CD#
                                   AND T1.CHNL_CD     = T2.CHNL_CD
                                   AND T1.CHNL_CD     = T3.CHNL_CD
                                   AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                                   AND T2.SL_ITM_CD   = T3.ITM_CD
                                   AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0					 
											             AND T1.SL_AREA_CD  = #SL_AREA_CD#	
											             AND T1.SL_CO_CD    = #SL_CO_CD#												 
                                   AND T1.SL_RLSE_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                   AND T1.SL_RLSE_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                                   AND NOT EXISTS (SELECT 'X'
                                                     FROM TB_SL_RLSE_MAP Z
                                                    WHERE 1 = 1
                                                      AND Z.CHNL_CD     = #CHNL_CD#
                                                      AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                                      AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )                         
                                GROUP BY CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 121)                                          
                                       , T1.SL_RLSE_NO
                                       , T1.SL_RMK      
										            UNION ALL
										             SELECT CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121)  AS SL_YYMMDD
													            , CASE WHEN T1.CLT_CD = '105' AND T1.BIL_RMK_CD = '105' THEN    'C1상계처리'
                                             ELSE 'C1수금' END
													            , 0
													            , 0                                
													            , CLT_AMT 
                                      , 'C'
													            , CLT_AMT * -1
                                      , T1.CLT_BIL_NO
                                      , BANK_ACCT_NM
											             FROM TB_SL_CLT_BIL T1
										             WHERE 1 = 1     
                                  AND T1.CHNL_CD      = #CHNL_CD#
											            AND T1.AREA_CD      = #SL_AREA_CD#
											            AND T1.CLT_CO_CD    = #SL_CO_CD#
											            AND T1.CLT_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
											            AND T1.CLT_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
                                UNION ALL 
                                   SELECT CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121)  AS SL_YYMMDD
  													            , CASE WHEN T1.BIL_RMK_CD = '101' THEN 'D1단위절삭'
                                               WHEN T1.BIL_RMK_CD = '103' THEN 'D1차손금' END AS BIL_RMK_CD
  													            , 0
  													            , 0
                  					            , CLT_RMN_AMT - CLT_AMT  
                                        , 'D'
                  					            , CLT_AMT - CLT_RMN_AMT
                                        , T1.CLT_BIL_NO
                                        , T1.BIL_RMK
                  			             FROM TB_SL_CLT_BIL T1
                  		             WHERE 1 = 1  
                                     AND T1.CHNL_CD     = #CHNL_CD#
												             AND T1.AREA_CD      = #SL_AREA_CD#
												             AND T1.CLT_CO_CD    = #SL_CO_CD#
												             AND T1.CLT_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
												             AND T1.CLT_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)  
                                     AND T1.BIL_RMK_CD    IN ('101', '103'  )                 
										            UNION ALL
                                  SELECT SL_YYMMDD
                                       , 'E1부가세'
		                                   , 0
		                                   , SUM(SL_TAX_AMT)                           
                                       , 0
                                       , 'E'
                                       , 0
                                       , ''
                                       , ''
                                    FROM (
                                                 SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
										                                   , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_BIL_DT) , 121)  AS SL_YYMMDD
										                                   , '부가세'   AS GBN
										                                   , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0))   AS SL_TAX_AMT         
									                                  FROM TB_SL_BIL      T1
										                                   , TB_SL_BIL_DTL  T2
										                                   , TB_CD_ITM      T3
									                                   WHERE 1 = 1
                                                       AND T1.CHNL_CD     = #CHNL_CD#
                                                       AND T1.CHNL_CD     = T2.CHNL_CD
                                                       AND T1.CHNL_CD     = T3.CHNL_CD
										                                   AND T1.SL_BIL_NO   = T2.SL_BIL_NO
										                                   AND T2.SL_ITM_CD   = T3.ITM_CD
										                                   AND T1.SL_AREA_CD  = #SL_AREA_CD#
											                                 AND T1.SL_CO_CD    = #SL_CO_CD#
											                                 AND T1.SL_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
											                                 AND T1.SL_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)          
										                                   AND T2.CLT_BIL_NO  IS NULL                                                       
								                                  GROUP BY T1.SL_CO_CD
												                                  , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_BIL_DT) , 121)
                                                      UNION ALL
                                                      SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_CD)       AS CO_NM
                                                           , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(CAST(SL_YRMON+ ' 00:00:00' AS DATETIME) ) , 121)  AS SL_YYMMDD
                                                           , '부가세'   AS GBN
                                                           , SL_TAX_AMT 
                                                        FROM TB_SL_TAX_ADJ T1
                                                       WHERE 1  = 1
                                                         AND T1.CHNL_CD     = #CHNL_CD#
                                                         AND T1.SL_YRMON  >= #FM_DT#
                                                         AND T1.SL_YRMON  <![CDATA[ <= ]]> #TO_DT#
										                                      <isNotNull property="SL_CO_CD">
													                                      AND T1.CO_CD    = #SL_CO_CD#
												                                  </isNotNull>                                                                                                 
                                                      UNION ALL    
                                                      SELECT dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.SL_CO_CD)       AS CO_NM 
												                                   , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_RLSE_DT) , 121)  AS SL_YYMMDD
												                                   , '부가세' AS GBN
												                                   , dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(T2.SL_ITM_AMT) * 0.1, 0)) 
                                                        FROM TB_SL_RLSE       T1
                                                           , TB_SL_RLSE_DTL   T2
                                                           , TB_CD_ITM      T3
                                                       WHERE 1 = 1
                                                         AND T1.CHNL_CD     = #CHNL_CD#
                                                         AND T1.CHNL_CD     = T2.CHNL_CD
                                                         AND T1.CHNL_CD     = T3.CHNL_CD
                                                         AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                                                         AND T2.SL_ITM_CD   = T3.ITM_CD
                                                         AND T2.SL_ITM_QTY  <![CDATA[ <> ]]> 0 
												                                 AND T1.SL_AREA_CD  = #SL_AREA_CD# 
													                               AND T1.SL_CO_CD    = #SL_CO_CD#  
                                                         AND T1.SL_RLSE_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                                         AND T1.SL_RLSE_DT   <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                                                         AND NOT EXISTS (SELECT 'X'
                                                                           FROM TB_SL_RLSE_MAP Z
                                                                          WHERE 1 = 1
                                                                            AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                                                            AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )       
                                                   GROUP BY T1.SL_CO_CD
												                                  , CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(T1.SL_RLSE_DT) , 121)
                                  ) T1  
                                  GROUP BY CO_NM
                                         , SL_YYMMDD
                                         , GBN
                  ) T1
                  ) T1
                  )
            , TMP1 AS (      
                  SELECT RN
                       , SL_YRMON
                       , GBN
                       , SL_AMT
                       , SL_TAX_AMT
                       , SL_CLT_AMT
                       , RMN_AMT
                       , SL_BIL_NO
                       , SL_BIL_RMK
                    FROM (
                              SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY SL_YYMMDD, GBN, SL_BIL_NO) AS RN
                                    , SL_YYMMDD  AS SL_YRMON
                                    , SUBSTRING(GBN, 2 , DATALENGTH(GBN)) AS GBN
                                    , CASE WHEN SUBSTRING(GBN, 2 , DATALENGTH(GBN)) = '이월' THEN 0 ELSE SL_AMT END AS SL_AMT 
                                    , SL_TAX_AMT
                                    , SL_CLT_AMT
                                    , CASE WHEN GBN = 'E1부가세' THEN 0 ELSE RMN_AMT END AS RMN_AMT
                                    , SL_BIL_NO
                                    , SL_BIL_RMK
                              FROM (
                              SELECT SL_YYMMDD
                                  , GBN
                                  , SL_AMT
                                  , SL_TAX_AMT
                                  , SL_CLT_AMT
                                  , SL_BIL_NO
                                  , RMN_AMT
                                  , SL_BIL_RMK
                              FROM TMP
                              UNION ALL
                              SELECT SL_YYMMDD
                                  , 'X2일계'
                                  , SUM(SL_AMT)
                                  , NULL
                                  , NULL
                                  , NULL
                                  , NULL
                                  , NULL
                              FROM TMP
                             WHERE GBN NOT IN ('A1이월', 'E1부가세')
                              GROUP BY SL_YYMMDD
                        ) T1      
                        ) T1
            )
    SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY RN ) AS RN 
          , CASE WHEN SUBSTRING(SL_YRMON, 7, 2) ='월계' THEN '' 
                WHEN SL_YRMON ='합계' THEN '' 
                ELSE SL_YRMON END AS SL_YRMON 
         , CASE WHEN SUBSTRING(SL_YRMON, 7, 2) ='월계' THEN '월계' 
                WHEN SL_YRMON ='합계'  THEN '합계'
                ELSE GBN END AS GBN
         , SL_AMT
         , SL_TAX_AMT
         , SL_CLT_AMT
         , RMN_AMT
         , SL_BIL_NO
         , SL_BIL_RMK
         , #CHNL_CD#  AS CHNL_CD             
      FROM (        
          SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY SL_YRMON, RN) AS RN 
               , SL_YRMON
               , GBN
               , SL_AMT
               , SL_TAX_AMT
               , SL_CLT_AMT
               , RMN_AMT
               , SL_BIL_NO
               , SL_BIL_RMK
            FROM (
            SELECT RN
                 , SL_YRMON
                 , SUBSTRING(GBN, 2, DATALENGTH(GBN)) AS GBN
                 , SL_AMT
                 , SL_TAX_AMT
                 , SL_CLT_AMT
                 , RMN_AMT
                 , SL_BIL_NO
                 , SL_BIL_RMK
              FROM TMP1
            UNION ALL
            SELECT 8888
                 , SUBSTRING(REPLACE(SL_YRMON, '-', ''), 1, 6)+'월계'
                 , NULL
                 , SUM(SL_AMT)
                 , SUM(SL_TAX_AMT)
                 , SUM(SL_CLT_AMT)
                 , SUM(SL_AMT) + SUM(SL_TAX_AMT) - SUM(SL_CLT_AMT)
                 , NULL
                 , NULL
              FROM TMP1
             WHERE GBN NOT IN ('2일계', '1이월')   
            GROUP BY SUBSTRING(REPLACE(SL_YRMON, '-', ''), 1, 6)
            UNION ALL  
            SELECT 9999
                 , '합계'
                 , NULL
                 , SUM(SL_AMT)
                 , SUM(SL_TAX_AMT)
                 , SUM(SL_CLT_AMT)
                 , SUM(SL_AMT) + SUM(SL_TAX_AMT) - SUM(SL_CLT_AMT)
                 , NULL
                 , NULL
              FROM TMP1
             WHERE GBN NOT IN ('2일계')
    ) T1    
    ) T1
    </select>
		
		
		<select id="S22122SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
			SELECT T3.ITM_NM
					, T3.ITM_SZ_NM
					, T2.SL_ITM_QTY
					, T2.SL_ITM_PRC_DC_VAL
					, T2.SL_ITM_AMT    
          , #CHNL_CD#  AS CHNL_CD             
			FROM TB_SL_BIL      T1
					, TB_SL_BIL_DTL  T2
					, TB_CD_ITM      T3
				WHERE 1 = 1
          AND T1.CHNL_CD     = #CHNL_CD#
          AND T1.CHNL_CD     = T2.CHNL_CD
          AND T1.CHNL_CD     = T3.CHNL_CD        
					AND T1.SL_BIL_NO   = T2.SL_BIL_NO
					AND T2.SL_ITM_CD   = T3.ITM_CD
					AND T1.SL_BIL_NO   = #SL_BIL_NO#
      UNION ALL 
      SELECT T3.ITM_NM
					, T3.ITM_SZ_NM
					, T2.SL_ITM_QTY
					, T2.SL_ITM_PRC_DC_VAL
					, T2.SL_ITM_AMT   
        FROM TB_SL_RLSE     T1
           , TB_SL_RLSE_DTL T2
           , TB_CD_ITM      T3
       WHERE 1 = 1
         AND T1.CHNL_CD     = #CHNL_CD#
         AND T1.CHNL_CD     = T2.CHNL_CD
         AND T1.CHNL_CD     = T3.CHNL_CD       
         AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
         AND T2.SL_ITM_CD   = T3.ITM_CD
         AND T1.SL_RLSE_NO  = #SL_BIL_NO#
		</select>

    <select id="S22122SelectReportList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
			  SELECT CO_NO
             , CO_NM
             , HDQTR_PHN_NO
             , HDQTR_FAX_NO
        FROM TB_CD_CO
          WHERE 1 = 1
           AND CO_NO    = #SL_CO_CD#
           AND CHNL_CD  = #CHNL_CD#
		</select>


  <!-- 어음관리현황 -->
		<select id="S2227SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
			 SELECT dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', AREA_CD) AS AREA_NM   
					, CONVERT(VARCHAR, CLT_BIL_DT, 23) AS CLT_BIL_DT    
					, CLT_BIL_NO   
					, CASE WHEN CLT_CD = '2' THEN '자수' 
								 WHEN CLT_CD = '5' THEN '타수' END AS CLT_BILL_NM 
					, dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, CLT_CO_CD) AS CLT_CO_NM      
					, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-036', BIL_TP_CD) AS BIL_TP_NM 
					, BIL_ACCT_NO  
					, CONVERT(VARCHAR, BIL_END_DT, 23) AS BIL_END_DT   
					, BIL_BANK_NM  
					, BIL_USR_NM   
					, dbo.FF_SL_CLT_RMN_AMT(#CHNL_CD#, CLT_CO_CD) AS CLT_RMN_AMT  
					, CLT_AMT  
					, CLT_DC_RT
					, dbo.FF_SL_CLT_RMN_AMT(#CHNL_CD#, CLT_CO_CD) * CLT_DC_RT AS CLT_DC_AMT 
					, dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-037', CLT_CD) AS CLT_BIL_NM     
          , #CHNL_CD#  AS CHNL_CD
			FROM TB_SL_CLT_BIL
				WHERE 1 = 1
          AND CHNL_CD     = #CHNL_CD#
			<isNotNull property="AREA_CD">
				AND AREA_CD = #AREA_CD#
			</isNotNull>
			<isNotNull property="FM_DT">
				AND CLT_BIL_DT >=  CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)  
				AND CLT_BIL_DT <![CDATA[ <= ]]>  CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
			</isNotNull>
		</select>


  <!-- 일자별 수금현황 -->
	<select id="S2247SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
    SELECT
            ROW_NUMBER() OVER (PARTITION BY CLT_BIL_DT ORDER BY CLT_BIL_NO, ( N1ST_CLT_AMT + N2ND_CLT_AMT + N3RD_CLT_AMT + N4TH_CLT_AMT ) DESC) AS RN 
          , CLT_BIL_DT
          , CO_NM
					, CASE WHEN CLT_CD = '105' AND CLT_BIL_CD = '100' THEN N1ST_CLT_AMT * -1
                 WHEN CLT_BIL_CD = '100' THEN N1ST_CLT_AMT  - ISNULL(CLT_RMN_AMT, 0)
                 ELSE 0  END    AS N1ST_CLT_AMT
          , CASE WHEN CLT_BIL_CD IN ('101', '104') THEN N2ND_CLT_AMT  - CLT_RMN_AMT ELSE 0 END AS N2ND_CLT_AMT 
          , CASE WHEN CLT_CD = '101' THEN N3RD_CLT_AMT 
                 WHEN CLT_BIL_CD = '102' THEN  N3RD_CLT_AMT - CLT_RMN_AMT 
                 ELSE 0 END  AS N3RD_CLT_AMT
           , CASE WHEN CLT_BIL_CD = '103' THEN  N4TH_CLT_AMT + 
            (CASE WHEN BIL_RMK_CD IN ('101', '102', '103') THEN CLT_RMN_AMT * -1 ELSE 0 END) 
            ELSE 0 END AS N4TH_CLT_AMT
          , CASE WHEN BIL_RMK_CD IN ('101', '102', '103') THEN CLT_RMN_AMT * -1 ELSE 0 END     AS CLT_RMN_AMT
          , N1ST_CLT_AMT + N2ND_CLT_AMT + N3RD_CLT_AMT + N4TH_CLT_AMT AS CLT_AMT    
          , GBN
          , BIL_RMK
          , CLT_BIL_NO  
          , #CHNL_CD#  AS CHNL_CD
			FROM (
				  SELECT  CLT_BIL_DT
									, CO_NM
									, ISNULL(SUM(CASE WHEN CLT_BIL_CD = '100' THEN CLT_AMT 
                                    WHEN CLT_CD = '105' AND CLT_BIL_CD = '100' THEN CLT_AMT       
                                    ELSE 0 END), 0)           AS N1ST_CLT_AMT 
									, ISNULL(SUM(CASE WHEN CLT_BIL_CD IN ('101', '104') THEN CLT_AMT END), 0) AS N2ND_CLT_AMT  
									, ISNULL(SUM(CASE WHEN CLT_BIL_CD = '102' THEN CLT_AMT  END), 0)           AS N3RD_CLT_AMT 
									, ISNULL(SUM(CASE WHEN CLT_BIL_CD = '103' THEN CLT_AMT END), 0)           AS N4TH_CLT_AMT  
									, ISNULL(SUM(CLT_RMN_AMT), 0) AS CLT_RMN_AMT
									, GBN
									, BIL_RMK
                  , MAX(CLT_BIL_CD)  AS CLT_BIL_CD
                  , MAX(CLT_CD)      AS CLT_CD
                  , MAX(CLT_BIL_NO)  AS CLT_BIL_NO 
                  , MAX(BIL_RMK_CD)  AS BIL_RMK_CD
							FROM (
											SELECT CONVERT(VARCHAR(10), CLT_BIL_DT, 121) AS CLT_BIL_DT
													 , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CLT_CO_CD)  AS CO_NM     
													 , CLT_BIL_CD
													 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-035', CLT_BIL_CD) AS CLT_BIL_NM     
													 , T1.CLT_RMN_AMT   AS CLT_AMT
													 , T1.CLT_RMN_AMT - T1.CLT_AMT AS CLT_RMN_AMT 
													 , CASE WHEN CLT_BIL_CD = '101' THEN '자수' 
																	WHEN CLT_BIL_CD = '104' THEN '타수' 
																	END  AS GBN 
													 , T1.BIL_RMK       
                           , T1.CLT_CD
                           , CLT_BIL_NO    
                           , T1.BIL_RMK_CD
												FROM TB_SL_CLT_BIL  T1
											 WHERE 1 = 1
                         AND T1.CHNL_CD     = #CHNL_CD#
												<isNotNull property="AREA_CD">
													AND T1.AREA_CD     = #AREA_CD#
												</isNotNull>
												<isNotNull property="CO_CD">
													AND T1.CLT_CO_CD   = #CO_CD# 
												</isNotNull>
												 AND T1.CLT_BIL_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)   
												 AND T1.CLT_BIL_DT <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)   
										) T1 
						 WHERE 1 = 1      
						GROUP BY CLT_BIL_DT
									 , CO_NM 
									 , GBN
									 , BIL_RMK   
                   , CLT_CD
                   , CLT_BIL_CD
			) T1               
	 </select>

  
    <!-- 미수금현황 -->
		<select id="S2238SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY CASE WHEN T1.CO_CD IN ('15525', '11030') THEN '[SZ] 본지점거래'
                                                              ELSE'[' + T2.SL_AREA_CD + ']' 
                                                       + CASE WHEN T2.AREA_CD = '100' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', T2.SL_AREA_CD)
                                                              WHEN T2.AREA_CD = '200' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-112', T2.SL_AREA_CD)
                                                              WHEN T2.AREA_CD = '300' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-113', T2.SL_AREA_CD) END
                                                          END
                                                        , ISNULL(T2.ABBR_NM,  T2.CO_NM)
          ) AS RN     
                   , CASE WHEN T1.CO_CD IN ('15525', '11030') THEN '[SZ] 본지점거래' 
                    ELSE
                    '[' + T2.SL_AREA_CD + ']' + CASE WHEN T2.AREA_CD = '100' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', T2.SL_AREA_CD)
      						        WHEN T2.AREA_CD = '200' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-112', T2.SL_AREA_CD)
      						        WHEN T2.AREA_CD = '300' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-113', T2.SL_AREA_CD) END 
                    END   AS SL_AREA_NM         
                   , T1.CO_CD  AS SL_CO_CD                       
      		         , ISNULL(T2.ABBR_NM,  T2.CO_NM)    AS CO_NM             
      		         , dbo.FF_CD_CO_GRD_NM(#CHNL_CD#, T1.CO_CD)    AS CO_GRD_CD
      		         , ISNULL(dbo.FF_CO_LMT_AMT(#CHNL_CD#, T1.CO_CD), 0)     AS CO_LMT_AMT 
                   , T1.PRV_AMT
                   , T1.MM_0
                   , T1.MM_1
                   , T1.MM_2
                   , T1.MM_3
                   , RMN_AMT
      		         , T2.HDQTR_PHN_NO    
                   , T3.SL_RMK
                   , T2.CO_RGST_NO
                   , #CHNL_CD#  AS CHNL_CD
          FROM (
            SELECT CO_CD
                 , PRV_AMT 
                 , FLOOR(CASE WHEN PRV_AMT > 0 THEN MM_1_AMT ELSE MM_0 END)  AS MM_0
                 , FLOOR(CASE WHEN MM_0 > 0 THEN MM_2_AMT ELSE MM_1 END)     AS MM_1
                 , FLOOR(CASE WHEN MM_1 > 0 THEN MM_3_AMT ELSE MM_2 END)     AS MM_2         
                 , FLOOR(CASE WHEN MM_2 > 0 THEN MM_4_AMT ELSE MM_3 END)     AS MM_3         
                 , RMN_AMT
              FROM (
                    SELECT  CO_CD
                          , CASE WHEN SUM_B_AMT >= PRV_AMT THEN 0 ELSE PRV_AMT - SUM_B_AMT  END   AS PRV_AMT 
                          , CASE WHEN SUM_B_AMT >= (PRV_AMT + MM_1_AMT) THEN 0 ELSE (PRV_AMT + MM_1_AMT) - SUM_B_AMT END  AS MM_0
                          , CASE WHEN SUM_B_AMT >= (PRV_AMT + MM_1_AMT + MM_2_AMT) THEN 0 ELSE (PRV_AMT + MM_1_AMT + MM_2_AMT) - SUM_B_AMT END  AS MM_1
                          , CASE WHEN SUM_B_AMT >= (PRV_AMT + MM_1_AMT + MM_2_AMT + MM_3_AMT) THEN 0 ELSE (PRV_AMT + MM_1_AMT + MM_2_AMT+ MM_3_AMT) - SUM_B_AMT END  AS MM_2
                          , CASE WHEN SUM_B_AMT >= (PRV_AMT + MM_1_AMT + MM_2_AMT + MM_3_AMT + MM_4_AMT) THEN 0 ELSE (PRV_AMT + MM_1_AMT + MM_2_AMT+ MM_3_AMT+ MM_4_AMT) - SUM_B_AMT END  AS MM_3
                          , SUM_B_AMT
                          , MM_1_AMT
                          , MM_2_AMT
                          , MM_3_AMT
                          , MM_4_AMT
                          , (PRV_AMT + MM_1_AMT + MM_2_AMT + MM_3_AMT + MM_4_AMT) - SUM_B_AMT AS RMN_AMT
                      FROM (
                              SELECT CO_CD
                                   , ISNULL(MAX(CASE WHEN RN = 1 AND GBN = '이월' THEN RMN_AMT END), 0) AS PRV_AMT
                                   , ISNULL(SUM(CASE WHEN RN = 1 AND GBN IN ('판매') THEN RMN_AMT END), 0) AS MM_1_AMT
                                   , ISNULL(SUM(CASE WHEN RN = 2 AND GBN IN ('판매') THEN RMN_AMT END), 0) AS MM_2_AMT
                                   , ISNULL(SUM(CASE WHEN RN = 3 AND GBN IN ('판매') THEN RMN_AMT END), 0) AS MM_3_AMT
                                   , ISNULL(SUM(CASE WHEN RN = 4 AND GBN IN ('판매') THEN RMN_AMT END), 0) AS MM_4_AMT
                                   , ISNULL(MAX(SUM_B_AMT), 0) AS SUM_B_AMT
                                FROM (
                                             SELECT T2.NO   AS RN 
                                                  , T2.SL_YYMM AS SL_YYMMDD
                                                  , GBN
                                                  , SUM(RMN_AMT) OVER (PARTITION BY CO_CD, GBN ) AS SUM_RMN_AMT     
                                                  , RMN_AMT
                                                  , CO_CD
                                                  , CASE WHEN GBN ='수금' THEN SUM(RMN_AMT) OVER (PARTITION BY CO_CD, GBN ) END AS SUM_B_AMT       
                                                FROM (
                    																        SELECT  SUBSTRING(SL_YRMON, 1, 4) + SUBSTRING(SL_YRMON, 5, 2)            AS SL_YYMMDD 
                    																			        , '이월'                      AS GBN
                    																			        , T1.SL_INIT_AMT          AS RMN_AMT
                    																			        , T1.CO_CD
                    																	         FROM TB_SL_CO_INIT_AMT T1
                    																	        WHERE 1 = 1
                                                                AND T1.CHNL_CD     = #CHNL_CD#
                                                              <isNotNull property="AREA_CD">
                    																		        AND T1.AREA_CD = #AREA_CD#
                                                              </isNotNull>  
                    																		        AND SL_YRMON   = SUBSTRING(CONVERT(VARCHAR(8), DATEADD(MM, -3,  #FM_DT#), 112), 1, 6)
                                                              <isNotNull property="SL_CO_CD">                            
                    																		        AND CO_CD      = #SL_CO_CD#
                    																	        </isNotNull>                            
                                                                UNION ALL
                    																	         SELECT SUBSTRING(CONVERT(VARCHAR(8), T1.CLT_BIL_DT, 112), 1, 6)  AS SL_YYMMDD
                    																				        , '수금'
                    																				        , SUM(CASE WHEN CLT_CD ='105' AND T1.BIL_RMK_CD = '102' AND T1.CLT_AMT > 0  THEN T1.CLT_AMT * -1  ELSE CLT_RMN_AMT END)
                    																				        , T1.CLT_CO_CD
                    																		         FROM TB_SL_CLT_BIL T1
                    																	         WHERE 1 = 1            
                                                                 AND T1.CHNL_CD     = #CHNL_CD#
                    																		       <isNotNull property="AREA_CD"> 
                    																		        AND T1.AREA_CD = #AREA_CD#
                                                               </isNotNull>                             
                    																		       <isNotNull property="SL_CO_CD">                               
                    																			      AND T1.CLT_CO_CD    = #SL_CO_CD#
                    																	         </isNotNull>                           
                    																			         AND T1.CLT_BIL_DT >= SUBSTRING(CONVERT(VARCHAR(8), DATEADD(MM, -3,  #FM_DT#), 112), 1, 6) +'01'
                    																			         AND T1.CLT_BIL_DT <![CDATA[ <= ]]> CAST(#FM_DT#+ ' 23:59:59' AS DATETIME)    
                                                                GROUP BY  SUBSTRING(CONVERT(VARCHAR(8), T1.CLT_BIL_DT, 112), 1, 6)
                                                                        , T1.CLT_CO_CD
                                                    UNION ALL
                                                     SELECT SUBSTRING(CONVERT(VARCHAR(8), T1.SL_BIL_DT, 112), 1, 6)  AS SL_YYMMDD
                    														         , '판매' AS GBN
                    														         , SUM(T2.SL_ITM_AMT) + dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, ROUND(SUM(dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, T2.SL_ITM_AMT)) * 0.1, 0))
                    														         , T1.SL_CO_CD
                      												        FROM TB_SL_BIL      T1
                      													         , TB_SL_BIL_DTL  T2
                      													         , TB_CD_ITM      T3
                      												         WHERE 1 = 1
                                                         AND T1.CHNL_CD     = #CHNL_CD#
                                                         AND T1.CHNL_CD     = T2.CHNL_CD
                                                         AND T1.CHNL_CD     = T3.CHNL_CD
                      													         AND T1.SL_BIL_NO   = T2.SL_BIL_NO
                      													         AND T2.SL_ITM_CD   = T3.ITM_CD
                                                         <isNotNull property="AREA_CD">
                      													         AND T1.SL_AREA_CD  = #AREA_CD#
                                                         </isNotNull>
                      													         <isNotNull property="SL_CO_CD">                               
                      													         AND T1.SL_CO_CD    = #SL_CO_CD#
                        												         </isNotNull>            
                      													         AND T1.SL_BIL_DT >= SUBSTRING(CONVERT(VARCHAR(8), DATEADD(MM, -3,  #FM_DT#), 112), 1, 6) +'01'
                      													         AND T1.SL_BIL_DT <![CDATA[ <= ]]> CAST(#FM_DT#+ ' 23:59:59' AS DATETIME)
                      													         AND T2.CLT_BIL_NO  IS NULL
                      									           GROUP BY  SUBSTRING(CONVERT(VARCHAR(8), T1.SL_BIL_DT, 112), 1, 6)
                      															         , T1.SL_CO_CD
                                                  UNION ALL
                                                   SELECT SUBSTRING(CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(CAST(SL_YRMON+ ' 00:00:00' AS DATETIME) ) , 112), 1, 6)  AS SL_YYMMDD
                                                       , '판매'
                                                       , SL_TAX_AMT 
                                                       , T1.CO_CD
                                                    FROM TB_SL_TAX_ADJ T1
                                                   WHERE 1  = 1
                                                     AND T1.CHNL_CD     = #CHNL_CD#
                                                    <isNotNull property="AREA_CD">
                                                     AND T1.CO_CD IN (SELECT CO_NO FROM TB_CD_CO WHERE AREA_CD = #AREA_CD#)
                                                     </isNotNull>
                                                     <isNotNull property="SL_CO_CD">
					                                           AND T1.CO_CD    = #SL_CO_CD#     
                                                     </isNotNull> 
                                                     UNION ALL 
                                                          SELECT CONVERT(VARCHAR(6), T1.SL_RLSE_DT, 112) AS BIL_DT      
                                                              , '판매' AS GBN
                              					                      , SUM(T2.SL_ITM_AMT) + ROUND(SUM(dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, T2.SL_ITM_AMT)) * 0.1, 0)
                              					                      , T1.SL_CO_CD          
                              				                      FROM TB_SL_RLSE        T1
                              					                       , TB_SL_RLSE_DTL    T2       
                              			                       WHERE 1 = 1
                                                             AND T1.CHNL_CD     = #CHNL_CD#
                                                             AND T1.CHNL_CD     = T2.CHNL_CD
                                                             <isNotNull property="AREA_CD">
                              				                       AND T1.SL_AREA_CD      = #AREA_CD#
                                                             </isNotNull>
                                                             <isNotNull property="SL_CO_CD">                               
                            													        AND T1.SL_CO_CD    = #SL_CO_CD#
                              												      </isNotNull>     
                              				                       AND T1.SL_RLSE_NO = T2.SL_RLSE_NO
                                                             AND T1.SL_NXT_CLZ_FLG = 'N'
                              				                       AND T1.SL_RLSE_DT  >= SUBSTRING(CONVERT(VARCHAR(8), DATEADD(MM, -3, #FM_DT#), 112), 1, 6) +'01'
                              				                       AND T1.SL_RLSE_DT  <![CDATA[ <= ]]> CONVERT(VARCHAR(8), CAST(#FM_DT#+ ' 23:59:59' AS DATETIME), 112)
                                                             AND NOT EXISTS (SELECT 'X'
                                                                               FROM TB_SL_RLSE_MAP X
                                                                              WHERE 1 = 1
                                                                                AND X.CHNL_CD     = #CHNL_CD#
                                                                                AND X.SL_RLSE_NO  = T2.SL_RLSE_NO
                                                                                AND X.SL_RLSE_SEQ = T2.SL_RLSE_SEQ
                                                                            )
                              		                      GROUP BY T1.SL_CO_CD            
                              						                     , CONVERT(VARCHAR(6), T1.SL_RLSE_DT, 112)    
                                                        UNION ALL 
                                                        SELECT CONVERT(VARCHAR(6), T1.NXT_MON_DT, 112) AS BIL_DT      
                                                              , '판매' AS GBN
                                                              , SUM(T2.SL_ITM_AMT) + ROUND(SUM(dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, T2.SL_ITM_AMT)) * 0.1, 0)
                              					                      , T1.SL_CO_CD          
                              				                      FROM TB_SL_RLSE        T1
                              					                       , TB_SL_RLSE_DTL    T2       
                              			                       WHERE 1 = 1
                                                             AND T1.CHNL_CD     = #CHNL_CD#
                                                             AND T1.CHNL_CD     = T2.CHNL_CD
                                                             <isNotNull property="AREA_CD">
                              				                       AND T1.SL_AREA_CD      = #AREA_CD#
                                                             </isNotNull>
                                                             <isNotNull property="SL_CO_CD">                               
                            													        AND T1.SL_CO_CD    = #SL_CO_CD#
                              												       </isNotNull>    
                              				                       AND T1.SL_RLSE_NO = T2.SL_RLSE_NO                                                             
                                                             AND T1.SL_NXT_CLZ_FLG = 'Y'
                              				                       AND T1.NXT_MON_DT  >= SUBSTRING(CONVERT(VARCHAR(8), DATEADD(MM, -3, #FM_DT#), 112), 1, 6) +'01'
                              				                       AND T1.NXT_MON_DT  <![CDATA[ <= ]]> CONVERT(VARCHAR(8), CAST(#FM_DT#+ ' 23:59:59' AS DATETIME), 112)
                                                             AND NOT EXISTS (SELECT 'X'
                                                                               FROM TB_SL_RLSE_MAP X
                                                                              WHERE 1 = 1
                                                                                AND X.CHNL_CD     = #CHNL_CD#
                                                                                AND X.SL_RLSE_NO  = T2.SL_RLSE_NO
                                                                                AND X.SL_RLSE_SEQ = T2.SL_RLSE_SEQ
                                                                            )
                              		                      GROUP BY T1.SL_CO_CD            
                              						                     , CONVERT(VARCHAR(6), T1.NXT_MON_DT, 112)  
                                                  UNION ALL
                                                      SELECT CONVERT(VARCHAR(6), T1.SL_BIL_RTN_DT , 112) AS BIL_DT 
                                                            , '판매' AS GBN
                                                            , SUM(T2.SL_RTN_ITM_AMT)  + ROUND(SUM(dbo.FF_TAX_VAL(#CHNL_CD#, T1.SL_CO_CD, T2.SL_ITM_AMT)) * 0.1, 0)
                              					                      , T1.SL_CO_CD          
                                                        FROM TB_SL_BIL_RTN      T1
                                                           , TB_SL_BIL_RTN_DTL  T2
                                                       WHERE 1 = 0
                                                         AND T1.CHNL_CD     = #CHNL_CD#
                                                         AND T1.CHNL_CD     = T2.CHNL_CD
                                                         AND T1.SL_BIL_RTN_NO = T2.SL_BIL_RTN_NO
                                                         <isNotNull property="AREA_CD">
                                                         AND T1.AREA_CD       = #AREA_CD#
                                                         </isNotNull>
                                                         <isNotNull property="SL_CO_CD">                               
                        													        AND T1.SL_CO_CD    = #SL_CO_CD#
                          												       </isNotNull>   
                                                         AND T1.SL_BIL_RTN_DT  >= SUBSTRING(CONVERT(VARCHAR(8), DATEADD(MM, -3, #FM_DT#), 112), 1, 6) +'01'
                                                         AND T1.SL_BIL_RTN_DT <![CDATA[ <= ]]> CONVERT(VARCHAR(8), CAST(#FM_DT#+ ' 23:59:59' AS DATETIME), 112)
                                                         AND T1.RTN_APRO_FLG  = 'N'
                                                      GROUP BY T1.SL_CO_CD           
                                                            , CONVERT(VARCHAR(6), T1.SL_BIL_RTN_DT , 112)                                 
                          									        ) T1, 
                                                    (                                             
                                                    SELECT SUBSTRING(CONVERT(VARCHAR(8), DATEADD(MM, -(NO-1),  #FM_DT#), 112), 1, 6) AS SL_YYMM
                                                         , CASE WHEN NO = 1 THEN 4 WHEN NO = 2 THEN 3 WHEN NO = 3 THEN 2 ELSE 1 END AS NO     
                                                        FROM CPY_T  T1
                                                       WHERE NO <![CDATA[ <= ]]> 4
                                                    ) T2 
                                          WHERE  ( 1 = 1                                            
                                           AND  T2.SL_YYMM = SUBSTRING(T1.SL_YYMMDD, 1, 6) )
               ) T1
               GROUP BY  CO_CD
              ) T1 
            )T1)T1, TB_CD_CO T2 LEFT OUTER JOIN TB_SL_RMK_LOG T3 
               ON (      T2.CO_NO = T3.CO_CD
                     AND T3.RMK_CD = 'A'
                     AND T3.CHNL_CD = #CHNL_CD#
                     AND T3.SL_YRMON = CONVERT(VARCHAR(6),  #FM_DT#, 112)
               )
          WHERE 1 = 1
            AND T2.CHNL_CD = #CHNL_CD#
            AND T1.CO_CD = T2.CO_NO
            AND T2.DELT_FLG = 'N'
            AND RMN_AMT <![CDATA[ <> ]]> 0                  
     </select>

    <insert id="S2238InsertRMK" parameterClass="ModelsLibrary.Sale.SaleVo">
       INSERT INTO TB_SL_RMK_LOG
        ( 
	          CHNL_CD
          , RMK_CD               
	        , SL_YRMON             
	        , CO_CD                
	        , SL_RMK               
	        , CRE_USR_ID           
	        , CRE_DT               
	        , UPD_USR_ID           
	        , UPD_DT               
        ) VALUES (
           #CHNL_CD#
	        ,#RMK_CD#       
	        ,#SL_YRMON#
	        ,#CO_CD#
	        ,#SL_RMK#
	        ,#CRE_USR_ID#
	        ,GETDATE()
	        ,#UPD_USR_ID#
	        ,GETDATE()
        )
    </insert>
    
    <update id="S2238UpdateRMK" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_RMK_LOG
      <isNotNull property="SL_RMK">
         SET SL_RMK = #SL_RMK#
      </isNotNull>
      <isNotNull property="CLT_DT">
         SET CLT_DT  =  #CLT_DT#
      </isNotNull>
        WHERE 1 = 1
          AND CHNL_CD    = #CHNL_CD#
          AND RMK_CD     = 'A'
          AND SL_YRMON   = #SL_YRMON#
          AND CO_CD      = #CO_CD#
    </update>

    
    <select id="S2239SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      WITH TMP AS (
      SELECT  T1.SL_CLSS_NM  AS GBN
      , CASE WHEN T1.BIL_CD = 'B' THEN T1.SL_BIL_DT
      ELSE CONVERT(VARCHAR(10), dbo.SYS_LAST_DAY(CAST('201710'+'01' AS DATETIME)), 121) END AS SL_BIL_DT
      , T1.SL_CO_CD
      , T2.CO_RGST_NO
      , T2.PRSD_NM
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-003', T2.N1ST_BZTP_CD)      AS BZTP_NM
      , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'S-002', T2.N1ST_BIZ_COND_CD)  AS BIZ_COND_NM
      , T2.CO_NM AS ABBR_NM
      , T1.SL_ITM_AMT
      , T1.SL_ITM_TAX_AMT
      , T1.SL_ITM_AMT + T1.SL_ITM_TAX_AMT AS SUM_AMT
      , T1.BIL_CD
      , T2.AREA_CD
      , T2.SL_AREA_CD
      FROM (
      SELECT  SL_CLSS_NM
      , GBN
      , MAX(SL_BIL_DT) AS SL_BIL_DT
      , SL_CO_CD
      , SUM(T1.SL_ITM_AMT) AS SL_ITM_AMT
      , SUM(SL_TAX_AMT) AS SL_ITM_TAX_AMT
      , T1.BIL_CD
      FROM (
      SELECT CASE WHEN T1.SL_CLSS_CD = 'A' THEN '매출'
      ELSE '수금할인'          END AS SL_CLSS_NM
      , CASE WHEN T1.SL_CLSS_CD = 'B' THEN '현금'
      ELSE '외상' END AS GBN
      , ISNULL(GRP_BIL_NO, SL_BIL_NO)  AS SL_BIL_NO
      , CONVERT(VARCHAR(10),  dbo.SYS_LAST_DAY(CAST(T1.SL_YRMON + '01' + ' 00:00:00' AS DATETIME)) , 121) AS SL_BIL_DT
      , SL_CO_CD
      , T1.SL_AMT                     AS SL_ITM_AMT
      , T1.BIL_CD
      , T1.SL_TAX_AMT
      FROM TB_SL_ELTR_BIL T1
      WHERE 1 = 1
      AND T1.CHNL_CD     = #CHNL_CD#
      AND SL_YRMON     >= SUBSTRING(#FM_DT#, 1, 6)
      AND SL_YRMON     <![CDATA[ <= ]]> SUBSTRING(#TO_DT#, 1, 6)
      AND SL_CLSS_CD   = 'B'
      <isNotNull property="SL_CO_CD">
        AND T1.SL_CO_CD    =  #SL_CO_CD#
      </isNotNull>
      <isNotNull property="AREA_CD">
        AND T1.AREA_CD   = #AREA_CD#
      </isNotNull>
      AND NOT EXISTS (SELECT 'X'
      FROM TB_IF_HO X
      WHERE 1 = 1
      AND X.CHNL_CD = #CHNL_CD#
      AND X.CO_NO = T1.SL_CO_CD
      AND SUBSTRING(X.SL_DT, 1, 6) = T1.SL_YRMON)
      ) T1
      GROUP BY SL_CLSS_NM
      , GBN
      , SL_BIL_NO
      , SL_CO_CD
      , T1.BIL_CD
      UNION ALL
      SELECT  SL_CLSS_NM
      , GBN
      , MAX(SL_BIL_DT) AS SL_BIL_DT
      , SL_CO_CD
      , SUM(T1.SL_ITM_AMT) AS SL_ITM_AMT
      , dbo.FF_TAX_VAL(#CHNL_CD#, SL_CO_CD, ROUND(SUM(T1.SL_ITM_AMT) * 0.1, 0))
      + ISNULL(dbo.FF_HOME_TAX_ADJ(#CHNL_CD#, SUBSTRING(#FM_DT#, 1, 6), SL_CO_CD), 0)  AS SL_TAX_AMT
      , T1.BIL_CD
      FROM (
      SELECT CASE WHEN T1.SL_CLSS_CD = 'A' THEN '매출'
      ELSE '수금할인'          END AS SL_CLSS_NM
      , CASE WHEN T1.SL_CLSS_CD = 'B' THEN '현금'
      ELSE '외상' END AS GBN
      , ISNULL(T1.GRP_BIL_NO, T1.SL_BIL_NO)  AS SL_BIL_NO
      , CONVERT(VARCHAR(10),  dbo.SYS_LAST_DAY(CAST(T1.SL_YRMON + '01' + ' 00:00:00' AS DATETIME)) , 121) AS SL_BIL_DT
      , T1.SL_CO_CD
      , T1.SL_AMT                     AS SL_ITM_AMT
      , T1.SL_TAX_AMT                 AS SL_ITM_TAX_AMT
      , T1.BIL_CD
      , T1.SL_TAX_AMT
      FROM TB_SL_ELTR_BIL T1
      WHERE 1 = 1
      AND T1.CHNL_CD     = #CHNL_CD#
      AND SL_YRMON     >= SUBSTRING(#FM_DT#, 1, 6)
      AND SL_YRMON     <![CDATA[ <= ]]> SUBSTRING(#TO_DT#, 1, 6)
      <isNotNull property="SL_CO_CD">
        AND T1.SL_CO_CD    =  #SL_CO_CD#
      </isNotNull>
      <isNotNull property="AREA_CD">
        AND T1.AREA_CD   = #AREA_CD#
      </isNotNull>
      AND T1.SL_CLSS_CD  = 'A'
      AND NOT EXISTS (SELECT 'X'
      FROM TB_IF_HO X
      WHERE 1 = 1
      AND X.CHNL_CD = #CHNL_CD#
      AND X.CO_NO = T1.SL_CO_CD
      AND SUBSTRING(X.SL_DT, 1, 6) = T1.SL_YRMON)
      ) T1
      GROUP BY SL_CLSS_NM
      , GBN
      , SL_CO_CD
      , T1.BIL_CD
      UNION ALL
      SELECT CASE WHEN SL_RMK ='B' THEN '수금할인'
      ELSE '매출' END
      , '외상'
      , '2017-08-31'
      , CO_NO
      , SL_AMT
      , SL_TAX_AMT
      , 'A'
      FROM TB_IF_HO
      WHERE 1 = 1
      AND CHNL_CD = #CHNL_CD#
      AND '201708' >= SUBSTRING(#FM_DT#, 1, 6)
      AND  '201708' <![CDATA[ <= ]]> SUBSTRING(#TO_DT#, 1, 6)
      <isNotNull property="AREA_CD">
        AND '100'   = #AREA_CD#
      </isNotNull>
      ) T1 , TB_CD_CO T2
      WHERE 1 = 1
      AND T2.CHNL_CD = #CHNL_CD#
      AND T1.SL_CO_CD = T2.CO_NO
      AND T1.SL_ITM_AMT <![CDATA[ <> ]]> 0
      )
      SELECT CO_RGST_NO
      , ABBR_NM
      , SL_CO_CD
      , PRSD_NM
      , BZTP_NM
      , BIZ_COND_NM
      , COUNT(SL_CO_CD) OVER (PARTITION BY SL_CO_CD, GBN) AS KNT
      , SL_ITM_AMT       AS ITM_AMT
      , SL_ITM_TAX_AMT   AS ITM_TAX_AMT
      , SUM_AMT
      , '' AS SL_RMK
      , CASE WHEN T1.SL_CO_CD IN ('15525', '11030') THEN '[SZ] 본지점거래'
      ELSE
      '[' + T1.SL_AREA_CD + ']' + CASE WHEN T1.AREA_CD = '100' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', T1.SL_AREA_CD)
      WHEN T1.AREA_CD = '200' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-112', T1.SL_AREA_CD)
      WHEN T1.AREA_CD = '300' THEN dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-113', T1.SL_AREA_CD) END
      END   AS SL_AREA_NM
      , #CHNL_CD#  AS CHNL_CD
      FROM TMP  T1
      WHERE 1 = 1
      <isNotNull property="GBN">
        AND GBN LIKE #GBN#
      </isNotNull>
      ORDER BY  AREA_CD, T1.SL_AREA_CD, CO_RGST_NO, ABBR_NM
    </select>
  

     <!-- 매출상세(기간별)-->
    <select id="S2281SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT SL_YY
						 , SL_MM
						 , SL_DD
						 , AREA_NM 
						 , SL_AREA_NM 
						 , TEAM_NM 
						 , CO_NM
						 , N1ST_ITM_GRP_NM
						 , N2ND_ITM_GRP_NM    
						 , ITM_SZ_NM
             , SL_ITM_CD
             , PROD_LOC_NM
						 , SUM(SL_ITM_AMT)  AS ITM_AMT
						 , SUM(SL_ITM_QTY)  AS ITM_QTY
						 , SUM(MD_QTY)      AS MD_QTY 
						 , SUM(SL_ITM_WGT)  AS ITM_WGT
						 , #CHNL_CD#  AS CHNL_CD
					FROM (
									SELECT DATENAME(YYYY, T1.SL_BIL_DT) AS SL_YY
											 , DATENAME(MM, T1.SL_BIL_DT)   AS SL_MM
											 , dbo.F_RPAD(DATENAME(DD, T1.SL_BIL_DT), 2, '0')   AS SL_DD
											 , CASE WHEN T3.TRD_CATE_CD = '400' THEN '광주' 
                              ELSE dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD) END  AS AREA_NM 
											 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', T3.SL_AREA_CD)  AS SL_AREA_NM 
											 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-010', T3.TEAM_CD)      AS TEAM_NM 
											 , T3.CO_NM
											 , dbo.PUR_N1ST_GRP_NM_FNC(#CHNL_CD#, T4.ITM_GRP_CLSS_CD, T4.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
											 , dbo.PUR_N2ST_GRP_NM_FNC(#CHNL_CD#, T4.ITM_GRP_CLSS_CD, T4.N1ST_ITM_GRP_CD, T4.N2ND_ITM_GRP_CD)  AS N2ND_ITM_GRP_NM    
											 , T4.ITM_SZ_NM
											 , T1.SL_ITM_QTY
											 , T1.SL_ITM_AMT
											 , dbo.FF_ITM_TP_QTY(#CHNL_CD#, T1.SL_ITM_CD, T1.SL_ITM_QTY, 'A') AS MD_QTY 
											 , T4.UOM_WGT * T1.SL_ITM_QTY   AS SL_ITM_WGT
                       , T1.SL_ITM_CD
                       , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-600', T4.PROD_LOC_CD) PROD_LOC_NM
                  FROM (
												 SELECT 'A' AS GBN
															, T1.SL_AREA_CD           
                              , T2.SL_ITM_CD
                              , T1.SL_CO_CD
															, CONVERT(VARCHAR(8), T1.SL_BIL_DT, 112) AS SL_BIL_DT 
															, SUM(T2.SL_ITM_AMT) AS SL_ITM_AMT
                              , SUM(T2.SL_ITM_QTY) AS SL_ITM_QTY 
														FROM TB_SL_BIL        T1
															 , TB_SL_BIL_DTL    T2       
													 WHERE 1 = 1
                             AND T1.CHNL_CD = #CHNL_CD#
                             AND T1.CHNL_CD = T2.CHNL_CD
                           <isNotNull property="SL_AREA_CD">
                             AND T1.SL_AREA_CD      = ( CASE WHEN '400' = #SL_AREA_CD# THEN T1.SL_AREA_CD ELSE #SL_AREA_CD# END )
                             <isEqual property="SL_AREA_CD" compareValue="400">
                               AND T1.SL_CO_CD IN ( SELECT CO_NO
                               FROM TB_CD_CO
                               WHERE 1 = 1
                               AND CHNL_CD = #CHNL_CD#
                               <!--AND TRD_CATE_CD = '400'-->
                               )
                             </isEqual>
                           </isNotNull>
                           AND T1.SL_BIL_NO       = T2.SL_BIL_NO
                           AND T1.SL_BIL_DT      >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)
                           AND T1.SL_BIL_DT      <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)  
                             AND T2.CLT_BIL_NO IS NULL
												 GROUP BY T1.SL_AREA_CD           
																, CONVERT(VARCHAR(8), T1.SL_BIL_DT, 112)    
                                , T2.SL_ITM_CD
                                , T1.SL_CO_CD
                       UNION ALL                                
		                       SELECT 'A' AS GBN
					                      , T1.SL_AREA_CD        
                                , T2.SL_ITM_CD
                                , T1.SL_CO_CD
					                      , CONVERT(VARCHAR(8), T1.NXT_MON_DT, 112) AS BIL_DT                
					                      , SUM(T2.SL_ITM_AMT) AS SL_AMT
                                , SUM(T2.SL_ITM_QTY) AS SL_QTY 
				                      FROM TB_SL_RLSE        T1
					                       , TB_SL_RLSE_DTL    T2       
			                       WHERE 1 = 1
                               AND T1.CHNL_CD = #CHNL_CD#
                               AND T1.CHNL_CD = T2.CHNL_CD
                          <isNotNull property="SL_AREA_CD">
													  AND T1.SL_AREA_CD      = ( CASE WHEN '400' = #SL_AREA_CD# THEN T1.SL_AREA_CD ELSE #SL_AREA_CD# END )
                            <isEqual property="SL_AREA_CD" compareValue="400">
                            AND T1.SL_CO_CD IN ( SELECT CO_NO
                            FROM TB_CD_CO
                            WHERE 1 = 1
                            AND CHNL_CD = #CHNL_CD#
                            <!--AND TRD_CATE_CD = '400'-->
                            )
                          </isEqual>
                        </isNotNull>                             
				                       AND T1.SL_RLSE_NO = T2.SL_RLSE_NO
				                       AND T1.NXT_MON_DT  >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
				                       AND T1.NXT_MON_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)  
                               AND NOT EXISTS (SELECT 'X'
                                                 FROM TB_SL_RLSE_MAP X
                                                WHERE 1 = 1
                                                  AND X.CHNL_CD = #CHNL_CD#
                                                  AND X.SL_RLSE_NO  = T2.SL_RLSE_NO
                                                  AND X.SL_RLSE_SEQ = T2.SL_RLSE_SEQ
                                              )
		                      GROUP BY T1.SL_AREA_CD           
						                     , CONVERT(VARCHAR(8), T1.NXT_MON_DT, 112) 
                                 , T2.SL_ITM_CD      
                                 , T1.SL_CO_CD
                       UNION ALL                                
		                       SELECT 'A' AS GBN
					                      , T1.SL_AREA_CD        
                                , T2.SL_ITM_CD
                                , T1.SL_CO_CD
					                      , CONVERT(VARCHAR(8), T1.SL_RLSE_DT, 112) 
					                      , SUM(T2.SL_ITM_AMT) AS SL_AMT
                                , SUM(T2.SL_ITM_QTY) AS SL_QTY 
				                      FROM TB_SL_RLSE        T1
					                       , TB_SL_RLSE_DTL    T2       
			                       WHERE 1 = 1
                               AND T1.CHNL_CD = #CHNL_CD#
                               AND T1.CHNL_CD = T2.CHNL_CD
                          <isNotNull property="SL_AREA_CD">
                            AND T1.SL_AREA_CD      = ( CASE WHEN '400' = #SL_AREA_CD# THEN T1.SL_AREA_CD ELSE #SL_AREA_CD# END )
                            <isEqual property="SL_AREA_CD" compareValue="400">
                              AND T1.SL_CO_CD IN ( SELECT CO_NO
                              FROM TB_CD_CO
                              WHERE 1 = 1
                              AND CHNL_CD = #CHNL_CD#
                              <!--AND TRD_CATE_CD = '400'-->
                              )
                            </isEqual>
                          </isNotNull>
				                       AND T1.SL_RLSE_NO = T2.SL_RLSE_NO
				                       AND T1.SL_RLSE_DT    >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
				                       AND T1.SL_RLSE_DT    <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)  
                               AND NOT EXISTS (SELECT 'X'
                                                 FROM TB_SL_RLSE_MAP X
                                                WHERE 1 = 1
                                                  AND X.CHNL_CD     = #CHNL_CD#
                                                  AND X.SL_RLSE_NO  = T2.SL_RLSE_NO
                                                  AND X.SL_RLSE_SEQ = T2.SL_RLSE_SEQ
                                              )
		                      GROUP BY T1.SL_AREA_CD           
						                     , CONVERT(VARCHAR(8), T1.SL_RLSE_DT, 112)
                                 , T2.SL_ITM_CD      
                                 , T1.SL_CO_CD                                 
                    UNION ALL
                        SELECT 'A' AS GBN
                              , T1.AREA_CD           
                              , T2.SL_RTN_ITM_CD
                              , T1.SL_CO_CD
                              , CONVERT(VARCHAR(8), T1.SL_BIL_RTN_DT , 112) AS BIL_DT 
                              , SUM(T2.SL_RTN_ITM_AMT) AS SL_AMT
                              , SUM(T2.SL_RTN_ITM_QTY) AS SL_QTY
                          FROM TB_SL_BIL_RTN      T1
                             , TB_SL_BIL_RTN_DTL  T2
                         WHERE 1 = 1
                           AND T1.CHNL_CD = #CHNL_CD#
                           AND T1.CHNL_CD = T2.CHNL_CD
                           AND T1.SL_BIL_RTN_NO = T2.SL_BIL_RTN_NO
                          <isNotNull property="SL_AREA_CD">
                            AND T1.AREA_CD      = ( CASE WHEN '400' = #SL_AREA_CD# THEN T1.AREA_CD ELSE #SL_AREA_CD# END )
                            <isEqual property="SL_AREA_CD" compareValue="400">
                              AND T1.SL_CO_CD IN ( SELECT CO_NO
                              FROM TB_CD_CO
                              WHERE 1 = 1
                              AND CHNL_CD = #CHNL_CD#
                              <!--AND TRD_CATE_CD = '400'-->
                              )
                            </isEqual>
                          </isNotNull>

                           AND T1.SL_BIL_RTN_DT >=  CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                           AND T1.SL_BIL_RTN_DT <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)  
                           AND T1.RTN_APRO_FLG  = 'N'
                        GROUP BY T1.AREA_CD           
                              , CONVERT(VARCHAR(8), T1.SL_BIL_RTN_DT , 112)   
                              , T2.SL_RTN_ITM_CD
                              , T1.SL_CO_CD
                    ) T1 , TB_CD_CO       T3, TB_CD_ITM      T4                       
                WHERE 1 = 1
                  AND T3.CHNL_CD    = #CHNL_CD#
                  AND T3.CHNL_CD    = T4.CHNL_CD
                  AND T1.SL_CO_CD   = T3.CO_NO
                  AND T1.SL_ITM_CD  = T4.ITM_CD
								) T1             
				GROUP BY SL_YY
							 , SL_MM
							 , SL_DD
							 , AREA_NM 
							 , SL_AREA_NM 
							 , TEAM_NM 
							 , CO_NM
							 , N1ST_ITM_GRP_NM
							 , N2ND_ITM_GRP_NM    
							 , ITM_SZ_NM     
               , SL_ITM_CD
			         , PROD_LOC_NM
		</select>
    
  <!-- 매출요약(기간별)-->
  <select id="S2282SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
				SELECT DATENAME(YYYY, T1.SL_BIL_DT) AS SL_YY
							 , DATENAME(MM, T1.SL_BIL_DT)   AS SL_MM
							 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.SL_AREA_CD)  AS AREA_NM 
							 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-009', T3.SL_AREA_CD)  AS SL_AREA_NM 
							 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-010', T3.TEAM_CD)      AS TEAM_NM 
							 , T3.CO_NM
               , T3.CO_NO AS CO_CD
							 , dbo.PUR_N1ST_GRP_NM_FNC(#CHNL_CD#, T4.ITM_GRP_CLSS_CD, T4.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
							 , SUM(T2.SL_ITM_QTY) AS ITM_QTY
							 , SUM(T2.SL_ITM_AMT)  AS ITM_AMT 
							 , SUM(dbo.FF_ITM_TP_QTY(#CHNL_CD#, T2.SL_ITM_CD, T2.SL_ITM_QTY, 'A')) AS MD_QTY 
							 , SUM(T4.UOM_WGT * T2.SL_ITM_QTY)   AS ITM_WGT
							 , #CHNL_CD#  AS CHNL_CD
						FROM TB_SL_BIL      T1  
							 , TB_SL_BIL_DTL  T2
							 , TB_CD_CO       T3
							 , TB_CD_ITM      T4
					 WHERE 1 = 1     
             AND T1.CHNL_CD = #CHNL_CD#
             AND T1.CHNL_CD = T2.CHNL_CD
             AND T1.CHNL_CD = T3.CHNL_CD
             AND T1.CHNL_CD = T4.CHNL_CD
						 AND T1.SL_BIL_NO = T2.SL_BIL_NO
						 AND T1.SL_CO_CD  = T3.CO_NO
						 AND T2.SL_ITM_CD = T4.ITM_CD
						<isNotNull property="SL_AREA_CD">
						 AND T1.SL_AREA_CD = #SL_AREA_CD#
						</isNotNull>
						 AND T1.SL_BIL_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
						 AND T1.SL_BIL_DT <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)    
				GROUP BY DATENAME(YYYY, T1.SL_BIL_DT) 
							 , DATENAME(MM, T1.SL_BIL_DT)   
							 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#,'L-002', T1.SL_AREA_CD)  
							 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#,'L-009', T3.SL_AREA_CD)  
							 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#,'L-010', T3.TEAM_CD)   
							 , T3.CO_NM
               , T3.CO_NO
							 , dbo.PUR_N1ST_GRP_NM_FNC(#CHNL_CD#, T4.ITM_GRP_CLSS_CD, T4.N1ST_ITM_GRP_CD) 
		</select>
  
     <!-- 통장 관리 -->
		 <select id="S2231SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
				SELECT  BANK_ACCT_CD
						, BANK_ACCT_NM
						, BANK_TP_NM
						, BANK_RMK
						, BANK_NM  
            , CHNL_CD
				FROM TB_CD_BANK_ACCT
					WHERE 1=1 
            AND CHNL_CD = #CHNL_CD#
					<isNotNull property="BANK_ACCT_CD">
						AND BANK_ACCT_CD = #BANK_ACCT_CD#
					</isNotNull>
		</select>
		
		<insert id="S2231InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			INSERT INTO TB_CD_BANK_ACCT
			(
          CHNL_CD
				,	BANK_ACCT_CD
				, BANK_ACCT_NM
				, BANK_TP_NM
				, BANK_RMK
				, CRE_USR_ID
				, CRE_DT
				, UPD_USR_ID
				, UPD_DT
				, BANK_NM
			)
			VALUES
			(
          #CHNL_CD#
				,	#BANK_ACCT_CD#
				, #BANK_ACCT_NM#
				, #BANK_TP_NM#
				, #BANK_RMK#
				, #CRE_USR_ID#
				, GETDATE()
				, #UPD_USR_ID#
				, GETDATE()
				, #BANK_NM#
			)
		</insert>   
		
		<update id="S2231UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			UPDATE TB_CD_BANK_ACCT 
				 SET
						BANK_ACCT_NM  = #BANK_ACCT_NM#
					, BANK_TP_NM    = #BANK_TP_NM#
					, BANK_RMK      = #BANK_RMK#
					, BANK_NM       = #BANK_NM#
					, UPD_USR_ID    = #UPD_USR_ID#
					, UPD_DT        = GETDATE()
				WHERE 1=1
					 AND BANK_ACCT_CD = #BANK_ACCT_CD#
           AND CHNL_CD = #CHNL_CD#
		</update>

		<delete id="S2231DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			DELETE FROM TB_CD_BANK_ACCT
				WHERE 1=1
					 AND BANK_ACCT_CD = #BANK_ACCT_CD#
           AND CHNL_CD = #CHNL_CD#
		</delete>
		
    
    <!-- 차종관리 -->
    <select id="S11410SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		SELECT CHNL_CD
        , CAR_TP_CD           
        , CAR_TP_NM           
        , CAR_TP_SUB_NM       
        , CO_CD      
        , dbo.CD_COMPANY_NM_FNC(CHNL_CD, CO_CD)  AS CO_NM  
        , (CASE WHEN DELT_FLG = 'N' THEN '사용' ELSE '미사용' END) AS DELT_FLG
    FROM TB_CD_CAR_TP
      WHERE 1 = 1
        AND CHNL_CD = #CHNL_CD#
       	<isNotNull property="DELT_FLG">
					AND DELT_FLG = #DELT_FLG# 
				</isNotNull>
	</select>
    
  <insert id="S11410InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			INSERT INTO TB_CD_CAR_TP
      ( 
          CHNL_CD
        , CAR_TP_CD
        , CAR_TP_NM
        , CAR_TP_SUB_NM
        , CO_CD
        , DELT_FLG
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
          #CHNL_CD#
        , #CAR_TP_CD#
        , #CAR_TP_NM#
        , #CAR_TP_SUB_NM#
        , #CO_CD#
        , #DELT_FLG#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
		</insert>   
		
		<update id="S11410UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			UPDATE TB_CD_CAR_TP
       SET CAR_TP_NM        = #CAR_TP_NM#
         , CAR_TP_SUB_NM    = #CAR_TP_SUB_NM#
         , CO_CD            = #CO_CD#
         , DELT_FLG         = #DELT_FLG#
         , UPD_USR_ID       = #CAR_TP_NM#
         , UPD_DT           = GETDATE()
     WHERE 1 = 1
       AND CHNL_CD    = #CHNL_CD#
       AND CAR_TP_CD  = #CAR_TP_CD#
		</update>

    <!--
		<delete id="S11410DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			DELETE FROM TB_CD_CAR_TP
				WHERE 1=1
					 AND CAR_TP_CD = #CAR_TP_CD#
           AND CHNL_CD = #CHNL_CD#
		</delete>
    -->
    
    
  
    <!-- (월)판매계획 -->
  <select id="S2220SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		SELECT T3.CHNL_CD
           , T3.SL_PLN_NO
           , CONVERT(CHAR(7),CONVERT(DATE, T3.SL_PLN_YRMON + '01'), 23) AS        SL_PLN_YRMON
           , T3.ITM_CD
           , dbo.CD_ITEM_NM_FNC(T3.CHNL_CD, T3.ITM_CD) AS ITM_NM
           , T3.N1ST_ITM_GRP_CD
           , dbo.PUR_N1ST_GRP_NM_FNC(T3.CHNL_CD, 'G', T3.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM 
           , T3.SL_CO_CD   AS CO_CD  
           , dbo.CD_COMPANY_NM_FNC(T3.CHNL_CD, T3.SL_CO_CD)  AS CO_NM
           , T3.SL_PLN_CD
           , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD, 'S-050', T3.SL_PLN_CD)  AS SL_PLN_NM  
           , T3.SL_PLN_QTY   
           , dbo.FF_N1ST_ITM_STK_QTY(T3.CHNL_CD, T3.N1ST_ITM_GRP_CD)  AS ITM_STK_QTY 
           , 0   AS ITM_ROUT_QTY 
           , 0   AS ITM_IN_QTY
           , 0   AS ITM_OUT_QTY      
           , T3.SL_PLN_RMK 
           , T3.CLZ_FLG
           , (SELECT COUNT(*) FROM TB_PROD_MON_PLN AS X WHERE 1=1 AND X.SL_PLN_NO = T3.SL_PLN_NO AND X.CHNL_CD = T3.CHNL_CD) AS RN
	       , T3.SL_ORD_NO
	       , T3.SL_ORD_SEQ
	       , CONVERT(VARCHAR(10), CONVERT(DATETIME, T2.DUE_DT), 120) AS DUE_DT
	       , T2.SO_QT AS ITM_ROUT_QTY
    <!--FROM TB_SL_MON_PLN AS T1-->
	  FROM DZICUBE.dbo.LSO T1
	     , DZICUBE.dbO.LSO_D T2 LEFT OUTER JOIN TB_SL_MON_PLN T3
	    ON(
	            T2.SO_NB = T3.SL_ORD_NO
	        AND T2.SO_SQ  = T3.SL_ORD_SEQ
	        AND T3.CHNL_CD =  #CHNL_CD#
	        AND T2.ITEM_CD = T3.ITM_CD
	    )
	  WHERE 1 = 1
	    AND T1.CO_CD    = T2.CO_CD
		AND T1.SO_NB    = T2.SO_NB
        AND T3.CHNL_CD  = #CHNL_CD#
	  <isNotNull property="SL_PLN_YRMON">
       AND T3.SL_PLN_YRMON = #SL_PLN_YRMON#
       </isNotNull>
      <isNotNull property="SL_PLN_NO">
       AND T3.SL_PLN_NO   = #SL_PLN_NO#
      </isNotNull>
      <!-- 조회 -> 생산계획 투입 된것 제외 -->
      <!--<isNotNull property="GBN">
       AND NOT EXISTS (SELECT 'X' FROM TB_PROD_MON_PLN AS X WHERE 1=1 AND X.CHNL_CD = T1.CHNL_CD AND X.SL_PLN_NO = T1.SL_PLN_NO)
      </isNotNull>-->
    ORDER BY T3.CRE_DT
	</select>
    
  <insert id="S2220InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
	INSERT INTO TB_SL_MON_PLN 
      (
          CHNL_CD
        , SL_PLN_NO
        , SL_PLN_YRMON
        , N1ST_ITM_GRP_CD
        , ITM_CD
        , SL_CO_CD
        , SL_PLN_CD
        , SL_PLN_QTY
        , SL_PLN_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , CLZ_FLG
		, SL_ORD_NO
	    , SL_ORD_SEQ
    ) 
    VALUES 
    (
        #CHNL_CD#
	  , #SL_PLN_CD# + 'F' + SUBSTRING(#SL_PLN_YRMON#, 3, 6) + '-' + #ITM_CD#
	  , #SL_PLN_YRMON#
	  , #N1ST_ITM_GRP_CD#
	  , #ITM_CD#
	  , #CO_CD#
	  , #SL_PLN_CD#
	  , #SL_PLN_QTY#
	  , #SL_PLN_RMK#
	  , #CRE_USR_ID#
	  , GETDATE()
	  , #UPD_USR_ID#
	  , GETDATE()
	  , #CLZ_FLG#
	  , #SL_ORD_NO#
	  , #SL_ORD_SEQ#
	)
  </insert>   
		
		<update id="S2220UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
		UPDATE TB_SL_MON_PLN
          SET  N1ST_ITM_GRP_CD  = #N1ST_ITM_GRP_CD#
             , ITM_CD           = #ITM_CD#
             , SL_CO_CD         = #CO_CD#
             , SL_PLN_CD        = #SL_PLN_CD#
             , SL_PLN_QTY       = #SL_PLN_QTY#
             , SL_PLN_RMK       = #SL_PLN_RMK#
             , UPD_USR_ID       = #UPD_USR_ID#
             , UPD_DT           = GETDATE()
         WHERE 1 = 1
           AND CHNL_CD    = #CHNL_CD#
           AND SL_PLN_NO  = #SL_PLN_NO#
		</update>
  
		<delete id="S2220DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
			DELETE FROM TB_SL_MON_PLN
				WHERE 1=1
					 AND SL_PLN_NO  = #SL_PLN_NO#
                     AND CHNL_CD    = #CHNL_CD#
           <!--AND NOT EXISTS (SELECT 'X' FROM TB_PROD_MON_PLN AS Z WHERE 1=1 AND Z.CHNL_CD = #CHNL_CD# AND Z.SL_PLN_NO = #SL_PLN_NO#)-->
		</delete>

    
  
    <!-- 수금할인 계산서 할인 -->
	<select id="S22310SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
       SELECT  
					 CLT_BIL_DT
				   , CO_NM
				   , CLT_RMN_AMT
				   , CLT_AMT
				   , RMN_AMT
				   , RMN_TAX_AMT
				   , RMN_CLT_AMT
				   , CLT_DC_RT
				   , BIL_RMK
				   , CLT_USR_NM
				   , CLT_BIL_NO
				   , BIL_FLG
			   FROM
			   (
				  SELECT CONVERT(VARCHAR(10), T1.CLT_BIL_DT, 121)  AS CLT_BIL_DT
						  , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CLT_CO_CD)       AS CO_NM
						  , T1.CLT_RMN_AMT
						  , T1.CLT_AMT
						  , ROUND((T1.CLT_AMT - CLT_RMN_AMT) / 1.1, 0)                   AS RMN_AMT
						  , ROUND((T1.CLT_AMT - CLT_RMN_AMT) - ((T1.CLT_AMT - CLT_RMN_AMT) / 1.1), 0) AS RMN_TAX_AMT
						  , ROUND((T1.CLT_AMT - CLT_RMN_AMT), 0) AS RMN_CLT_AMT
						  , T1.CLT_DC_RT
						  , T1.BIL_RMK
						  , T1.CLT_USR_NM
						  , T1.CLT_BIL_NO
						  , dbo.FF_CLT_BIL_YN_FNC(T1.CHNL_CD, T1.CLT_BIL_NO) AS BIL_FLG
					  FROM TB_SL_CLT_BIL T1
						   WHERE 1 = 1
                  AND T1.CHNL_CD    = #CHNL_CD#
								  AND T1.AREA_CD    = #AREA_CD#
								  AND T1.CLT_DC_RT  > 0
								  AND T1.CLT_BIL_DT >= CAST(#FM_DT# +'01'+ ' 00:00:00' AS DATETIME)
								  AND T1.CLT_BIL_DT <![CDATA[ <= ]]> DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,CAST(#FM_DT#+'01' AS DATETIME))+1,0))
								  AND T1.BIL_RMK_CD = '103'
			   ) T2
			   WHERE 1=1
					  AND T2.BIL_FLG = #BIL_FLG#
	 </select>
		
	 <statement id="ProcS22310" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
			exec @RTN = sp_saleCltBilDC #CHNL_CD#, #AREA_CD#, #FM_DT#, #CLT_BIL_NO#
			select @RTN AS R_value
	 </statement>



	  <!-- (화성판매)현품표출력 -->
	<select id="S22230SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		SELECT    
		          CONVERT(VARCHAR, T3.IN_REQ_DT, 23) AS IN_REQ_DT  
		        , T3.ITM_CD    
		        , T5.ITM_NM 
		        , T5.ITM_SZ_NM 
		        , T3.PUR_QTY   
		        , T3.CO_UT_PRC AS ITM_PRC 
		        , T3.PUR_AMT   AS ITM_AMT 
		        , T3.PUR_ITM_RMK          
		        , T1.SL_ORD_NO          
		        , T1.SL_ORD_SEQ         
		        , CONVERT(VARCHAR, T1.DUE_DT, 23) AS DUE_DT         
		        , T1.SL_ORD_QTY         
		        , T1.ORD_ITM_CD         
		        , dbo.CD_ITEM_NM_FNC('C201030-HS', T1.ORD_ITM_CD)  AS  CUST_ITM_NM 
		        , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD) AS CUST_CO_NM 
		        , T1.CO_CD  AS CUST_CO_CD          
		        , T3.PUR_ORD_NO     
		        , T3.PUR_ORD_SEQ    
		        , T4.PUR_CO_CD      
		        , T2.UN_FOL_NO
		        , T2.MRP_SEQ
		        <!--, 'N'  AS CHK-->
		        , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T3.ITM_CD) AS RN
		        , T6.SCM_RLSE_NO
		        , T6.SL_RLSE_NO
		        , T6.SL_RLSE_SEQ
		        , CONVERT(VARCHAR, T6.SL_RLSE_DT, 23) AS SL_RLSE_DT
		FROM TB_PUR_MRP        T1
		    , TB_PUR_MRP_DTL   T2
		    , TB_PUR_ORD_DTL   T3
		    , TB_PUR_ORD       T4
		    , TB_CD_ITM        T5
		    , TB_SCM_ORD_IF    T6
		WHERE 1 = 1
		    AND T1.CHNL_CD     = 'C201030-HS'
		    AND T6.CHNL_CD     = #CHNL_CD#
		    AND T1.CHNL_CD     = T2.CHNL_CD
		    AND T1.CHNL_CD     = T3.CHNL_CD
		    AND T1.CHNL_CD     = T4.CHNL_CD
		    AND T1.CHNL_CD     = T5.CHNL_CD
		    AND T3.ITM_CD      = T5.ITM_CD
		    AND T1.UN_FOL_NO   = T2.UN_FOL_NO
		    AND T2.UN_FOL_NO   = T3.ORD_NO
		    AND T2.MRP_SEQ     = T3.ORD_SEQ
		    AND T3.PUR_ORD_NO  = T4.PUR_ORD_NO
		    AND T3.PUR_ORD_NO  = T6.SCM_PUR_NO
		    AND T3.PUR_ORD_SEQ = T6.SCM_PUR_SEQ
		    AND T4.PUR_CO_CD   = '10954'
		    AND T3.IN_REQ_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		    AND T3.IN_REQ_DT <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
	</select>


	  <statement id="ProcS22230" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
		  declare @RTN VARCHAR(MAX)
		  exec @RTN = sp_anpRlseCrt #CHNL_CD#, #SCM_RLSE_NO#, #PUR_ORD_NO#, #PUR_ORD_SEQ#, #CRE_USR_ID#
		  select @RTN AS R_value
	  </statement>

	  <!-- S22230  BarCode Report-->
	  <select id="S22230SelectDtlBarCodeReportList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Pur.PurVo">
		  SELECT 
		        T1.CHNL_CD
		      , T4.STK_SER_NO
		      , T1.PUR_ORD_NO
		      , T1.PUR_ORD_SEQ
		      , CONVERT(VARCHAR, T1.IN_REQ_DT, 23) AS IN_REQ_DT
		      , T1.ITM_CD
		      , T2.ITM_NM
		      , T2.ITM_SZ_NM
		      , T1.UOM_CD
		      , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T1.UOM_CD)  AS UOM_NM
		      , T1.PUR_ITM_RMK
		      , ROW_NUMBER() OVER (PARTITION BY  NULL ORDER BY  T2.ITM_CD  ) RN
		      , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
		      , (SELECT dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, X.PUR_CO_CD) FROM TB_PUR_ORD AS X  WHERE 1=1 AND  X.PUR_ORD_NO = T1.PUR_ORD_NO) AS CO_NM
		      , T3.SL_ORD_NO
		      , T3.SL_ORD_SEQ
		      , ISNULL(T2.PK_PER_QTY, 0) AS PK_PER_QTY
			  , T4.ITM_QTY AS SL_ITM_QTY
		  FROM TB_PUR_ORD_DTL  T1 LEFT OUTER JOIN TB_PUR_MRP T3 ON(T1.CHNL_CD = T3.CHNL_CD AND T1.ORD_NO = T3.UN_FOL_NO)
		  , TB_CD_ITM       T2
		  , TB_CD_STK_SER    T4
		  WHERE 1 = 1
		      AND T1.CHNL_CD     = 'C201030-HS'
		      AND T1.CHNL_CD     = T2.CHNL_CD
		      AND T1.CHNL_CD     = T4.CHNL_CD
		      AND T1.ITM_CD      = T2.ITM_CD
		      AND T1.PUR_ORD_NO  = #PUR_ORD_NO#
		      AND T1.PUR_ORD_NO  = T4.PUR_ORD_NO
		      AND T1.PUR_ORD_SEQ  = T4.PUR_ORD_SEQ
		      AND T3.SL_ORD_NO IS NOT NULL
		  ORDER BY T1.PUR_ORD_SEQ
	  </select>



      <!-- 판매출고처리 -->
    <select id="S22213SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT
            CONVERT(VARCHAR, T1.INAUD_DT, 23) AS FM_DT
          , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T3.CUST_CO_CD)  AS CO_NM
          , T3.SCM_RLSE_NO
          , T4.ITM_NM
          , T4.ITM_SZ_NM
          , T5.ITM_CD          AS N1ST_ITM_CD
          , T5.ITM_NM          AS N1ST_ITM_NM
          , T2.SCM_PUR_ITM_QTY AS SL_PLN_QTY
          , T1.ITM_QTY         AS IN_QTY
          , ISNULL(T6.ITM_ETC_QTY, 0) AS ITM_ROUT_QTY
          , T7.SL_QTY          AS ITM_PROD_QTY
          , T1.INAUD_TMP_NO
          , T1.INAUD_TMP_SEQ
          , T2.SCM_PUR_NO
          , T2.SCM_PUR_SEQ
          , T1.CHNL_CD
          , #CRE_USR_ID# AS CRE_USR_ID
      FROM TB_INAUD_TMP     T1
          , TB_SCM_PUR       T2
      OUTER APPLY
      (
        SELECT ISNULL(SUM(INAUD_QTY), 0)  AS SL_QTY
          FROM TB_INAUD_DTL X
            WHERE 1 = 1
              AND X.CHNL_CD  = #CHNL_CD#
              AND X.INAUD_CD = 'IGS'
              AND X.SL_ORD_NO = T2.SCM_PUR_NO
              AND X.SL_ORD_SEQ = T2.SCM_PUR_SEQ
        ) T7
        , MV_TB_CD_ITM     T5
        , TB_INVT_DLY_STK  T6
        , TB_SCM_ORD_RLSE  T3
        , MV_TB_CD_ITM     T4
      WHERE 1 = 1
          AND T1.CHNL_CD         =  #CHNL_CD#
          AND T1.CHNL_CD         = T2.CHNL_CD
          AND T1.CHNL_CD         = T3.CHNL_CD
          AND T1.CHNL_CD         = T4.CHNL_CD
          AND T1.CHNL_CD         = T5.CHNL_CD
          AND T1.CHNL_CD         = T6.CHNL_CD
          AND T1.PUR_ORD_NO      = T2.SCM_PUR_NO
          AND T1.PUR_ORD_SEQ     = T2.SCM_PUR_SEQ
          AND T2.SCM_RLSE_NO     = T3.SCM_RLSE_NO
          AND T3.ITM_CD          = T4.ITM_CD
          AND T2.SCM_PUR_ITM_CD  = T5.ITM_CD
          AND T2.SCM_PUR_ITM_CD  = T6.ITM_CD
          AND T1.INSP_FLG        = 'Y'
          AND T1.AREA_CD         = '001'
          AND T2.BOM_LVL_VAL     = 0
          AND T1.INAUD_DT       >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
          AND T1.INAUD_DT    <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
          AND NOT EXISTS
      (
        SELECT 'X' FROM TB_INAUD_DTL X  WHERE 1 = 1  
          AND X.CHNL_CD = 'C201030-ANP'  
          AND X.SL_ORD_NO  = T1.INAUD_TMP_NO  
          AND X.SL_ORD_SEQ = T1.INAUD_TMP_SEQ  AND X.INAUD_CD = 'IGS'
      )
    </select>

    <statement id="ProcS22213" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
      declare @RTN VARCHAR(MAX)
      exec @RTN = sp_saleRlseAnp #CHNL_CD#, #INAUD_TMP_NO#, #INAUD_TMP_SEQ#, #CRE_USR_ID#
      select @RTN AS R_value
    </statement>

    

    
    
     <!-- S3321 수주관리-->
     <!--수주관리 MST - 조회-->
     <select id="S3321SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
       SELECT  
              T1.CHNL_CD        AS CHNL_CD
            , T1.SL_RLSE_NO
            , T1.SL_CO_CD
            , T2.CO_NM
            , T1.SL_AREA_CD     AS SL_AREA_CD
            , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-002', T1.SL_AREA_CD) AS SL_AREA_NM
            , CONVERT(NVARCHAR, T1.SL_RLSE_DT, 23) AS SL_RLSE_DT
            , T1.SL_RMK
            , T1.CRE_USR_ID
            , dbo.USR_NM_FNC(T1.CHNL_CD , T1.CRE_USR_ID) AS  CRE_USR_NM
            , CONVERT(NVARCHAR, T1.CRE_DT, 121) AS CRE_DT
            , T1.UPD_USR_ID
            , T2.HDQTR_PHN_NO
            , T2.HDQTR_FAX_NO
            <!--, T2.CNTC_MAN_EML-->
            , #FM_DT#   AS FM_DT
            , #TO_DT#   AS TO_DT
         FROM TB_SL_RLSE T1
            , TB_CD_CO   T2
        WHERE 1 = 1
          AND T1.CHNL_CD   = #CHNL_CD#
          AND T1.CHNL_CD	 = T2.CHNL_CD
          AND T1.SL_CO_CD  = T2.CO_NO
        <isNotNull property="SL_CO_CD">
           AND T1.SL_CO_CD = #SL_CO_CD#
        </isNotNull>
        <isNotNull property="FM_DT">
           AND T1.SL_RLSE_DT >= CAST( #FM_DT# + ' 00:00:00' AS DATETIME)
           AND T1.SL_RLSE_DT <![CDATA[<=]]> CAST( #TO_DT# + ' 23:59:59' AS DATETIME)
        </isNotNull>
     </select>

     <!-- Service -->
     <select id="S3321SelectSlRlseNo" resultClass="string">
        SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'SR', #SL_AREA_CD#) AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
     </select>

     <update id="S3321UpdatePurOrdNo" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_SYS_NO_FMT
					SET LST_FMT_NO		= #SL_RLSE_NO#
						WHERE TBL_ID    = 'SR'
							AND CHNL_CD   = #CHNL_CD#
							AND AREA_CD   = #SL_AREA_CD#
     </update>

     <!--수주관리 MST - 추가-->
     <insert id="S3321InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        INSERT INTO TB_SL_RLSE
        (
            CHNL_CD
           ,SL_RLSE_NO
           ,SL_RLSE_DT
           ,SL_AREA_CD
           ,SL_CO_CD
           ,SL_RMK
           ,CRE_USR_ID
           ,CRE_DT
           ,UPD_USR_ID
           ,UPD_DT
        )
        VALUES
        (
            #CHNL_CD#
           ,#SL_RLSE_NO#
           ,#SL_RLSE_DT#
           ,#SL_AREA_CD#
           ,#SL_CO_CD#
           ,#SL_RMK#
           ,#CRE_USR_ID#
           ,GETDATE()
           ,#UPD_USR_ID#
           ,GETDATE()
        )
     </insert>


     <!--수주관리 MST - 수정-->
     <update id="S3321UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_SL_RLSE
        SET
            CHNL_CD     = #CHNL_CD#
          , SL_RLSE_NO  = #SL_RLSE_NO#
          , SL_RLSE_DT  = #SL_RLSE_DT#
          , SL_AREA_CD  = #SL_AREA_CD#
          , SL_CO_CD    = #SL_CO_CD#
          , SL_RMK      = #SL_RMK#
          , CRE_USR_ID  = #CRE_USR_ID#
          , CRE_DT      = #CRE_DT#
          , UPD_USR_ID  = #UPD_USR_ID#
          , UPD_DT      = GETDATE()
        WHERE 1=1 
          AND SL_RLSE_NO = #SL_RLSE_NO#
          AND CHNL_CD    = #CHNL_CD#
     </update>

     <!--수주관리 MST - 삭제-->
     <delete id="S3321DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        DELETE FROM TB_SL_RLSE
         WHERE 1 = 1
           AND CHNL_CD     = #CHNL_CD#
           AND SL_RLSE_NO  = #SL_RLSE_NO#
     </delete>
    
    
    
    <!-- 수주 관리 - 도면 선택 -->
    <select id="S3321SelectPopupList" parameterClass="ModelsLibrary.Pur.PurVo" resultClass="ModelsLibrary.Pur.PurVo">
       SELECT  
                T1.CHNL_CD
              , T1.PUR_NO
              , T1.PUR_SEQ
              , T1.DE_CO_NM
              , T1.CNTR_NM
              , T1.CNTR_PSN_NM
              , T1.FLR_NM
              , T1.FLR_NO
              , ISNULL(T1.PUR_QTY, 0) AS PUR_QTY
              , T1.PUR_WGT
              , T1.FLR_FILE
              , T1.CRE_USR_ID
              , CONVERT(NVARCHAR, T1.UPD_DT, 23) AS UPD_DT
              , T1.UPD_USR_ID
              , CONVERT(NVARCHAR, T1.IN_REQ_DT, 23) AS IN_REQ_DT
              , CONVERT(INT, ROW_NUMBER() OVER ( PARTITION BY  T1.PUR_NO ORDER BY  T1.PUR_SEQ )) AS RN
              , #GBN#  AS GBN
              , T1.FLR_FILE_ID
        FROM TB_CUST_PUR_DTL  T1
         WHERE 1 = 1
           AND T1.CHNL_CD = #CHNL_CD#
           AND T1.PUR_NO IN ( SELECT PUR_NO FROM TB_CUST_PUR AS T1 WHERE 1=1 AND T1.PUR_DT >= CAST( #FM_DT# + ' 00:00:00' AS DATETIME) AND T1.PUR_DT <![CDATA[<=]]>  CAST( #TO_DT#  + ' 23:59:59' AS DATETIME) )
     </select>



    <!--수주관리 DTL - 추가-->
	  <select id="S3321SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
	    SELECT 
            T2.SL_RLSE_NO
          , T2.SL_RLSE_SEQ
          , T3.ITM_CD
          , T3.ITM_NM
          , T3.ITM_SZ_NM
          , T2.ITM_SHP_CD	AS A1
	        , T2.ITM_STL_CD	AS A2
	        , T2.ITM_STL_SZ_CD	AS A3
	        , T2.ITM_STL_LENG	AS A4
          , T2.SL_ITM_QTY	AS A5
          , T2.SL_ITM_WGT		AS A6
			    , SL_ITM_RMK  AS SL_RMK
          , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM 
			    , T2.CUST_PUR_NO	  AS PUR_ORD_NO
			    , T2.CUST_PUR_SEQ   AS PUR_ORD_SEQ
			    , T5.FLR_NO         AS FLR_NO
			    , T2.CNTR_PSN_NM    AS CNTR_PSN_NM
			    , T2.CNTR_NM        AS CNTR_NM
          , T5.DE_CO_NM       AS CUST_CO_NM
          , CONVERT(VARCHAR, T5.IN_REQ_DT, 23)     AS IN_REQ_DT
          , CONVERT(INT, ROW_NUMBER() OVER ( PARTITION BY  T2.SL_RLSE_NO ORDER BY  T2.SL_RLSE_SEQ )) AS RN
          , T1.CHNL_CD
          , T2.ITM_STL_PRD_DESC
		    FROM TB_SL_RLSE      T1
			    , TB_SL_RLSE_DTL   T2 LEFT OUTER JOIN TB_CUST_PUR_DTL T5 ON (T2.CHNL_CD = T5.CHNL_CD AND T2.CUST_PUR_NO = T5.PUR_NO AND T2.CUST_PUR_SEQ = T5.PUR_SEQ)
			    , TB_CD_ITM      T3
		    WHERE 1 = 1
			    AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
			    AND T1.CHNL_CD     = T2.CHNL_CD
			    AND T1.CHNL_CD     = #CHNL_CD#
			    AND T2.SL_ITM_CD   = T3.ITM_CD
		      AND T2.SL_RLSE_NO  = #SL_RLSE_NO#
		</select>


    <!--수주관리 DTL - 추가-->
     <insert id="S3321InsertDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
				 INSERT INTO TB_SL_RLSE_DTL 
         (
           	     CHNL_CD
             ,   SL_RLSE_NO
             ,   SL_RLSE_SEQ
             ,   SL_ITM_CD
             ,   ITM_STL_SZ_CD
             ,   ITM_STL_LENG
             ,   SL_ITM_QTY
             ,   SL_ITM_WGT
             ,   ITM_STL_CD
             ,   CRE_USR_ID
             ,   CRE_DT
             ,   UPD_USR_ID
             ,   UPD_DT
             ,   CUST_PUR_NO
             ,   CUST_PUR_SEQ
             ,   CNTR_NM
             ,   CNTR_PSN_NM
             ,   IN_REQ_DT
             ,   ITM_STL_PRD_DESC
					) 
          VALUES
          (
              #CHNL_CD#
            , #SL_RLSE_NO#
            , (SELECT  ISNULL(MAX(SL_RLSE_SEQ), 0) + 1 FROM TB_SL_RLSE_DTL WHERE 1 = 1 AND CHNL_CD = #CHNL_CD# AND SL_RLSE_NO = #SL_RLSE_NO#)
            , #SL_ITM_CD#
            , #ITM_STL_SZ_CD#
            , #ITM_STL_LENG#
            , #A1#
            , #SL_ITM_WGT#
            , #ITM_STL_CD#
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()
            , #PUR_ORD_NO#
            , #PUR_ORD_SEQ#
            , #CNTR_NM#
            , #CNTR_PSN_NM#
            , #IN_REQ_DT#
            , #ITM_STL_PRD_DESC#
        	)
		</insert>

    <!--수주관리 DTL - 삭제-->
    <delete id="S3321DeleteDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE FROM TB_SL_RLSE_DTL
        WHERE 1 = 1
          AND CHNL_CD     = #CHNL_CD#
          AND SL_RLSE_NO  = #SL_RLSE_NO#
        <isNotNull property="SL_RLSE_SEQ">
          AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
        </isNotNull>
    </delete>
    
    
    
    
    <!--거래처별 판가기준표 MST -->
    <select id="S3311SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT CO_NO
           , CO_NM
           , FM_DT
           , CHNL_CD
           , GBN
        FROM (
          SELECT T1.CO_NO
               , T2.CO_NM
               , CONVERT(VARCHAR, T1.CNG_APLY_DT, 23) AS FM_DT
               , T1.CHNL_CD
               , T1.ITM_BZTP_FLG AS GBN
               , ROW_NUMBER() OVER (PARTITION BY T1.CO_NO ORDER BY T1.CNG_APLY_DT DESC) AS RN
             FROM TB_CD_CO_UT_PRC AS T1
                , TB_CD_CO           T2
                WHERE 1=1
                    AND T1.CHNL_CD                = T2.CHNL_CD
                    AND T1.CO_NO                  = T2.CO_NO
                    AND T1.CHNL_CD                = #CHNL_CD#
               AND T2.AREA_CD                = #AREA_CD#
                    AND T1.ITM_BZTP_FLG           = #GBN#   
                ) T1
             WHERE 1 = 1
                 AND RN = 1
    </select>
    
      <!--거래처별 판가기준표  MST - 추가-->
     <insert id="S3311InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
       WITH TMP AS 
       (
         SELECT T1.N1ST_CD
               , T1.N1ST_NM
               , T1.N1ST_KNT
               , T1.N1ST_SRT_SEQ
               , T2.N2ND_CD
               , T2.N2ND_NM
               , T2.N2ND_KNT
               , T2.N2ND_SRT_SEQ
         FROM (
                  SELECT CLSS_CD      AS N1ST_CD
                        , CLSS_DESC    AS N1ST_NM
                        , COUNT(*) OVER (PARTITION BY NULL) AS N1ST_KNT
                        , CLSS_ORD_SEQ AS  N1ST_SRT_SEQ
                  FROM TB_SYS_CLSS_CD
                  WHERE 1 = 1
                      AND CLSS_TP_CD = 'L-909'
                      AND DELT_FLG   = 'N'
                      AND CHNL_CD = #CHNL_CD#
                      AND USE_ST_DT   <![CDATA[ <= ]]>  GETDATE() 
                      AND USE_END_DT >= GETDATE()
              ) T1,               
              (
                  SELECT CLSS_CD      AS N2ND_CD
                        , CLSS_DESC    AS N2ND_NM
                        , COUNT(*) OVER (PARTITION BY NULL) AS N2ND_KNT
                        , CLSS_ORD_SEQ AS N2ND_SRT_SEQ
                    FROM TB_SYS_CLSS_CD
                    WHERE 1 = 1
                      AND CLSS_TP_CD = 'L-910'
                      AND DELT_FLG   = 'N'
                           AND CHNL_CD = #CHNL_CD#
                      AND USE_ST_DT  <![CDATA[ <= ]]>  GETDATE() 
                      AND USE_END_DT >= GETDATE()
              ) T2   
          )
          INSERT INTO TB_CD_CO_UT_PRC
           (
               ITM_CD
             , CO_ITM_CD
             , CO_NO
             , CNG_APLY_DT
             , ITM_BZTP_FLG
             , CO_ITM_NM
             , CO_UT_PRC
             , MN_CO_FLG
             , CRNT_PRC_FLG
             , UOM_CD
             , LOT_VAL
             , CURR_CD
             , CNG_HIS_DESC
             , CRE_USR_ID
             , CRE_DT
             , UPD_USR_ID
             , UPD_DT
             , CHNL_CD
             , ITM_STEL_CD
             , ITM_STEL_SZ_CD
           )
            SELECT
                T1.N1ST_CD
               , T1.N2ND_CD
               , #CO_NO#       AS CO_NO
               , GETDATE()     AS CNG_APLY_DT
               , #GBN#         AS ITM_BZTP_FLG
               , NULL          AS CO_ITM_NM
               , 0.0           AS CO_UT_PRC
               , 'Y'           AS MN_CO_FLG
               , 'Y'           AS CRNT_PRC_FLG
               , NULL          AS UOM_CD
               , NULL          AS LOT_VAL
               , 'KRW'         AS CURR_CD
               , NULL          AS CNG_HIS_DESC
               , #CRE_USR_ID#  AS CRE_USR_ID
               , GETDATE()     AS CRE_DT
               , #UPD_USR_ID#  AS UPD_USR_ID
               , GETDATE()     AS UPD_DT
               , #CHNL_CD#     AS CHNL_CD
               , NULL          AS ITM_STEL_CD
               , NULL          AS ITM_STEL_SZ_CD
            FROM TMP T1               
           WHERE 1 = 1
     </insert>


     <!--거래처별 판가기준표  MST - 수정-->
     <update id="S3311UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
       WITH TMP AS (
          SELECT T1.N1ST_CD
               , T1.N1ST_NM
               , T1.N1ST_KNT
               , T1.N1ST_SRT_SEQ
               , T2.N2ND_CD
               , T2.N2ND_NM
               , T2.N2ND_KNT
               , T2.N2ND_SRT_SEQ     
            FROM (
                    SELECT CLSS_CD      AS N1ST_CD
                         , CLSS_DESC    AS N1ST_NM
                         , COUNT(*) OVER (PARTITION BY NULL) AS N1ST_KNT
                         , CLSS_ORD_SEQ AS  N1ST_SRT_SEQ
                      FROM TB_SYS_CLSS_CD
                     WHERE 1 = 1
                       AND CLSS_TP_CD = 'L-909'
                       AND DELT_FLG   = 'N'
                       AND CHNL_CD = #CHNL_CD#
                       AND USE_ST_DT  <![CDATA[ <= ]]> GETDATE() 
                       AND USE_END_DT >= GETDATE()
                  ) T1,               
                (
                    SELECT CLSS_CD      AS N2ND_CD
                         , CLSS_DESC    AS N2ND_NM
                         , COUNT(*) OVER (PARTITION BY NULL) AS N2ND_KNT
                         , CLSS_ORD_SEQ AS N2ND_SRT_SEQ
                      FROM TB_SYS_CLSS_CD
                     WHERE 1 = 1
                       AND CLSS_TP_CD = 'L-910'
                       AND DELT_FLG   = 'N'
                       AND CHNL_CD = #CHNL_CD#
                       AND USE_ST_DT  <![CDATA[ <= ]]> GETDATE() 
                       AND USE_END_DT >= GETDATE()
                ) T2   
          )
        , TMP_DT AS 
        (
          SELECT ITM_CD
                , CO_ITM_CD
                , CO_NO
                , CNG_APLY_DT
                , ITM_BZTP_FLG
            FROM (
           SELECT ROW_NUMBER() OVER (PARTITION BY ITM_CD, CO_ITM_CD, CO_NO ORDER BY CNG_APLY_DT DESC) AS RN 
                , ITM_CD
                , CO_ITM_CD
                , CO_NO
                , CNG_APLY_DT
                , ITM_BZTP_FLG
             FROM TB_CD_CO_UT_PRC 
            WHERE 1 = 1
              AND CHNL_CD       = #CHNL_CD#
              AND CO_NO         = #CO_NO#
              AND ITM_BZTP_FLG  = #ITM_BZTP_FLG#
              AND CNG_APLY_DT   <![CDATA[ <= ]]> CAST(#FM_DT# + ' 23:59:59' AS DATETIME)
             ) T1
           WHERE RN = 1   
        )
          UPDATE TB_CD_CO_UT_PRC
             SET CO_UT_PRC  = #CO_UT_PRC#
            FROM TMP    T1
               , TMP_DT T2
           WHERE 1 = 1
             AND TB_CD_CO_UT_PRC.CHNL_CD      = #CHNL_CD#
             AND TB_CD_CO_UT_PRC.ITM_CD       = (CASE WHEN T1.N1ST_SRT_SEQ = #XLS_A# THEN T1.N1ST_CD END )
             AND TB_CD_CO_UT_PRC.CO_ITM_CD    = (CASE WHEN T1.N2ND_SRT_SEQ = #XLS_B# THEN T1.N2ND_CD END )
             AND TB_CD_CO_UT_PRC.ITM_CD       = T2.ITM_CD
             AND TB_CD_CO_UT_PRC.CO_ITM_CD    = T2.CO_ITM_CD
             AND TB_CD_CO_UT_PRC.CO_NO        = T2.CO_NO
             AND TB_CD_CO_UT_PRC.CNG_APLY_DT  = T2.CNG_APLY_DT
             AND TB_CD_CO_UT_PRC.ITM_BZTP_FLG = T2.ITM_BZTP_FLG
     </update>

     <!--거래처별 판가기준표  MST - 삭제-->
     <delete id="S3311DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        DELETE FROM TB_CD_CO_UT_PRC
         WHERE 1 = 1
           AND CHNL_CD                           = #CHNL_CD#
           AND CO_NO                             = #CO_NO#
           AND CONVERT(VARCHAR, CNG_APLY_DT, 23) = #FM_DT#
		   AND ITM_BZTP_FLG                      = #GBN#
     </delete>
    

    <select id="S3311SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      WITH TMP AS (
        SELECT T1.N1ST_CD
             , T1.N1ST_NM
             , T1.N1ST_KNT
             , T1.N1ST_SRT_SEQ
             , T2.N2ND_CD
             , T2.N2ND_NM
             , T2.N2ND_KNT
             , T2.N2ND_SRT_SEQ    
          FROM (
                  SELECT CLSS_CD      AS N1ST_CD
                       , CLSS_DESC    AS N1ST_NM
                       , COUNT(*) OVER (PARTITION BY NULL) AS N1ST_KNT
                       , CLSS_ORD_SEQ AS  N1ST_SRT_SEQ
                    FROM TB_SYS_CLSS_CD
                   WHERE 1 = 1
                     AND CLSS_TP_CD = 'L-909'
                     AND DELT_FLG   = 'N'
                     AND USE_ST_DT  <![CDATA[ <= ]]> GETDATE() 
                     AND USE_END_DT >= GETDATE()
                ) T1,               
              (
                SELECT CLSS_CD      AS N2ND_CD
                   , CLSS_DESC    AS N2ND_NM
                   , COUNT(*) OVER (PARTITION BY NULL) AS N2ND_KNT
                   , CLSS_ORD_SEQ AS N2ND_SRT_SEQ
                FROM TB_SYS_CLSS_CD
               WHERE 1 = 1
                 AND CLSS_TP_CD = 'L-910'
                 AND DELT_FLG   = 'N'
                 AND USE_ST_DT  <![CDATA[ <= ]]> GETDATE() 
                 AND USE_END_DT >= GETDATE()
              ) T2   
        )                                                         
        , TMP_DT AS 
        (                                             
            SELECT ITM_CD
                  , CO_ITM_CD
                  , CO_NO
                  , CNG_APLY_DT
                  , ITM_BZTP_FLG
              FROM (
                   SELECT ROW_NUMBER() OVER (PARTITION BY ITM_CD, CO_ITM_CD, CO_NO ORDER BY CNG_APLY_DT DESC) AS RN  
                        , ITM_CD           
                        , CO_ITM_CD        
                        , CO_NO            
                        , CNG_APLY_DT      
                        , ITM_BZTP_FLG     
                     FROM TB_CD_CO_UT_PRC  
                    WHERE 1 = 1
                      AND CHNL_CD       = #CHNL_CD#
                      AND CO_NO         = #CO_NO#   
                      AND ITM_BZTP_FLG  = #GBN#    
                      AND CNG_APLY_DT  <![CDATA[ <= ]]> CAST(#FM_DT# + ' 23:59:59' AS DATETIME)   
           ) T1
         WHERE RN = 1   
      )                                                                                              
        SELECT 'D10' AS GBN
            , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 1 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 1 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 1 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 1 THEN T1.CO_UT_PRC END), 0) AS A4
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1     
             , TMP              T2     
             , TMP_DT           T3     
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#  
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG
      UNION ALL
        SELECT 'D13' AS GBN
            , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 2 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 2 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 2 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 2 THEN T1.CO_UT_PRC END), 0) AS A4
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1    
             , TMP              T2    
             , TMP_DT           T3    
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#  
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG   
      UNION ALL
        SELECT 'D16' AS GBN
              , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 3 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 3 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 3 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 3 THEN T1.CO_UT_PRC END), 0) AS A4
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1     
             , TMP              T2     
             , TMP_DT           T3     
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#  
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG   
      UNION ALL
        SELECT 'D19' AS GBN
              , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 4 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 4 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 4 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 4 THEN T1.CO_UT_PRC END), 0) AS A4
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1    
             , TMP              T2    
             , TMP_DT           T3    
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#  
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG   
      UNION ALL
        SELECT 'D22' AS GBN
              , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 5 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 5 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 5 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 5 THEN T1.CO_UT_PRC END), 0) AS A4
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1 
             , TMP              T2 
             , TMP_DT           T3 
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG   
      UNION ALL
        SELECT 'D25' AS GBN
              , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 6 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 6 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 6 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 6 THEN T1.CO_UT_PRC END), 0) AS A4 
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1     
             , TMP              T2     
             , TMP_DT           T3     
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG   
      UNION ALL
        SELECT 'D29' AS GBN
              , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 7 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 7 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 7 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 7 THEN T1.CO_UT_PRC END), 0) AS A4
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1    
             , TMP              T2    
             , TMP_DT           T3    
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG   
      UNION ALL
        SELECT 'D32' AS GBN
              , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 1 AND T2.N2ND_SRT_SEQ = 8 THEN T1.CO_UT_PRC END), 0) AS A1
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 2 AND T2.N2ND_SRT_SEQ = 8 THEN T1.CO_UT_PRC END), 0) AS A2
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 3 AND T2.N2ND_SRT_SEQ = 8 THEN T1.CO_UT_PRC END), 0) AS A3
             , ISNULL(MAX(CASE WHEN T2.N1ST_SRT_SEQ = 4 AND T2.N2ND_SRT_SEQ = 8 THEN T1.CO_UT_PRC END), 0) AS A4
          , MAX(T1.ITM_BZTP_FLG)  AS ITM_BZTP_FLG
          FROM TB_CD_CO_UT_PRC  T1     
             , TMP              T2     
             , TMP_DT           T3     
         WHERE 1 = 1
           AND T1.CHNL_CD   = #CHNL_CD#
           AND T1.CO_NO     = #CO_NO#
           AND T1.ITM_CD    = T2.N1ST_CD
           AND T1.CO_ITM_CD = T2.N2ND_CD
           AND T1.ITM_CD    = T3.ITM_CD
           AND T1.CO_ITM_CD = T3.CO_ITM_CD
           AND T1.CO_NO     = T3.CO_NO
           AND T1.CNG_APLY_DT = T3.CNG_APLY_DT
           AND T1.ITM_BZTP_FLG = T3.ITM_BZTP_FLG
    </select>
    
    
    
    <!-- 주문별 생산공장/GR확정 MST --><!--
    <select id="S22223SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT  
                ROW_NUMBER() OVER(PARTITION BY NULL ORDER BY T1.IN_REQ_DT) AS RN
              , CONVERT(VARCHAR, T1.IN_REQ_DT, 23)    AS IN_REQ_DT      
              , T1.DE_CO_NM                           AS GBN       
		          , T3.SL_CO_CD		                        AS CO_CD			
		          , CONVERT(VARCHAR, T3.SL_RLSE_DT, 23)   AS SL_RLSE_DT	
	            , T1.CNTR_NM                            AS CNTR_NM     
              , T1.CNTR_PSN_NM                        AS CNTR_PSN_NM 
              , T1.FLR_NM                             AS FLR_NM      
              , T1.FLR_NO                             AS FLR_NO      
              , ISNULL(T2.RLSE_ACT_FLG, 'N')          AS ACT_FLG
              , SUM(T2.SL_ITM_QTY)                    AS ITM_STK_QTY 
              , SUM(T2.SL_ITM_WGT)                    AS SL_ITM_WGT 
              , T2.CUST_PUR_NO                        AS SL_ORD_NO
              , T2.CUST_PUR_SEQ                       AS SL_ORD_SEQ
              , MAX(T1.CHNL_CD)                       AS CHNL_CD
        FROM   TB_CUST_PUR_DTL T1
             , TB_SL_RLSE_DTL  T2
	           , TB_SL_RLSE T3
       WHERE 1 = 1 
          AND T1.CHNL_CD    =  T2.CHNL_CD 
          AND T1.CHNL_CD	  =	 T3.CHNL_CD
          AND T1.CHNL_CD    =  #CHNL_CD#
          AND T1.PUR_NO     =  T2.CUST_PUR_NO
          AND T1.PUR_SEQ    =  T2.CUST_PUR_SEQ
          AND T3.SL_RLSE_NO =	T2.SL_RLSE_NO
          --><!-- 판매처 --><!--
        <isNotNull property="CO_CD">
          AND T3.SL_CO_CD		= #CO_CD#
        </isNotNull>
        --><!--<isNotNull property="Y1_FM_DT">
          --><!-- 주문 등록일 --><!--
          AND T3.SL_RLSE_DT            >= CAST(#Y1_FM_DT# + ' 00:00:00' AS DATETIME)
          AND T3.SL_RLSE_DT  <![CDATA[ <= ]]> CAST(#Y1_TO_DT# + ' 23:59:59' AS DATETIME)
        </isNotNull>--><!--
        <isNotNull property="FM_DT">
          --><!-- 납품 요청일 --><!--
          AND T1.IN_REQ_DT            >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
          AND T1.IN_REQ_DT  <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
        </isNotNull>
        GROUP BY T1.IN_REQ_DT, T1.DE_CO_NM, T1.CNTR_NM, T1.CNTR_PSN_NM, T1.FLR_NM, T1.FLR_NO, T2.RLSE_ACT_FLG, T3.SL_CO_CD, T3.SL_RLSE_DT, T2.CUST_PUR_NO, T2.CUST_PUR_SEQ 
    </select>
    
    --><!-- 주문별 생산공장/GR확정 DTL --><!--
    <select id="S22223SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
     SELECT 
                T1.SL_RLSE_NO         AS  SL_RLSE_NO  
              , T1.SL_RLSE_SEQ        AS  SL_RLSE_SEQ 
              , T1.RLSE_CMD_NO        AS  RLSE_CMD_NO 
              , T2.FLR_NO             AS  FLR_NO      
              , T1.CNTR_NM            AS  CNTR_NM     
              , T1.CNTR_PSN_NM        AS  CNTR_PSN_NM 
              , LEFT(T1.ITM_SHP_CD, CHARINDEX('_', T1.ITM_SHP_CD)-1)   AS  ITM_SHP_CD  
              , CONCAT(T1.SL_ITM_CD ,'-', T1.ITM_STL_CD ,'-', T1.ITM_STL_SZ_CD ,'-', CONVERT(INT,T1.ITM_STL_LENG)) AS ITM_CD 
              , CONVERT(INT, T1.SL_ITM_QTY)         AS  SL_ITM_QTY  
              , T1.SL_ITM_WGT         AS  SL_ITM_WGT  
              , T1.RLSR_BCD_NO        AS  GBN
              , T1.CHNL_CD	
        FROM  TB_SL_RLSE_DTL    T1
             ,TB_CUST_PUR_DTL   T2
       WHERE 1 = 1
          AND T1.CHNL_CD		  = T2.CHNL_CD 
          AND T1.CUST_PUR_NO	= T2.PUR_NO
          AND T1.CUST_PUR_SEQ = T2.PUR_SEQ  
          AND T1.CHNL_CD		  = #CHNL_CD#
          --><!--
            AND T1.CUST_PUR_NO  = #SL_ORD_NO#
            AND T1.CUST_PUR_SEQ = #SL_ORD_SEQ#
          --><!--
          <isNotNull property="A_GBN">
            <iterate property="A_GBN" prepend=" AND T1.CUST_PUR_NO + '-' + CONVERT(VARCHAR, T1.CUST_PUR_SEQ) IN " open = "(" close=")" conjunction=",">
                #A_GBN[]#
            </iterate>
          </isNotNull>
    </select>
    
    
    		
			--><!-- Service --><!--
		<select id="S22223SelectRlseCmdNo" resultClass="string">
			SELECT dbo.FF_NO_FMT(#CHNL_CD#, #TBL_ID#, #AREA_CD#) AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
		</select>

		<update id="S22223UpdateRlseCmdNo" parameterClass="ModelsLibrary.Sale.SaleVo">
			UPDATE TB_SYS_NO_FMT
				SET LST_FMT_NO  = #LST_FMT_NO#
			 WHERE TBL_ID     = #TBL_ID#
					AND AREA_CD   = #AREA_CD#
          AND CHNL_CD   = #CHNL_CD#
		</update>
    
  
     --><!--주문별 생산공장/GR확정 MST - GR 확정 --><!--
     <update id="S22223UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_SL_RLSE_DTL
        SET
            RLSE_ACT_FLG  = 'Y' 
          , RLSE_CMD_NO   = #LST_FMT_NO#
          , RLSR_BCD_NO   = #GBN#
          , IN_REQ_DT     = #IN_REQ_DT#
          , UPD_USR_ID    = #UPD_USR_ID#
          , UPD_DT        = GETDATE()
    WHERE 1 = 1 
       AND CHNL_CD      =  #CHNL_CD#
       AND SL_RLSE_NO   =  #SL_RLSE_NO#
       AND SL_RLSE_SEQ  =  #SL_RLSE_SEQ#
     </update>-->


    <!-- 수주현황	 -->
    <select id="S2215SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT T1.SL_RLSE_NO  
            , CONVERT(VARCHAR, T1.SL_RLSE_DT, 23) AS SL_RLSE_DT 
            , T1.SL_CO_CD   
            , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD)  AS CO_NM   
            , T2.SL_ITM_CD  AS ITM_CD
            , T3.N1ST_ITM_GRP_NM 
            , T3.N2ND_ITM_GRP_NM 
            , T3.ITM_NM     
            , T3.ITM_SZ_NM  
            , CONVERT(FLOAT, T2.SL_ITM_QTY) AS SL_ITM_QTY
            , T2.SL_ITM_PRC_DC_VAL AS ITM_PRC
            , CONVERT(FLOAT, T2.SL_ITM_AMT) AS SL_ITM_AMT    
            , CONVERT(FLOAT, T2.SL_ITM_TAX_AMT) AS  SL_ITM_TAX_AMT
            , T2.SL_ITM_RMK    
          FROM TB_SL_RLSE       T1
            ,  TB_SL_RLSE_DTL   T2
            ,  MV_TB_CD_ITM        T3
          WHERE 1 = 1
            AND T1.CHNL_CD     = T2.CHNL_CD
            AND T1.CHNL_CD     = T3.CHNL_CD
            AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
            AND T2.SL_ITM_CD   = T3.ITM_CD
            AND T1.CHNL_CD     = #CHNL_CD#
            AND T1.SL_RLSE_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
            AND T1.SL_RLSE_DT  <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
    </select>



    <!-- 출하현황 -->
    <select id="S2230SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT T2.RLSE_CMD_NO 
		            , CONVERT(VARCHAR, T6.SL_BIL_DT, 23) AS   SL_BIL_DT 
		            , T6.SL_CO_CD    
		            , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T6.SL_CO_CD)  AS SL_CO_NM     
		            , T3.N1ST_ITM_GRP_NM   
		            , T3.N2ND_ITM_GRP_NM   
		            , T2.SL_ITM_CD   AS ITM_CD
		            , T3.ITM_NM     
		            , T3.ITM_SZ_NM   
		            , CONVERT(FLOAT, T5.SL_ITM_QTY) AS SL_ITM_QTY
		            , T5.SL_ITM_PRC_DC_VAL AS ITM_PRC  
		            , CONVERT(FLOAT, T5.SL_ITM_AMT) AS  SL_ITM_AMT    
		            , CONVERT(FLOAT, T5.SL_ITM_TAX_AMT) AS SL_ITM_TAX_AMT
		            , T5.SL_ITM_RMK      
		            , T2.RLSE_CMD_NO    
		            , T1.SL_RLSE_NO  
		            , CONVERT(VARCHAR, T1.SL_RLSE_DT,  23) AS  SL_RLSE_DT
		        FROM TB_SL_RLSE       T1
		            ,  TB_SL_RLSE_DTL   T2
		            ,  MV_TB_CD_ITM     T3
		            ,  TB_SL_RLSE_MAP   T4 
		            ,  TB_SL_BIL_DTL    T5  
		            ,  TB_SL_BIL        T6  
		       WHERE 1 = 1
		          AND T1.CHNL_CD     = T2.CHNL_CD
		          AND T1.CHNL_CD     = T3.CHNL_CD
  		        AND T1.CHNL_CD     = T4.CHNL_CD
 		          AND T1.CHNL_CD     = T5.CHNL_CD
		          AND T1.CHNL_CD     = T6.CHNL_CD
		          AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
		          AND T2.SL_ITM_CD   = T3.ITM_CD
		          AND T2.SL_RLSE_NO  = T4.SL_RLSE_NO
		          AND T2.SL_RLSE_SEQ = T4.SL_RLSE_SEQ
		          AND T4.SL_BIL_NO   = T5.SL_BIL_NO
		          AND T4.SL_BIL_SEQ  = T5.SL_BIL_SEQ
		          AND T5.SL_BIL_NO   = T6.SL_BIL_NO
		          AND T1.CHNL_CD     = #CHNL_CD#
		          AND T6.SL_BIL_DT   >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		          AND T6.SL_BIL_DT   <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
    </select>
    
    
    
    
        <!-- LOT 추적 -->
    <select id="S2232SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT T1.SL_RLSE_NO       
             , CONVERT(VARCHAR, T1.SL_RLSE_DT, 23)  AS SL_RLSE_DT  
             , T1.SL_CO_CD      
             , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD)  AS SL_CO_NM
             , T2.SL_ITM_CD       AS ITM_CD
             , T5.ITM_NM          
             , T5.ITM_SZ_NM       
             , T2.SL_ITM_QTY  AS SL_ORD_QTY  
             , T4.LOT_DIV_NO  AS GBN
             , T4.PROD_QTY    AS ITM_PROD_QTY      
             , T4.PROD_BAD_QTY      AS OUT_QTY
             , T2.RLSE_CMD_NO       
             , CONVERT(VARCHAR, T3.SL_BIL_DT,  23) AS  SL_BIL_DT    
             , ISNULL(T3.RLSE_QTY, 0) AS IN_QTY 
          FROM TB_SL_RLSE       T1
            ,  TB_SL_RLSE_DTL   T2
            OUTER APPLY (
               SELECT Y.SL_BIL_DT
                    , Y.SL_BIL_NO
                    , ISNULL(SUM(Z.SL_ITM_QTY), 0)   AS RLSE_QTY 
                 FROM TB_SL_RLSE_MAP  X
                    , TB_SL_BIL       Y 
                    , TB_SL_BIL_DTL   Z
               WHERE 1 = 1
                 AND X.CHNL_CD      = #CHNL_CD#
                 AND X.CHNL_CD      = Y.CHNL_CD
                 AND X.CHNL_CD      = Z.CHNL_CD         
                 AND X.SL_BIL_NO    = Z.SL_BIL_NO         
                 AND X.SL_BIL_SEQ   = Z.SL_BIL_SEQ
                 AND Y.SL_BIL_NO    = Z.SL_BIL_NO         
                 AND X.SL_RLSE_NO   = T2.SL_RLSE_NO
                 AND X.SL_RLSE_SEQ  = T2.SL_RLSE_SEQ 
             GROUP BY Y.SL_BIL_DT
                    , Y.SL_BIL_NO         
             ) T3 
           OUTER APPLY (
              SELECT X.LOT_DIV_NO
                  ,  ISNULL(SUM(Y.PROD_GD_QTY), 0) AS PROD_QTY 
                   , ISNULL(MAX(Z.BAD_QTY), 0)     AS PROD_BAD_QTY 
                FROM TB_PROD_LOT_DIV  X
                   , TB_PROD_JB_ORD   Y
                   OUTER APPLY ( 
                      SELECT  SUM(Z.BAD_QTY)  AS BAD_QTY
                        FROM TB_PROD_CD_BAD Z
                       WHERE Z.CHNL_CD      = #CHNL_CD#
                         AND Z.LOT_DIV_NO   = Y.LOT_DIV_NO 
                         AND Z.LOT_DIV_SEQ  = Y.LOT_DIV_SEQ
                    ) Z
               WHERE 1 = 1
                 AND X.CHNL_CD      = #CHNL_CD#
                 AND X.CHNL_CD     = Y.CHNL_CD
                 AND X.LOT_DIV_NO  = Y.LOT_DIV_NO
                 AND X.ORD_NO      = T2.SL_RLSE_NO 
                 AND X.ORD_SEQ     = T2.SL_RLSE_SEQ
            GROUP BY X.LOT_DIV_NO         
           ) T4
           , MV_TB_CD_ITM  T5
         WHERE 1 = 1    
           AND T1.CHNL_CD     = #CHNL_CD#
           AND T1.CHNL_CD     = T2.CHNL_CD
           AND T1.CHNL_CD     = T5.CHNL_CD
           AND T2.SL_ITM_CD   = T5.ITM_CD
           AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO   
           AND T1.SL_RLSE_DT  >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)
           AND T1.SL_RLSE_DT  <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
    </select>

    
    
    
    
    

    <!-- GR확정 화면 -->
    <select id="S22225SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
     SELECT
          T1.RLSE_CMD_NO
        , CONVERT(VARCHAR, MAX(T1.IN_REQ_DT), 23) AS IN_REQ_DT
        , MAX(T1.CNTR_NM)   AS CNTR_NM
        , SUM(T1.SL_ITM_QTY) AS SUM_ITM_QTY
        , SUM(T1.SL_ITM_WGT) AS SUM_ITM_WGT
        , MAX(T1.CHNL_CD)   AS CHNL_CD
		    , MAX(T2.RLSE_LOT_NO)  AS RLSE_LOT_NO                                  
		    , MAX(T2.PROD_EQ_NO)   AS PROD_EQ_NO                                   
		    , CONVERT(VARCHAR, MAX(T2.RLSE_DIV_DT), 23) AS RLSE_DIV_DT             
      FROM  TB_SL_RLSE_DTL T1 LEFT OUTER JOIN TB_SL_RLSE_LOT T2 ON (T1.RLSE_CMD_NO = T2.RLSE_LOT_NO AND T1.CHNL_CD = T2.CHNL_CD)
        WHERE 1=1
          AND T1.CHNL_CD  = #CHNL_CD#
          AND T1.RLSE_CMD_NO IS NOT NULL
          AND T1.OK_FLG = 'Y'
		      AND T1.IN_REQ_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		      AND T1.IN_REQ_DT  <![CDATA[ <= ]]>  CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
      GROUP BY RLSE_CMD_NO
    </select>


    <select id="S22225SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT
          T1.CNTR_PSN_NM
        , T1.SL_ITM_CD
        , T1.ITM_STL_CD
        , T1.ITM_STL_SZ_CD
        , T1.ITM_STL_LENG
        , T1.RLSR_BCD_NO
        , T1.SL_ITM_QTY
        , T1.SL_ITM_WGT
        , T1.RLSE_CMD_NO
        , T1.CHNL_CD
      FROM TB_SL_RLSE_DTL T1
        WHERE 1=1
          AND CHNL_CD  = #CHNL_CD#
          AND RLSE_CMD_NO = #RLSE_CMD_NO#
    </select>

    
    <!--생산분배 MST - 추가-->
    <insert id="S22225InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_SL_RLSE_LOT
      (
         CHNL_CD
       , RLSE_LOT_NO
       , RLSE_LOT_SEQ
       , RLSE_DIV_DT
       , PROD_EQ_NO
       , CRE_USR_ID
       , CRE_DT
       , UPD_USR_ID
       , UPD_DT
      )
      VALUES
      (
         #CHNL_CD#
       , #RLSE_CMD_NO#
       , ISNULL((SELECT MAX(RLSE_LOT_SEQ) + 1 FROM TB_SL_RLSE_LOT WHERE RLSE_LOT_NO = #RLSE_CMD_NO#), 1)
       , #RLSE_DIV_DT#
       , #PROD_EQ_NO#
       , #CRE_USR_ID#
       , GETDATE()
       , #UPD_USR_ID#
       , GETDATE()
      )
    </insert>

    <!--생산분배 MST - 삭제-->
    <delete id="S22225DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE FROM TB_SL_RLSE_LOT
        WHERE 1 = 1
          AND CHNL_CD     = #CHNL_CD#
          AND RLSE_LOT_NO = #RLSE_CMD_NO#
    </delete>
    

    
       <!-- 생산최적화 -->
    <select id="S22226SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
         SELECT 
                 T1.CHNL_CD
               , T1.SL_RLSE_NO
               , T1.SL_RLSE_SEQ
               , T1.SL_ITM_CD
               , CONVERT(INT, T1.SL_ITM_QTY) AS SL_ITM_QTY
               , T1.CRE_USR_ID
               , CONVERT(VARCHAR, T1.CRE_DT, 23) AS CRE_DT
               , T1.UPD_USR_ID
               , CONVERT(VARCHAR, T1.UPD_DT, 23) AS UPD_DT
               , T1.RLSE_PRT_FLG
               , T1.ITM_STL_CD
               , T1.ITM_STL_SZ_CD
               , T1.ITM_STL_LENG
               , (T1.SL_RLSE_NO + '-' + CONVERT(VARCHAR, T1.SL_RLSE_SEQ)) AS  RLSR_BCD_NO
               , T1.SL_ITM_WGT
               <!--, T1.CUST_PUR_NO-->
               , T1.CNTR_NM
               , T1.CNTR_PSN_NM
               , CONVERT(VARCHAR, T1.IN_REQ_DT, 23) AS IN_REQ_DT   
               , T1.RLSE_CMD_NO						
		           , T1.RLSE_CMD_SEQ							
		           , CONVERT(VARCHAR, T2.RLSE_DIV_DT, 23) AS RLSE_DIV_DT  
               , T2.PROD_EQ_NO						
               , CONVERT(VARCHAR, T1.INSP_DT, 23) AS INSP_DT
               , T1.INSP_FLG
		     FROM TB_SL_RLSE_DTL AS T1 
	          , TB_SL_RLSE_LOT AS T2
	      WHERE 1=1
		      AND T1.RLSE_CMD_NO = T2.RLSE_LOT_NO
		      AND T1.CHNL_CD	   = T2.CHNL_CD
		      AND T1.CHNL_CD	   = #CHNL_CD#
          AND T2.RLSE_DIV_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)                                
          AND T2.RLSE_DIV_DT <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)    
		
      
      
     <!--SELECT
          T1.RLSE_CMD_NO
        , CONVERT(VARCHAR, MAX(T1.IN_REQ_DT), 23) AS IN_REQ_DT
        , MAX(T1.CNTR_NM)   AS CNTR_NM
        , SUM(T1.SL_ITM_QTY) AS SUM_ITM_QTY
        , SUM(T1.SL_ITM_WGT) AS SUM_ITM_WGT
        , MAX(T1.CHNL_CD)   AS CHNL_CD
		    , MAX(T2.RLSE_LOT_NO)  AS RLSE_LOT_NO                                  
		    , MAX(T2.PROD_EQ_NO)   AS PROD_EQ_NO                                   
		    , CONVERT(VARCHAR, MAX(T2.RLSE_DIV_DT), 23) AS RLSE_DIV_DT             
      FROM  TB_SL_RLSE_DTL T1 LEFT OUTER JOIN TB_SL_RLSE_LOT T2 ON (T1.RLSE_CMD_NO = T2.RLSE_LOT_NO AND T1.CHNL_CD = T2.CHNL_CD)
        WHERE 1=1
          AND T1.CHNL_CD  = #CHNL_CD#
          AND T1.RLSE_CMD_NO IS NOT NULL
          AND T1.OK_FLG = 'Y'
		      AND T1.IN_REQ_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		      AND T1.IN_REQ_DT  <![CDATA[ <= ]]>  CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
      GROUP BY RLSE_CMD_NO-->
    </select>



    <update id="S22226UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_RLSE_DTL
      SET INSP_DT  = GETDATE()
        , INSP_FLG = #INSP_FLG#
      WHERE SL_RLSE_NO  = #SL_RLSE_NO#
        AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
        AND CHNL_CD     = #CHNL_CD#
    </update>
    
    
    
    <!--생산최적화 MST - 추가-->
    <insert id="S22226InsertPopupMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_OPMZ_MST
      (
          OPMZ_NO
        , CHNL_CD
        , OPMZ_DT
        , OPMZ_RMK
        , UPD_USR_ID
        , CRE_USR_ID
        , CRE_DT
        , UPD_DT
      )
      VALUES
      (
          #OPMZ_NO#
        , #CHNL_CD#
        , #OPMZ_DT#
        , #OPMZ_RMK#
        , #UPD_USR_ID#
        , #CRE_USR_ID#
        , GETDATE()
        , GETDATE()
      )
    </insert>


    <!--생산최적화 DTL - 추가-->
    <insert id="S22226InsertPopupDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
        INSERT INTO TB_OPMZ_DTL
        (
             OPMZ_NO
           , STEP_NO
           , STEP_SEQ
           , CHNL_CD
           , STL_N1ST_LENG
           , STL_N2ND_LENG
           , RLSE_N1ST_CMD_NO
           , RLSE_N2ND_CMD_NO
           , ITM_N1ST_SHP_CD
           , ITM_N2ND_SHP_CD
           , STL_N1ST_PROC_TM
           , STL_N2ND_PROC_TM
           , PROC_N1ST_SET
           , PROC_N2ND_SET
           , PROC_N3RD_SET
           , PROC_N4ND_SET
           , IN_STL_LENG
           , IN_STL_QTY
           , STEP_LSS_RTO
           , STEP_TTL_STK
           , STEP_LSS_TTL
           , WT_LIST
           , BP_WT_LIST
           , SL_RLSE_NO
           , SL_RLSE_SEQ
           , CRE_USR_ID
           , UPD_USR_ID
           , CRE_DT
           , UPD_DT
        )
        VALUES
        (
             #OPMZ_NO#
           , #STEP_NO#
           , #STEP_SEQ#
           , #CHNL_CD#
           , #STL_N1ST_LENG#
           , #STL_N2ND_LENG#
           , #RLSE_N1ST_CMD_NO#
           , #RLSE_N2ND_CMD_NO#
           , #ITM_N1ST_SHP_CD#
           , #ITM_N2ND_SHP_CD#
           , #STL_N1ST_PROC_TM#
           , #STL_N2ND_PROC_TM#
           , #PROC_N1ST_SET#
           , #PROC_N2ND_SET#
           , #PROC_N3RD_SET#
           , #PROC_N4ND_SET#
           , #IN_STL_LENG#
           , #IN_STL_QTY#
           , #STEP_LSS_RTO#
           , #STEP_TTL_STK#
           , #STEP_LSS_TTL#
           , #WT_LIST#
           , #BP_WT_LIST#
           , #SL_RLSE_NO#
           , #SL_RLSE_SEQ#
           , #CRE_USR_ID#
           , #UPD_USR_ID#
           , GETDATE()
           , GETDATE()
        )
    </insert>





      <!-- 주문별 생산공장/GR확정 MST -->
    <select id="S22223SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT
          MIN(T1.CHNL_CD) AS   CHNL_CD
        , T1.SL_RLSE_NO AS SL_RLSE_NO
        , CONVERT(NVARCHAR, MIN(T1.IN_REQ_DT), 23) AS IN_REQ_DT
        , MIN(T2.DE_CO_NM)      AS GBN
        , ISNULL(T1.CNTR_NM, '') AS   CNTR_NM     
        , ISNULL(T1.CNTR_PSN_NM, '') AS   CNTR_PSN_NM 
        , MIN(T2.FLR_NO) AS FLR_NO
        , MIN(T1.ITM_STL_CD) AS ITM_STL_CD
        , MIN(RIGHT(T1.ITM_STL_SZ_CD,3)) AS ITM_STL_SZ_CD
        , SUM(T1.SL_ITM_QTY)   AS SL_ITM_QTY
        , SUM(T1.ITM_STL_LENG) AS ITM_STL_LENG
        , SUM(T1.SL_ITM_WGT)   AS SL_ITM_WGT
        , CONVERT(NVARCHAR, MIN(T3.DUE_DT), 23) AS DUE_DT
        , MIN(T1.OK_FLG) AS OK_FLG
        , COUNT(T1.CHNL_CD) AS RN
        , #UPD_USR_ID# AS UPD_USR_ID
        , #AREA_CD# AS AREA_CD
      FROM  TB_SL_RLSE_DTL T1
        , TB_CUST_PUR_DTL T2
        , TB_CUST_PUR T3
      WHERE 1=1
        AND T1.CHNL_CD     = #CHNL_CD#
        AND T1.CHNL_CD     = T2.CHNL_CD
        AND T1.CUST_PUR_NO = T2.PUR_NO
        AND T1.CUST_PUR_SEQ = T2.PUR_SEQ
        AND T2.PUR_NO      = T3.PUR_NO
        AND T1.IN_REQ_DT  >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)
        AND T1.IN_REQ_DT  <![CDATA[ <= ]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
      GROUP BY
          T1.CNTR_NM
        , T1.CNTR_PSN_NM
        , T1.SL_RLSE_NO
    </select>
    



    <!-- 주문별 생산공장/GR확정 DTL -->
    <select id="S22223SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT
          T1.CHNL_CD
        , CONVERT(NVARCHAR, T1.IN_REQ_DT, 23) AS IN_REQ_DT
        , T1.SL_RLSE_NO
        , T1.SL_RLSE_SEQ
        , T1.RLSE_CMD_NO
        , T1.CNTR_NM
        , T1.CNTR_PSN_NM
        , T1.SL_ITM_CD
        , T2.FLR_NM
        , T2.FLR_NO
        , T1.SL_ITM_QTY
        , T1.SL_ITM_WGT
        , T1.ITM_STL_CD
        , T1.ITM_STL_SZ_CD
        , T1.CRE_DT
        , T1.CRE_USR_ID
        , T1.UPD_DT
        , #UPD_USR_ID# AS UPD_USR_ID
        , #AREA_CD# AS AREA_CD
      FROM TB_SL_RLSE_DTL T1 LEFT OUTER JOIN TB_CUST_PUR_DTL T2
		    ON (T1.CUST_PUR_NO = T2.PUR_NO AND T1.CUST_PUR_SEQ = T2.PUR_SEQ AND T1.CHNL_CD = T2.CHNL_CD)
      WHERE 1=1
        AND T1.CHNL_CD = #CHNL_CD#
      <isNotNull property="A_SL_RLSE_NO">
        <iterate property="A_SL_RLSE_NO" prepend=" AND (T1.SL_RLSE_NO + '_' + T1.CNTR_NM + '_' + T1.CNTR_PSN_NM) IN " open = "(" close=")" conjunction=",">
          #A_SL_RLSE_NO[]#
        </iterate>
      </isNotNull>
    </select>



    <!-- Service -->
    <select id="S22223SelectRlseCmdNo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, #TBL_ID#, #AREA_CD#) AS LST_FMT_NO  FROM CPY_T WHERE NO = 1
    </select>

    <update id="S22223UpdateRlseCmdNo" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SYS_NO_FMT
      SET LST_FMT_NO = #LST_FMT_NO#
      WHERE TBL_ID   = #TBL_ID#
      AND AREA_CD    = #AREA_CD#
      AND CHNL_CD    = #CHNL_CD#
    </update>



    <!--주문별 생산공장/GR확정 DTL - GR 번호 부여 -->
    <update id="S22223UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_RLSE_DTL
      SET
      OK_FLG  = 'Y'
      , RLSE_CMD_NO   = #LST_FMT_NO#
      <!--, RLSR_BCD_NO   = #GBN#-->
      , IN_REQ_DT     = #IN_REQ_DT#
      , UPD_USR_ID    = #UPD_USR_ID#
      , UPD_DT        = GETDATE()
      WHERE 1 = 1
      AND CHNL_CD      =  #CHNL_CD#
      AND SL_RLSE_NO   =  #SL_RLSE_NO#
      AND SL_RLSE_SEQ  =  #SL_RLSE_SEQ#
    </update>



    <!--주문별 생산공장/GR확정 DTL - GR 확정(선택한거끼리 같은 GR번호로 부여) -->
    <update id="S22223UpdateGR" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_RLSE_DTL
        SET
            OK_FLG  = 'Y'
          , RLSE_CMD_NO   = #RLSE_CMD_NO#
          , UPD_USR_ID    = #UPD_USR_ID#
          , UPD_DT        = GETDATE()
      WHERE 1 = 1
        AND CHNL_CD      =  #CHNL_CD#
      <!--AND SL_RLSE_NO   =  #SL_RLSE_NO#
       AND SL_RLSE_SEQ  =  #SL_RLSE_SEQ#-->

      <isNotNull property="A_SL_RLSE_NO">
        <iterate property="A_SL_RLSE_NO" prepend=" AND (SL_RLSE_NO + '_' + CONVERT(NVARCHAR, SL_RLSE_SEQ)) IN " open = "(" close=")" conjunction=",">
          #A_SL_RLSE_NO[]#
        </iterate>
      </isNotNull>

    </update>



    <!-- 반품 현황 -->
     <select id="S2218SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
            SELECT   
                  T1.SL_ITM_CD    AS SL_ITM_CD     
                   , T2.ITM_NM       AS ITM_NM        
                   , T2.ITM_SZ_NM    AS ITM_SZ_NM       
                   , ISNULL(SUM(T1.SL_ITM_QTY),0)   AS SL_ITM_QTY     
                   , ISNULL(T3.SL_RTN_ITM_QTY,0)    AS SL_RTN_ITM_QTY 
                   , ISNULL(CONVERT(NUMERIC(5,2),((T3.SL_RTN_ITM_QTY / ISNULL(SUM(T1.SL_ITM_QTY),0) * 100))),0) AS A1  
               , T1.CRE_DT
              FROM TB_SL_RLSE_DTL T1
              OUTER APPLY ( SELECT X.ITM_NM AS ITM_NM
                                  ,X.ITM_SZ_NM AS ITM_SZ_NM
                              FROM TB_CD_ITM X
                             WHERE 1 = 1 
                               AND X.ITM_CD = T1.SL_ITM_CD
                     )T2
              OUTER APPLY ( SELECT SUM(X.SL_RTN_ITM_QTY) AS SL_RTN_ITM_QTY
                                  ,X.SL_RTN_ITM_CD       AS SL_RTN_ITM_CD
                              FROM TB_SL_BIL_RTN_DTL X
                             WHERE 1 = 1 
                               AND X.SL_RTN_ITM_CD = T1.SL_ITM_CD
                               <!--AND X.CRE_DT >= #CRE_DT#-->
                             AND X.CRE_DT    >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
                            AND X.CRE_DT    <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME) 
                              GROUP BY X.SL_RTN_ITM_CD
                           )T3
             WHERE 1 = 1 
               AND T1.CHNL_CD = #CHNL_CD#
               AND T1.SL_ITM_QTY > 0 
            
               <!--AND T1.CRE_DT >= #CRE_DT#-->
              
            AND T1.CRE_DT    >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
            AND T1.CRE_DT    <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME) 
               
            GROUP BY T1.SL_ITM_CD,SL_RTN_ITM_QTY,T1.SL_ITM_CD, T2.ITM_NM,T2.ITM_SZ_NM, T1.CRE_DT
     </select>
    
        <!-- S2219 견적서 발행-->
    
    <!--견적서 MST 조회-->
    <select id="S2219SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT ESTM_NO 
           , CO_NM 
           , CONVERT(VARCHAR,ESTM_DT,23) AS ESTM_DT 
           , CHNL_CD
        FROM TB_ESTM_MST
       WHERE 1 = 1 
         AND CHNL_CD = #CHNL_CD#
         AND ESTM_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
         AND ESTM_DT <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)      
    
     </select>

    <!--견적서 DTL 조회-->
    <select id="S2219SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT  ESTM_NO 
            , CONVERT(VARCHAR,ESTM_DT,23) AS ESTM_DT 
            , CO_NM 
            , MGR_NM
            , PHN_NO
            , FAX_NO 
            , CONVERT(VARCHAR,EXP_DT,23) AS EXP_DT
            , CLZ_FLG 
            , ESTM_RMK
            , ITM_FILE
            , ITM_FILE_NM
            , CHNL_CD
       FROM TB_ESTM_MST
      WHERE 1 = 1
        AND CHNL_CD = #CHNL_CD#
        AND ESTM_NO = #ESTM_NO#
     </select>  
    
    <!--견적서 내역 조회-->
    <select id="S2219SelectEstmList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT ESTM_SEQ
           , ESTM_ITM_NM
           , ESTM_ITM_SZ_NM
           , ESTM_ITM_QTY
           , ITM_UT
           , ITM_PER_PRC 
           , ITM_DC_RT           
		   , (ITM_PER_PRC * (1-ITM_DC_RT)) AS ITM_DC_PER_PRC
           , ITM_PRC
           , (ESTM_ITM_QTY * ITM_PRC) AS ITM_AMT 
           , ITM_RMK
           , CHNL_CD
           , ESTM_NO
       FROM TB_ESTM_DTL
      WHERE 1 = 1 
        AND CHNL_CD = #CHNL_CD#
        AND ESTM_NO = #ESTM_NO#
     </select>  

    <!--공정과정 선택 조회-->
    <select id="S2219SelectProdList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
      SELECT ROUT_CD
           , ROUT_NM
        FROM TB_PROD_ROUT  
       WHERE 1 = 1
         AND CHNL_CD = #CHNL_CD#
     </select>  

    <!--견적서 MST - 추가-->
    <select id="S2219SelectEstmNo" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="string">
         SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'ES', '001') AS ESTM_NO FROM CPY_T WHERE NO = 1
    </select>  
      
    <insert id="S2219InsertPopupMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        INSERT INTO TB_ESTM_MST
           (
              CHNL_CD    
            , ESTM_NO  
            , CO_NM      
            , ESTM_DT     
            , MGR_NM      
            , PHN_NO    
            , FAX_NO      
            , EXP_DT       
            , ESTM_RMK    
            , ITM_FILE  
            , ITM_FILE_NM  
            , CLZ_FLG      
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
           )
        VALUES
          (
             #CHNL_CD#
           , #ESTM_NO#
           , #CO_NM#
           , #ESTM_DT#
           , #MGR_NM#
           , #PHN_NO#
           , #FAX_NO#
           , #EXP_DT#
           , #ESTM_RMK#
           , #ITM_FILE#
           , #ITM_FILE_NM#
           , 'N'
           , #CRE_USR_ID#
           , GETDATE()
           , #UPD_USR_ID#
           , GETDATE()
          )
    </insert>  
    
    <update id="S2219UpdateEstmNo" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_SYS_NO_FMT
           SET LST_FMT_NO = #ESTM_NO#
         WHERE TBL_ID     = 'ES'
           AND CHNL_CD    = #CHNL_CD#
           AND AREA_CD    = '001'     
      </update>

    <!--견적서 MST - 수정-->
    <update id="S2219UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_ESTM_MST
          SET 
                CO_NM = #CO_NM#
              , ESTM_DT = #ESTM_DT#
              , MGR_NM = #MGR_NM#
              , PHN_NO = #PHN_NO#
              , FAX_NO = #PHN_NO#
              , EXP_DT = #EXP_DT#
              , ESTM_RMK = #ESTM_RMK#
              , ITM_FILE = #ITM_FILE#
              , ITM_FILE_NM = #ITM_FILE_NM#
              , CLZ_FLG = #CLZ_FLG#
              , UPD_USR_ID = #UPD_USR_ID#
              , UPD_DT = GETDATE()
          WHERE 1 = 1
            AND CHNL_CD = #CHNL_CD#
            AND ESTM_NO = #ESTM_NO#
      </update>

    <!--견적서 MST - 삭제-->
    <delete id="S2219DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE 
        FROM TB_ESTM_MST
       WHERE 1 = 1 
         AND CHNL_CD = #CHNL_CD#
         AND ESTM_NO = #ESTM_NO#
    </delete> 
    
    <delete id="S2219DeleteDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE
        FROM TB_ESTM_DTL
       WHERE 1 = 1
         AND CHNL_CD = #CHNL_CD#
         AND ESTM_NO = #ESTM_NO#
    </delete> 

    <!--견적서 내역  - 원자재 / 공정과정 추가-->
    <insert id="S2219InsertEstm" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_ESTM_DTL
          (
              CHNL_CD        
            , ESTM_NO       
            , ESTM_SEQ      
            , ESTM_ITM_NM     
            , ESTM_ITM_SZ_NM  
            , ESTM_ITM_QTY    
            , ITM_UT          
            , ITM_PER_PRC     
            , ITM_DC_RT       
            , ITM_PRC         
            , ITM_RMK         
            , CRE_USR_ID     
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
          )
       VALUES
          (
              #CHNL_CD#
            , #ESTM_NO#  
            , (SELECT COUNT(ESTM_SEQ) FROM TB_ESTM_DTL WHERE CHNL_CD = #CHNL_CD# AND ESTM_NO = #ESTM_NO#) + 1
            , #ESTM_ITM_NM#
            , #ESTM_ITM_SZ_NM#
            , #ESTM_ITM_QTY#
            , #ITM_UT#
            , #ITM_PER_PRC#
            , #ITM_DC_RT#
            , #ITM_PRC#
            , #ITM_RMK#
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()
          )
    </insert>
  
    <!--견적서 내역 - 수정-->
    <update id="S2219UpdateEstm" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_ESTM_DTL
          SET 
               CHNL_CD = #CHNL_CD#
             , ESTM_NO = #ESTM_NO#  
             , ESTM_SEQ = #ESTM_SEQ#
             , ESTM_ITM_NM = #ESTM_ITM_NM#
             , ESTM_ITM_SZ_NM = #ESTM_ITM_SZ_NM#
             , ESTM_ITM_QTY = #ESTM_ITM_QTY#
             , ITM_UT = #ITM_UT#
             , ITM_PER_PRC = #ITM_PER_PRC#
             , ITM_DC_RT = #ITM_DC_RT#
             , ITM_PRC = #ITM_PRC#
             , ITM_RMK = #ITM_RMK#
             , UPD_USR_ID = #UPD_USR_ID#
             , UPD_DT = GETDATE()
         WHERE 1 = 1
           AND CHNL_CD = #CHNL_CD#
           AND ESTM_NO = #ESTM_NO#  
           AND ESTM_SEQ = #ESTM_SEQ#
      </update>

    <!--견적서 내역 - 삭제-->
    <delete id="S2219DeleteEstm" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE 
        FROM TB_ESTM_DTL
       WHERE 1 = 1 
         AND CHNL_CD = #CHNL_CD#
         AND ESTM_NO = #ESTM_NO#  
         AND ESTM_SEQ = #ESTM_SEQ#
    </delete> 

    <update id="S2219UpdateEstmSeq" parameterClass="ModelsLibrary.Sale.SaleVo">
        UPDATE TB_ESTM_DTL
          SET
              ESTM_SEQ = ESTM_SEQ - 1
         WHERE 1 = 1
           AND CHNL_CD = #CHNL_CD#
           AND ESTM_NO = #ESTM_NO#
           AND ESTM_SEQ > #ESTM_SEQ#
      </update>


	  <!--수주등록 (편리사)-->
	  <!--수주등록(편리사) DTL 조회-->
	  <select id="S2223SelectDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		  SELECT
		  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_SEQ) AS RN
		  , CASE WHEN DC_PRC_VAL  <![CDATA[<>]]>  SL_ITM_PRC_VAL THEN 1 ELSE 0 END AS DC_CHK
		  , OK_FLG
		  , SL_ITM_CD
		  , ITM_NM
		  , (N1ST_ITM_SZ_NM + '*' + N2ND_ITM_SZ_NM + '*' + N3RD_ITM_SZ_NM) AS ITM_SZ_NM
		  , CONVERT(BIGINT, ISNULL(SL_ITM_QTY, 0))      AS SL_ITM_QTY
		  , SL_ITM_WGT
		  , CONVERT(FLOAT, ISNULL(SL_ITM_PRC_VAL, 0.0)) AS SL_ITM_PRC_VAL
		  , CONVERT(FLOAT, ISNULL(DC_PRC_VAL, 0.0))     AS DC_PRC_VAL
		  , CONVERT(BIGINT, ISNULL(SL_ITM_AMT, 0))      AS SL_ITM_AMT
		  , SL_ITM_RMK
		  , CHNL_CD
		  , N1ST_ITM_GRP_NM
		  , SL_RLSE_NO
		  , SL_RLSE_SEQ
		  , SL_ITM_PRC_DC_RT
		  FROM (
		  SELECT T1.SL_ITM_CD
		  , T2.ITM_NM
		  , T1.OK_FLG
		  , T1.N1ST_ITM_SZ_NM
		  , T1.N2ND_ITM_SZ_NM
		  , T1.N3RD_ITM_SZ_NM
		  , T1.SL_ITM_QTY
		  , T1.SL_ITM_PRC_VAL
		  , T1.SL_ITM_PRC_DC_VAL AS DC_PRC_VAL
		  , T1.SL_ITM_AMT
		  , T1.SL_ITM_RMK
		  , T1.SL_RLSE_NO
		  , T1.SL_RLSE_SEQ
		  <!--, ROUND(T1.SL_ITM_QTY * T2.UOM_WGT, 0) AS SL_ITM_WGT-->
		  , ROUND(T1.SL_ITM_QTY * T1.SL_ITM_WGT, 0) AS SL_ITM_WGT
		  , T1.CHNL_CD
		  , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
		  , T1.SL_ITM_PRC_DC_RT
		  FROM TB_SL_RLSE_DTL T1
		  , TB_CD_ITM      T2
		  WHERE 1 = 1
		  AND T1.SL_RLSE_NO = #SL_RLSE_NO#
		  AND T1.CHNL_CD    = #CHNL_CD#
		  AND T1.CHNL_CD    = T2.CHNL_CD
		  AND T1.SL_ITM_CD = T2.ITM_CD
		  AND T1.SL_ITM_QTY <![CDATA[<>]]>  0
		  <isNotNull property="SL_RLSE_SEQ">
			  AND T1.SL_RLSE_SEQ = #SL_RLSE_SEQ#
		  </isNotNull>
		  ) T1
	  </select>


	  <!--수주등록(편리사) DTL 다이얼로그 수주물품 추가-->
	  <insert id="S2223InsertDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
		  INSERT INTO TB_SL_RLSE_DTL
		  (
		  CHNL_CD
		  , SL_RLSE_NO
		  , SL_RLSE_SEQ
		  , OK_FLG
		  , SL_ITM_CD
		  , SL_ITM_PRC_VAL
		  , SL_ITM_PRC_DC_VAL
		  , N1ST_ITM_SZ_NM
		  , N2ND_ITM_SZ_NM
		  , N3RD_ITM_SZ_NM
		  , SL_ITM_QTY
		  , SL_ITM_AMT
		  , SL_ITM_TAX_AMT
		  , SL_ITM_RMK
		  , SL_ITM_WGT
		  , CRE_USR_ID
		  , CRE_DT
		  , UPD_USR_ID
		  , UPD_DT
		  )
		  SELECT
		  T1.CHNL_CD
		  , #SL_RLSE_NO#
		  , T2.SL_RLSE_SEQ
		  , #OK_FLG#
		  , T1.ITM_CD
		  , dbo.FF_SL_RLSE_PRC(T1.CHNL_CD, T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT)
		  , 0
		  , #N1ST_ITM_SZ_NM#
		  , #N2ND_ITM_SZ_NM#
		  , #N3RD_ITM_SZ_NM#
		  , #SL_ITM_QTY#
		  , ROUND(#SL_ITM_QTY# * dbo.FF_SL_RLSE_PRC(T1.CHNL_CD, T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT), 0)
		  , ROUND(ROUND(#SL_ITM_QTY# * dbo.FF_SL_RLSE_PRC(T1.CHNL_CD, T2.SL_AREA_CD, T1.ITM_CD, T2.SL_RLSE_DT), 1) * 0.1, 0)
		  , #SL_ITM_RMK#
		  , #SL_ITM_WGT#
		  , #CRE_USR_ID#
		  , GETDATE()
		  , #UPD_USR_ID#
		  , GETDATE()
		  FROM TB_CD_ITM T1
		  , (
		  SELECT SL_AREA_CD
		  , SL_CO_CD
		  , SL_RLSE_DT
		  , ISNULL(MAX(T2.SL_RLSE_SEQ) + 1, 1)  AS SL_RLSE_SEQ
		  FROM TB_SL_RLSE T1 LEFT OUTER JOIN TB_SL_RLSE_DTL T2
		  ON ( T1.SL_RLSE_NO = T2.SL_RLSE_NO
		  AND T2.CHNL_CD    = #CHNL_CD#)
		  WHERE 1 = 1
		  AND T1.SL_RLSE_NO = #SL_RLSE_NO#
		  AND T1.CHNL_CD    = #CHNL_CD#
		  GROUP BY SL_AREA_CD
		  , SL_CO_CD
		  , SL_RLSE_DT
		  ) T2
		  WHERE T1.ITM_CD = #ITM_CD#
		  AND T1.CHNL_CD = #CHNL_CD#
	  </insert>

	  <!--수주등록(편리사) DTL 다이얼로그 수주물품 추가 상단 조회 쿼리-->
	  <select id="S2223SelectSubItmDtlList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		  SELECT  T1.ITM_CD
		  , T1.ITM_NM
		  , T1.STK_A_QTY
		  , T1.UOM_NM
		  , T1.CHNL_CD
		  FROM (
		  SELECT T1.ITM_CD
		  , T2.ITM_NM
		  , T2.ITM_SZ_NM
		  , T2.UOM_CD
		  , T3.UOM_NM
		  , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_QTY END), 0) AS STK_A_QTY
		  , T1.CHNL_CD
		  FROM TB_INVT_DLY_STK  T1
		  , TB_CD_ITM     T2
		  OUTER APPLY
		  (
		  SELECT X.CLSS_CD
		  , X.CLSS_DESC AS UOM_NM
		  FROM TB_SYS_CLSS_CD X
		  WHERE 1 = 1
		  AND X.CLSS_TP_CD ='L-003'
		  AND X.CLSS_CD = T2.UOM_CD
		  AND X.CHNL_CD = T2.CHNL_CD
		  )T3
		  WHERE 1 = 1
		  AND T1.CHNL_CD    = #CHNL_CD#
		  AND T1.ITM_CD     = T2.ITM_CD
		  AND T1.CHNL_CD    = T2.CHNL_CD
		  <isNotNull property="ITM_GRP_CLSS_CD" >
			  AND T2.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
		  </isNotNull>
		  <isNotNull property="N1ST_ITM_GRP_CD" >
			  AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
		  </isNotNull>
		  <isNotNull property="N2ND_ITM_GRP_CD" >
			  AND T2.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
		  </isNotNull>
		  <isNotNull property="HD_LEN_CD" >
			  AND T2.HD_LEN_CD       = #HD_LEN_CD#
		  </isNotNull>
		  <isNotNull property="ITM_CD" >
			  AND T2.ITM_CD           LIKE  #ITM_CD# + '%'
		  </isNotNull>
		  GROUP BY T1.CHNL_CD
		  , T1.ITM_CD
		  , T2.ITM_NM
		  , T2.ITM_SZ_NM
		  , T2.UOM_CD
		  , T3.UOM_NM
		  ) T1
		  ORDER BY T1.ITM_CD
	  </select>

	  <!--수주등록(편리사) DTL 수정 쿼리-->
	  <update id="S2223UpdateDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
		  UPDATE TB_SL_RLSE_DTL
		  SET
		  UPD_USR_ID          = #UPD_USR_ID#
		  , UPD_DT            = GETDATE()
		  , SL_ITM_PRC_DC_RT = #SL_ITM_PRC_DC_RT#
		  , SL_ITM_RMK        = #SL_ITM_RMK#
		  <isNotNull property="SL_ITM_PRC_VAL">
			  , SL_ITM_PRC_VAL = #SL_ITM_PRC_VAL#
			  , SL_ITM_AMT        = #SL_ITM_AMT#
			  , SL_ITM_TAX_AMT    = ROUND(ROUND(SL_ITM_QTY * CAST(SL_ITM_PRC_DC_VAL AS FLOAT), 1) * 0.1, 0)
		  </isNotNull>
		  WHERE  1 = 1
		  AND SL_RLSE_NO  = #SL_RLSE_NO#
		  AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
		  AND CHNL_CD     = #CHNL_CD#
	  </update>




	  <!-- 판매출고내역 MST - 조회 -->
	  <select id="S2233SelectMstList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		  SELECT
		  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T4.SL_RLSE_DT, T1.SL_RLSE_NO, T2.SL_RLSE_SEQ) AS RN
		  , T1.SL_CO_CD
		  , T5.CO_NM
		  , T4.RLSE_CMD_NO
		  , T4.RLSE_CMD_SEQ
		  , T2.SL_RLSE_NO
		  , CONVERT(VARCHAR, T4.SL_RLSE_DT, 120) AS SL_RLSE_DT
		  , T3.N1ST_ITM_GRP_NM
		  , T3.ITM_CD
		  , T3.ITM_NM
		  <!--, T3.ITM_SZ_NM-->
		  , T2.N1ST_ITM_SZ_NM + '*' + T2.N2ND_ITM_SZ_NM + '*' + T2.N3RD_ITM_SZ_NM AS ITM_SZ_NM
		  , T4.ITM_QTY
		  , T4.ITM_PRC
		  , T4.ITM_AMT
		  , T4.SL_ITM_RMK
		  , T6.CLZ_FLG
		  FROM  TB_SL_RLSE          T1
		  , TB_SL_RLSE_DTL      T2
		  , MV_TB_CD_ITM        T3
		  , TB_SL_RLSE_CMD_DTL  T4
		  OUTER APPLY (
		  SELECT CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END AS CLZ_FLG
		  FROM TB_SL_RLSE_MAP X
		  WHERE 1 = 1
		  AND X.SL_RLSE_NO   = T4.RLSE_CMD_NO
		  AND X.SL_RLSE_SEQ  = T4.RLSE_CMD_SEQ
		  ) T6
		  , TB_CD_CO            T5
		  WHERE 1 = 1
		  AND T1.CHNL_CD         = #CHNL_CD#
		  AND T1.CHNL_CD         = T2.CHNL_CD
		  AND T1.CHNL_CD         = T3.CHNL_CD
		  AND T1.CHNL_CD         = T4.CHNL_CD
		  AND T1.CHNL_CD         = T5.CHNL_CD
		  AND T2.SL_RLSE_NO      = T4.SL_RLSE_NO
		  AND T2.SL_RLSE_SEQ     = T4.SL_RLSE_SEQ
		  AND T1.SL_AREA_CD      = #AREA_CD#
		  AND T1.SL_CO_CD        = T5.CO_NO
		  AND T1.SL_RLSE_NO      = T2.SL_RLSE_NO
		  AND T2.SL_ITM_CD       = T3.ITM_CD
		  AND T1.SL_RLSE_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		  AND T1.SL_RLSE_DT <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
	  </select>

	  <!--판매출고내역  MST - 삭제-->
	  <delete id="S2233DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
		  DELETE FROM TB_SL_RLSE_CMD_DTL
		  WHERE CHNL_CD       = #CHNL_CD#
		  AND RLSE_CMD_NO   = #RLSE_CMD_NO#
		  AND RLSE_CMD_SEQ  = #RLSE_CMD_SEQ#
	  </delete>


	  <!-- 판매출고내역 Dialog - 조회 -->
	  <select id="S2233SelectDialogList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		  SELECT
		  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SL_RLSE_DT, T1.SL_RLSE_NO, T2.SL_RLSE_SEQ) AS RN
		  , T1.SL_CO_CD
		  , T5.CO_NM
		  , T2.SL_RLSE_NO
		  , T2.SL_RLSE_SEQ
		  , CONVERT(VARCHAR, T1.SL_RLSE_DT, 120) AS SL_RLSE_DT
		  , T3.N1ST_ITM_GRP_NM
		  , T3.ITM_CD
		  , T3.ITM_NM
		  <!--, T3.ITM_SZ_NM-->
		  , T2.N1ST_ITM_SZ_NM + '*' + T2.N2ND_ITM_SZ_NM + '*' + T2.N3RD_ITM_SZ_NM AS ITM_SZ_NM
		  , T4.ITM_QTY
		  , T2.SL_ITM_QTY
		  , T2.SL_ITM_QTY - T4.ITM_QTY  AS RMN_QTY
		  , T2.SL_ITM_PRC_VAL  AS ITM_PRC
		  , T2.SL_ITM_PRC_VAL
		  , T2.SL_ITM_AMT
		  , T2.SL_ITM_RMK
		  FROM  TB_SL_RLSE      T1
		  , TB_SL_RLSE_DTL  T2
		  OUTER APPLY (
		  SELECT
		  ISNULL(SUM(X.ITM_QTY), 0)  AS ITM_QTY
		  , MAX(X.ITM_PRC)  AS ITM_PRC
		  FROM TB_SL_RLSE_CMD_DTL X
		  WHERE 1 = 1
		  AND X.SL_RLSE_NO  = T2.SL_RLSE_NO
		  AND X.SL_RLSE_SEQ = T2.SL_RLSE_SEQ
		  AND X.CHNL_CD     = #CHNL_CD#
		  ) T4
		  , MV_TB_CD_ITM    T3
		  , TB_CD_CO        T5
		  WHERE 1 = 1
		  AND T1.CHNL_CD         = #CHNL_CD#
		  AND T1.CHNL_CD         = T2.CHNL_CD
		  AND T1.CHNL_CD         = T3.CHNL_CD
		  AND T1.CHNL_CD         = T5.CHNL_CD
		  AND T1.SL_AREA_CD      = #AREA_CD#
		  AND T3.ITM_GRP_CLSS_CD = 'G'
		  AND T1.SL_CO_CD        = T5.CO_NO
		  AND T1.SL_RLSE_NO      = T2.SL_RLSE_NO
		  AND T2.SL_ITM_CD       = T3.ITM_CD
		  AND T1.CLZ_FLG         = 'N'
		  AND T4.ITM_QTY        <![CDATA[<]]> T2.SL_ITM_QTY
		  AND T1.SL_RLSE_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		  AND T1.SL_RLSE_DT <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
	  </select>

	  <!--판매출고내역 Dialog - 추가-->
	  <insert id="S2233InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
		  INSERT INTO TB_SL_RLSE_CMD_DTL
		  (
		  CHNL_CD
		  , RLSE_CMD_NO
		  , RLSE_CMD_SEQ
		  , SL_RLSE_DT
		  , SL_RLSE_NO
		  , SL_RLSE_SEQ
		  , ITM_QTY
		  , ITM_PRC
		  , ITM_AMT
		  , SL_ITM_RMK
		  , CRE_USR_ID
		  , CRE_DT
		  , UPD_USR_ID
		  , UPD_DT
		  )
		  VALUES
		  (
		  #CHNL_CD#
		  , 'DO' + SUBSTRING(CONVERT(VARCHAR(8), GETDATE(), 112), 3, 8)
		  , (SELECT ISNULL(MAX(RLSE_CMD_SEQ), 0) + 1 FROM TB_SL_RLSE_CMD_DTL X WHERE 1 = 1 AND X.RLSE_CMD_NO = 'DO' + SUBSTRING(CONVERT(VARCHAR(8), GETDATE(), 112), 3, 8))
		  , GETDATE()
		  , #SL_RLSE_NO#
		  , #SL_RLSE_SEQ#
		  , #RMN_QTY#
		  , #ITM_PRC#
		  , #SL_ITM_AMT#
		  , #SL_ITM_RMK#
		  , #CRE_USR_ID#
		  , GETDATE()
		  , #UPD_USR_ID#
		  , GETDATE()
		  )
	  </insert>



	  <!-- 판매출고  -->
	  <select id="S2233SelectNewInsertData" resultClass="ModelsLibrary.Sale.SaleVo">
		  SELECT CHNL_CD
		  , RLSE_CMD_NO
		  , RLSE_CMD_SEQ
		  , CRE_USR_ID
		  FROM (
		  SELECT TOP 1 *
		  FROM TB_SL_RLSE_CMD_DTL
		  WHERE 1=1
		  AND CHNL_CD = #CHNL_CD#
		  ORDER BY CRE_DT DESC
		  ) T1
	  </select>


	  <statement id="ProcS2233INSERT" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="int">
		  declare @RTN VARCHAR(MAX)
		  exec @RTN = saleRlseYM  #CHNL_CD# , #RLSE_CMD_NO#, #RLSE_CMD_SEQ# , #CRE_USR_ID#
		  select @RTN AS R_value
	  </statement>

        
	 <!-- 고객발주현황  -->
     <select id="S32210SelectMst" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT  T2.PUR_NO                 
                , T2.PUR_SEQ                 
                , CONVERT(VARCHAR, T1.PUR_DT, 23) AS PUR_DT                 
                , CONVERT(VARCHAR, T1.DUE_DT, 23) AS DUE_DT                 
                , T1.PUR_CO_CD            
                , T2.FLR_FILE_ID            
                , T2.FLR_NO                  
                , T2.FLR_FILE_ID+ '_' + T2.FLR_NM  AS FLR_FILE   
                , T2.FLR_NM                
                , T2.PUR_WGT             
                , T2.DE_CO_NM 
                , T2.CNTR_NM 
                , T2.AREA_NM
                , T2.CHNL_CD 
                , T2.PRG_TP_CD
                , T2.CNTR_DE_NM
            FROM TB_CUST_PUR        T1
               , TB_CUST_PUR_DTL    T2
            WHERE 1 = 1
              AND T1.CHNL_CD   = T2.CHNL_CD
              AND T1.PUR_NO    = T2.PUR_NO
              AND T1.CHNL_CD   = #CHNL_CD#
              AND T1.PUR_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
              AND T1.PUR_DT <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
     </select>
	  
	  
	   <!--S3311추가 - 조회-->
     <select id="S3311CocdSelect" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
       SELECT CO_NO
            , CO_NM           
          FROM TB_CD_CO
             WHERE 1 = 1
               AND CHNL_CD  = #CHNL_CD#
               AND DELT_FLG = #DELT_FLG#
               AND CO_NO IN (SELECT CO_NO
                               FROM TB_CD_CO_TP 
                              WHERE 1 = 1
                                AND CO_TP_CD = CASE WHEN #GBN# = 'S' THEN 'AR' ELSE 'AP' END 
                             )
     </select>

	  
	  
	  
	  
	 <select id="S22223GrDlgSelect" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
       SELECT 
           GR_NO
         , GR_CNTR_NM
         , GR_CNTR_ROUT_NM
         , GR_RLSE_KNT_NM
         , CONVERT(VARCHAR(10), GR_SND_DT, 23) AS GR_SND_DT
         , CONVERT(VARCHAR(10), GR_ARR_DT, 23) AS GR_ARR_DT
         , GR_INV_NO
         , GR_CAR_NO
         , GR_WGT
         , ARR_USR_NM
         , ARR_ADDR
         , CAR_DRV_USR_NM
         , N1ST_TEL_NO
         , N2ND_TEL_NO
         , INCR_RT
      FROM TB_SL_RLSE_GR_INFO
     WHERE 1 = 1 
       AND GR_NO = #RLSE_CMD_NO# 
     </select>
	  
	 <insert id="S22223GrDlgInsert" parameterClass="ModelsLibrary.Sale.SaleVo" >
		INSERT INTO TB_SL_RLSE_GR_INFO
        ( 
             GR_NO
           , GR_CNTR_NM
           , GR_CNTR_ROUT_NM
           , GR_RLSE_KNT_NM
           , GR_SND_DT
           , GR_ARR_DT
           , GR_INV_NO
           , GR_CAR_NO
           , INCR_RT
           , GR_WGT
           , ARR_USR_NM            
           , ARR_ADDR              
           , CAR_DRV_USR_NM     
           , N1ST_TEL_NO           
           , N2ND_TEL_NO            
           , CRE_USR_ID
           , CRE_DT
           , UPD_USR_ID
           , UPD_DT
        )
        VALUES 
        (
  	         #GR_NO#
           , #GR_CNTR_NM#
           , #GR_CNTR_ROUT_NM#
           , #GR_RLSE_KNT_NM#
           , #GR_SND_DT#
           , #GR_ARR_DT#
           , #GR_INV_NO#
           , #GR_CAR_NO#
           , #INCR_RT# 
           , #GR_WGT#
           , #ARR_USR_NM#            
           , #ARR_ADDR#              
           , #CAR_DRV_USR_NM#     
           , #N1ST_TEL_NO#           
           , #N2ND_TEL_NO#            
           , #CRE_USR_ID#
           , GETDATE()
           , #UPD_USR_ID#
           , GETDATE()
        ) 
     </insert>
	  
	 <update id="S22223GrDlgUpdate" parameterClass="ModelsLibrary.Sale.SaleVo" >
	    UPDATE TB_SL_RLSE_GR_INFO
           SET UPD_USR_ID      = #UPD_USR_ID#
             , UPD_DT          = GETDATE()
             , GR_CNTR_NM      = #GR_CNTR_NM#
             , GR_CNTR_ROUT_NM = #GR_CNTR_ROUT_NM#
             , GR_RLSE_KNT_NM  = #GR_RLSE_KNT_NM#
             , GR_SND_DT       = #GR_SND_DT#
             , GR_ARR_DT       = #GR_ARR_DT#
             , GR_INV_NO       = #GR_INV_NO#
             , GR_CAR_NO       = #GR_CAR_NO#
             , INCR_RT         = #INCR_RT#
             , GR_WGT          = #GR_WGT#
             , ARR_USR_NM      = #ARR_USR_NM#      
             , ARR_ADDR        = #ARR_ADDR#
             , CAR_DRV_USR_NM  = #CAR_DRV_USR_NM#
             , N1ST_TEL_NO     = #N1ST_TEL_NO#
             , N2ND_TEL_NO     = #N2ND_TEL_NO# 
         WHERE 1 = 1 
           AND GR_NO = #GR_NO# 
     </update>
	  
	 <select id="S22223GrRpt1Select" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
	    SELECT T1.ITM_STL_SZ_CD
             , T1.ITM_WGT
             , ISNULL(T2.INCR_RT, 0) AS INCR_RT
             , ISNULL(ROUND(T1.ITM_WGT + (T1.ITM_WGT * ( T2.INCR_RT / 100 )), 3), 0)   AS LOSS_ITM_WGT
             , T2.GR_CNTR_NM
             , T2.GR_CNTR_ROUT_NM
             , T2.GR_RLSE_KNT_NM
             , CONVERT(VARCHAR(10), T2.GR_SND_DT, 23) AS GR_SND_DT
             , CONVERT(VARCHAR(10), T2.GR_ARR_DT, 23) AS GR_ARR_DT
             , T2.GR_INV_NO
             , T2.GR_CAR_NO
             , T2.ARR_USR_NM
             , T2.ARR_ADDR
             , T2.CAR_DRV_USR_NM
             , T2.N1ST_TEL_NO
             , T2.N2ND_TEL_NO
          FROM (
                SELECT T2.ITM_STL_SZ_CD
                     , ROUND(SUM(T2.SL_ITM_WGT) / 1000, 3)  AS ITM_WGT    
                  FROM TB_SL_RLSE       T1
                     , TB_SL_RLSE_DTL   T2
                     OUTER APPLY (
                        SELECT X.A_LEN, X.B_LEN, X.C_LEN, X.D_LEN, X.E_LEN, X.F_LEN, X.A_VAL, X.B_VAL, X.C_VAL, X.D_VAL, X.E_VAL, X.F_VAL 
                          FROM TB_MES_PROD_DESC  X
                         WHERE 1 = 1
                           AND X.SL_RLSE_NO   = T2.SL_RLSE_NO
                           AND X.SL_RLSE_SEQ  = T2.SL_RLSE_SEQ
                     ) T4
                     OUTER APPLY (
                      SELECT X.ITM_NM   AS ITM_SHP_NM
                           , X.ITM_CD AS SHP_CD
                           , Z.ITM_IMG  
                        FROM TB_CD_ITM  X
                          OUTER APPLY ( 
                             SELECT Z.IMG  AS ITM_IMG 
                               FROM TB_CD_ITM_IMG Z
                              WHERE 1 = 1
                                AND X.CHNL_CD = Z.CHNL_CD
                                AND X.ITM_CD  = Z.ITM_CD
                          ) Z 
                       WHERE 1 = 1
                         AND X.CHNL_CD           = #CHNL_CD#
                         AND X.ITM_GRP_CLSS_CD   = 'P'  
                         AND X.DELT_FLG          = 'N'   
                         AND X.ITM_CD            = T2.ITM_SHP_CD
                       ) T3
                WHERE 1 = 1
                  AND T1.CHNL_CD     = T2.CHNL_CD
                  AND T1.CHNL_CD     = #CHNL_CD#
                  AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                  AND T2.RLSE_CMD_NO = #RLSE_CMD_NO#
                GROUP BY T2.ITM_STL_SZ_CD    
            ) T1 
          OUTER APPLY (
              SELECT  X.GR_NO
                    , X.INCR_RT
                    , X.GR_CNTR_NM
                    , X.GR_CNTR_ROUT_NM
                    , X.GR_RLSE_KNT_NM
                    , X.GR_SND_DT
                    , X.GR_ARR_DT
                    , X.GR_INV_NO
                    , X.GR_CAR_NO
                    , X.ARR_USR_NM
                    , X.ARR_ADDR
                    , X.CAR_DRV_USR_NM
                    , X.N1ST_TEL_NO
                    , X.N2ND_TEL_NO
                FROM TB_SL_RLSE_GR_INFO X
               WHERE 1 = 1  
                 AND X.GR_NO = #RLSE_CMD_NO#
          ) T2     
     </select>

	  <select id="S22223GrRpt2Select" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		   SELECT CONVERT(VARCHAR(10), T1.SL_RLSE_DT, 23) AS SL_RLSE_DT
                , T1.SL_CO_CD
                , T2.SL_RLSE_NO
                , dbo.F_RPAD(CAST(T2.SL_RLSE_SEQ AS VARCHAR), 3, '0') AS RLSE_NO 
                , T2.SL_ITM_CD
                , T2.SL_ITM_QTY
                , T2.SL_ITM_WGT
                , T2.ITM_SHP_CD
                , T2.ITM_STL_CD 
                , T3.ITM_SHP_NM
                , T3.ITM_IMG 
                , T2.ITM_STL_SZ_CD
                , T2.ITM_STL_LENG 
                , T2.ITM_STL_PRD_DESC
                , T2.CUST_PUR_NO
                , T2.CUST_PUR_SEQ
                , T2.CNTR_NM
                , T2.CNTR_PSN_NM 
                , CONVERT(VARCHAR(10), T2.IN_REQ_DT, 23) AS IN_REQ_DT
                , T2.CNTR_DE_NM
                , T2.CHNL_CD   
                , CASE WHEN T3.SHP_CD IS NULL THEN 'Y' ELSE 'N' END AS VIS_FLG
                , T4.A_LEN
                , T4.A_VAL 
                , T4.B_LEN
                , T4.B_VAL
                , T4.C_LEN
                , T4.C_VAL
                , T4.D_LEN
                , T4.D_VAL
                , T4.E_LEN
                , T4.E_VAL
                , T4.F_LEN
                , T4.F_VAL     
                , T6.A_LEN AS A_LEN_POS
                , T6.A_VAL AS A_VAL_POS
                , T6.B_LEN AS B_LEN_POS
                , T6.B_VAL AS B_VAL_POS
                , T6.C_LEN AS C_LEN_POS
                , T6.C_VAL AS C_VAL_POS
                , T6.D_LEN AS D_LEN_POS
                , T6.D_VAL AS D_VAL_POS
                , T6.E_LEN AS E_LEN_POS
                , T6.E_VAL AS E_VAL_POS
                , T6.F_LEN AS F_LEN_POS
                , T6.F_VAL AS F_VAL_POS
                , T5.GR_NO    
                , T5.GR_CNTR_NM      
                , T5.GR_CNTR_ROUT_NM 
                , CONVERT(VARCHAR(10), T5.GR_SND_DT, 23) AS GR_SND_DT
                , CONVERT(VARCHAR(10), T5.GR_ARR_DT, 23) AS GR_ARR_DT
                , T5.GR_INV_NO 
                , T5.GR_CAR_NO
                , T5.GR_WGT  
            FROM TB_SL_RLSE       T1
                , TB_SL_RLSE_DTL   T2
                OUTER APPLY (
                SELECT X.A_LEN, X.B_LEN, X.C_LEN, X.D_LEN, X.E_LEN, X.F_LEN, X.A_VAL, X.B_VAL, X.C_VAL, X.D_VAL, X.E_VAL, X.F_VAL 
                    FROM TB_MES_PROD_DESC  X
                    WHERE 1 = 1
                    AND X.SL_RLSE_NO   = T2.SL_RLSE_NO
                    AND X.SL_RLSE_SEQ  = T2.SL_RLSE_SEQ
                ) T4
                OUTER APPLY (
                SELECT X.ITM_NM   AS ITM_SHP_NM
                    , X.ITM_CD AS SHP_CD
                    , Z.ITM_IMG  
                FROM TB_CD_ITM  X
                    OUTER APPLY ( 
                        SELECT Z.IMG  AS ITM_IMG 
                        FROM TB_CD_ITM_IMG Z
                        WHERE 1 = 1
                        AND X.CHNL_CD = Z.CHNL_CD
                        AND X.ITM_CD  = Z.ITM_CD
                    ) Z 
                WHERE 1 = 1
                    AND X.CHNL_CD           = #CHNL_CD#
                    AND X.ITM_GRP_CLSS_CD   = 'P'  
                    AND X.DELT_FLG          = 'N'   
                    AND X.ITM_CD            = T2.ITM_SHP_CD
                ) T3
                OUTER APPLY (
                    SELECT  X.GR_NO
                        , X.INCR_RT
                        , X.GR_CNTR_NM, X.GR_CNTR_ROUT_NM, X.GR_RLSE_KNT_NM
                        , X.GR_SND_DT, X.GR_ARR_DT, X.GR_INV_NO, X.GR_CAR_NO
                        , X.GR_WGT, X.ARR_USR_NM, X.ARR_ADDR
                        , X.CAR_DRV_USR_NM, X.N1ST_TEL_NO, X.N2ND_TEL_NO
                    FROM TB_SL_RLSE_GR_INFO X
                    WHERE 1 = 1  
                        AND X.GR_NO = #RLSE_CMD_NO#
                ) T5            
                OUTER APPLY (
                     SELECT A_LEN, B_LEN, C_LEN, D_LEN, E_LEN, F_LEN
                          , A_VAL, B_VAL, C_VAL, D_VAL, E_VAL, F_VAL
                       FROM TB_SYS_SHAPE_PSN X
                      WHERE 1 = 1 
                        AND X.ITM_CD = T2.ITM_SHP_CD
                ) T6
        WHERE 1 = 1
            AND T1.CHNL_CD      = T2.CHNL_CD
            AND T1.CHNL_CD      = #CHNL_CD#
            AND T1.SL_RLSE_NO   = T2.SL_RLSE_NO
            AND T2.RLSE_CMD_NO  = #RLSE_CMD_NO#
	  </select>
	  
	  
<!--##주문별 생산공장/GR확정##-->		  
	  <select id="S22227LeftTopMstSelect" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT T1.SL_CO_CD
             , T2.CUST_PUR_NO
             , T3.CO_NM
          FROM TB_SL_RLSE       T1
             , TB_SL_RLSE_DTL   T2
             , TB_CD_CO         T3
         WHERE 1= 1
           AND T1.CHNL_CD     = #CHNL_CD#
           AND T1.CHNL_CD     = T2.CHNL_CD
           AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
           AND T1.SL_CO_CD    = T3.CO_NO
           AND T1.SL_RLSE_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
           AND T1.SL_RLSE_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
        GROUP BY T1.SL_CO_CD
               , T2.CUST_PUR_NO   
               , T3.CO_NM
	  </select>	  
	  
	  <select id="S22227RightTopDtlSelect" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
        SELECT  CONVERT(VARCHAR, T1.IN_REQ_DT, 23) AS IN_REQ_DT
              , T1.DE_CO_NM AS GBN
              , T2.CNTR_NM
              , T2.CNTR_PSN_NM
              , T1.FLR_NO
              , ISNULL(T2.OK_Y_WGT, 0)        AS OK_Y_WGT
              , ISNULL(T2.OK_N_WGT, 0)        AS OK_N_WGT
              , ISNULL(T2.TOT_WGT, 0)         AS OK_WGT
              , CONVERT(VARCHAR, T1.UPD_DT, 23) AS DUE_DT
              , T1.PUR_NO
              , T1.PUR_SEQ
          FROM TB_CUST_PUR_DTL    T1
         OUTER APPLY ( 
            SELECT X.CNTR_NM
                 , X.CNTR_PSN_NM
                 , ISNULL(SUM(CASE WHEN X.OK_FLG = 'Y' THEN X.SL_ITM_WGT END), 0) AS OK_Y_WGT
                 , ISNULL(SUM(CASE WHEN X.OK_FLG = 'N' THEN X.SL_ITM_WGT END), 0) AS OK_N_WGT
                 , ISNULL(SUM(X.SL_ITM_WGT), 0) AS TOT_WGT
              FROM (
               SELECT 'Y'   AS OK_FLG
                    , X.CNTR_NM
                    , X.CNTR_PSN_NM
                    , X.SL_ITM_WGT            
                 FROM TB_SL_RLSE_DTL  X
                WHERE 1= 1
                  AND X.CHNL_CD        = #CHNL_CD#
                  AND X.CUST_PUR_NO    = T1.PUR_NO
                  AND X.CUST_PUR_SEQ   = T1.PUR_SEQ   
                  AND X.OK_FLG         = 'Y'
              UNION ALL          
               SELECT 'N'   AS OK_FLG
                    , X.CNTR_NM
                    , X.CNTR_PSN_NM
                    , X.SL_ITM_WGT
                 FROM TB_SL_RLSE_DTL  X
                WHERE 1= 1
                  AND X.CHNL_CD        = #CHNL_CD#
                  AND X.CUST_PUR_NO    = T1.PUR_NO
                  AND X.CUST_PUR_SEQ   = T1.PUR_SEQ   
                  AND X.OK_FLG         = 'N'
                  ) X
            GROUP BY X.CNTR_NM
                   , X.CNTR_PSN_NM          
              ) T2
          WHERE 1 = 1
            AND T1.PUR_NO = #CUST_PUR_NO#
	  </select>	  

	  <select id="S22227LeftBottomDtlSelect" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
     SELECT  T2.RLSE_CMD_NO
           , MIN(T3.LOC_NM) AS LOC_NM
		   , MIN(LOC_CD) AS LOC_CD
           , T2.CUST_PUR_NO
        FROM TB_SL_RLSE       T1
           , TB_SL_RLSE_DTL   T2
     OUTER APPLY (
                   SELECT X.CLSS_DESC    AS LOC_NM 
                     FROM TB_SYS_CLSS_CD  X
                    WHERE 1 = 1
                      AND X.CHNL_CD     = 'C210914-ROBO'
                      AND X.CLSS_TP_CD  = 'C-008'
                      AND X.CLSS_CD     = T2.LOC_CD    
                            ) T3
       WHERE 1 = 1
         AND T1.CHNL_CD       = #CHNL_CD#
         AND T1.CHNL_CD       = T2.CHNL_CD
         AND T2.OK_FLG        = 'Y'              
         AND T2.RLSE_CMD_NO   IS NOT NULL      
         AND T2.CUST_PUR_NO   = #CUST_PUR_NO# 
         AND NOT EXISTS 
		                (SELECT 'X'
                           FROM TB_SL_RLSE_GR_INFO X
                          WHERE 1 = 1
                            AND X.GR_NO = T2.RLSE_CMD_NO )
       GROUP BY T2.RLSE_CMD_NO
              , T3.LOC_NM
              , T2.SL_RLSE_NO
              , T2.CUST_PUR_NO
     </select>
     
	  
	  <select id="S22227RightBottomDtlSelect" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
		   SELECT  'N' AS CHK_FLG
		          , T1.FLR_NO
		          , T2.RLSE_CMD_NO
		          , T2.CNTR_NM
		          , T2.CNTR_PSN_NM
		          , T2.SL_ITM_CD
		          , T2.ITM_SHP_CD
		          , T2.ITM_STL_CD
		          , T2.ITM_STL_SZ_CD
		          , T2.SL_ITM_QTY
		          , T2.SL_ITM_WGT
		          , T2.LOC_CD
		          , T2.SL_RLSE_NO
		          , T2.SL_RLSE_SEQ
		          , T1.PUR_NO
		  FROM  TB_CUST_PUR_DTL   T1
		      , TB_SL_RLSE_DTL    T2
		  WHERE 1=1
		   AND T1.CHNL_CD     = #CHNL_CD#
		   AND T1.CHNL_CD     = T2.CHNL_CD
		   AND T1.PUR_NO      = T2.CUST_PUR_NO
		   AND T1.PUR_SEQ     = T2.CUST_PUR_SEQ
		   AND T1.PUR_NO      = #PUR_NO#
		   AND T2.OK_FLG      = #OK_FLG#
		  <isNotNull property="A_PUR_NO">
			  <iterate property="A_PUR_NO" prepend=" AND (T1.PUR_NO + '_' + T2.CNTR_NM + '_' + T2.CNTR_PSN_NM) IN " open = "(" close=")" conjunction=",">
				  #A_PUR_NO[]#
			  </iterate>
		   </isNotNull>
	  </select>	  
	  
	  <!--확정된 GRList조회-->
	  <select id="S22227GrListDtlSelect" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
       SELECT  'N' AS CHK_FLG
              , T1.FLR_NO
              , T2.RLSE_CMD_NO
              , T2.CNTR_NM
              , T2.CNTR_PSN_NM
              , T2.SL_ITM_CD
              , T2.ITM_SHP_CD
              , T2.ITM_STL_CD
              , T2.ITM_STL_SZ_CD
              , T2.SL_ITM_QTY
              , T2.SL_ITM_WGT
              , T2.LOC_CD
              , T2.SL_RLSE_NO
              , T2.SL_RLSE_SEQ
              , T1.PUR_NO
        FROM   TB_CUST_PUR_DTL   T1
             , TB_SL_RLSE_DTL    T2
        WHERE 1=1
         AND T1.CHNL_CD     = #CHNL_CD#
         AND T1.CHNL_CD     = T2.CHNL_CD
         AND T1.PUR_NO      = T2.CUST_PUR_NO
         AND T1.PUR_SEQ     = T2.CUST_PUR_SEQ
         AND T1.PUR_NO      = #CUST_PUR_NO#
         AND T2.OK_FLG      = #OK_FLG#
		 AND T2.RLSE_CMD_NO = #RLSE_CMD_NO#
	   <isNotNull property="LOC_CD">
         AND #SL_CO_GRD_NM# IN (T2.RLSE_CMD_NO + '_' + T2.LOC_CD)
	   </isNotNull>
	   <isNull property="LOC_CD">
         AND T2.LOC_CD IS NULL 
	   </isNull>		  
	
		
		 
	  </select>	  
	  
<!--GR번호 신규 부여 함수-->
      <select id="S22227SelectGRNo" resultClass="string">
          SELECT dbo.FF_ROBO_GR_CRT()
      </select>
  
	  
    <update id="S22227UpdateGRApply" parameterClass="ModelsLibrary.Sale.SaleVo">
	  UPDATE TB_SL_RLSE_DTL   
         SET OK_FLG         = 'Y'
           , RLSE_CMD_NO    = #RLSE_CMD_NO#
           , LOC_CD         = #LOC_CD#
      WHERE 1 = 1
       AND CHNL_CD     = #CHNL_CD#
       AND SL_RLSE_NO  = #SL_RLSE_NO# 
       AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
    </update> 
	  	  
    <update id="S22227UpdateGROriginApply" parameterClass="ModelsLibrary.Sale.SaleVo">
	  UPDATE TB_SL_RLSE_DTL   
         SET OK_FLG         = 'Y'
           , RLSE_CMD_NO    = #RLSE_CMD_NO#
      WHERE 1 = 1
       AND CHNL_CD     = #CHNL_CD#
       AND SL_RLSE_NO  = #SL_RLSE_NO# 
       AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
    </update> 
	  
<!--LOC창고 콤보박스조회-->
    <select id="S22227SelectLocList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
 
 WITH LOC_INFO AS (
                     SELECT CLSS_CD      AS LOC_CD
                         , CLSS_DESC    AS LOC_NM
                      FROM TB_SYS_CLSS_CD  T1
                     WHERE 1 = 1
                      AND CHNL_CD     = #CHNL_CD#
                      AND CLSS_TP_CD  = 'C-008'
                      AND USE_ST_DT  <![CDATA[<=]]> GETDATE()
                      AND USE_END_DT >= GETDATE()
                      AND DELT_FLG    = 'N'           

                   ) 

    SELECT T1.LOC_CD, 
           CASE WHEN T1.LOC_CD = T2.LOC_CD THEN '우선순위창고 ->' + T1.LOC_NM
                ELSE T1.LOC_NM
                END LOC_NM
      FROM LOC_INFO T1
    OUTER APPLY(
                SELECT MIN(T1.LOC_CD) AS LOC_CD
                             FROM (
                                           SELECT LOC_CD 
                                             FROM LOC_INFO
                                            WHERE 1=1
                                             AND LOC_CD NOT IN 
                                              (  SELECT LOC_CD FROM TB_SL_RLSE_DTL
                                                                WHERE LOC_CD IS NOT NULL
                                                                GROUP BY LOC_CD)
                                          
                                               ) T1
                                    ) T2        
    </select>	  
	  
	  
    <update id="S22227UpdateLoc" parameterClass="ModelsLibrary.Sale.SaleVo">
    UPDATE TB_SL_RLSE_DTL
       SET LOC_CD = #LOC_CD# 
      WHERE 1 = 1
	   AND CHNL_CD     = #CHNL_CD#
	   AND RLSE_CMD_NO = #RLSE_CMD_NO#
	  <isNotNull property ="LOC_RMK">
	   AND LOC_CD = #LOC_RMK#	  
	  </isNotNull>
      <isNull property ="LOC_RMK">
	   AND LOC_CD IS NULL	   
	   </isNull>
    </update> 
 
<!--GR번호 삭제 버튼-->
    <update id="S22227UpdateGR_RollBack" parameterClass="ModelsLibrary.Sale.SaleVo">
	UPDATE TB_SL_RLSE_DTL
		SET OK_FLG         = 'N'
		  , RLSE_CMD_NO    = NULL
		  , LOC_CD         = NULL
	 	WHERE 1 = 1
		 AND CHNL_CD     = #CHNL_CD#
		 AND SL_RLSE_NO  = #SL_RLSE_NO#
		 AND SL_RLSE_SEQ = #SL_RLSE_SEQ#
	</update>	  

<!--LOC번호 삭제 버튼-->
    <update id="S22227UpdateLoc_RollBack" parameterClass="ModelsLibrary.Sale.SaleVo">
    UPDATE TB_SL_RLSE_DTL   
       SET LOC_CD     = NULL
      WHERE 1 = 1
      AND CHNL_CD     = #CHNL_CD#
      AND RLSE_CMD_NO = #RLSE_CMD_NO#
	  AND LOC_CD      = #LOC_CD#
    </update>
	  

<!--출하등록-->
   <select id="S221111SelectMst" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">
    SELECT T1.CHNL_CD
         , T1.SL_BIL_NO
         , T1.SL_AREA_CD
         , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-002', T1.SL_AREA_CD) AS SL_AREA_NM
         , T1.SL_CO_CD
         , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS SL_CO_NM
         , T1.CAR_NO
         , CONVERT(VARCHAR, T1.SL_BIL_DT, 23) AS SL_BIL_DT
         , T1.SL_BIL_RMK
         , T1.CRE_USR_ID
         , T1.MV_CAR_AMT
         , T1.CRE_DT
         , T1.UPD_USR_ID
         , T1.UPD_DT
         , T2.HDQTR_PHN_NO
         , T2.HDQTR_ADDR
         , T2.HDQTR_FAX_NO
         , T1.CLR_TXT
      FROM TB_SL_BIL T1
        OUTER APPLY (
                SELECT * FROM TB_CD_CO
                WHERE 1=1
                AND CHNL_CD = #CHNL_CD#
                AND CO_NO = T1.SL_CO_CD 
                ) T2
      WHERE 1=1
       AND T1.CHNL_CD = #CHNL_CD#
       AND T1.SL_BIL_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
       AND T1.SL_BIL_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
    </select>   
	  
 <!-- 운송장번호 생성 -->
    <select id="S221111SelectSLBILNo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'ARTAX', '001') 
    </select>
	  
	  
   <insert id="S221111InsertMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      INSERT INTO TB_SL_BIL
     (
        SL_BIL_NO
      , SL_AREA_CD
      , SL_CO_CD
      , CAR_NO
      , SL_BIL_DT
      , SL_BIL_RMK
      , CLR_TXT
      <!--, MV_CAR_AMT-->
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
      , CHNL_CD
     )
    VALUES
    (  
        #SL_BIL_NO#
      , #SL_AREA_CD#
      , #SL_CO_CD#
      , #CAR_NO#
      , #SL_BIL_DT#
      , #SL_BIL_RMK#
      , #CLR_TXT#
      <!--, #MV_CAR_AMT#-->
      , #CRE_USR_ID#
      , GETDATE()
      , #UPD_USR_ID#
      , GETDATE()
      , #CHNL_CD#
     )
    </insert>
	  
	  <!--운송장번호 업데이트-->
	<update id="S221111UpdateSLBILNo" parameterClass="ModelsLibrary.Sale.SaleVo">
    UPDATE TB_SYS_NO_FMT
       SET LST_FMT_NO = #SL_BIL_NO#
     WHERE 1 = 1 
       AND CHNL_CD  = #CHNL_CD#
       AND TBL_ID   = 'ARTAX'
       AND AREA_CD  = '001'
    </update>	  
	  
   <update id="S221111UpdateMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      UPDATE TB_SL_BIL
         SET   
              SL_AREA_CD = #SL_AREA_CD#
            , SL_CO_CD   = #SL_CO_CD# 
            , CAR_NO     = #CAR_NO#
            , SL_BIL_DT  = #SL_BIL_DT#
            , SL_BIL_RMK = #SL_BIL_RMK#
            , CLR_TXT    = #CLR_TXT#
            <!--, MV_CAR_AMT = #MV_CAR_AMT#-->
            , UPD_USR_ID = #UPD_USR_ID#
            , UPD_DT     = GETDATE()
            , CHNL_CD    = #CHNL_CD#
         WHERE 1=1
          AND CHNL_CD   = #CHNL_CD#
          AND SL_BIL_NO = #SL_BIL_NO#
    </update>
	  
    <delete id="S221111DeleteMst" parameterClass="ModelsLibrary.Sale.SaleVo">
      DELETE FROM TB_SL_BIL
         WHERE 1=1
         AND CHNL_CD   = #CHNL_CD#
         AND SL_BIL_NO = #SL_BIL_NO#
    </delete>	  
	  
	<select id="S221111SelectDtlPopupList" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">  
        SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.LOT_DIV_NO) AS RN
		     , T1.LOT_DIV_NO
             , T1.LOT_DIV_SEQ
             , T1.SL_RLSE_NO
             , T1.SL_RLSE_SEQ
             , T5.CO_NM
             , T2.RLSE_CMD_NO
             , T2.CNTR_NM
             , CONVERT(VARCHAR, T2.IN_REQ_DT, 23) AS IN_REQ_DT
             , T2.CNTR_PSN_NM
             , T2.ITM_SHP_CD
             , T2.ITM_STL_CD
             , T2.ITM_STL_SZ_CD
             , T2.ITM_STL_LENG
             , T2.SL_ITM_WGT
             , T2.SL_ITM_QTY
             , T1.PROD_GD_QTY     
             , T2.LOC_CD
           FROM TB_RBK_MORD      T1
              , TB_SL_RLSE_DTL   T2   
              , TB_SL_RLSE       T4
              , TB_CD_CO         T5
        WHERE 1 = 1
         AND T1.SL_RLSE_NO   = T2.SL_RLSE_NO
         AND T1.SL_RLSE_SEQ  = T2.SL_RLSE_SEQ
         AND T2.SL_RLSE_NO   = T4.SL_RLSE_NO 
         AND T2.CHNL_CD      = T4.CHNL_CD
         AND T2.CHNL_CD      = T5.CHNL_CD
         AND T1.PROD_GD_QTY > 0 
         AND T4.CLZ_FLG       = 'N'
         AND T4.SL_CO_CD      = T5.CO_NO
		 <!--AND T5.CO_NO         = #SL_CO_CD#-->
		 AND T2.CHNL_CD       = #CHNL_CD#
         AND NOT EXISTS (SELECT 'X'
                           FROM TB_SL_BIL_DTL X
                          WHERE 1 = 1
                            AND X.PUR_NO  = T1.LOT_DIV_NO
                            AND X.PUR_SEQ = T1.LOT_DIV_SEQ
                         )
    </select>	
	  
	<insert id="S221111InsertDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
    INSERT INTO TB_SL_BIL_DTL
    (     
          CHNL_CD
        , SL_BIL_NO
        , SL_BIL_SEQ
        , SL_ITM_CD
        , SL_ITM_QTY
        , SL_ITM_PRC_VAL
        , SL_ITM_AMT
        , SL_ITM_TAX_AMT
        , SL_ITM_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , SL_RLSE_NO
        , SL_RLSE_SEQ
        , RLSE_CMD_NO 
		, PUR_NO
		, PUR_SEQ
    )
    VALUES
    (
         #CHNL_CD#
       , #SL_BIL_NO#
       , (SELECT ISNULL(MAX(SL_BIL_SEQ), 0) + 1 FROM TB_SL_BIL_DTL WHERE 1=1 AND CHNL_CD = #CHNL_CD# AND SL_BIL_NO = #SL_BIL_NO#) 
       , #SL_ITM_CD#
       , #SL_ITM_QTY#
       , #SL_ITM_PRC_VAL#
       , #SL_ITM_AMT#
       , #SL_ITM_TAX_AMT#
       , #SL_ITM_RMK#
       , #CRE_USR_ID#
       , GETDATE()
       , #UPD_USR_ID#
       , GETDATE()
       , #SL_RLSE_NO#
       , #SL_RLSE_SEQ#
       , #RLSE_CMD_NO# 
	   , #LOT_DIV_NO#
	   , #LOT_DIV_SEQ#
    )
    </insert>	  

	<delete id="S221111DeleteDtl" parameterClass="ModelsLibrary.Sale.SaleVo">
       DELETE FROM TB_SL_BIL_DTL
        WHERE 1=1
         AND CHNL_CD    = #CHNL_CD#
         AND SL_BIL_NO  = #SL_BIL_NO#
		 AND SL_BIL_SEQ = #SL_BIL_SEQ#
    </delete>	 
	  
	<select id="S221111SelectDtl" parameterClass="ModelsLibrary.Sale.SaleVo" resultClass="ModelsLibrary.Sale.SaleVo">  
       SELECT  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T2.SL_BIL_NO) AS RN 
	         , T2.SL_BIL_NO
	         , T2.SL_BIL_SEQ
             , T1.SL_CO_CD
             , T4.CO_NM                         
             , T2.SL_RLSE_NO
             , T2.SL_RLSE_SEQ
             , T3.SL_ITM_CD
             , T3.RLSE_CMD_NO
             , T3.CNTR_NM      
             , CONVERT(VARCHAR, T3.IN_REQ_DT, 23) AS IN_REQ_DT      
             , T3.CNTR_PSN_NM  
             , T3.ITM_SHP_CD   
             , T3.ITM_STL_CD  
             , T3.ITM_STL_SZ_CD  
             , T3.ITM_STL_LENG   
             , T3.SL_ITM_WGT     
             , T3.SL_ITM_QTY 
             , T3.LOC_CD 
             , T2.SL_ITM_AMT
             , T2.SL_ITM_TAX_AMT
             , T2.SL_ITM_RMK
         FROM TB_SL_BIL       T1
            , TB_SL_BIL_DTL   T2
            , TB_SL_RLSE_DTL  T3
            , TB_CD_CO        T4
     WHERE 1 = 1
       AND T1.CHNL_CD     = T2.CHNL_CD     
       AND T1.CHNL_CD     = T3.CHNL_CD     
       AND T1.CHNL_CD     = T4.CHNL_CD     
       AND T1.SL_BIL_NO   = T2.SL_BIL_NO
       AND T2.SL_RLSE_NO  = T3.SL_RLSE_NO
       AND T2.SL_RLSE_SEQ = T3.SL_RLSE_SEQ
       AND T1.SL_CO_CD    = T4.CO_NO
       AND T2.SL_BIL_NO   = #SL_BIL_NO#
       AND T2.CHNL_CD     = #CHNL_CD#
    </select>	  
	   
  </statements>
</sqlMap>