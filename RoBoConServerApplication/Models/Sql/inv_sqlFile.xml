<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="inv" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <statements>
    
    <!--품목 입고-->
    <select id="I66110SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
      SELECT 
             ROW_NUMBER() OVER (PARTITION BY T1.ITM_CD, T1.CO_CD ORDER BY T1.INAUD_DT) AS RN 
           , T1.INSRL_NO      
           , T1.ITM_CD        
           , T1.CO_CD         
           , T3.CO_NM         
           , T2.ITM_NM        
           , CONVERT(VARCHAR, T1.INAUD_DT, 23) AS INAUD_DT  
           , T1.BAT_CD        AS BATCH_CD
           , T1.MST_LOT_NO    
           , T1.SER_NO        
           , T1.EXP_NO
           , T1.ITM_QTY       
           , T1.ITM_QTY AS MM_01
           , (T1.ITM_QTY - T4.O_QTY) AS STK_QTY 
           , T1.CHNL_CD 
        FROM TB_COM_INAUD_DTL T1
          CROSS APPLY ( 
                        SELECT ISNULL(SUM(X.ITM_QTY), 0)  AS O_QTY 
                           FROM TB_COM_INAUD_DTL X
                          WHERE 1 = 1
                            AND X.ORD_NO  = T1.INSRL_NO
                            AND X.IO_CD   = 'O'
                      ) T4           
           , TB_CD_ITM        T2
           , TB_CD_CO         T3
         WHERE 1 = 1
           AND T1.AREA_CD   = #AREA_CD#    
           AND T1.CHNL_CD   = #CHNL_CD#    
          <isNotNull property="FM_DT" >
           AND T1.INAUD_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
          </isNotNull>
          <isNotNull property="TO_DT" >
           AND T1.INAUD_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
          </isNotNull>
           AND T1.IO_CD     = #IO_CD#
           AND T1.CHNL_CD   = T2.CHNL_CD   
           AND T1.CHNL_CD   = T3.CHNL_CD   
           AND T1.ITM_CD    = T2.ITM_CD
           AND T1.CO_CD     = T3.CO_NO
           AND T1.CLZ_FLG   = 'N'
          <isNotNull property="INSRL_NO" >
            AND T1.INSRL_NO  = #INSRL_NO#
          </isNotNull>

    </select>
    
    <select id="I66110SelectDtlPurList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
        SELECT T4.CO_NM     
             , CONVERT(VARCHAR, T1.PUR_DT, 23) AS    PUR_DT 
             , T3.ITM_CD    
             , T3.ITM_NM    
             , T3.ITM_SZ_NM 
             , T3.UOM_CD    
             , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T3.UOM_CD)  AS UOM_NM 
             , '' AS BATCH_CD    
             , '' AS MST_LOT_NO 
             , '' AS SER_NO     
             , '' AS EXP_NO     
             , T2.PUR_QTY       
             , 0  AS ITM_QTY  
             , T1.PUR_ORD_NO    
             , T2.PUR_ORD_SEQ   
             , T1.PUR_CO_CD   AS CO_CD
             , T1.AREA_CD
             , #CRE_USR_ID# AS CRE_USR_ID
             , #UPD_USR_ID# AS UPD_USR_ID
             , T1.CHNL_CD
          FROM TB_PUR_ORD       T1
             , TB_PUR_ORD_DTL   T2
             , TB_CD_ITM        T3
             , TB_CD_CO         T4
           WHERE 1 = 1
             AND T1.CHNL_CD       = #CHNL_CD#
             AND T1.CHNL_CD       = T2.CHNL_CD
             AND T1.CHNL_CD       = T3.CHNL_CD   
             AND T1.CHNL_CD       = T4.CHNL_CD      
             AND T1.PUR_ORD_NO    = T2.PUR_ORD_NO
             AND T2.ITM_CD        = T3.ITM_CD
             AND T1.PUR_CO_CD     = T4.CO_NO
             AND T1.PUR_CLZ_FLG   = 'N'
    </select>

    <select id="I66110SelectDtlOthList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT T3.ITM_CD     
           , T3.ITM_NM     
           , T3.ITM_SZ_NM  
           , T3.UOM_CD     
           , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD, 'L-003', T3.UOM_CD)  AS UOM_NM 
           , CONVERT(VARCHAR, GETDATE(), 23) AS INAUD_DT
           , '' AS CO_CD            
           , '' AS BATCH_CD        
           , '' AS MST_LOT_NO    
           , '' AS SER_NO        
           , '' AS EXP_NO        
           , 0  AS ITM_QTY   
           , #CRE_USR_ID# AS CRE_USR_ID
           , #UPD_USR_ID# AS UPD_USR_ID
           , #AREA_CD# AS AREA_CD
           , T3.CHNL_CD
        FROM TB_CD_ITM        T3
          WHERE 1 = 1
            AND T3.CHNL_CD  = #CHNL_CD#
            AND T3.DELT_FLG = 'N'
    </select>

    

    <insert id="I66110InsertMst" parameterClass="ModelsLibrary.Inv.InvVo">
      INSERT INTO TB_COM_INAUD_DTL
      ( 
          CHNL_CD
        , INSRL_NO
        , CO_CD
        , ITM_CD
        , INAUD_DT
        , IO_CD
        , ORD_NO
        , ORD_SEQ
        , BAT_CD
        , MST_LOT_NO
        , SER_NO
        , EXP_NO
        , ITM_QTY
        , WH_QTY
        , GNTE_QTY
        , CLZ_FLG
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , AREA_CD
      ) VALUES (
          #CHNL_CD#
        , LEFT( NEWID(), 8)
        , #CO_CD#
        , #ITM_CD#
        , GETDATE()
        <!--
        , #INAUD_DT#
        -->
        , 'I'
        , #PUR_ORD_NO#
        , #PUR_ORD_SEQ#
        , #BATCH_CD#
        , #MST_LOT_NO#
        , #SER_NO#
        , #EXP_NO#
        , #ITM_QTY#  
        , #WH_QTY#
        , #GNTE_QTY#  
        , 'N'
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
        , #AREA_CD#
      )
    </insert>

    <delete id="I66110DeleteMst" parameterClass="ModelsLibrary.Inv.InvVo" >
      DELETE FROM TB_COM_INAUD_DTL
      WHERE 1=1
        AND CHNL_CD   = #CHNL_CD#
        AND INSRL_NO = #INSRL_NO#
    </delete>

    
     <!--품목 출고(얼라이브) - 추가-->
    <insert id="I66210InsertMst" parameterClass="ModelsLibrary.Inv.InvVo">
       INSERT INTO TB_COM_INAUD_DTL
        ( 
            CHNL_CD
          , INSRL_NO
          , CO_CD
          , ITM_CD
          , INAUD_DT
          , IO_CD
          , ORD_NO  
          , ITM_QTY  
          , CLZ_FLG
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , AREA_CD
        ) 
        SELECT    CHNL_CD
                , LEFT( NEWID(), 8)
                , CO_CD
                , ITM_CD
                , GETDATE()
                , 'O'
                , #INSRL_NO#
                , #MM_01#
                , 'N'        
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()
                , AREA_CD
          FROM TB_COM_INAUD_DTL
         WHERE CHNL_CD    = #CHNL_CD#
           AND INSRL_NO   = #INSRL_NO#
     </insert>

	  <!--품목 가입고-->
	  <select id="I6610SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
		  SELECT  #CHNL_CD#  AS CHNL_CD
		  , T1.RN
		  , T1.AREA_CD
		  , T1.AREA_NM
		  , T1.INAUD_TMP_NO
		  , T1.INAUD_TMP_SEQ
		  , T1.INAUD_DT
		  , T1.PUR_ORD_NO
		  , T1.PUR_ORD_SEQ
		  , T1.GBN
		  , T1.IN_FLG
		  , T1.CO_CD
		  , T1.CO_NM
		  , T1.LOC_CD
		  , T1.LOC_NM
		  , T1.ITM_CD
		  , T1.ITM_NM
		  , N1ST_ITM_SZ_NM + '*' + N2ND_ITM_SZ_NM AS ITM_SZ_NM
		  , T1.ITM_QTY
		  , T1.ITM_WGT
		  , T1.UOM_CD
		  , T1.UOM_NM
		  , T1.ITM_RMK
		  , T1.CRE_USR_ID
		  , T1.CRE_USR_NM
		  , T1.CRE_DT
		  , T1.IMP_ITM_PRC
		  , T1.IMP_ITM_AMT
		  , T1.SFTK_MD_QTY
		  , T1.ITM_MD_QTY
		  , T1.ITM_PCK_QTY
		  , T1.ITM_STK_QTY
		  , dbo.FF_ITM_TP_QTY(#CHNL_CD#,T1.ITM_CD, ITM_STK_QTY, 'A' ) AS ITM_STK_MD_QTY
		  , T1.ITM_LOC_NM
		  , MD_PER_QTY
		  , PK_PER_QTY
		  , ( CASE WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2) IN ('AZ', 'P2', 'P3') THEN 'N' ELSE 'Y' END ) AS DEL_FLG
		  , T1.PUR_QTY
		  , T1.INSP_NO
		  , T1.CO_MAKE_NO
		  , CONVERT(VARCHAR, T1.MTRL_MAKE_DT , 23) AS MTRL_MAKE_DT
		  , CONVERT(VARCHAR, DATEADD(DD, T1.MTRL_EXP_DY, T1.MTRL_MAKE_DT), 23) AS MTRL_EXP_DY
		  , T1.BATCH_CD
		  , T1.INSP_QTY
		  , T1.BAD_QTY
		  , T1.OK_FLG
		  , T1.INSP_FLG
		  FROM (
		  SELECT ROW_NUMBER() OVER (PARTITION BY T1.AREA_CD ORDER BY T2.N1ST_ITM_GRP_CD, T2.ITM_CD, T1.INAUD_DT) AS RN
		  , T1.AREA_CD
		  , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-002', T1.AREA_CD) AS AREA_NM
		  , T1.INAUD_TMP_NO
		  , T1.INAUD_TMP_SEQ
		  , CONVERT(VARCHAR, T1.INAUD_DT, 23) AS INAUD_DT
		  , T1.PUR_ORD_NO
		  , T1.PUR_ORD_SEQ
		  , CASE WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2)  =  'PO' THEN '발주-국내'
		  WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2)  =  'AZ' THEN '재고이동'
		  WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2)  =  'IV' THEN '발주-수입' END AS GBN
		  , dbo.FF_INAUD_YN ( T1.CHNL_CD, T1.PUR_ORD_NO,   T1.PUR_ORD_SEQ) AS IN_FLG
		  , T1.CO_CD
		  , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD)  AS CO_NM
		  , T1.LOC_CD
		  , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'P-008', T1.LOC_CD) AS LOC_NM
		  , T1.ITM_CD
		  , T2.ITM_NM
		  , T2.ITM_SZ_NM
		  , T1.ITM_QTY - dbo.FF_INVT_TMP_RMN_QTY(T1.CHNL_CD, T1.INAUD_TMP_NO, T1.INAUD_TMP_SEQ) AS ITM_QTY
		  , ROUND(T1.ITM_QTY * T2.UOM_WGT, 0) AS ITM_WGT
		  , T1.UOM_CD
		  , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T1.UOM_CD)  AS UOM_NM
		  , T1.ITM_RMK
		  , T1.CRE_USR_ID
		  , dbo.USR_NM_FNC(T1.CHNL_CD, T1.CRE_USR_ID) AS CRE_USR_NM
		  , CONVERT(VARCHAR, T1.CRE_DT, 121) AS CRE_DT
		  , T1.ITM_PRC  AS IMP_ITM_PRC
		  , T1.ITM_AMT  AS IMP_ITM_AMT
		  , dbo.FF_ITM_TP_QTY(T1.CHNL_CD, T1.ITM_CD, T1.ITM_QTY, 'A' ) AS SFTK_MD_QTY
		  , dbo.FF_ITM_TP_QTY(T1.CHNL_CD, T1.ITM_CD, T1.ITM_QTY, 'A' ) AS ITM_MD_QTY
		  , 0 AS ITM_PCK_QTY
		  , dbo.FF_ITM_STK_QTY(T1.CHNL_CD, ISNULL(#LOC_CD#, T1.AREA_CD), T1.ITM_CD, T1.INAUD_DT)  AS ITM_STK_QTY
		  , dbo.FF_ITM_LOC_NM(T1.CHNL_CD, T1.LOC_CD, T1.ITM_CD)       AS ITM_LOC_NM
		  , T2.MD_PER_QTY
		  , T2.PK_PER_QTY
		  , T3.PUR_QTY
		  , T1.INSP_NO
		  , T1.CO_MAKE_NO
		  , T1.MTRL_MAKE_DT
		  , T1.MTRL_EXP_DY
		  , T1.BATCH_CD
		  , T1.INSP_QTY
		  , T1.BAD_QTY
		  , T1.OK_FLG
		  , T1.INSP_FLG
		  , T1.N1ST_ITM_SZ_NM
		  , T1.N2ND_ITM_SZ_NM
		  FROM TB_INAUD_TMP    T1
		  , TB_CD_ITM      T2
		  , TB_PUR_ORD_DTL T3
		  WHERE 1 = 1
		  AND T1.CHNL_CD    = #CHNL_CD#
		  AND T1.CHNL_CD    = T2.CHNL_CD
		  AND T1.CHNL_CD    = T3.CHNL_CD
		  AND T1.ITM_CD     = T2.ITM_CD
		  AND T1.PUR_ORD_NO = T3.PUR_ORD_NO
		  AND T1.PUR_ORD_SEQ = T3.PUR_ORD_SEQ
		  AND T1.INAUD_DT   >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		  AND T1.INAUD_DT <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
		  <isNotNull property="GBN">
			  AND T1.PUR_ORD_NO LIKE #GBN# + '%'
		  </isNotNull>
		  <isNotNull property="AREA_CD">
			  AND T1.AREA_CD = #AREA_CD#
		  </isNotNull>
		  <isNotNull property="LOC_CD">
			  AND T1.LOC_CD = #LOC_CD#
		  </isNotNull>
		  <isNotNull property="IN_FLG">
			  AND NOT EXISTS (SELECT 'X'
			  FROM TB_INAUD_DTL  Z
			  WHERE 1 = 1
			  AND Z.CHNL_CD   = #CHNL_CD#
			  AND Z.ORD_NO    = T1.INAUD_TMP_NO
			  AND Z.ORD_SEQ   = T1.INAUD_TMP_SEQ
			  AND T1.ITM_QTY  =  dbo.FF_INVT_TMP_RMN_QTY(#CHNL_CD#, T1.INAUD_TMP_NO, T1.INAUD_TMP_SEQ)
			  )
		  </isNotNull>
		  ) T1
		  WHERE 1 = 1
	  </select>

  <select id="I6610SelectNo" resultClass="string">
    SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'ST', #AREA_CD#) AS LST_FMT_NO FROM CPY_T WHERE NO = 1 
  </select>

  <update id="I6610UpdateNo" parameterClass="ModelsLibrary.Inv.InvVo">
    UPDATE TB_SYS_NO_FMT
        SET LST_FMT_NO = #INAUD_TMP_NO#
      WHERE 1 = 1
        AND CHNL_CD   = #CHNL_CD#
        AND TBL_ID    = 'ST'
        AND AREA_CD   = #AREA_CD#
  </update>
    
  <insert id="I6610InsertPurMst" parameterClass="ModelsLibrary.Inv.InvVo">
      INSERT INTO TB_INAUD_TMP
      (
            INAUD_TMP_NO
          , INAUD_TMP_SEQ
          , INAUD_DT  
          , AREA_CD
          , PUR_ORD_NO
          , PUR_ORD_SEQ
          , CO_CD
          , LOC_CD
          , ITM_CD
          , ITM_QTY
          , ITM_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , ITM_PRC
          , ITM_AMT
          , CHNL_CD
      )
      SELECT #INAUD_TMP_NO#
          , ISNULL((SELECT MAX(INAUD_TMP_SEQ) + 1 
                      FROM TB_INAUD_TMP 
                    WHERE INAUD_TMP_NO = #INAUD_TMP_NO# AND CHNL_CD = #CHNL_CD#
                    ), 1) AS INAUD_TMP_SEQ
          , GETDATE()
          , #AREA_CD#
          , #PUR_ORD_NO#
          , #PUR_SEQ#
          , #CO_CD#
          , #LOC_CD#
          , #ITM_CD#
          , #ITM_QTY# 
          , #ITM_RMK#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()             
          , #CO_UT_PRC#
          , ROUND(#ITM_QTY#  * #CO_UT_PRC#, 0)
          , #CHNL_CD#
      <!--
      FROM (
            SELECT T1.PUR_ORD_NO
                , T2.PUR_ORD_SEQ AS PUR_SEQ
                , T2.ITM_CD
                , T3.ITM_NM
                , T3.ITM_SZ_NM     
                , T2.PUR_QTY
                , T2.CO_UT_PRC 
                , T2.PUR_AMT     
                , T2.PUR_ITM_RMK
                , T1.PUR_CO_CD  AS CO_NO
                , T1.AREA_CD
                , T3.UOM_CD
            FROM  TB_PUR_ORD     T1
                , TB_PUR_ORD_DTL T2
                , TB_CD_ITM     T3 
            WHERE 1 = 1
              AND T1.CHNL_CD       = T2.CHNL_CD
              AND T1.PUR_ORD_NO    = T2.PUR_ORD_NO
              AND T2.ITM_CD        = T3.ITM_CD
              AND T2.PUR_ORD_NO    = #PUR_ORD_NO#
              AND T2.PUR_ORD_SEQ   = #PUR_SEQ#
              AND T2.CHNL_CD       = #CHNL_CD#
          ) T1
      -->
  </insert>
    
  <delete id="I6610DeleteMst" parameterClass="ModelsLibrary.Inv.InvVo" >
      DELETE FROM TB_INAUD_TMP 
         WHERE 1=1
          AND CHNL_CD   = #CHNL_CD#
          AND INAUD_TMP_NO = #INAUD_TMP_NO#  
        <isNotNull property="INAUD_TMP_SEQ">
          AND INAUD_TMP_SEQ = #INAUD_TMP_SEQ#
        </isNotNull>
  </delete>
    
    <!-- 원자재 품질검사-->
	<select id="I6610SelectDtlmList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
		  SELECT  #CHNL_CD#  AS CHNL_CD
              , T1.PUR_ORD_NO   
              , T1.PUR_ORD_SEQ  
              , T1.N1ST_ITM_GRP_CD
              , T1.N2ND_ITM_GRP_CD
              , T1.CO_CD          
              , T1.ITM_CD         
              , T1.ITM_NM         
              , T1.ITM_SZ_NM      
              , T1.UOM_CD         
              , T1.PUR_QTY AS TMP_QTY
              , T1.ITM_QTY        
              , T1.LOC_CD         
              , T1.INSP_NO        
              , T1.CO_MAKE_NO     
              , CONVERT(VARCHAR, T1.MTRL_MAKE_DT, 23) AS MTRL_MAKE_DT    
              , CONVERT(VARCHAR, T1.MTRL_EXP_DY) AS MTRL_EXP_DY
              , CONVERT(VARCHAR, T1.INSP_DT, 23) AS INSP_DT    
              , T1.INSP_FLG       
              , T1.INSP_RMK     AS INAUD_RMK   
              , ( CASE WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2) IN ('AZ', 'P2', 'P3') THEN 'N' ELSE 'Y' END ) AS DELT_FLG
          FROM (
                SELECT ROW_NUMBER() OVER (PARTITION BY T1.AREA_CD ORDER BY T2.N1ST_ITM_GRP_CD, T2.ITM_CD, T1.INAUD_DT) AS RN 
                    , T3.PUR_ORD_NO   
                    , T3.PUR_ORD_SEQ  
                    , T2.N1ST_ITM_GRP_CD 
                    , T2.N2ND_ITM_GRP_CD 
                    , T1.CO_CD
                    , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_CD)  AS CO_NM 
                    , T1.ITM_CD
                    , T2.ITM_NM
                    , T2.ITM_SZ_NM
                    , T1.UOM_CD
                    , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T1.UOM_CD)  AS UOM_NM 
                    , T3.PUR_QTY
                    , T1.LOC_CD
                    , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'P-008', T1.LOC_CD) AS LOC_NM 
                    , T1.ITM_QTY - dbo.FF_INVT_TMP_RMN_QTY(#CHNL_CD#, T1.INAUD_TMP_NO, T1.INAUD_TMP_SEQ) AS ITM_QTY
                    , T1.INSP_NO
                    , T1.CO_MAKE_NO
                    , T1.MTRL_MAKE_DT
                    , T1.MTRL_EXP_DY
                    , T1.INSP_DT
                    , T1.INSP_FLG
                    , T1.INSP_RMK 
                    , CASE WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2)  =  'PO' THEN '발주-국내'
                            WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2)  =  'AZ' THEN '재고이동'     
                            WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2)  =  'IV' THEN '발주-수입' END AS GBN  
                    , dbo.FF_INAUD_YN ( #CHNL_CD#, T1.PUR_ORD_NO,   T1.PUR_ORD_SEQ) AS IN_FLG  
                    , T1.CRE_USR_ID
                    , dbo.USR_NM_FNC(#CHNL_CD#, T1.CRE_USR_ID) AS CRE_USR_NM 
                    , CONVERT(VARCHAR, T1.CRE_DT, 121) AS CRE_DT
                  FROM TB_INAUD_TMP T1
                      , TB_CD_ITM    T2
                      , TB_PUR_ORD_DTL T3
                  WHERE 1 = 1
                    AND T1.CHNL_CD  = #CHNL_CD#
                    AND T1.CHNL_CD  = T2.CHNL_CD
                    AND T1.ITM_CD   = T2.ITM_CD
                    AND T2.CHNL_CD  = T3.CHNL_CD
                    AND T1.CHNL_CD  = T3.CHNL_CD
                    AND T1.ITM_CD   = T3.ITM_CD
                    <isNotNull property="CO_NO">
						AND T1.CO_CD   = #CO_NO#
					</isNotNull>
                    AND T1.INAUD_DT   >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
                    AND T1.INAUD_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
          ) T1
        WHERE 1 = 1  
	  </select>

	  
	<select id="I6610SelectDtlPurList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
        SELECT   #CHNL_CD#  AS CHNL_CD
           , RN
           , PUR_ORD_NO
           , PUR_ORD_SEQ
           , N1ST_ITM_GRP_NM
           , N2ND_ITM_GRP_NM  
           , CO_CD
           , CO_NM 
           , ITM_CD
           , ITM_NM
           , ITM_SZ_NM
           , UOM_NM 
           , ITM_QTY  AS TMP_RMK_QTY
           , PUR_QTY  
           , ITM_MD_QTY
           , RMN_QTY
           , CO_UT_PRC     
           , ITM_QTY * CO_UT_PRC AS PUR_AMT
           , PUR_RMK
           , ITM_QTY
           , INAUD_ORG_NO
           , INAUD_ORG_NM
      FROM (       
            SELECT ROW_NUMBER() OVER (PARTITION BY T1.AREA_CD ORDER BY T3.N1ST_ITM_GRP_CD, T3.ITM_CD, T1.PUR_DT ) AS RN
               , T2.PUR_ORD_NO
               , T2.PUR_ORD_SEQ
               , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD)                    AS N1ST_ITM_GRP_NM
               , dbo.PUR_N2ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD,  N2ND_ITM_GRP_CD) AS N2ND_ITM_GRP_NM  
               , T1.PUR_CO_CD                         AS CO_CD
               , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.PUR_CO_CD)  AS CO_NM 
               , T3.ITM_CD
               , T3.ITM_NM
               , T3.ITM_SZ_NM
               , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T3.UOM_CD) AS UOM_NM 
               , T2.PUR_QTY  
               , (T2.PUR_QTY * T2.BUN_WGT)  AS ITM_MD_QTY
               , 0 AS RMN_QTY
               , T2.CO_UT_PRC     
               , T2.PUR_AMT     
               , T2.PUR_ITM_RMK AS PUR_RMK
               , (T2.PUR_QTY  - ISNULL(dbo.FF_INV_ORD_QTY(T1.CHNL_CD, T2.PUR_ORD_NO, T2.PUR_ORD_SEQ), 0))  AS ITM_QTY
               , '100' AS INAUD_ORG_NO
               , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'P-008', '100') AS INAUD_ORG_NM
            FROM TB_PUR_ORD       T1
               , TB_PUR_ORD_DTL   T2 
               , TB_CD_ITM        T3
           WHERE 1 = 1
             AND T1.CHNL_CD   = #CHNL_CD#      
             AND T1.CHNL_CD   = T2.CHNL_CD
             AND T1.CHNL_CD   = T3.CHNL_CD
             AND T1.PUR_ORD_NO = T2.PUR_ORD_NO
             AND T2.ITM_CD     = T3.ITM_CD
             AND T2.PUR_QTY  - ISNULL(dbo.FF_INV_ORD_QTY(#CHNL_CD#, T2.PUR_ORD_NO, T2.PUR_ORD_SEQ), 0)  > 0  
             AND T1.PUR_CLZ_FLG = 'N'          
             AND T1.PUR_DT     >=  #FM_DT# 
             AND T1.PUR_DT <![CDATA[<=]]> #TO_DT#
             AND NOT EXISTS (SELECT 'X'
                               FROM TB_PUR_CTRT_CLZ  X 
                             WHERE 1 = 1
                               AND X.CHNL_CD   = #CHNL_CD#
                               AND X.ORD_NO    = T2.PUR_ORD_NO
                               AND X.ORD_SEQ   = T2.PUR_ORD_SEQ
                    )
            <isNotNull property="CO_NO">
              AND T1.PUR_CO_CD   = #CO_NO#   
            </isNotNull>
          ) T1        
          ORDER BY RN 
    </select>



      <!--품목 입고-->
     <select id="I6611SelectMstList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">  
       SELECT 
				        CHNL_CD
               , INSRL_NO
               , INSRL_SEQ
               , INAUD_CD
               , INAUD_NM     
               , LOC_CD
               , LOC_NM      
               , CO_NO        
               , CO_NM
               , ITM_CD
               , ITM_NM
               , ITM_SZ_NM
               , INAUD_QTY
               , (INAUD_QTY * ITM_WGT) AS TOT_MD_QTY 
			         , ITM_WGT
               , ORD_NO
               , ORD_SEQ
               , LOT_NO
               , INAUD_RMK
               , INAUD_PRC
               , INAUD_AMT
               , CLZ_FLG
               , ITM_LOC_NM 
               , RN
               , MD_QTY
               , INAUD_DT
               , N1ST_ITM_GRP_NM   
      FROM
      (
          SELECT  T1.CHNL_CD AS CHNL_CD
               , T1.INSRL_NO
               , T1.INSRL_SEQ
               , T1.INAUD_CD
               , dbo.CD_SYS_CLSS_FNC( T1.CHNL_CD, 'L-007', T1.INAUD_CD) AS INAUD_NM     
               , T1.LOC_CD
               , dbo.CD_SYS_CLSS_FNC( T1.CHNL_CD, 'P-008', T1.LOC_CD)   AS LOC_NM      
               , T1.CO_NO        
               , dbo.CD_COMPANY_NM_FNC( T1.CHNL_CD, T1.CO_NO)  AS CO_NM
               , T1.ITM_CD
               , T2.ITM_NM
               , T2.ITM_SZ_NM
               , T1.INAUD_QTY
               , T2.UOM_CD
               , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD)  AS UOM_NM 
               <!--, ROUND(T1.INAUD_QTY * T2.UOM_WGT, 0) AS ITM_WGT--> 
              , (SELECT TOP 1 X.BUN_WGT FROM TB_PUR_ORD_DTL AS X WHERE 1=1 AND X.PUR_ORD_NO = T1.ORD_NO AND X.PUR_ORD_SEQ = T1.ORD_SEQ) AS ITM_WGT
               , T1.ORD_NO
               , T1.ORD_SEQ
               , T1.LOT_NO
               , T1.INAUD_RMK
               , T1.INAUD_PRC
               , T1.INAUD_AMT
               , dbo.FF_INAUD_CLZ_FLG( T1.CHNL_CD, T1.ITM_CD, CONVERT(VARCHAR(8), T3.INAUD_DT, 112)) AS CLZ_FLG
               , dbo.FF_ITM_LOC_NM( T1.CHNL_CD, T3.AREA_CD , T1.ITM_CD) AS ITM_LOC_NM 
               , ROW_NUMBER() OVER (PARTITION BY T1.INSRL_NO ORDER BY T1.INSRL_SEQ) AS RN
               , dbo.FF_ITM_TP_QTY( T1.CHNL_CD, T1.ITM_CD, T1.INAUD_QTY, 'A')  AS MD_QTY
               , CONVERT(VARCHAR(10), T3.INAUD_DT, 120) AS INAUD_DT
               , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM   
            FROM TB_INAUD_DTL       T1
               , TB_CD_ITM     T2 
               , TB_INAUD_MAST      T3
           WHERE 1 = 1
             AND T3.INAUD_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
             AND T3.INAUD_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
             AND T1.CHNL_CD    = #CHNL_CD#
             AND T1.CHNL_CD    = T2.CHNL_CD
             AND T1.CHNL_CD    = T3.CHNL_CD
             AND T1.INSRL_NO   = T3.INSRL_NO 
             AND T1.ITM_CD     = T2.ITM_CD
        ) AS T10
    </select>

    
    <insert id="I6611InsertMst" parameterClass="ModelsLibrary.Inv.InvVo">
      INSERT INTO TB_INAUD_HIS
      (
          CHNL_CD
        , AREA_CD
        , INAUD_DT
        , INAUD_TP_CD
        , IO_CD
        , FM_LOC_CD
        , TO_LOC_CD
        , CO_CD
        , ITM_CD
        , ITM_QTY
        , ORD_NO
        , ORD_SEQ
        , DELT_FLG
        , CRE_USR_ID
        , CRE_DT
        , CONN_NO
        , CONN_SEQ
        , INAUD_RMK
        , ROUT_CD
        , INAUD_FLG
        , LOT_NO
      )
      VALUES
      (
         
          #CHNL_CD#
        , #AREA_CD#
        , GETDATE()
        , #GBN#
        , #IO_CD#
        , #FM_LOC#
        , #TO_LOC#
        , #CO_CD#
        , #ITM_CD#
        , #ITM_QTY#
        , null
        , null
        , 'N'
        , #CRE_USR_ID#
        , GETDATE()
        , #PUR_ORD_NO#
        , #PUR_ORD_SEQ#
        , #ITM_RMK#
        , ''
        , ''
        , #LOT_NO#
      )
    </insert>




    <!--품목 입고-->
    <select id="I5511SelectMstList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT #CHNL_CD# AS CHNL_CD
         , DATENAME(YEAR, INAUD_DT) + '년 ' + DATENAME(MM, INAUD_DT) + '월' AS YRMON 
         , INSRL_NO + ' / ' + DATENAME(DD, INAUD_DT) + ' 일' AS INSRL_NM
         , INSRL_NO
         , CONVERT(VARCHAR(10), INAUD_DT, 120) AS INAUD_DT
         , RQST_EMPE_ID
         , dbo.USR_NM_FNC(#CHNL_CD#, RQST_EMPE_ID) AS RQST_EMPE_NM 
         , IO_CD
         , INAUD_RMK  
         , CONVERT(VARCHAR, CRE_DT, 121) AS CRE_DT  
         , (SELECT CONVERT(VARCHAR, MAX(UPD_DT), 121) AS UPD_DT  FROM TB_INAUD_DTL X WHERE  X.CHNL_CD = #CHNL_CD# AND X.INSRL_NO = T1.INSRL_NO ) AS UPD_DT
         , AREA_CD
         , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-002', T1.AREA_CD) AS AREA_NM  
         , CO_CD
         , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, CO_CD)  AS CO_NM
         , dbo.FF_INAUD_MAST_CLZ_FLG(#CHNL_CD#, T1.INSRL_NO)  AS CLZ_FLG         
      FROM TB_INAUD_MAST T1
        WHERE 1=1
          AND T1.CHNL_CD = #CHNL_CD#
          AND INAUD_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
          AND INAUD_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
          AND IO_CD = 'I'
        <isNotNull property="AREA_CD">
          AND AREA_CD = #AREA_CD#
        </isNotNull>
        <isNotNull property="CO_CD">
          AND CO_CD = #CO_CD#
        </isNotNull>
        <isNotNull property="CO_TP_CD">
          AND CO_CD IN (
                       SELECT CO_NO
                         FROM TB_CD_CO_TP
                         WHERE 1 = 1
                           AND CHNL_CD = #CHNL_CD#
                           AND CO_TP_CD LIKE #CO_TP_CD#
                        ) 
        </isNotNull>
       <isNotNull property="GRP_ID">
            AND RQST_EMPE_ID IN (
                         SELECT T1.USR_ID
                           FROM TB_SYS_USR T1
                              , TB_SYS_GRP T2
                          WHERE 1 = 1
                            AND T1.CHNL_CD = T2.CHNL_CD
                            AND T1.CHNL_CD = #CHNL_CD#
                            AND T1.GRP_ID  = T2.GRP_ID
                            AND T1.GRP_ID LIKE '%'
                      UNION ALL 
                         SELECT T1.USR_ID
                           FROM TB_SYS_USR T1
                              , TB_SYS_GRP T2
                          WHERE 1 = 1
                            AND T1.CHNL_CD = T2.CHNL_CD
                            AND T1.CHNL_CD = #CHNL_CD#
                            AND T1.GRP_ID  = T2.GRP_ID
                            AND T1.GRP_ID  = #GRP_ID#
                        )  
        </isNotNull>
    </select>
    
     <!-- Service -->
    <select id="I5511SelectInsrlNo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'I_INSRL', #AREA_CD#) AS LST_FMT_NO FROM CPY_T WHERE NO = 1
    </select>

    <update id="I5511UpdateInsrlNo" parameterClass="ModelsLibrary.Inv.InvVo">
      UPDATE TB_SYS_NO_FMT
        SET LST_FMT_NO = #INSRL_NO#
      WHERE TBL_ID = 'I_INSRL'
        AND CHNL_CD = #CHNL_CD#
        AND AREA_CD = #AREA_CD#
    </update>
    
     <insert id="I5511InsertMst" parameterClass="ModelsLibrary.Inv.InvVo">
       INSERT INTO TB_INAUD_MAST
       ( CHNL_CD  
       , INSRL_NO
       , INAUD_DT
       , RQST_EMPE_ID
       , IO_CD
       , INAUD_RMK
       , CRE_USR_ID
       , CRE_DT
       , UPD_USR_ID
       , UPD_DT
       , AREA_CD
       , CO_CD
       ) VALUES (
         #CHNL_CD#
       , #INSRL_NO#
       , #INAUD_DT#
       , #RQST_EMPE_ID#
       , 'I'
       , #INAUD_RMK#
       , #CRE_USR_ID#
       , GETDATE()
       , #UPD_USR_ID#
       , GETDATE()
       , #AREA_CD#
       , #CO_NO#
       )
     </insert>
    
    <update id="I5511UpdateMst" parameterClass="ModelsLibrary.Inv.InvVo">
      UPDATE TB_INAUD_MAST
       SET INAUD_DT       = #INAUD_DT#
         , RQST_EMPE_ID   = #RQST_EMPE_ID#
         , IO_CD          = #IO_CD#
         , INAUD_RMK      = #INAUD_RMK#
         , UPD_USR_ID     = #UPD_USR_ID#
         , UPD_DT         = GETDATE()
         , AREA_CD        = #AREA_CD#
         , CO_CD          = CO_CD
       WHERE INSRL_NO = #INSRL_NO#
         AND CHNL_CD  = #CHNL_CD#
    </update>

    <delete id="I5511DeleteMst" parameterClass="ModelsLibrary.Inv.InvVo">
        DELETE FROM TB_INAUD_MAST
          WHERE 1 = 1
            AND CHNL_CD = #CHNL_CD#
            AND INSRL_NO = #INSRL_NO#
    </delete>
    
      <!-- I5511-->
     <select id="I5511SelectDtlList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">        
          SELECT #CHNL_CD# AS CHNL_CD
               , T1.INSRL_NO
               , T1.INSRL_SEQ
               , T1.INAUD_CD
               , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-007', T1.INAUD_CD) AS INAUD_NM     
               , T1.LOC_CD
               , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-100', T1.LOC_CD)   AS LOC_NM      
               , T1.CO_NO        
               , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_NO)  AS CO_NM
               , T1.ITM_CD
               , T2.ITM_NM
               , T2.ITM_SZ_NM
               , T1.INAUD_QTY
               , ROUND(T1.INAUD_QTY * T2.UOM_WGT, 0) AS ITM_WGT 
               , T1.ORD_NO
               , T1.ORD_SEQ
               , T1.INAUD_RMK
               , T1.INAUD_PRC
               , T1.INAUD_AMT
               , dbo.FF_INAUD_CLZ_FLG(#CHNL_CD#, T1.ITM_CD, CONVERT(VARCHAR(8), T3.INAUD_DT, 112)) AS CLZ_FLG
               , dbo.FF_ITM_LOC_NM(#CHNL_CD#, T3.AREA_CD , T1.ITM_CD) AS ITM_LOC_NM 
               , ROW_NUMBER() OVER (PARTITION BY T1.INSRL_NO ORDER BY T1.INSRL_SEQ) AS RN
               , dbo.FF_ITM_TP_QTY(#CHNL_CD#, T1.ITM_CD, T1.INAUD_QTY, 'A')  AS MD_QTY
               , CONVERT(VARCHAR(10), T3.INAUD_DT, 120) AS INAUD_DT
               , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM   
            FROM TB_INAUD_DTL       T1
               , TB_CD_ITM     T2 
               , TB_INAUD_MAST      T3
           WHERE 1 = 1
             AND T1.CHNL_CD    = #CHNL_CD#
             AND T1.CHNL_CD    = T2.CHNL_CD
             AND T1.CHNL_CD    = T3.CHNL_CD
             AND T1.INSRL_NO   = T3.INSRL_NO 
             AND T1.ITM_CD     = T2.ITM_CD
             AND T1.INSRL_NO   = #INSRL_NO#
    </select>
    
    <insert id="I5511InsertDtl" parameterClass="ModelsLibrary.Inv.InvVo">
        INSERT INTO TB_INAUD_DTL
        ( 
              CHNL_CD
            , INSRL_NO
            , INSRL_SEQ
            , LOC_CD
            , CO_NO
            , INAUD_CD
            , ITM_CD
            , INAUD_QTY
            , ORD_NO
            , ORD_SEQ
            , INAUD_RMK
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
            , INAUD_PRC
            , INAUD_AMT
        ) VALUES (
              #CHNL_CD#
            , #INSRL_NO#
            , ISNULL((SELECT MAX(INSRL_SEQ) + 1 FROM TB_INAUD_DTL WHERE CHNL_CD = #CHNL_CD# AND INSRL_NO = #INSRL_NO# AND CHNL_CD = #CHNL_CD#), 1)
            , #LOC_CD#       
            , #CO_NO#        
            , #INAUD_CD#
            , #ITM_CD#
            , #INAUD_QTY#
            , #ORD_NO#       
            , #ORD_SEQ#      
            , #INAUD_RMK#
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()
            , #IMP_ITM_PRC#
            , #IMP_ITM_AMT#
        )      
    </insert>

    
    <update id="I5511UpdateDtl" parameterClass="ModelsLibrary.Inv.InvVo">
      UPDATE TB_INAUD_DTL
        SET INAUD_QTY       = #INAUD_QTY#
          , INAUD_PRC       = #INAUD_PRC#
          , INAUD_RMK       = #INAUD_RMK#
          , UPD_USR_ID      = #UPD_USR_ID#    
          , UPD_DT          = GETDATE()
          , INAUD_AMT       = #INAUD_AMT#
      WHERE 1 = 1
        AND CHNL_CD = #CHNL_CD#
        AND INSRL_NO = #INSRL_NO#
        AND INSRL_SEQ = #INSRL_SEQ#
    </update>
    
    <delete id="I5511DeleteDtl" parameterClass="ModelsLibrary.Inv.InvVo">
        DELETE FROM TB_INAUD_DTL
          WHERE 1 = 1
            AND CHNL_CD = #CHNL_CD#
            AND INSRL_NO = #INSRL_NO#
          <isNotNull property="INSRL_SEQ">
            AND INSRL_SEQ    = #INSRL_SEQ#
          </isNotNull>
    </delete>

   
    <!-- 가입고에서 정입고 -->
    <select id="I5511SelectDtlImpInList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT #CHNL_CD#  AS CHNL_CD
           , T1.INAUD_TMP_NO
           , T1.INAUD_TMP_SEQ
           , T1.INAUD_TP_NM
           , T1.CO_NO
           , T1.CO_NM   
           , T1.ITM_CD         
           , T1.ITM_NM         
           , T1.ITM_SZ_NM      
           , T1.LOC_CD  
           , T1.LOC_NM 
           , T1.ITM_QTY      
           , T1.RMN_QTY  AS TMP_RMK_QTY
           , T1.RMN_QTY  
           , T1.ITM_WGT
           , T1.UOM_CD
           , T1.UOM_NM 
           , T1.ITM_RMK 
           , T1.IMP_ITM_PRC
           , T1.IMP_ITM_AMT
           , RMN_QTY  AS IN_QTY
           , T1.IMP_CTRT_NO
           , T1.IMP_BL_NO
           , CASE WHEN T1.IMP_INV_NO  IS NULL THEN dbo.FF_INAUD_TMP_RLSE_NO(#CHNL_CD#, T1.INAUD_TMP_NO, T1.INAUD_TMP_SEQ)
                  ELSE T1.IMP_INV_NO END AS IMP_INV_NO
           , CASE WHEN GBN = 'A' THEN '수입' ELSE '국내' END AS GBN 
           , CONVERT(VARCHAR(10), INAUD_DT, 121)  AS INAUD_DT_NM
           , '자재창고' As INAUD_ORG_NM
           , '002' As INAUD_ORG_NO
        FROM (
            SELECT T1.INAUD_TMP_NO
                 , T1.INAUD_TMP_SEQ
                 , CASE WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2) = 'IV' THEN '수입' 
                        WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2) = 'PO' THEN '국내' END AS INAUD_TP_NM
                 , T1.CO_CD AS CO_NO
                 , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_CD)  AS CO_NM   
                 , T1.ITM_CD         
                 , T2.ITM_NM         
                 , T2.ITM_SZ_NM      
                 , T1.LOC_CD  
                 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'P-008', T1.LOC_CD) AS LOC_NM 
                 , T1.ITM_QTY      
                 , ISNULL(T1.ITM_QTY - dbo.FF_INVT_TMP_RMN_QTY(#CHNL_CD#, T1.INAUD_TMP_NO, T1.INAUD_TMP_SEQ), 0) AS RMN_QTY 
                 , ROUND(T1.ITM_QTY * T2.UOM_WGT, 0) AS ITM_WGT
                 , T1.UOM_CD
                 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T1.UOM_CD)  AS UOM_NM 
                 , T1.ITM_RMK 
                 , T1.ITM_PRC AS IMP_ITM_PRC
                 , T1.ITM_AMT AS IMP_ITM_AMT
                 , ISNULL(T1.ITM_QTY, 0) AS IN_QTY
                 , T1.PUR_ORD_NO
                 , T1.PUR_ORD_SEQ
                 , T3.IMP_CTRT_NO
                 , T3.IMP_BL_NO
                 , T3.IMP_INV_NO
                 , T3.GBN
                 , T1.INAUD_DT
              FROM TB_INAUD_TMP     T1
                   LEFT OUTER JOIN ( 
                          SELECT GBN
                               , IMP_CTRT_NO
                               , IMP_BL_NO
                               , IMP_INV_NO
                               , IMP_INV_SEQ
                            FROM (
                                  SELECT 'A'   AS GBN 
                                       , MAX(T2.IMP_CTRT_NO)  AS IMP_CTRT_NO 
                                       , MAX(T3.IMP_BL_NO)    AS IMP_BL_NO
                                       , T3.IMP_INV_NO
                                       , T1.IMP_INV_SEQ
                                    FROM TB_PUR_IMP_INV_DTL  T1
                                       , TB_PUR_IMP_CTRT     T2
                                       , TB_PUR_IMP_CTRT_DTL T4
                                       , TB_PUR_IMP_INV      T3
                                   WHERE 1 = 1
                                     AND T1.CHNL_CD    = #CHNL_CD#
                                     AND T1.CHNL_CD    = T2.CHNL_CD
                                     AND T1.CHNL_CD    = T3.CHNL_CD
                                     AND T1.CHNL_CD    = T4.CHNL_CD
                                     AND T2.IMP_PUR_NO = T4.IMP_PUR_NO
                                     AND T1.IMP_INV_NO = T3.IMP_INV_NO
                                     AND T1.IMP_PUR_NO = T4.IMP_PUR_NO
                                     AND T1.IMP_PUR_SEQ = T4.IMP_PUR_SEQ
                                     AND T2.IMP_CO_CD  = #CO_NO#
                                     AND T2.IMP_CTRT_DT >= GETDATE() - 365
                                     AND NOT EXISTS ( SELECT 'X'
                                                        FROM TB_PUR_CTRT_CLZ  X
                                                       WHERE 1 = 1
                                                         AND X.CHNL_CD  = #CHNL_CD#
                                                         AND X.ORD_NO   = T4.IMP_PUR_NO 
                                                         AND X.ORD_SEQ  = T4.IMP_PUR_SEQ
                                                     )
                                  GROUP BY  T3.IMP_INV_NO
                                          , T1.IMP_INV_SEQ                                                    
                                  UNION ALL 
                                  SELECT 'B'   AS GBN 
                                       , T1.PUR_ORD_NO
                                       , NULL
                                       , T1.PUR_ORD_NO  
                                       , T2.PUR_ORD_SEQ
                                    FROM TB_PUR_ORD T1
                                       , TB_PUR_ORD_DTL  T2
                                   WHERE 1 = 1
                                     AND T1.CHNL_CD     = #CHNL_CD#
                                     AND T1.CHNL_CD     = T2.CHNL_CD
                                     AND T1.PUR_ORD_NO  = T2.PUR_ORD_NO
                                     AND T1.PUR_CO_CD   = #CO_NO#
                                     AND T1.PUR_DT      >= GETDATE() - 365
                                     AND NOT EXISTS ( SELECT 'X'
                                                        FROM TB_PUR_CTRT_CLZ  X
                                                       WHERE 1 = 1
                                                         AND X.CHNL_CD  = #CHNL_CD#
                                                         AND X.ORD_NO   = T2.PUR_ORD_NO
                                                         AND X.ORD_SEQ  = T2.PUR_ORD_SEQ
                                                     )
                                  GROUP BY T1.PUR_ORD_NO                                                     
                                         , T2.PUR_ORD_SEQ
                                  ) T1
                          GROUP BY GBN
                                 , IMP_CTRT_NO
                                 , IMP_BL_NO  
                                 , IMP_INV_NO
                                 , IMP_INV_SEQ
                   )  T3
                 ON ( T1.PUR_ORD_NO  = T3.IMP_INV_NO
                  AND T1.PUR_ORD_SEQ = T3.IMP_INV_SEQ
                    )                 
                 , TB_CD_ITM     T2
             WHERE 1 = 1
               AND T1.CHNL_CD    = #CHNL_CD#
               AND T1.CHNL_CD    = T2.CHNL_CD
               AND T1.ITM_CD     = T2.ITM_CD
               AND T1.CO_CD      = #CO_NO#
               AND T1.INSP_FLG   = 'Y'
               AND T1.INAUD_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
               AND T1.INAUD_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)                    
              <isNotNull property="INAUD_TP_NM">
                 AND SUBSTRING(T1.PUR_ORD_NO, 1, 2) LIKE #INAUD_TP_NM# + '%'
              </isNotNull>
            ) T1
        WHERE RMN_QTY <![CDATA[<>]]> 0 
      <!--SELECT #CHNL_CD#  AS CHNL_CD
           , T1.INAUD_TMP_NO
           , T1.INAUD_TMP_SEQ
           , T1.INAUD_TP_NM
           , T1.CO_NO
           , T1.CO_NM   
           , T1.ITM_CD         
           , T1.ITM_NM         
           , T1.ITM_SZ_NM      
           , T1.LOC_CD  
           , T1.LOC_NM 
           , T1.ITM_QTY      
           , T1.RMN_QTY  AS TMP_RMK_QTY
           , T1.RMN_QTY  
           , T1.ITM_WGT
           , T1.UOM_CD
           , T1.UOM_NM 
           , T1.ITM_RMK 
           , T1.IMP_ITM_PRC
           , T1.IMP_ITM_AMT
           , RMN_QTY  AS IN_QTY
           , T1.IMP_CTRT_NO
           , T1.IMP_BL_NO
           , CASE WHEN T1.IMP_INV_NO  IS NULL THEN dbo.FF_INAUD_TMP_RLSE_NO(#CHNL_CD#, T1.INAUD_TMP_NO, T1.INAUD_TMP_SEQ)
                  ELSE T1.IMP_INV_NO END AS IMP_INV_NO
           , CASE WHEN GBN = 'A' THEN '수입' ELSE '국내' END AS GBN 
           , CONVERT(VARCHAR(10), INAUD_DT, 121)  AS INAUD_DT_NM
        FROM (
            SELECT T1.INAUD_TMP_NO
                 , T1.INAUD_TMP_SEQ
                 , CASE WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2) = 'IV' THEN '수입' 
                        WHEN SUBSTRING(T1.PUR_ORD_NO, 1, 2) = 'PO' THEN '국내' END AS INAUD_TP_NM
                 , T1.CO_CD AS CO_NO
                 , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_CD)  AS CO_NM   
                 , T1.ITM_CD         
                 , T2.ITM_NM         
                 , T2.ITM_SZ_NM      
                 , T1.LOC_CD  
                 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'P-008', T1.LOC_CD) AS LOC_NM 
                 , T1.ITM_QTY      
                 , ISNULL(T1.ITM_QTY - dbo.FF_INVT_TMP_RMN_QTY(#CHNL_CD#, T1.INAUD_TMP_NO, T1.INAUD_TMP_SEQ), 0) AS RMN_QTY 
                 , ROUND(T1.ITM_QTY * T2.UOM_WGT, 0) AS ITM_WGT
                 , T1.UOM_CD
                 , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T1.UOM_CD)  AS UOM_NM 
                 , T1.ITM_RMK 
                 , T1.ITM_PRC AS IMP_ITM_PRC
                 , T1.ITM_AMT AS IMP_ITM_AMT
                 , ISNULL(T1.ITM_QTY, 0) AS IN_QTY
                 , T1.PUR_ORD_NO
                 , T1.PUR_ORD_SEQ
                 , T3.IMP_CTRT_NO
                 , T3.IMP_BL_NO
                 , T3.IMP_INV_NO
                 , T3.GBN
                 , T1.INAUD_DT
              FROM TB_INAUD_TMP     T1
                   LEFT OUTER JOIN ( 
                          SELECT GBN
                               , IMP_CTRT_NO
                               , IMP_BL_NO
                               , IMP_INV_NO
                               , IMP_INV_SEQ
                            FROM (
                                  SELECT 'A'   AS GBN 
                                       , MAX(T2.IMP_CTRT_NO)  AS IMP_CTRT_NO 
                                       , MAX(T3.IMP_BL_NO)    AS IMP_BL_NO
                                       , T3.IMP_INV_NO
                                       , T1.IMP_INV_SEQ
                                    FROM TB_PUR_IMP_INV_DTL  T1
                                       , TB_PUR_IMP_CTRT     T2
                                       , TB_PUR_IMP_CTRT_DTL T4
                                       , TB_PUR_IMP_INV      T3
                                   WHERE 1 = 1
                                     AND T1.CHNL_CD    = #CHNL_CD#
                                     AND T1.CHNL_CD    = T2.CHNL_CD
                                     AND T1.CHNL_CD    = T3.CHNL_CD
                                     AND T1.CHNL_CD    = T4.CHNL_CD
                                     AND T2.IMP_PUR_NO = T4.IMP_PUR_NO
                                     AND T1.IMP_INV_NO = T3.IMP_INV_NO
                                     AND T1.IMP_PUR_NO = T4.IMP_PUR_NO
                                     AND T1.IMP_PUR_SEQ = T4.IMP_PUR_SEQ
                                     AND T2.IMP_CO_CD  = #CO_NO#
                                     AND T2.IMP_CTRT_DT >= GETDATE() - 365
                                     AND NOT EXISTS ( SELECT 'X'
                                                        FROM TB_PUR_CTRT_CLZ  X
                                                       WHERE 1 = 1
                                                         AND X.CHNL_CD  = #CHNL_CD#
                                                         AND X.ORD_NO   = T4.IMP_PUR_NO 
                                                         AND X.ORD_SEQ  = T4.IMP_PUR_SEQ
                                                     )
                                  GROUP BY  T3.IMP_INV_NO
                                          , T1.IMP_INV_SEQ                                                    
                                  UNION ALL 
                                  SELECT 'B'   AS GBN 
                                       , T1.PUR_ORD_NO
                                       , NULL
                                       , T1.PUR_ORD_NO  
                                       , T2.PUR_ORD_SEQ
                                    FROM TB_PUR_ORD T1
                                       , TB_PUR_ORD_DTL  T2
                                   WHERE 1 = 1
                                     AND T1.CHNL_CD     = #CHNL_CD#
                                     AND T1.CHNL_CD     = T2.CHNL_CD
                                     AND T1.PUR_ORD_NO  = T2.PUR_ORD_NO
                                     AND T1.PUR_CO_CD   = #CO_NO#
                                     AND T1.PUR_DT      >= GETDATE() - 365
                                     AND NOT EXISTS ( SELECT 'X'
                                                        FROM TB_PUR_CTRT_CLZ  X
                                                       WHERE 1 = 1
                                                         AND X.CHNL_CD  = #CHNL_CD#
                                                         AND X.ORD_NO   = T2.PUR_ORD_NO
                                                         AND X.ORD_SEQ  = T2.PUR_ORD_SEQ
                                                     )
                                  GROUP BY T1.PUR_ORD_NO                                                     
                                         , T2.PUR_ORD_SEQ
                                  ) T1
                          GROUP BY GBN
                                 , IMP_CTRT_NO
                                 , IMP_BL_NO  
                                 , IMP_INV_NO
                                 , IMP_INV_SEQ
                   )  T3
                 ON ( T1.PUR_ORD_NO  = T3.IMP_INV_NO
                  AND T1.PUR_ORD_SEQ = T3.IMP_INV_SEQ
                    )                 
                 , TB_CD_ITM     T2
             WHERE 1 = 1
               AND T1.CHNL_CD    = #CHNL_CD#
               AND T1.CHNL_CD    = T2.CHNL_CD
               AND T1.ITM_CD     = T2.ITM_CD
               AND T1.CO_CD      = #CO_NO#
               AND T1.INAUD_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
               AND T1.INAUD_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)                    
              <isNotNull property="INAUD_TP_NM">
                 AND SUBSTRING(T1.PUR_ORD_NO, 1, 2) LIKE #INAUD_TP_NM# + '%'
              </isNotNull>
            ) T1
        WHERE RMN_QTY <![CDATA[<>]]> 0--> 
   </select>
    
 <!--기타 입고-->
    <!--
    <select id="I5511SelectDtlEtcInList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT #CHNL_CD# AS CHNL_CD
           , T1.ITM_CD
           , T1.ITM_NM
           , T1.ITM_SZ_NM
           , T1.UOM_CD
           , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T1.UOM_CD) AS UOM_NM 
           , CASE WHEN #AREA_CD# = '100' THEN '100' 
                  WHEN #AREA_CD# = '200' THEN '200' 
                  WHEN #AREA_CD# = '300' THEN '300' END  AS INAUD_ORG_NO
           , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-100', 
             CASE WHEN #AREA_CD# = '100' THEN '100' 
                  WHEN #AREA_CD# = '200' THEN '200' 
                  WHEN #AREA_CD# = '300' THEN '300' END
             ) AS INAUD_ORG_NM 
           , 'RGM'  AS INAUD_CD 
           , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.ITM_CD) AS RN 
        FROM TB_CD_ITM T1
       WHERE 1 = 1
         AND T1.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
         AND T1.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
        <isNotNull property="N2ND_ITM_GRP_CD">
         AND T1.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
        </isNotNull>
    </select>
    -->
    <!--기타 입고-->
    <select id="I5511SelectDtlEtcInList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT 
	        #CHNL_CD# AS CHNL_CD
          , T1.ITM_CD
          , T1.ITM_NM
          , T1.ITM_SZ_NM
          , T1.UOM_CD
          , T2.UOM_NM
          , T1.PROD_LOC_CD  AS INAUD_ORG_NO  
          , T3.INAUD_ORG_NM 
          , 'RGM'  AS INAUD_CD 
          , T4.INAUD_NM 
          , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.ITM_CD) AS RN
          , dbo.FF_CO_UR_PRC(T1.CHNL_CD , #CO_CD#, T1.ITM_CD, GETDATE())  AS  IMP_ITM_PRC 
          , #CO_CD#   AS CO_CD  
          , #CO_NM#   AS CO_NM
      FROM TB_CD_ITM T1
           OUTER APPLY(
              SELECT CLSS_DESC AS UOM_NM
                FROM TB_SYS_CLSS_CD
               WHERE 1 = 1
                 AND CLSS_CD    = T1.UOM_CD
                 AND CHNL_CD    = #CHNL_CD#
                 AND CLSS_TP_CD = 'L-003'
                 AND DELT_FLG   = 'N'
           ) T2                   
           OUTER APPLY(
              SELECT CLSS_DESC AS INAUD_ORG_NM
                FROM TB_SYS_CLSS_CD
               WHERE 1 = 1
                 AND CLSS_CD    = T1.PROD_LOC_CD
                 AND CHNL_CD    = #CHNL_CD#
                 AND CLSS_TP_CD = 'L-100'
                 AND DELT_FLG   = 'N'
           ) T3                  
           OUTER APPLY(
              SELECT CLSS_DESC AS INAUD_NM
                FROM TB_SYS_CLSS_CD
               WHERE 1 = 1
                 AND CLSS_CD    = 'RGM'
                 AND CHNL_CD    = #CHNL_CD#
                 AND CLSS_TP_CD = 'L-007'
                 AND DELT_FLG   = 'N'
           ) T4
        WHERE 1 = 1
          AND T1.CHNL_CD         = #CHNL_CD# 
          AND T1.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
        <isNotNull property="N1ST_ITM_GRP_CD">
          AND T1.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
        </isNotNull>
        <isNotNull property="N2ND_ITM_GRP_CD">
          AND T1.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
        </isNotNull>
    </select>
    
    <!--외주 입고-->
    <select id="I5511SelectDtlOutInList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
       SELECT T1.INAUD_CD
           , T1.INAUD_NM 
           , T1.INSRL_NO
           , T1.INSRL_SEQ
           , T1.CO_NO
           , T1.CO_NM 
           , T1.ITM_CD
           , T1.ITM_NM AS GBN
           , T1.ITM_SZ_NM
           , T1.UOM_CD
           , T1.UOM_NM 
           , T1.INAUD_QTY       
           , T1.IN_QTY   
           , T1.RMN_QTY 
           , T1.RMN_QTY AS TMP_RMN_QTY
           , T1.INAUD_RMK
           , T1.INAUD_PRC
           , T1.INAUD_AMT
           , #AREA_CD# AS INAUD_ORG_NO
           , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-100', #AREA_CD#) AS INAUD_ORG_NM 
           , N1ST_ITM_GRP_NM
		       , T1.INAUD_DT
		       , dbo.CD_ITEM_NM_FNC(#CHNL_CD#, SUBSTRING(T1.ITM_CD,5,LEN(T1.ITM_CD))) AS ITM_NM
		       , T1.ALTR_ITM_CD
		       , dbo.CD_ITEM_NM_FNC(#CHNL_CD#, T1.ALTR_ITM_CD) AS ALTR_ITM_NM
        FROM (
              SELECT T1.INAUD_CD
                   , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-007', T1.INAUD_CD)  AS INAUD_NM 
                   , T1.INSRL_NO
                   , T1.INSRL_SEQ
                   , T3.CO_CD  AS CO_NO
                   , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T3.CO_CD) AS CO_NM  
                   , T1.ALTR_ITM_CD AS  ITM_CD
                   , T2.ITM_NM
                   , T2.ITM_SZ_NM
                   , T2.UOM_CD
                   , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T2.UOM_CD) AS UOM_NM 
                   , T1.INAUD_QTY       
                   , 0 AS IN_QTY                  
                   , T1.INAUD_RMK
                   , T1.INAUD_PRC
                   , T1.INAUD_AMT
                   , T1.INAUD_QTY - ISNULL(dbo.FF_INVT_TMP_RMN_QTY(#CHNL_CD#, T1.INSRL_NO, T1.INSRL_SEQ), 0)  AS RMN_QTY
                   , dbo.PUR_N1ST_GRP_NM_FNC(#CHNL_CD#, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM 
				           , CONVERT(VARCHAR, T3.INAUD_DT, 23) AS INAUD_DT
				           , T1.ALTR_ITM_CD
                FROM TB_INAUD_DTL  T1
                   , TB_CD_ITM     T2  
                   , TB_INAUD_MAST T3
               WHERE 1 = 1
                 AND T1.CHNL_CD   = #CHNL_CD# 
                 AND T1.CHNL_CD   = T2.CHNL_CD
                 AND T1.CHNL_CD   = T3.CHNL_CD
                 AND T1.INSRL_NO  = T3.INSRL_NO
                 AND T1.INAUD_CD  = 'IGH'
                 AND T1.ALTR_ITM_CD     = T2.ITM_CD
                 AND T3.INAUD_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
                 AND T3.INAUD_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME) 
                 AND ISNULL(T1.CLZ_FLG, 'N')  = 'N'
              ) T1
          WHERE RMN_QTY > 0   
    </select>
    
    
  <!--품목 출고-->
  <select id="I5512SelectMstList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT DATENAME(YEAR, INAUD_DT) + '년 ' + DATENAME(MM, INAUD_DT) + '월' AS YRMON
          , INSRL_NO + ' / ' + DATENAME(DD, INAUD_DT) + ' 일' AS INSRL_NM
          , INSRL_NO
          , CONVERT(VARCHAR(10), INAUD_DT, 120) AS INAUD_DT
          , RQST_EMPE_ID
          , dbo.USR_NM_FNC(T1.CHNL_CD, RQST_EMPE_ID) AS RQST_EMPE_NM
          , IO_CD
          , INAUD_RMK
          , CONVERT(VARCHAR, CRE_DT, 121) AS CRE_DT
          , (SELECT CONVERT(VARCHAR, MAX(UPD_DT), 121) AS UPD_DT  FROM TB_INAUD_DTL X WHERE 1 = 1 AND CHNL_CD = T1.CHNL_CD AND X.INSRL_NO = T1.INSRL_NO ) AS UPD_DT
          , AREA_CD
          , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-002', T1.AREA_CD) AS AREA_NM
          , CO_CD
          , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, CO_CD)  AS CO_NM
          , dbo.FF_INAUD_MAST_CLZ_FLG(T1.CHNL_CD, T1.INSRL_NO)  AS CLZ_FLG
          , T1.CHNL_CD AS CHNL_CD
      FROM TB_INAUD_MAST T1
        WHERE 1=1
          AND T1.CHNL_CD  = #CHNL_CD#
          AND INAUD_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
          AND INAUD_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
          AND IO_CD = 'O'
          <isNotNull property="AREA_CD">
            AND AREA_CD = #AREA_CD#
          </isNotNull>
          <isNotNull property="CO_CD">
            AND CO_CD = #CO_CD#
          </isNotNull>
          <isNotNull property="CO_TP_CD">
            AND CO_CD IN 
            (
              SELECT CO_NO
                FROM TB_CD_CO_TP
                  WHERE 1 = 1
                    AND CHNL_CD = #CHNL_CD#
                    AND CO_TP_CD LIKE #CO_TP_CD#
            )
          </isNotNull>
          <isNotNull property="GRP_ID">
            AND RQST_EMPE_ID IN 
            (
                SELECT T1.USR_ID
                  FROM TB_SYS_USR T1
                     , TB_SYS_GRP T2
                WHERE 1 = 1
                    AND T1.CHNL_CD = #CHNL_CD#
                    AND T1.CHNL_CD = T2.CHNL_CD
                    AND T1.GRP_ID = T2.GRP_ID
                    AND T1.GRP_ID LIKE '%'
                UNION ALL
                SELECT T1.USR_ID
                  FROM TB_SYS_USR T1
                     , TB_SYS_GRP T2
                WHERE 1 = 1
                    AND T1.CHNL_CD = #CHNL_CD#
                    AND T1.CHNL_CD = T2.CHNL_CD
                    AND T1.GRP_ID = T2.GRP_ID
                    AND T1.GRP_ID = #GRP_ID#
            )
      </isNotNull>
    </select>

    <!-- Service -->
    <select id="I5512SelectInsrlNo" resultClass="string">
      SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'O_INSRL', #AREA_CD#) AS LST_FMT_NO FROM CPY_T WHERE NO = 1
    </select>

    <update id="I5512UpdateInsrlNo" parameterClass="ModelsLibrary.Inv.InvVo">
      UPDATE TB_SYS_NO_FMT
      SET LST_FMT_NO = #INSRL_NO#
      WHERE 1 = 1
      AND CHNL_CD = #CHNL_CD#
      AND TBL_ID = 'O_INSRL'
      AND AREA_CD = #AREA_CD#
    </update>

    <insert id="I5512InsertMst" parameterClass="ModelsLibrary.Inv.InvVo">
      INSERT INTO TB_INAUD_MAST
      ( CHNL_CD
      , INSRL_NO
      , INAUD_DT
      , RQST_EMPE_ID
      , IO_CD
      , INAUD_RMK
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
      , AREA_CD
      , CO_CD
      ) VALUES (
      #CHNL_CD#
      , #INSRL_NO#
      , #INAUD_DT#
      , #RQST_EMPE_ID#
      , 'O'
      , #INAUD_RMK#
      , #CRE_USR_ID#
      , GETDATE()
      , #UPD_USR_ID#
      , GETDATE()
      , #AREA_CD#
      , #CO_NO#
      )
    </insert>

    <update id="I5512UpdateMst" parameterClass="ModelsLibrary.Inv.InvVo">
      UPDATE TB_INAUD_MAST
      SET INAUD_DT       = #INAUD_DT#
      , RQST_EMPE_ID   = #RQST_EMPE_ID#
      , IO_CD          = #IO_CD#
      , INAUD_RMK      = #INAUD_RMK#
      , UPD_USR_ID     = #UPD_USR_ID#
      , UPD_DT         = GETDATE()
      , AREA_CD        = #AREA_CD#
      WHERE 1 = 1
      AND CHNL_CD  = #CHNL_CD#
      AND INSRL_NO = #INSRL_NO#
    </update>

    <delete id="I5512DeleteMst" parameterClass="ModelsLibrary.Inv.InvVo">
      DELETE FROM TB_INAUD_MAST
      WHERE 1 = 1
      AND CHNL_CD  = #CHNL_CD#
      AND INSRL_NO = #INSRL_NO#
    </delete>

    <!-- I5512-->
    <select id="I5512SelectDtlList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT #CHNL_CD#  AS CHNL_CD
        , T1.INSRL_NO
        , T1.INSRL_SEQ
        , T1.INAUD_CD
        , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-007', T1.INAUD_CD) AS INAUD_NM
        , T1.LOC_CD
        , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-100', T1.LOC_CD)   AS LOC_NM
        , T1.CO_NO
        , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.CO_NO)  AS CO_NM
        , T1.ITM_CD
        , T2.ITM_NM
        , T2.ITM_SZ_NM
        , T1.INAUD_QTY
        , ROUND(T1.INAUD_QTY * T2.UOM_WGT, 0) AS ITM_WGT
        , T1.ORD_NO
        , T1.ORD_SEQ
        , T1.INAUD_RMK
        , T1.INAUD_PRC
        , T1.INAUD_AMT
        , T1.ROUT_CD
        , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-500', T1.ROUT_CD)   AS ROUT_NM
        , T1.ALTR_ITM_CD
        , dbo.CD_ITEM_NM_FNC(#CHNL_CD#, T1.ALTR_ITM_CD) AS ALTR_ITM_NM
        , (SELECT TOP 1 X.ITM_SZ_NM FROM TB_CD_ITM AS X WHERE 1=1 AND CHNL_CD = #CHNL_CD# AND X.ITM_CD = T1.ALTR_ITM_CD) AS ALTR_ITM_SZ_NM
        , dbo.FF_INAUD_CLZ_FLG(#CHNL_CD#, T1.ITM_CD, CONVERT(VARCHAR(8), T3.INAUD_DT, 112)) AS CLZ_FLG
        , dbo.FF_ITM_MAIN_LOC_NM(#CHNL_CD#, T1.LOC_CD, T1.ITM_CD) AS ITM_LOC_NM
        , T2.N1ST_ITM_GRP_CD
        , dbo.PUR_N1ST_GRP_NM_FNC(T2.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
		    , T1.LOT_NO
		    , T1.INSP_NO
      FROM TB_INAUD_DTL T1
        , TB_CD_ITM    T2
        , TB_INAUD_MAST T3
      WHERE 1 = 1
        AND T1.CHNL_CD    = #CHNL_CD#
        AND T1.CHNL_CD    = T2.CHNL_CD
        AND T1.CHNL_CD    = T3.CHNL_CD
        AND T1.INSRL_NO   = T3.INSRL_NO
        AND T1.ITM_CD     = T2.ITM_CD
        AND T1.INSRL_NO   = #INSRL_NO#
    </select>

      <!-- 외주 출고 -->
    <select id="I5512SelectDtlOutOutList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT T1.CHNL_CD  AS CHNL_CD
          , T1.ITM_CD
          , T1.ITM_NM    AS GBN
          , T1.ITM_SZ_NM
          , T1.UOM_CD
          , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T1.UOM_CD) AS UOM_NM
          , T1.PROD_LOC_CD  AS INAUD_ORG_NO
          , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-100', PROD_LOC_CD) AS INAUD_ORG_NM
          , dbo.FF_CO_UR_PRC(T1.CHNL_CD, #CO_CD#, T1.ITM_CD, GETDATE())  AS  IMP_ITM_PRC
          , #CO_CD#   AS CO_CD
          , #CO_NM#   AS CO_NM
          , 'IGH'  AS INAUD_CD   
          , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-007', 'IGH') AS INAUD_NM
          , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T1.ITM_GRP_CLSS_CD, T1.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
          , '70'    AS ROUT_CD
          , '임가공' AS ROUT_NM
		      , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, SUBSTRING(T1.ITM_CD,5,LEN(T1.ITM_CD))) AS ITM_NM
		      , '' AS ALTR_ITM_CD
		      , '' AS ALTR_ITM_NM
          , T1.N1ST_ITM_GRP_CD
      FROM TB_CD_ITM T1
        WHERE 1 = 1
          AND T1.CHNL_CD            = #CHNL_CD#
          AND T1.ITM_GRP_CLSS_CD    = #ITM_GRP_CLSS_CD#
          AND T1.ITM_CD NOT LIKE 'C-%'
          <isNotNull property="N1ST_ITM_GRP_CD">
            AND T1.N1ST_ITM_GRP_CD    = #N1ST_ITM_GRP_CD#
          </isNotNull>
          <isNotNull property="N2ND_ITM_GRP_CD">
            AND T1.N2ND_ITM_GRP_CD  = #N2ND_ITM_GRP_CD#
          </isNotNull>
    </select>
	  
    <!-- 기타 출고 -->
    <select id="I5512SelectDtlEtcOutList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
      SELECT     
          #CHNL_CD#  AS CHNL_CD
         , T1.ITM_CD
         , T1.ITM_NM
         , T1.ITM_SZ_NM
         , T1.UOM_CD
         , T2.UOM_NM
         , T1.PROD_LOC_CD  AS INAUD_ORG_NO
         , T3.INAUD_ORG_NM
         , dbo.FF_CO_UR_PRC(#CHNL_CD#, #CO_CD#, T1.ITM_CD, GETDATE())  AS  IMP_ITM_PRC
         , #CO_CD#   AS CO_CD
         , #CO_NM# AS CO_NM
         , 'IGM'  AS INAUD_CD   
         , T4.INAUD_NM
         , '' AS ALTR_ITM_CD
         , '' AS ALTR_ITM_NM
      FROM TB_CD_ITM T1      
           OUTER APPLY(
              SELECT CLSS_DESC AS UOM_NM
                FROM TB_SYS_CLSS_CD
               WHERE 1 = 1
                 AND CLSS_CD    = T1.UOM_CD
                 AND CHNL_CD    = #CHNL_CD#
                 AND CLSS_TP_CD = 'L-003'
                 AND DELT_FLG   = 'N'
           ) T2                   
           OUTER APPLY(
              SELECT CLSS_DESC AS INAUD_ORG_NM
                FROM TB_SYS_CLSS_CD
               WHERE 1 = 1
                 AND CLSS_CD    = T1.PROD_LOC_CD
                 AND CHNL_CD    = #CHNL_CD#
                 AND CLSS_TP_CD = 'L-100'
                 AND DELT_FLG   = 'N'
           ) T3                  
           OUTER APPLY(
              SELECT CLSS_DESC AS INAUD_NM
                FROM TB_SYS_CLSS_CD
               WHERE 1 = 1
                 AND CLSS_CD    = 'IGM'
                 AND CHNL_CD    = #CHNL_CD#
                 AND CLSS_TP_CD = 'L-007'
                 AND DELT_FLG   = 'N'
           ) T4
     WHERE 1 = 1
        AND T1.CHNL_CD            = #CHNL_CD#
        AND T1.ITM_GRP_CLSS_CD    = #ITM_GRP_CLSS_CD#
        <isNotNull property="N1ST_ITM_GRP_CD">
          AND T1.N1ST_ITM_GRP_CD  = #N1ST_ITM_GRP_CD#
        </isNotNull>
        <isNotNull property="N2ND_ITM_GRP_CD">
          AND T1.N2ND_ITM_GRP_CD  = #N2ND_ITM_GRP_CD#
        </isNotNull>
    </select>

	  <!-- 샘플 출고 -->
	  <select id="I5512SelectDtlSampleOutList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
		  SELECT    
		        #CHNL_CD# AS CHNL_CD
		      , T1.ITM_CD
		      , T1.ITM_NM
		      , T1.ITM_SZ_NM
		      , T1.UOM_CD
		      , T1.UOM_NM AS UOM_NM
		      , T1.PROD_LOC_CD  AS INAUD_ORG_NO
		      , T3.CLSS_DESC AS INAUD_ORG_NM
		      , '0' AS ITM_PRC 
		      , #CO_CD#     AS CO_CD
		      , #CO_NM#     AS CO_NM
		      , 'IGP'  AS INAUD_CD
		      ,  T2.CLSS_DESC  AS INAUD_NM 
		      <!--, #INSP_NO# AS INSP_NO
		      , #LOT_NO#  AS LOT_NO-->
		  FROM MV_TB_CD_ITM T1
		  OUTER APPLY (SELECT X1.CHNL_CD
		                  , X1.CLSS_TP_CD
		                  , X1.CLSS_CD
		                  , X1.CLSS_DESC
		                FROM dbo.TB_SYS_CLSS_CD X1
		                    WHERE 1 = 1
		                      AND X1.CHNL_CD    = T1.CHNL_CD
		                      AND X1.USE_ST_DT  <![CDATA[<=]]>  GETDATE()
		                      AND X1.USE_END_DT >= GETDATE()
		                      AND X1.CLSS_TP_CD = 'L-007'
		                      AND X1.CLSS_CD = 'IGP'
		  ) T2
		  OUTER APPLY (SELECT X1.CHNL_CD
		                  , X1.CLSS_TP_CD
		                  , X1.CLSS_CD
		                  , X1.CLSS_DESC
		                  FROM dbo.TB_SYS_CLSS_CD X1
		                    WHERE 1 = 1
		                      AND X1.CHNL_CD    = T1.CHNL_CD
		                      AND X1.USE_ST_DT  <![CDATA[<=]]>  GETDATE()
		                      AND X1.USE_END_DT >= GETDATE()
		                      AND X1.CLSS_TP_CD = 'L-100'
		                      AND X1.CLSS_CD    = T1.PROD_LOC_CD
		  ) T3
		  WHERE 1 = 1
		    AND T1.CHNL_CD            = #CHNL_CD#
		    AND T1.ITM_GRP_CLSS_CD    = #ITM_GRP_CLSS_CD#
		  <isNotNull property="N1ST_ITM_GRP_CD">
			  AND T1.N1ST_ITM_GRP_CD  = #N1ST_ITM_GRP_CD#
		  </isNotNull>
		  <isNotNull property="N2ND_ITM_GRP_CD">
			  AND T1.N2ND_ITM_GRP_CD  = #N2ND_ITM_GRP_CD#
		  </isNotNull>
	  </select>
    

    <insert id="I5512InsertDtl" parameterClass="ModelsLibrary.Inv.InvVo">
      INSERT INTO TB_INAUD_DTL
      (
            CHNL_CD
          , INSRL_NO
          , INSRL_SEQ
          , LOC_CD
          , CO_NO
          , INAUD_CD
          , ITM_CD
          , INAUD_QTY
          , ORD_NO
          , ORD_SEQ
          , INAUD_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , INAUD_PRC
          , INAUD_AMT
          , ROUT_CD
          , ALTR_ITM_CD
		  , LOT_NO
		  , INSP_NO
      ) VALUES (
            #CHNL_CD#
          , #INSRL_NO#
          , ISNULL((SELECT MAX(INSRL_SEQ) + 1 FROM TB_INAUD_DTL WHERE 1 = 1 AND CHNL_CD = #CHNL_CD# AND  INSRL_NO = #INSRL_NO# AND CHNL_CD = #CHNL_CD#), 1)
          , #LOC_CD#
          , #CO_NO#
          , #INAUD_CD#
          , #ITM_CD#
          , #INAUD_QTY#
          , #ORD_NO#
          , #ORD_SEQ#
          , #INAUD_RMK#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          , #IMP_ITM_PRC#
          , #IMP_ITM_AMT#
          , #ROUT_CD#
          , #ALTR_ITM_CD#
		      , #LOT_NO#
		      , #INSP_NO#
      )
    </insert>


    <update id="I5512UpdateDtl" parameterClass="ModelsLibrary.Inv.InvVo">
      UPDATE TB_INAUD_DTL
        SET INAUD_CD        = #INAUD_CD#
        , ITM_CD          = #ITM_CD#
        , INAUD_QTY       = #INAUD_QTY#
        , CO_NO           = #CO_NO#
        , INAUD_RMK       = #INAUD_RMK#
        , ORD_NO          = #ORD_NO#
        , ORD_SEQ         = #ORD_SEQ#
        , UPD_USR_ID      = #UPD_USR_ID#
        , UPD_DT          = GETDATE()
        , ALTR_ITM_CD     = #ALTR_ITM_CD#
        <isNotNull property="INAUD_AMT">
          , INAUD_AMT       = ROUND(#INAUD_QTY# * INAUD_PRC, 0)
        </isNotNull>
      WHERE 1 = 1
        AND CHNL_CD    = #CHNL_CD#
        AND INSRL_NO = #INSRL_NO#
        AND INSRL_SEQ = #INSRL_SEQ#
    </update>

    <delete id="I5512DeleteDtl" parameterClass="ModelsLibrary.Inv.InvVo">
      DELETE FROM TB_INAUD_DTL
        WHERE 1 = 1
          AND CHNL_CD    = #CHNL_CD#
          AND INSRL_NO  = #INSRL_NO#
        <isNotNull property="INSRL_SEQ">
          AND INSRL_SEQ    = #INSRL_SEQ#
        </isNotNull>
    </delete>

    
    <!-- I5521 자재수불명세서-->
    <select id="I5521SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
     SELECT  ITM_GRP_CLSS_NM 
            , N1ST_ITM_GRP_NM
            , N2ND_ITM_GRP_NM
            , ITM_CD
            , ITM_NM
            , ITM_SZ_NM
            , PRV_MON_QTY
            , IN_QTY
            , OUT_QTY
            , PRV_MON_QTY + IN_QTY - OUT_QTY AS STK_QTY
            , LOC_NM      
            , #CHNL_CD#  AS CHNL_CD
	          , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY ITM_CD) AS RN 
        FROM (
                        SELECT T2.ITM_GRP_CLSS_CD 
                             , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-001', T2.ITM_GRP_CLSS_CD)  AS ITM_GRP_CLSS_NM
                             , T2.N1ST_ITM_GRP_CD
                             , dbo.PUR_N1ST_GRP_NM_FNC(#CHNL_CD#,  T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
                             , T2.N2ND_ITM_GRP_CD
                             , dbo.PUR_N2ST_GRP_NM_FNC(#CHNL_CD#,  T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD, T2.N2ND_ITM_GRP_CD) AS N2ND_ITM_GRP_NM
                             , T1.ITM_CD
                             , T2.ITM_NM
                             , T2.ITM_SZ_NM 
                             , dbo.FF_ITM_LOC_NM(#CHNL_CD#, '001', T1.ITM_CD) AS LOC_NM 
                             , ISNULL(MAX(CASE WHEN GBN = 'A' THEN T1.INAUD_QTY END), 0) AS PRV_MON_QTY
                             , ISNULL(MAX(CASE WHEN GBN = 'B' THEN T1.INAUD_QTY END), 0) AS IN_QTY
                             , ISNULL(MAX(CASE WHEN GBN = 'C' THEN T1.INAUD_QTY END), 0) AS OUT_QTY                               
                          FROM (
                              SELECT 'A'  AS GBN 
                                     , T1.ITM_CD 
                                     , CASE WHEN SUBSTRING(#YRMON#, 5, 2) = '01' THen M12_RMN_QTY 
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '02' THen M1_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '03' THen M2_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '04' THen M3_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '05' THen M4_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '06' THen M5_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '07' THen M6_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '08' THen M7_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '09' THen M8_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '10' THen M9_RMN_QTY
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '11' THen M10_RMN_QTY            
                                            WHEN SUBSTRING(#YRMON#, 5, 2) = '12' THen M11_RMN_QTY                        
                                         END AS INAUD_QTY    
                                FROM  TB_INEOMLOC   T1
                                    , TB_CD_ITM     T2
                               WHERE 1 = 1
                                 AND T1.CHNL_CD     = #CHNL_CD#
                                 AND T1.CHNL_CD     = T2.CHNL_CD
                                 AND T1.END_YR = (CASE WHEN SUBSTRING(#YRMON#, 5, 2) = '01' THEN SUBSTRING(#YRMON#, 1, 4) - 1 ELSE SUBSTRING(#YRMON#, 1, 4) END) 
                                 AND T1.LOC_NO = #AREA_CD#
                                 AND T1.ITM_CD = T2.ITM_CD
                                <isNotNull property="ITM_GRP_CLSS_CD">
                                    AND T2.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
                                  </isNotNull>
                                <isNotNull property="N1ST_ITM_GRP_CD">
                                 AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
                                </isNotNull>
                                <isNotNull property="N2ND_ITM_GRP_CD">
                                 AND T2.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD# 
                                </isNotNull>
                            UNION ALL         
                               SELECT 'B'  
                                    , T2.ITM_CD
                                    , SUM(T2.INAUD_QTY) AS INAUD_QTY
                                 FROM TB_INAUD_MAST T1
                                    , TB_INAUD_DTL  T2
                                    , TB_CD_ITM     T3                              
                                WHERE 1 = 1
                                  AND T1.CHNL_CD     = #CHNL_CD#
                                  AND T1.CHNL_CD     = T2.CHNL_CD
                                  AND T1.CHNL_CD     = T3.CHNL_CD
                                  AND T1.AREA_CD  = #AREA_CD#
                                  AND T1.INSRL_NO = T2.INSRL_NO
                                  AND T2.ITM_CD = T3.ITM_CD
                                 <isNotNull property="ITM_GRP_CLSS_CD">
                                    AND T3.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
                                  </isNotNull>
                                <isNotNull property="N1ST_ITM_GRP_CD">
                                  AND T3.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
                                </isNotNull>
                                <isNotNull property="N2ND_ITM_GRP_CD">
                                  AND T3.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#                          
                                </isNotNull>
                                  AND T2.INAUD_CD LIKE 'R' + '%'
                                  AND T1.INAUD_DT >= CAST(#YRMON# + '01'+ ' 00:00:00' AS DATETIME) 
                                  AND T1.INAUD_DT <![CDATA[<=]]> DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,CAST(#YRMON# + '01' AS DATETIME))+1,0))
                                GROUP BY T2.ITM_CD    
                               UNION ALL
                               SELECT 'C'  
                                    , T2.ITM_CD
                                    , SUM(T2.INAUD_QTY) AS INAUD_QTY
                                 FROM TB_INAUD_MAST T1
                                    , TB_INAUD_DTL  T2
                                    , TB_CD_ITM     T3                               
                                WHERE 1 = 1
                                  AND T1.CHNL_CD     = #CHNL_CD#
                                  AND T1.CHNL_CD     = T2.CHNL_CD
                                  AND T1.CHNL_CD     = T3.CHNL_CD
                                  AND T1.INSRL_NO = T2.INSRL_NO
                                  AND T2.INAUD_CD LIKE 'I' + '%'
                                  AND T2.ITM_CD = T3.ITM_CD
                                  <isNotNull property="ITM_GRP_CLSS_CD">
                                    AND T3.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
                                  </isNotNull>
                                <isNotNull property="N1ST_ITM_GRP_CD">
                                  AND T3.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
                                </isNotNull>
                                <isNotNull property="N2ND_ITM_GRP_CD">
                                  AND T3.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#                              
                                </isNotNull>
                                  AND T1.INAUD_DT >= CAST(#YRMON# + '01' + ' 00:00:00' AS DATETIME) 
                                  AND T1.INAUD_DT <![CDATA[<=]]> DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,CAST(#YRMON# + '01' AS DATETIME))+1,0))
                              GROUP BY T2.ITM_CD    
                          ) T1, TB_CD_ITM T2 
                      WHERE 1 = 1
                        AND T2.CHNL_CD     = #CHNL_CD#
                        AND T1.ITM_CD = T2.ITM_CD 
          GROUP BY T1.ITM_CD
                 , T2.ITM_NM
                 , T2.ITM_SZ_NM                   
                 , T2.ITM_GRP_CLSS_CD 
                 , T2.N1ST_ITM_GRP_CD
                 , T2.N2ND_ITM_GRP_CD           
      ) T1    
    </select>
    
    <!-- 연말 재고조사용 출력물 -->
    <select id="I5521SelectReportList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
              SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.ITM_CD) AS RN 
                   , T1.ITM_CD
                   , T1.ITM_NM 
                   , T1.ITM_SZ_NM 
                   , T2.ITM_QTY
                   , T1.MD_PER_QTY
                   , T1.PK_PER_QTY
                   , dbo.FF_ITM_TP_QTY(#CHNL_CD#, T1.ITM_CD, T2.ITM_QTY, 'A') AS ITM_MD_QTY 
                   , dbo.FF_ITM_LOC_NM(#CHNL_CD#, #AREA_CD#, T1.ITM_CD)  AS ITM_LOC_NM
                   , #CHNL_CD#  AS CHNL_CD
                FROM TB_CD_ITM       T1
                  ,  TB_INVT_DLY_STK    T2
               WHERE 1 = 1
                 AND T1.CHNL_CD   = #CHNL_CD#
                 AND T1.CHNL_CD   = T2.CHNL_CD
                 AND T1.ITM_CD    = T2.ITM_CD
                 AND T2.AREA_CD   = #AREA_CD#
                 <isNotNull property="ITM_GRP_CLSS_CD">
                 AND T1.ITM_GRP_CLSS_CD   = #ITM_GRP_CLSS_CD#
                 </isNotNull>
                 <isNotNull property="N1ST_ITM_GRP_CD">
                 AND T1.N1ST_ITM_GRP_CD   = #N1ST_ITM_GRP_CD#
                 </isNotNull>
                 <isNotNull property="N2ND_ITM_GRP_CD">
                 AND T1.N2ND_ITM_GRP_CD   = #N2ND_ITM_GRP_CD#                              
                 </isNotNull>
    </select>    
    

    <!-- I5522 자재수불장-->
    <select id="I5522SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY ITM_CD ORDER BY INAUD_DT ) AS RN
        , ITM_GRP_CLSS_NM
        , N1ST_ITM_GRP_NM
        , N2ND_ITM_GRP_NM
        , ITM_CD
        , ITM_NM
        , ITM_SZ_NM
        , INAUD_DT
        , INAUD_NM
        , PRV_MON_QTY
        , IN_QTY
        , OUT_QTY
        , STK_QTY
        , #CHNL_CD#  AS CHNL_CD
      FROM (
        SELECT T2.ITM_GRP_CLSS_CD
        , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-001', T2.ITM_GRP_CLSS_CD)  AS ITM_GRP_CLSS_NM
        , T2.N1ST_ITM_GRP_CD
        , dbo.PUR_N1ST_GRP_NM_FNC(#CHNL_CD#,  T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
        , T2.N2ND_ITM_GRP_CD
        , dbo.PUR_N2ST_GRP_NM_FNC(#CHNL_CD#,  T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD, T2.N2ND_ITM_GRP_CD) AS N2ND_ITM_GRP_NM
        , T1.ITM_CD
        , T2.ITM_NM
        , T2.ITM_SZ_NM
        , INAUD_DT
        , INAUD_NM
        , ISNULL(MAX(CASE WHEN GBN = 'A' THEN T1.INAUD_QTY END), 0) AS PRV_MON_QTY
        , ISNULL(MAX(CASE WHEN GBN = 'B' THEN T1.INAUD_QTY END), 0) AS IN_QTY
        , ISNULL(MAX(CASE WHEN GBN = 'C' THEN T1.INAUD_QTY END), 0) AS OUT_QTY
        , ISNULL(MAX(CASE WHEN GBN IN ('B', 'C')  THEN dbo.FF_ITM_STK_QTY(#CHNL_CD#, '001', T1.ITM_CD, INAUD_DT) END), 0) AS STK_QTY
        FROM (
      SELECT 'A'  AS GBN
        , '>>전월이월' AS INAUD_DT
        , '' AS INAUD_CD
        , ''    AS INAUD_NM
        , T1.ITM_CD
        , CASE WHEN SUBSTRING(#YRMON#, 5, 2) = '01' THen M12_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '02' THen M1_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '03' THen M2_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '04' THen M3_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '05' THen M4_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '06' THen M5_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '07' THen M6_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '08' THen M7_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '09' THen M8_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '10' THen M9_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '11' THen M10_RMN_QTY
              WHEN SUBSTRING(#YRMON#, 5, 2) = '12' THen M11_RMN_QTY
              END AS INAUD_QTY
      FROM  TB_INEOMLOC   T1
          , TB_CD_ITM     T2
      WHERE 1 = 1
        AND T1.CHNL_CD     = #CHNL_CD#
        AND T1.CHNL_CD     = T2.CHNL_CD
        AND T1.END_YR = (CASE WHEN SUBSTRING(#YRMON#, 5, 2) = '01' THEN SUBSTRING(#YRMON#, 1, 4) - 1 ELSE SUBSTRING(#YRMON#, 1, 4) END)
        AND T1.LOC_NO = #AREA_CD#
        AND T1.ITM_CD = T2.ITM_CD
        <isNotNull property="ITM_GRP_CLSS_CD">
          AND T2.ITM_GRP_CLSS_CD =  #ITM_GRP_CLSS_CD#
        </isNotNull>
        <isNotNull property="N1ST_ITM_GRP_CD">
          AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
        </isNotNull>
        <isNotNull property="N2ND_ITM_GRP_CD">
          AND T2.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
        </isNotNull>
      UNION ALL
      SELECT 'B'
          , CONVERT(VARCHAR(10), T1.INAUD_DT, 121)
          , T2.INAUD_CD
          , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-007', T2.INAUD_CD)  AS INAUD_NM
          , T2.ITM_CD
          , SUM(T2.INAUD_QTY) AS INAUD_QTY
      FROM TB_INAUD_MAST T1
        , TB_INAUD_DTL  T2
        , TB_CD_ITM     T3
      WHERE 1 = 1
        AND T1.CHNL_CD     = #CHNL_CD#
        AND T1.CHNL_CD     = T2.CHNL_CD
        AND T1.CHNL_CD     = T3.CHNL_CD
        AND T1.AREA_CD  = #AREA_CD#
        AND T1.INSRL_NO = T2.INSRL_NO
        AND T2.ITM_CD = T3.ITM_CD
        <isNotNull property="ITM_GRP_CLSS_CD">
          AND T3.ITM_GRP_CLSS_CD =  #ITM_GRP_CLSS_CD#
        </isNotNull>
        <isNotNull property="N1ST_ITM_GRP_CD">
          AND T3.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
        </isNotNull>
        <isNotNull property="N2ND_ITM_GRP_CD">
          AND T3.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
        </isNotNull>
        AND T2.INAUD_CD LIKE 'R' + '%'
        AND T1.INAUD_DT >= CAST(#YRMON#+'01'+ ' 00:00:00' AS DATETIME)
        AND T1.INAUD_DT <![CDATA[<=]]> DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,CAST(#YRMON#+'01' AS DATETIME))+1,0))
      GROUP BY T2.ITM_CD
        , CONVERT(VARCHAR(10), T1.INAUD_DT, 121)
        , T2.INAUD_CD
      UNION ALL
      SELECT 'C'
        , CONVERT(VARCHAR(10), T1.INAUD_DT, 121)
        , T2.INAUD_CD
        , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-007', T2.INAUD_CD)  AS INAUD_NM
        , T2.ITM_CD
        , SUM(T2.INAUD_QTY) AS INAUD_QTY
      FROM TB_INAUD_MAST T1
        , TB_INAUD_DTL  T2
        , TB_CD_ITM     T3
      WHERE 1 = 1
        AND T1.CHNL_CD     = #CHNL_CD#
        AND T1.CHNL_CD     = T2.CHNL_CD
        AND T1.CHNL_CD     = T3.CHNL_CD
        AND T1.AREA_CD  = #AREA_CD#
        AND T1.INSRL_NO = T2.INSRL_NO
        AND T2.ITM_CD = T3.ITM_CD
        <isNotNull property="ITM_GRP_CLSS_CD">
          AND T3.ITM_GRP_CLSS_CD =  #ITM_GRP_CLSS_CD#
        </isNotNull>
        <isNotNull property="N1ST_ITM_GRP_CD">
          AND T3.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
        </isNotNull>
        <isNotNull property="N2ND_ITM_GRP_CD">
          AND T3.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
        </isNotNull>
        AND T2.INAUD_CD LIKE 'I' + '%'
        AND T1.INAUD_DT >= CAST(#YRMON#+'01'+ ' 00:00:00' AS DATETIME)
        AND T1.INAUD_DT <![CDATA[<=]]> DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,CAST(#YRMON#+'01' AS DATETIME))+1,0))
      GROUP BY T2.ITM_CD
          , CONVERT(VARCHAR(10), T1.INAUD_DT, 121)
          , T2.INAUD_CD
          ) T1, TB_CD_ITM T2
      WHERE 1 = 1
        AND T2.CHNL_CD = #CHNL_CD#
        AND T1.ITM_CD = T2.ITM_CD
      GROUP BY T1.ITM_CD
          , T2.ITM_NM
          , T2.ITM_SZ_NM
          , T2.ITM_GRP_CLSS_CD
          , T2.N1ST_ITM_GRP_CD
          , T2.N2ND_ITM_GRP_CD
          , INAUD_DT
          , INAUD_NM
      ) T1
    </select>


    <!-- I6613 입고현황-->
    <select id="I6613SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
       SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.INSRL_NO, T2.INSRL_SEQ) AS RN 
           , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-007', T2.INAUD_CD) AS INAUD_NM
           , CONVERT(VARCHAR, T1.INAUD_DT, 23) AS INAUD_DT
           , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, ISNULL(T2.CO_NO, T1.CO_CD))  AS CO_NM
           , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-100', T2.LOC_CD)   AS LOC_NM   
           , T1.INSRL_NO
           , T2.ITM_CD
           , T3.ITM_NM
           , T3.ITM_SZ_NM
           , T2.INAUD_QTY
           , T2.INAUD_QTY * T3.UOM_WGT  AS ITM_WGT
           , T2.INAUD_PRC
           , T2.INAUD_AMT
           , T2.INAUD_RMK
           , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-600', T3.PROD_LOC_CD)  AS PROD_LOC_NM       
           , #CHNL_CD#  AS CHNL_CD
        FROM TB_INAUD_MAST    T1
           , TB_INAUD_DTL     T2
           , TB_CD_ITM        T3
       WHERE 1 = 1
         AND T1.CHNL_CD     = #CHNL_CD#
         AND T1.CHNL_CD     = T2.CHNL_CD
         AND T1.CHNL_CD     = T3.CHNL_CD
         AND T1.INSRL_NO  = T2.INSRL_NO
         AND T2.ITM_CD    = T3.ITM_CD
      <isNotNull property="AREA_CD">         
         AND T1.AREA_CD   = #AREA_CD#
      </isNotNull>
      <isNotNull property="CO_CD">
         AND T1.CO_CD     = #CO_CD#
      </isNotNull>
      <isNotNull property="FM_DT">
         AND T1.INAUD_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
         AND T1.INAUD_DT <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)  
      </isNotNull>
         AND T2.INAUD_CD  LIKE 'R' + '%'
      <isNotNull property="INAUD_CD">
         AND T2.INAUD_CD  = #INAUD_CD#
      </isNotNull>
    </select>
    
    
       <!-- I6614 출고현황 -->
    <select id="I6614SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
       SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.INSRL_NO, T2.INSRL_SEQ) AS RN 
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-007', T2.INAUD_CD) AS INAUD_NM
           , CONVERT(VARCHAR, T1.INAUD_DT, 23) AS INAUD_DT
           , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD , T1.CO_CD)  AS CO_NM
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-100', T2.LOC_CD)   AS LOC_NM   
           , T1.INSRL_NO
           , T2.ITM_CD
           , T3.ITM_NM
           , T3.ITM_SZ_NM
           , T2.INAUD_QTY
           , T2.INAUD_QTY * T3.UOM_WGT  AS ITM_WGT
           , T2.INAUD_PRC
           , T2.INAUD_AMT
           , T2.INAUD_RMK
           , T1.CHNL_CD   AS CHNL_CD
        FROM TB_INAUD_MAST    T1
           , TB_INAUD_DTL     T2
           , TB_CD_ITM        T3
       WHERE 1 = 1
         AND T1.CHNL_CD     = #CHNL_CD#
         AND T1.CHNL_CD     = T2.CHNL_CD
         AND T1.CHNL_CD     = T3.CHNL_CD
         AND T1.INSRL_NO  = T2.INSRL_NO
         AND T2.ITM_CD    = T3.ITM_CD
         AND T1.AREA_CD   = #AREA_CD#
      <isNotNull property="CO_CD">
         AND T2.CO_NO     = #CO_NO#
      </isNotNull>
      <isNotNull property="FM_DT">
         AND T1.INAUD_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
         AND T1.INAUD_DT <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)  
      </isNotNull>
         AND T2.INAUD_CD  LIKE 'I' + '%'
      <isNotNull property="INAUD_CD">
         AND T2.INAUD_CD  = #INAUD_CD#
      </isNotNull>
    </select>


      <!-- I6620 재고장 -->
   <select id="I6620SelectMstList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
        SELECT  
            N1ST_ITM_GRP_CD
          , N1ST_ITM_GRP_NM
          , N2ND_ITM_GRP_CD
          , N2ND_ITM_GRP_NM
          , ITM_GRP_CLSS_CD
          , CHNL_CD
        FROM
        (
            SELECT T1.ITM_GRP_CD    AS N1ST_ITM_GRP_CD  
                 , T1.ITM_GRP_NM    AS N1ST_ITM_GRP_NM
                 , T2.ITM_GRP_CD    AS N2ND_ITM_GRP_CD
                 , T2.ITM_GRP_NM    AS N2ND_ITM_GRP_NM     
                 , T1.ITM_GRP_CLSS_CD
                 , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.ITM_GRP_CD, T2.ITM_GRP_CD) AS RN 
                 , #CHNL_CD#        AS CHNL_CD
              FROM (
                    SELECT ITM_GRP_CD
                         , ITM_GRP_NM
                         , ITM_GRP_CLSS_CD
                      FROM TB_CD_ITM_GRP
                     WHERE 1 = 1
                       AND CHNL_CD     = #CHNL_CD#
                       AND PRNT_ITM_GRP_CD = 'T'
                     <isNotNull property="ITM_GRP_CLSS_CD" >
                       AND ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD# 
                     </isNotNull>
                    <isNotNull property="N1ST_ITM_GRP_CD" >
                       AND ITM_GRP_CD = #N1ST_ITM_GRP_CD#  
                    </isNotNull>
                       AND DELT_FLG = 'N' 
                     ) T1, ( 
                     SELECT ITM_GRP_CD
                         , ITM_GRP_NM
                         , PRNT_ITM_GRP_CD
                      FROM TB_CD_ITM_GRP
                     WHERE 1 = 1
                       AND CHNL_CD     = #CHNL_CD#
                       AND PRNT_ITM_GRP_CD <![CDATA[ <> ]]> 'T'
                     <isNotNull property="ITM_GRP_CLSS_CD" >
                       AND ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#  
                     </isNotNull>
                    <isNotNull property="N1ST_ITM_GRP_CD" >
                       AND PRNT_ITM_GRP_CD = #N1ST_ITM_GRP_CD# 
                    </isNotNull>
                       AND DELT_FLG = 'N' 
                  ) T2   
              WHERE T1.ITM_GRP_CD = T2.PRNT_ITM_GRP_CD
            ) T3
          WHERE 1=1 
		  <!--
		  AND ITM_GRP_CLSS_CD = 'G'
		  -->
      GROUP BY N1ST_ITM_GRP_CD, N1ST_ITM_GRP_NM, N2ND_ITM_GRP_CD, N2ND_ITM_GRP_NM, ITM_GRP_CLSS_CD, CHNL_CD
    </select>
    
    <!-- I6210 품목별입출고현황 -->
    <select id="I6210SelectMstList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
       SELECT CASE WHEN T1.INAUD_NM = '( 이 월 )' THEN '' ELSE SUBSTRING(T1.INAUD_DT, 1, 6) END AS YRMON
           , CASE WHEN T1.INAUD_NM = '( 이 월 )' THEN '' ELSE CONVERT(VARCHAR, CONVERT(DATE, T1.INAUD_DT), 23)  END   AS INAUD_DT
           , T1.CO_NM
           , T1.INAUD_NM
           , T1.IN_QTY
           , T1.IN_PRC
           , T1.IN_AMT
           , T1.OUT_QTY AS  OUT_QTY
           , T1.OUT_AMT
           , T1.STK_QTY
           , T1.STK_PRC
           , ROUND(T1.STK_QTY * T1.STK_PRC, 0)  AS STK_AMT
           , T1.RLSE_PRC
           , ROUND(T1.OUT_QTY * T1.RLSE_PRC, 0) AS RLSE_AMT
           , ITM_RMK
        FROM (
                  SELECT T1.INAUD_DT
                        , T1.CO_NM
                        , T1.INAUD_NM
                        , IN_QTY 
                        , IN_PRC
                        , IN_AMT
                        , T1.OUT_QTY
                        , OUT_AMT 
                        , STK_QTY = SUM(T1.IN_QTY - T1.OUT_QTY) OVER (PARTITION BY NULL ORDER BY RN) 
                        , T1.STK_PRC
                        , T1.RLSE_PRC
                        , RN
                        , ITM_RMK
                    FROM (
                              SELECT  T1.INAUD_DT
                                    , T1.CO_NM
                                    , T1.INAUD_NM
                                    , T1.PRV_QTY + T1.IN_QTY  AS IN_QTY 
                                    , T1.PRV_PRC + T1.IN_PRC  AS IN_PRC
                                    , T1.PRV_AMT + T1.IN_AMT  AS IN_AMT
                                    , T1.OUT_QTY
                                    , T1.OUT_QTY * T1.STK_PRC  AS OUT_AMT 
                                    , STK_QTY = SUM(T1.PRV_QTY + T1.IN_QTY - T1.OUT_QTY) OVER (PARTITION BY NULL ORDER BY T1.INAUD_DT, T1.CO_NM) 
                                    , T1.STK_PRC
                                    , T1.RLSE_PRC
                                    , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY INAUD_DT, GBN,  CRE_DT) AS RN
                                    , T1.ITM_RMK
                                FROM (
                                      SELECT T1.INAUD_DT
                                           , T1.CO_NM
                                           , T1.INAUD_NM 
                                           , ISNULL(SUM(CASE WHEN GBN = 'A' THEN T1.INAUD_QTY END), 0) AS PRV_QTY 
                                           , ISNULL(MAX(CASE WHEN GBN = 'A' THEN T1.INAUD_PRC END), 0) AS PRV_PRC             
                                           , ISNULL(SUM(CASE WHEN GBN = 'A' THEN T1.INAUD_AMT END), 0) AS PRV_AMT 
                                           , ISNULL(SUM(CASE WHEN GBN = 'I' THEN T1.INAUD_QTY END), 0) AS IN_QTY                   
                                           , ISNULL(MAX(CASE WHEN GBN = 'I' THEN T1.INAUD_PRC END), 0) AS IN_PRC
                                           , ISNULL(SUM(CASE WHEN GBN = 'I' THEN T1.INAUD_AMT END), 0) AS IN_AMT
                                           , ISNULL(SUM(CASE WHEN GBN = 'O' THEN T1.INAUD_QTY END), 0) AS OUT_QTY 
                                           , ISNULL(SUM(CASE WHEN GBN = 'O' THEN T1.INAUD_AMT END), 0) AS OUT_AMT   
                                           , ISNULL(MAX(dbo.FF_ITM_STK_PRC(#CHNL_CD#, #AREA_CD#, #ITM_CD#, T1.INAUD_DT)), 0) AS STK_PRC
                                           , MAX(RLSE_PRC) AS RLSE_PRC
                                           , T1.INSRL_NO
                                           , MAX(ITM_RMK)  AS ITM_RMK
                                           , MAX(CRE_DT)   AS CRE_DT
                                           , T1.INSRL_SEQ
                                           , MIN(GBN) AS GBN
                                        FROM (
                                                  SELECT T1.INAUD_DT
                                                       , T1.CO_NM
                                                       , T1.INAUD_NM
                                                       , T1.INAUD_QTY
                                                       , T1.INAUD_PRC * T1.INAUD_QTY AS INAUD_AMT
                                                       , T1.INAUD_PRC
                                                       , GBN 
                                                       , RLSE_PRC    
                                                       , INSRL_NO
                                                       , ITM_RMK
                                                       , T1.CRE_DT
                                                       , INSRL_SEQ                                                      
                                                    FROM (
                                                              SELECT 'A'  AS GBN 
                                                                   , '( 이 월 )'  AS INAUD_NM
                                                                   , SUBSTRING(#FM_DT#, 1, 4) + '0101'  AS INAUD_DT
                                                                   , T1.ITM_CD 
                                                                    , ''          AS CO_NM 
                                                                   , T1.ITM_QTY   AS INAUD_QTY    
                                                                   , T1.ITM_PRC   AS INAUD_PRC       
                                                                   , 0.00 AS RLSE_PRC
                                                                   , '이월'       AS INSRL_NO
                                                                   , '이월'       AS ITM_RMK 
                                                                   , CAST(SUBSTRING(#FM_DT#, 1, 4) + '0101' AS DATETIME) AS CRE_DT
                                                                   , 0            AS INSRL_SEQ
                                                              FROM  TB_INVT_ITM_PRC   T1
                                                                  , TB_CD_ITM         T2
                                                             WHERE 1 = 1
                                                               AND T1.CHNL_CD   = T2.CHNL_CD
                                                               AND T1.CHNL_CD   = #CHNL_CD#
                                                               AND T1.APLY_DT = SUBSTRING(#FM_DT#, 1, 4)+'0000'
                                                               AND T1.AREA_CD = #AREA_CD#
                                                               AND T1.ITM_CD  = T2.ITM_CD
                                                               AND T1.ITM_CD  = #ITM_CD#
                                                          UNION ALL
                                                             SELECT T1.IO_CD
                                                                  , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-007', T2.INAUD_CD) AS INAUD_NM
                                                                  , CONVERT(VARCHAR(8), T1.INAUD_DT, 112) 
                                                                  , T2.ITM_CD
                                                                  , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD) AS CO_NM
                                                                  , SUM(T2.INAUD_QTY) 
                                                                  , MAX(INAUD_PRC)
                                                                  , CASE WHEN T1.IO_CD = 'O' AND T2.INAUD_CD = 'IGS' THEN MAX(INAUD_PRC) ELSE 0 END 
                                                                  , T1.INSRL_NO  
                                                                  , MAX(T2.INAUD_RMK) AS INAUD_RMK
                                                                  , MAX(T1.CRE_DT)
                                                                  , T2.INSRL_SEQ
                                                               FROM TB_INAUD_MAST T1
                                                                  , TB_INAUD_DTL  T2
                                                                  , TB_CD_ITM     T3                              
                                                              WHERE 1 = 1
                                                               AND T1.CHNL_CD   = T2.CHNL_CD
                                                               AND T1.CHNL_CD   = T3.CHNL_CD
                                                               AND T1.CHNL_CD   = #CHNL_CD#                                                              
                                                                AND T2.LOC_CD   IN  ( SELECT LOC_CD
                                                                                        FROM TB_INVT_LOC 
                                                                                       WHERE 1 = 1
                                                                                         AND CHNL_CD = #CHNL_CD#
                                                                                         AND AREA_CD = #AREA_CD#  )
                                                                AND T1.INSRL_NO = T2.INSRL_NO
                                                                AND T2.ITM_CD   = T3.ITM_CD
                                                                AND T2.INAUD_CD  <![CDATA[<>]]> 'RGT'
                                                                AND T2.ITM_CD   = #ITM_CD#     
                                                                AND T2.INAUD_QTY <![CDATA[<>]]> 0
                                                                AND T1.INAUD_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                                                AND T1.INAUD_DT <![CDATA[<=]]> DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,CAST(SUBSTRING(#TO_DT#, 1, 6) +'01' AS DATETIME))+1,0))
                                                           GROUP BY T1.IO_CD
                                                                  , INAUD_CD
                                                                  , CONVERT(VARCHAR(8), T1.INAUD_DT, 112) 
                                                                  , T2.ITM_CD
                                                                  , T1.CO_CD       
                                                                  , T1.INSRL_NO
                                                                  , T2.INSRL_SEQ
                                                                  , T1.CHNL_CD
                                                          UNION ALL
                                                             SELECT T1.IO_CD
                                                                  , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-007', T2.INAUD_CD) AS INAUD_NM
                                                                  , CONVERT(VARCHAR(8), T1.INAUD_DT, 112) 
                                                                  , T2.ITM_CD
                                                                  , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, dbo.FF_INVT_STK_MV_ORI_AREA(T1.CHNL_CD, T4.INAUD_TMP_NO, T4.INAUD_TMP_SEQ)) AS CO_NM
                                                                  , SUM(T2.INAUD_QTY) 
                                                                  , MAX(INAUD_PRC)
                                                                  , CASE WHEN T1.IO_CD = 'O' AND T2.INAUD_CD = 'RGT' THEN MAX(INAUD_PRC) ELSE 0 END 
                                                                  , T1.INSRL_NO  
                                                                  , MAX(T2.INAUD_RMK) AS INAUD_RMK
                                                                  , MAX(T1.CRE_DT)
                                                                  , T2.INSRL_SEQ
                                                               FROM TB_INAUD_MAST T1
                                                                  , TB_INAUD_DTL  T2
                                                                  , TB_CD_ITM     T3        
                                                                  , TB_INAUD_TMP  T4
                                                              WHERE 1 = 1
                                                                AND T1.CHNL_CD   = T2.CHNL_CD
                                                                AND T1.CHNL_CD   = T3.CHNL_CD
                                                                AND T1.CHNL_CD   = T4.CHNL_CD
                                                                AND T1.CHNL_CD   = #CHNL_CD#
                                                                AND T2.LOC_CD   IN  ( SELECT LOC_CD
                                                                                        FROM TB_INVT_LOC 
                                                                                       WHERE 1 = 1
                                                                                          AND AREA_CD = #AREA_CD#  
                                                                                          AND CHNL_CD = #CHNL_CD#)
                                                                AND T1.INSRL_NO = T2.INSRL_NO
                                                                AND T2.ITM_CD   = T3.ITM_CD
                                                                AND T2.ORD_NO   = T4.INAUD_TMP_NO
                                                                AND T2.ORD_SEQ  = T4.INAUD_TMP_SEQ
                                                                AND T2.ITM_CD   = #ITM_CD#
                                                                AND T2.INAUD_QTY <![CDATA[<>]]> 0
                                                                AND T1.INAUD_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                                                AND T1.INAUD_DT <![CDATA[<=]]> DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,CAST(SUBSTRING(#TO_DT#, 1, 6) +'01' AS DATETIME))+1,0))
                                                                AND T2.INAUD_CD  = 'RGT'  
                                                           GROUP BY T1.IO_CD
                                                                  , INAUD_CD
                                                                  , CONVERT(VARCHAR(8), T1.INAUD_DT, 112) 
                                                                  , T2.ITM_CD
                                                                  , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD,  dbo.FF_INVT_STK_MV_ORI_AREA(T1.CHNL_CD, T4.INAUD_TMP_NO, T4.INAUD_TMP_SEQ))     
                                                                  , T1.INSRL_NO     
                                                                  , T2.INSRL_SEQ
                                                                  , T1.CHNL_CD
                                                        UNION ALL 
                                                       SELECT   'O'  AS IO_CD
                                                               , '주문'
                                                               , CONVERT(VARCHAR(8), T1.SL_RLSE_DT, 112)  AS SL_YYMMDD
                                                               , T2.SL_ITM_CD 
                                                               , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS CO_NM
                                                               , SUM(T2.SL_ITM_QTY)
                                                               , MAX(T2.SL_ITM_PRC_DC_VAL)
                                                               , MAX(T2.SL_ITM_PRC_DC_VAL) 
                                                               , T1.SL_RLSE_NO 
                                                               , MAX(T2.SL_ITM_RMK)
                                                               , MAX(T1.CRE_DT)
                                                               , 0 
                                                          FROM TB_SL_RLSE       T1
                                                             , TB_SL_RLSE_DTL   T2
                                                           WHERE 1 = 1                                                             
                                                             AND T1.CHNL_CD   = T2.CHNL_CD
                                                             AND T1.CHNL_CD   = #CHNL_CD#                                                           
                                                             AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
                                      					             AND T1.SL_AREA_CD  = #AREA_CD#
                                      					             AND T2.SL_ITM_CD   = #ITM_CD#
                                                             AND T2.SL_ITM_QTY  <![CDATA[<>]]> 0
                                                             AND T1.SL_RLSE_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                                             AND T1.SL_RLSE_DT   <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                                                             AND NOT EXISTS (SELECT 'X'
                                                                               FROM TB_SL_RLSE_MAP Z
                                                                              WHERE 1 = 1
                                                                                AND Z.CHNL_CD = #CHNL_CD#
                                                                                AND T2.SL_RLSE_NO = Z.SL_RLSE_NO
                                                                                AND T2.SL_RLSE_SEQ = Z.SL_RLSE_SEQ )     
                                                        GROUP BY CONVERT(VARCHAR(8), T1.SL_RLSE_DT, 112)  
                                                               , T2.SL_ITM_CD 
                                                               , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD)      
                                                               , T1.SL_RLSE_NO 
                                                        UNION ALL 
                                                        SELECT   'O'  AS IO_CD
                                                               , '단가수정'
                                                               , CONVERT(VARCHAR(8), T1.SL_BIL_DT, 112)  AS SL_YYMMDD
                                                               , T2.SL_ITM_CD 
                                                               , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD) AS CO_NM
                                                               , SUM(T2.SL_ITM_QTY)
                                                               , MAX(T2.SL_ITM_PRC_DC_VAL)
                                                               , MAX(T2.SL_ITM_PRC_DC_VAL) 
                                                               , T1.SL_BIL_NO 
                                                               , MAX(T2.SL_ITM_RMK)
                                                               , MAX(T1.CRE_DT)
                                                               , T2.SL_BIL_SEQ 
                                                          FROM TB_SL_BIL       T1
                                                             , TB_SL_BIL_DTL   T2
                                                           WHERE 1 = 1                                                             
                                                             AND T1.CHNL_CD   = T2.CHNL_CD
                                                             AND T1.CHNL_CD   = #CHNL_CD# 
                                                             AND T1.SL_BIL_NO  = T2.SL_BIL_NO
                                                             AND T1.SL_AREA_CD  = #AREA_CD#
                                                             AND T2.SL_ITM_CD   = #ITM_CD#
                                                             AND T1.SL_BIL_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                                                             AND T1.SL_BIL_DT   <![CDATA[<=]]>  CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                                                             AND T1.SL_BIL_CD    = 'P'                                                  
                                                        GROUP BY CONVERT(VARCHAR(8), T1.SL_BIL_DT, 112)  
                                                               , T2.SL_ITM_CD 
                                                               , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD)         
                                                               , T1.SL_BIL_NO 
                                                               , T2.SL_BIL_SEQ                                                                              
                                                      ) T1, TB_CD_ITM T2 
                                                  WHERE T1.ITM_CD = T2.ITM_CD    
                                      ) T1            
                              GROUP BY T1.INAUD_DT
                                     , T1.CO_NM
                                     , T1.INAUD_NM   
                                     , T1.INSRL_NO
                                     , T1.INSRL_SEQ 
                              ) T1        
                        ) T1  
          ) T1       
    </select>
    
  <!-- I6620 재고장 -->
  <select id="I6620SelectDtlList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">      
       SELECT  ROW_NUMBER() OVER ( PARTITION BY NULL ORDER BY T1.ITM_CD) AS RN 
             , T1.ITM_CD
             , T1.ITM_NM
             , T1.ITM_SZ_NM
             , T1.STK_A_QTY
             , T1.STK_B_QTY
             , T1.STK_C_QTY     
             , T1.TMP_QTY
             , T1.TMP_A_QTY     
             , T1.TMP_B_QTY     
             , T1.TMP_C_QTY   
             , T1.MD_PER_QTY       
             , T1.PK_PER_QTY       
             , T1.MTRL_NM_CD       
             , T1.MTRL_NM_NM        
             , T1.HD_LEN_CD        
             , T1.HD_LEN_NM         
             , T1.BOD_LEN_VAL      
             , T1.SCRW_LEN_CD      
             , T1.SCRW_LEN_NM   
             , T1.SCRW_BOD_LEN_VAL 
             , T1.SKIN_HDL_CD      
             , T1.SKIN_HDL_NM        
             , T1.COLOR_FLG
             , T1.SL_ITM_PRC_VAL
             , T1.S_GRD_PRC      
             , T1.K_GRD_PRC      
             , T1.A_GRD_PRC      
             , T1.B_GRD_PRC      
             , T1.C_GRD_PRC      
             , T1.D_GRD_PRC      
             , T1.F_GRD_PRC      
             , T1.G_GRD_PRC      
             , ROUND(CASE WHEN T1.MD_PER_QTY = 0 THEN 0 ELSE T1.STK_A_QTY / T1.MD_PER_QTY END, 1) AS TOT_MD_QTY
             , T1.UOM_WGT 
             , T1.PROD_LOC_NM
             , T2.INV_QTY
             , T1.RLSE_CHK_FLG
             , CASE WHEN T1.ACT_INSP_CD = 'F' THEN 'Y' ELSE 'N' END AS ACT_FLG
          , T1.ITM_GRP_CLSS_CD
          , T1.ITM_GRP_CLSS_NM
          , T1.N1ST_ITM_GRP_CD
          , T1.N1ST_ITM_GRP_NM
          , T1.N2ND_ITM_GRP_CD
          , T1.N2ND_ITM_GRP_NM  
        FROM (
              SELECT T1.ITM_CD
                   , T2.ITM_NM
                   , T2.ITM_SZ_NM
                   , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_QTY END), 0) AS STK_A_QTY
                   , ISNULL(MAX(CASE WHEN T1.AREA_CD = '002' THEN T1.ITM_QTY END), 0) AS STK_B_QTY
                   , ISNULL(MAX(CASE WHEN T1.AREA_CD = '003' THEN T1.ITM_QTY END), 0) AS STK_C_QTY     
                   , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_TMP_QTY
                                     WHEN T1.AREA_CD = '002' THEN T1.ITM_TMP_QTY
                                     WHEN T1.AREA_CD = '003' THEN T1.ITM_TMP_QTY END), 0) AS TMP_QTY
                   , ISNULL(MAX(CASE WHEN T1.AREA_CD = '001' THEN T1.ITM_TMP_QTY END ), 0) AS TMP_A_QTY     
                   , ISNULL(MAX(CASE WHEN T1.AREA_CD = '002' THEN T1.ITM_TMP_QTY END ), 0) AS TMP_B_QTY     
                   , ISNULL(MAX(CASE WHEN T1.AREA_CD = '003' THEN T1.ITM_TMP_QTY END ), 0) AS TMP_C_QTY   
                   , MAX(T2.MD_PER_QTY                     ) AS MD_PER_QTY       
                   , MAX(T2.PK_PER_QTY              ) AS PK_PER_QTY       
                   , MAX(T2.MTRL_NM_CD              ) AS MTRL_NM_CD       
                   , NULL  AS MTRL_NM_NM        
                   , MAX(T2.HD_LEN_CD               ) AS HD_LEN_CD        
                   , NULL  AS HD_LEN_NM         
                   , MAX(T2.BOD_LEN_VAL             ) AS BOD_LEN_VAL      
                   , MAX(T2.SCRW_LEN_CD             ) AS SCRW_LEN_CD      
                   , NULL AS SCRW_LEN_NM   
                   , MAX(T2.SCRW_BOD_LEN_VAL        ) AS SCRW_BOD_LEN_VAL 
                   , MAX(T2.SKIN_HDL_CD             ) AS SKIN_HDL_CD      
                   , NULL AS SKIN_HDL_NM        
                   , MAX(CASE WHEN #AREA_CD# = '001' THEN '1'
                          WHEN #AREA_CD# = '002' THEN '2'
                          WHEN #AREA_CD# = '003' THEN '3'
                          ELSE '4'
                     END) AS COLOR_FLG
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.SL_ITM_PRC_VAL END      ) AS SL_ITM_PRC_VAL
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.S_GRD_PRC END          ) AS S_GRD_PRC      
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.K_GRD_PRC END          ) AS K_GRD_PRC      
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.A_GRD_PRC END          ) AS A_GRD_PRC      
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.B_GRD_PRC END          ) AS B_GRD_PRC      
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.C_GRD_PRC END          ) AS C_GRD_PRC      
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.D_GRD_PRC END          ) AS D_GRD_PRC      
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.F_GRD_PRC END          ) AS F_GRD_PRC      
                   , MAX(CASE WHEN T1.AREA_CD = #AREA_CD# THEN T1.G_GRD_PRC END         ) AS G_GRD_PRC      
                   , MAX(T2.UOM_WGT)        AS  UOM_WGT 
                   , MAX(dbo.FF_ITM_LOC_NM(#CHNL_CD#, #AREA_CD#, T1.ITM_CD))  AS PROD_LOC_NM
                   , NULL             AS RLSE_CHK_FLG 
                   , MAX(T2.ACT_INSP_CD) AS ACT_INSP_CD
               , MAX(T2.ITM_GRP_CLSS_CD) AS ITM_GRP_CLSS_CD
               , MAX(T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_CD
               , MAX(T2.N2ND_ITM_GRP_CD) AS N2ND_ITM_GRP_CD
               , MAX(T2.ITM_GRP_CLSS_NM) AS ITM_GRP_CLSS_NM
               , MAX(T2.N1ST_ITM_GRP_NM) AS N1ST_ITM_GRP_NM
               , MAX(T2.N2ND_ITM_GRP_NM) AS N2ND_ITM_GRP_NM               
                FROM TB_INVT_DLY_STK  T1
                   , MV_TB_CD_ITM     T2
               WHERE 1 = 1
                 AND T1.CHNL_CD = #CHNL_CD#
                 AND T1.CHNL_CD = T2.CHNL_CD
                 AND T1.ITM_CD = T2.ITM_CD
                <isNotNull property="ITM_GRP_CLSS_CD" >
                  AND T2.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
                </isNotNull>
                <isNotNull property="N1ST_ITM_GRP_CD" >
                  AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
                </isNotNull>
                <isNotNull property="N2ND_ITM_GRP_CD" >
                  AND T2.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_CD#
                </isNotNull>
                <isNotNull property="HD_LEN_CD" >
                  AND T2.HD_LEN_CD       = #HD_LEN_CD#
                </isNotNull>
                <isNotNull property="ITM_CD" >
                  AND T2.ITM_CD           LIKE  #ITM_CD# + '%'
                </isNotNull>   
              GROUP BY T1.ITM_CD
                     , T2.ITM_NM
                     , T2.ITM_SZ_NM   
      ) T1 LEFT OUTER JOIN ( 
             SELECT T2.IMP_ITM_CD
                  , SUM(T2.IMP_ITM_QTY)  AS INV_QTY
               FROM TB_PUR_IMP_INV_DTL T2
              WHERE 1 = 1
               AND T2.CHNL_CD       = #CHNL_CD#
               AND NOT EXISTS (SELECT 'X'
                                 FROM TB_INAUD_TMP X
                                WHERE 1 = 1
                                  AND X.CHNL_CD       = #CHNL_CD#
                                  AND X.PUR_ORD_NO    = T2.IMP_INV_NO
                                  AND X.PUR_ORD_SEQ   = T2.IMP_INV_SEQ
                               )
               AND NOT EXISTS (SELECT 'X'
                                 FROM TB_PUR_CTRT_CLZ  X 
                                WHERE 1 = 1
                                  AND X.CHNL_CD       = #CHNL_CD#
                                  AND X.ORD_NO    = T2.IMP_PUR_NO
                                  AND X.ORD_SEQ   = T2.IMP_PUR_SEQ
                              )
          GROUP BY T2.IMP_ITM_CD        
        ) T2 ON ( T1.ITM_CD = T2.IMP_ITM_CD)      
    </select>

    
    <!-- I6616 MST - 발주 잔량-->
    <select id="I6616SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
         WITH TMP AS 
         (
                SELECT T1.PUR_ORD_NO
                     , T1.PUR_ORD_SEQ
                     , ISNULL(SUM(T2.INAUD_QTY), 0)    AS IN_QTY
                     , ISNULL(MAX(T2.INAUD_PRC), 0)    AS IN_PRC
                     , ISNULL(SUM(T2.INAUD_AMT), 0)    AS IN_AMT
                  FROM TB_INAUD_TMP  T1
                     , TB_INAUD_DTL  T2
                 WHERE 1 = 1
                   AND T1.CHNL_CD         = T2.CHNL_CD
                   AND T1.CHNL_CD         = #CHNL_CD#
                   AND T1.INAUD_TMP_NO    = T2.ORD_NO 
                   AND T1.INAUD_TMP_SEQ   = T2.ORD_SEQ
                   AND T1.INAUD_DT       >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                   AND T1.INAUD_DT       <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                GROUP BY T1.PUR_ORD_NO
                       , T1.PUR_ORD_SEQ   
         )
          SELECT PUR_CO_CD       AS CO_CD
               , PUR_CO_NM       AS CO_NM 
               , SUM(RMN_AMT)    AS PUR_AMT 
               , #FM_DT#      AS FM_DT
               , #TO_DT#      AS TO_DT
               <isNotNull property="CLZ_FLG">
               , #CLZ_FLG#    AS CLZ_FLG
              </isNotNull>  
            FROM (
              SELECT  PUR_DT
                    , PUR_ORD_NO
                    , PUR_ORD_SEQ
                    , PUR_CO_CD
                    , PUR_CO_NM
                    , ITM_CD
                    , ITM_NM
                    , ITM_SZ_NM 
                    , PUR_DUE_DT
                    , PUR_QTY
                    , PUR_PRC 
                    , PUR_AMT
                    , IN_QTY 
                    , CASE WHEN IN_QTY = 0 THEN 0 ELSE ROUND(IN_AMT / IN_QTY , 0) END AS IN_PRC       
                    , IN_AMT
                    , CASE WHEN CLZ_FLG = 'Y' THEN 0 ELSE RMN_QTY END AS RMN_QTY 
                    , CASE WHEN RMN_QTY = 0 OR CLZ_FLG = 'Y' THEN 0 ELSE ROUND(RMN_AMT / RMN_QTY , 0) END AS RMN_PRC 
                    , CASE WHEN CLZ_FLG = 'Y' THEN 0 ELSE RMN_AMT END AS RMN_AMT 
                    , IN_RTE
                    , CLZ_FLG
                    , isCheckd
                    , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY PUR_DT, PUR_ORD_NO, ITM_CD) AS RN 
                FROM (         
                     SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.PUR_DT, PUR_CO_CD, T1.PUR_ORD_NO, T1.PUR_ORD_SEQ) AS RN 
                          , CONVERT(VARCHAR, T1.PUR_DT, 23) AS PUR_DT
                          , T1.PUR_ORD_NO      AS PUR_ORD_NO
                          , T1.PUR_ORD_SEQ     AS PUR_ORD_SEQ
                          , T1.PUR_CO_CD
                          , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.PUR_CO_CD)  AS PUR_CO_NM
                          , T1.ITM_CD
                          , T3.ITM_NM
                          , T3.ITM_SZ_NM 
                          , CONVERT(VARCHAR, T1.PUR_DUE_DT, 23) AS PUR_DUE_DT
                          , T1.PUR_QTY
                          , T1.PUR_PRC 
                          , T1.PUR_QTY * T1.PUR_PRC  AS PUR_AMT
                          , ISNULL(T1.IN_QTY, 0) AS IN_QTY
                          , ISNULL(T1.IN_AMT, 0) AS IN_AMT
                          , ISNULL(T1.PUR_QTY, 0) -ISNULL(T1.IN_QTY, 0)    AS RMN_QTY
                          , (ISNULL(T1.PUR_QTY, 0) -ISNULL(T1.IN_QTY, 0)) * T1.PUR_PRC   AS RMN_AMT                          
                          , ISNULL(CASE WHEN T1.PUR_QTY = 0 THEN 0 ELSE   (ISNULL(T1.IN_QTY, 0) / T1.PUR_QTY) * 100 END, 0) AS IN_RTE
                          , ISNULL(T4.ORD_CLZ_FLG, 'N') AS CLZ_FLG
                          , (CASE WHEN ISNULL(T4.ORD_CLZ_FLG, 'N') = 'Y' THEN 1 ELSE 0 END) AS isCheckd
                      FROM (      
                   SELECT T1.PUR_DT
                        , T1.PUR_ORD_NO
                        , T1.PUR_CO_CD
                        , T1.ITM_CD
                        , T1.PUR_DUE_DT
                        , T1.PUR_QTY
                        , T1.PUR_PRC
                        , T1.PUR_AMT
                        , T1.PUR_ORD_SEQ
                        , SUM(T2.IN_QTY) AS IN_QTY
                        , SUM(T2.IN_AMT) AS  IN_AMT                      
                  FROM (
                          SELECT T1.PUR_DT
                                , T1.PUR_ORD_NO
                                , T1.PUR_CO_CD
                                , T2.ITM_CD
                                , T1.PUR_DUE_DT
                                , ISNULL(T2.PUR_QTY, 0)    AS PUR_QTY
                                , ISNULL(T2.CO_UT_PRC, 0)  AS PUR_PRC
                                , ISNULL(T2.PUR_AMT, 0)    AS PUR_AMT
                                , T2.PUR_ORD_SEQ
                                , T1.PUR_ORD_NO     AS INV_NO
                                , T2.PUR_ORD_SEQ    AS INV_SEQ
                            FROM TB_PUR_ORD         T1
                                , TB_PUR_ORD_DTL     T2
                            WHERE 1 = 1
                              AND T1.CHNL_CD         = T2.CHNL_CD
                              AND T1.CHNL_CD         = #CHNL_CD#                            
                              AND T1.PUR_ORD_NO = T2.PUR_ORD_NO
                              AND T1.PUR_DT    >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
                              AND T1.PUR_DT    <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                          UNION ALL      
                            SELECT  IMP_CTRT_DT
                                  , IMP_CTRT_NO
                                  , IMP_CO_CD
                                  , IMP_ITM_CD
                                  , IMP_EXP_DT
                                  , PUR_QTY
                                  , PUR_PRC
                                  , PUR_AMT       
                                  , IMP_PUR_SEQ     
                                  , IMP_INV_NO
                                  , IMP_INV_SEQ
                            FROM (
                            SELECT  ROW_NUMBER() OVER (PARTITION BY T2.IMP_PUR_NO, T2.IMP_PUR_SEQ ORDER BY  T2.IMP_PUR_SEQ) AS RN 
                                  , T1.IMP_CTRT_DT
                                  , T2.IMP_PUR_NO  AS IMP_CTRT_NO
                                  , T1.IMP_CO_CD
                                  , T2.IMP_ITM_CD
                                  , T1.IMP_EXP_DT
                                  , ISNULL(T2.IMP_ITM_QTY, 0)         AS PUR_QTY
                                  , T2.IMP_ITM_PRC * ISNULL(T1.IMP_XCH_RT, 1000)   AS PUR_PRC
                                  , ISNULL(T2.IMP_ITM_AMT, 0)         AS PUR_AMT       
                                  , T2.IMP_PUR_SEQ
                                  , T3.IMP_INV_NO
                                  , T3.IMP_INV_SEQ
                              FROM TB_PUR_IMP_CTRT      T1
                                  , TB_PUR_IMP_CTRT_DTL  T2
                                    LEFT OUTER JOIN TB_PUR_IMP_INV_DTL  T3
                                    ON ( 1 = 1
                                     AND T3.CHNL_CD       = #CHNL_CD#
                                     AND T2.IMP_PUR_NO    = T3.IMP_PUR_NO
                                     AND T2.IMP_PUR_SEQ   = T3.IMP_PUR_SEQ )
                              WHERE 1 = 1
                                AND T1.CHNL_CD         = T2.CHNL_CD
                                AND T1.CHNL_CD         = #CHNL_CD#
                                AND T1.IMP_PUR_NO = T2.IMP_PUR_NO
                                AND T1.IMP_CTRT_DT    >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
                                AND T1.IMP_CTRT_DT     <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)                      
                                ) T1
                            WHERE 1 = 1
                    ) T1   LEFT OUTER JOIN TMP T2 ON (
                            1 = 1
                        AND T1.INV_NO   = T2.PUR_ORD_NO
                        AND T1.INV_SEQ  = T2.PUR_ORD_SEQ
                            )  
          GROUP BY T1.PUR_DT
                , T1.PUR_ORD_NO
                , T1.PUR_CO_CD
                , T1.ITM_CD
                , T1.PUR_DUE_DT
                , T1.PUR_QTY
                , T1.PUR_PRC
                , T1.PUR_AMT
                , T1.PUR_ORD_SEQ   
                  ) T1 LEFT OUTER JOIN TB_PUR_CTRT_CLZ T4 ON (
                       1 = 1
                   AND T4.CHNL_CD      = #CHNL_CD#
                   AND T1.PUR_ORD_NO   = T4.ORD_NO
                   AND T1.PUR_ORD_SEQ  = T4.ORD_SEQ
                  )               
                  ,  TB_CD_ITM T3
              WHERE 1 = 1
                AND T3.CHNL_CD                 = #CHNL_CD#
                AND T1.ITM_CD                  = T3.ITM_CD
                AND ISNULL(T4.ORD_CLZ_FLG, 'N') LIKE 'N'
          ) T1      
          WHERE 1 = 1
          ) T1
          GROUP BY PUR_CO_CD       
                 , PUR_CO_NM
    </select>
    
    
    <!-- I6616 DTL - 발주 잔량 -->
    <select id="I6616SelectDtlList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
                 WITH TMP AS 
                 (
                        SELECT T1.PUR_ORD_NO
                             , T1.PUR_ORD_SEQ
                             , ISNULL(SUM(T2.INAUD_QTY), 0)    AS IN_QTY
                             , ISNULL(MAX(T2.INAUD_PRC), 0)    AS IN_PRC
                             , ISNULL(SUM(T2.INAUD_AMT), 0)    AS IN_AMT
                          FROM TB_INAUD_TMP  T1
                             , TB_INAUD_DTL  T2
                         WHERE 1 = 1
                           AND T1.CHNL_CD         = #CHNL_CD#
                           AND T1.CHNL_CD         = T2.CHNL_CD                           
                           AND T1.INAUD_TMP_NO    = T2.ORD_NO 
                           AND T1.INAUD_TMP_SEQ   = T2.ORD_SEQ
                           AND T1.INAUD_DT       >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                           AND T1.INAUD_DT       <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                        GROUP BY T1.PUR_ORD_NO
                               , T1.PUR_ORD_SEQ   
                 )
         SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY RN, PUR_DT ) AS RN 
              , CONVERT(VARCHAR, PUR_DT, 23) AS PUR_DT
              , PUR_ORD_NO AS ORD_NO
              , ITM_CD
              , ITM_NM
              , ITM_SZ_NM 
              , PUR_QTY
              , IN_QTY
              , RMN_QTY
              , IN_RTE
              , PUR_PRC
              , RMN_AMT  PUR_AMT      
              , CLZ_FLG
         FROM (
            SELECT  PUR_DT
                  , PUR_ORD_NO
                  , PUR_ORD_SEQ
                  , PUR_CO_CD
                  , PUR_CO_NM
                  , ITM_CD
                  , ITM_NM
                  , ITM_SZ_NM 
                  , PUR_DUE_DT
                  , PUR_QTY
                  , PUR_PRC 
                  , PUR_AMT
                  , IN_QTY 
                  , CASE WHEN IN_QTY = 0 THEN 0 ELSE ROUND(IN_AMT / IN_QTY , 0) END AS IN_PRC       
                  , IN_AMT
                  , CASE WHEN CLZ_FLG = 'Y' THEN 0 ELSE RMN_QTY END AS RMN_QTY 
                  , CASE WHEN RMN_QTY = 0 OR CLZ_FLG = 'Y' THEN 0 ELSE ROUND(RMN_AMT / RMN_QTY , 0) END AS RMN_PRC 
                  , CASE WHEN CLZ_FLG = 'Y' THEN 0 ELSE RMN_AMT END AS RMN_AMT 
                  , IN_RTE
                  , CLZ_FLG
                  , isCheckd
                  , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY PUR_DT, PUR_ORD_NO, ITM_CD) AS RN 
              FROM (         
                   SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.PUR_DT, PUR_CO_CD, T1.PUR_ORD_NO, T1.PUR_ORD_SEQ) AS RN 
                        , CONVERT(VARCHAR, T1.PUR_DT, 23) AS PUR_DT
                        , T1.PUR_ORD_NO      AS PUR_ORD_NO
                        , T1.PUR_ORD_SEQ     AS PUR_ORD_SEQ
                        , T1.PUR_CO_CD
                        , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.PUR_CO_CD)  AS PUR_CO_NM
                        , T1.ITM_CD
                        , T3.ITM_NM
                        , T3.ITM_SZ_NM 
                        , CONVERT(VARCHAR, T1.PUR_DUE_DT, 23) AS PUR_DUE_DT
                        , T1.PUR_QTY
                        , T1.PUR_PRC 
                        , T1.PUR_QTY * T1.PUR_PRC  AS PUR_AMT
                        , ISNULL(T1.IN_QTY, 0) AS IN_QTY
                        , ISNULL(T1.IN_AMT, 0) AS IN_AMT
                        , ISNULL(T1.PUR_QTY, 0) -ISNULL(T1.IN_QTY, 0)    AS RMN_QTY
                        , (ISNULL(T1.PUR_QTY, 0) -ISNULL(T1.IN_QTY, 0)) * T1.PUR_PRC   AS RMN_AMT
                        , ISNULL(CASE WHEN T1.PUR_QTY = 0 THEN 0 ELSE   (ISNULL(T1.IN_QTY, 0) / T1.PUR_QTY) * 100 END, 0) AS IN_RTE
                        , ISNULL(T4.ORD_CLZ_FLG, 'N') AS CLZ_FLG
                        , (CASE WHEN ISNULL(T4.ORD_CLZ_FLG, 'N') = 'Y' THEN 1 ELSE 0 END) AS isCheckd
                    FROM (      
                 SELECT T1.PUR_DT
                      , T1.PUR_ORD_NO
                      , T1.PUR_CO_CD
                      , T1.ITM_CD
                      , T1.PUR_DUE_DT
                      , T1.PUR_QTY
                      , T1.PUR_PRC
                      , T1.PUR_AMT
                      , T1.PUR_ORD_SEQ
                      , SUM(T2.IN_QTY) AS IN_QTY
                      , SUM(T2.IN_AMT) AS  IN_AMT                      
                FROM (
                        SELECT T1.PUR_DT
                              , T1.PUR_ORD_NO
                              , T1.PUR_CO_CD
                              , T2.ITM_CD
                              , T1.PUR_DUE_DT
                              , ISNULL(T2.PUR_QTY, 0)    AS PUR_QTY
                              , ISNULL(T2.CO_UT_PRC, 0)  AS PUR_PRC
                              , ISNULL(T2.PUR_AMT, 0)    AS PUR_AMT
                              , T2.PUR_ORD_SEQ
                              , T1.PUR_ORD_NO     AS INV_NO
                              , T2.PUR_ORD_SEQ    AS INV_SEQ
                          FROM TB_PUR_ORD         T1
                              , TB_PUR_ORD_DTL     T2
                          WHERE 1 = 1
                            AND T1.CHNL_CD    = #CHNL_CD#
                            AND T1.CHNL_CD    = T2.CHNL_CD
                            AND T1.PUR_ORD_NO = T2.PUR_ORD_NO
                            AND T1.PUR_CO_CD  = #CO_CD#
                            AND T1.PUR_DT    >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
                            AND T1.PUR_DT    <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
                        UNION ALL      
                          SELECT  IMP_CTRT_DT
                                , IMP_CTRT_NO
                                , IMP_CO_CD
                                , IMP_ITM_CD
                                , IMP_EXP_DT
                                , PUR_QTY
                                , PUR_PRC
                                , PUR_AMT       
                                , IMP_PUR_SEQ     
                                , IMP_INV_NO
                                , IMP_INV_SEQ
                          FROM (
                          SELECT  ROW_NUMBER() OVER (PARTITION BY T2.IMP_PUR_NO, T2.IMP_PUR_SEQ ORDER BY  T2.IMP_PUR_SEQ) AS RN 
                                , T1.IMP_CTRT_DT
                                , T2.IMP_PUR_NO  AS IMP_CTRT_NO
                                , T1.IMP_CO_CD
                                , T2.IMP_ITM_CD
                                , T1.IMP_EXP_DT
                                , ISNULL(T2.IMP_ITM_QTY, 0)         AS PUR_QTY
                                , T2.IMP_ITM_PRC * ISNULL(T1.IMP_XCH_RT, 1000)   AS PUR_PRC
                                , ISNULL(T2.IMP_ITM_AMT, 0)         AS PUR_AMT       
                                , T2.IMP_PUR_SEQ
                                , T3.IMP_INV_NO
                                , T3.IMP_INV_SEQ
                            FROM TB_PUR_IMP_CTRT      T1
                                , TB_PUR_IMP_CTRT_DTL  T2
                                  LEFT OUTER JOIN TB_PUR_IMP_INV_DTL  T3
                                  ON ( T3.CHNL_CD       = #CHNL_CD#
                                   AND T2.IMP_PUR_NO    = T3.IMP_PUR_NO
                                   AND T2.IMP_PUR_SEQ   = T3.IMP_PUR_SEQ )
                            WHERE 1 = 1
                              AND T1.CHNL_CD    = #CHNL_CD#
                              AND T1.CHNL_CD    = T2.CHNL_CD                              
                              AND T1.IMP_PUR_NO = T2.IMP_PUR_NO
                              AND T1.IMP_CO_CD  = #CO_CD#
                              AND T1.IMP_CTRT_DT    >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME) 
                              AND T1.IMP_CTRT_DT    <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)                      
                              ) T1
                          WHERE 1 = 1
                  ) T1   
                  LEFT OUTER JOIN TMP T2 ON (
                          T1.INV_NO   = T2.PUR_ORD_NO
                      AND T1.INV_SEQ  = T2.PUR_ORD_SEQ
                          )  
        GROUP BY T1.PUR_DT
              , T1.PUR_ORD_NO
              , T1.PUR_CO_CD
              , T1.ITM_CD
              , T1.PUR_DUE_DT
              , T1.PUR_QTY
              , T1.PUR_PRC
              , T1.PUR_AMT
              , T1.PUR_ORD_SEQ   
                ) T1 LEFT OUTER JOIN TB_PUR_CTRT_CLZ T4 ON (
                 1 = 1
                 AND T4.CHNL_CD      = #CHNL_CD#
                 AND T1.PUR_ORD_NO   = T4.ORD_NO
                 AND T1.PUR_ORD_SEQ  = T4.ORD_SEQ
                )               
                ,  TB_CD_ITM T3
            WHERE 1 = 1
              AND T3.CHNL_CD                 = #CHNL_CD#
              AND T1.ITM_CD                  = T3.ITM_CD
              AND ISNULL(T4.ORD_CLZ_FLG, 'N') LIKE 'N'
        ) T1      
        WHERE 1 = 1
        ) T1  
    </select>

    
    <!-- I6617 MST - 외주현황 -->
    <select id="I6617SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
        SELECT 
               T2.ITM_CD
             , T3.ITM_NM
             , T3.ITM_SZ_NM 
             , T4.ITM_NM      AS PRE_ITM_NM
             , T4.ITM_SZ_NM   AS PRE_ITM_SZ_NM
             , T1.CO_CD
             , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD) AS CO_NM 
             , CONVERT(VARCHAR, T1.INAUD_DT, 23) AS INAUD_DT
             , T2.INAUD_QTY   AS OUT_QTY
             , dbo.FF_INV_OUT_IN_QTY(T1.CHNL_CD,T2.INSRL_NO, T2.INSRL_SEQ) AS IN_QTY
             , T2.INAUD_QTY - dbo.FF_INV_OUT_IN_QTY(T1.CHNL_CD,T2.INSRL_NO, T2.INSRL_SEQ)  AS RMN_QTY
             , T2.CLZ_FLG
             , (CASE WHEN T2.CLZ_FLG = 'N' THEN 0 ELSE 1 END) AS isCheckd
             , T2.INSRL_NO
             , T2.INSRL_SEQ     
             , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T2.ITM_CD) AS RN              
          FROM TB_INAUD_MAST T1
             , TB_INAUD_DTL  T2
             , TB_CD_ITM     T3
             , TB_CD_ITM     T4
         WHERE 1 = 1
           AND T1.CHNL_CD     = #CHNL_CD#
           AND T1.CHNL_CD     = T2.CHNL_CD
           AND T1.CHNL_CD     = T3.CHNL_CD
           AND T1.CHNL_CD     = T4.CHNL_CD           
           AND T1.INSRL_NO    = T2.INSRL_NO 
           AND T2.ITM_CD      = T3.ITM_CD
           AND T2.ALTR_ITM_CD = T4.ITM_CD
           AND T2.INAUD_CD    = 'IGH'   
           AND T1.INAUD_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME) 
           AND T1.INAUD_DT   <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME) 
        <isNotNull property="CLZ_FLG">
           AND T2.CLZ_FLG     = #CLZ_FLG#
        </isNotNull>
    </select>
    
   <update id="I6617UpdateMst" parameterClass="ModelsLibrary.Inv.InvVo">
      UPDATE TB_INAUD_DTL
        SET
          UPD_USR_ID = #UPD_USR_ID#
        , UPD_DT = GETDATE()
        , CLZ_FLG = #CLZ_FLG#
        , INAUD_AMT = ROUND(INAUD_QTY * INAUD_PRC, 0)
      WHERE INSRL_NO = #INSRL_NO#
        AND INSRL_SEQ = #INSRL_SEQ#      
    </update>

    <!--
    <delete id="DeleteInudDtl" parameterClass="CpcErpServer.Service.Inv.Vo.InvVo">
      DELETE FROM TB_INAUD_DTL
      WHERE 1 = 1
        AND INSRL_NO = #INSRL_NO#
      <isNotNull property="INSRL_SEQ">
        AND INSRL_SEQ = #INSRL_SEQ#
      </isNotNull>
    </delete>  
    -->

	  <!-- I55121 MST - 가입고 현황 -->
	  <select id="I55121SelectMstList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
		  SELECT ROW_NUMBER()OVER (PARTITION BY NULL ORDER BY T1.INAUD_DT) AS RN  
		          , CONVERT(VARCHAR, T1.INAUD_DT , 23) AS INAUD_DT 
		          , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD)  AS CO_NM
		          , T1.PUR_ORD_NO 
		          , T1.PUR_ORD_SEQ
		          , T1.ITM_CD
		          , T2.ITM_NM
		          , T2.ITM_SZ_NM 
		          , T1.ITM_QTY 
		          , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD) AS UOM_NM 
		          , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'P-008', T1.LOC_CD) AS LOC_NM 
		          , T1.ITM_RMK 
		          , CASE WHEN T1.INSP_FLG = 'Y' THEN '합격'  WHEN T1.INSP_FLG = 'N' THEN '불합격' ELSE '검사 미진행' END AS INSP_FLG 
		          , T1.BATCH_CD 
		          , T1.INSP_NO
				     , CONVERT(VARCHAR, T1.INSP_DT , 23) AS INSP_DT 
				     , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-001', T2.ITM_GRP_CLSS_CD) AS ITM_GRP_CLSS_NM
		      FROM TB_INAUD_TMP T1
		            , TB_CD_ITM T2
		      WHERE 1 = 1
		      AND T1.CHNL_CD = T2.CHNL_CD
		      AND T1.CHNL_CD = #CHNL_CD#
		      AND T1.ITM_CD  = T2.ITM_CD
		  <isNotNull property="AREA_CD">
			  AND T1.AREA_CD   = #AREA_CD#
		  </isNotNull>
		  <isNotNull property="CO_CD">
			  AND T1.CO_CD     = #CO_CD#
		  </isNotNull>
		  <isNotNull property="FM_DT">
			  AND T1.INAUD_DT >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)
			  AND T1.INAUD_DT <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
		  </isNotNull>
	  </select>

	  
	  <!-- I55221 MST - 자재수불장 조회 -->
     <select id="I55221SelectList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
        SELECT 
               T1.ITM_CD       
             , T1.CO_CD        
             , T2.ITM_NM    
             , CONVERT(CHAR(10), T1.INAUD_DT, 23) AS INAUD_DT
             , T1.BAT_CD      
             , T1.MST_LOT_NO
             , T1.SER_NO       
             , T1.EXP_NO     
             , T1.ITM_QTY
             , T1.ITM_QTY - T4.O_QTY AS STK_QTY
             , T1.IO_CD        
          FROM TB_COM_INAUD_DTL T1
            CROSS APPLY ( SELECT ISNULL(SUM(X.ITM_QTY), 0)  AS O_QTY 
                 FROM TB_COM_INAUD_DTL X
                WHERE 1 = 1
                  AND X.ORD_NO  = T1.INSRL_NO
                  AND X.IO_CD   = 'O' ) T4   
             , TB_CD_ITM        T2
          WHERE 1=1
            AND T1.AREA_CD   = #AREA_CD#      
            AND T1.CHNL_CD   = #CHNL_CD#       
            AND T1.INAUD_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
            AND T1.INAUD_DT  <![CDATA[<=]]>  CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
            AND T1.CHNL_CD   = T2.CHNL_CD
            AND T1.ITM_CD    = T2.ITM_CD
            AND T1.CLZ_FLG   = 'N'
           ORDER BY T1.ITM_CD , T1.CO_CD , INAUD_DT
    </select>
	  
    
    <!-- I66201 - 재고장 조회 -->
     <select id="I66201SelectList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
        SELECT ROW_NUMBER() OVER (PARTITION BY T1.ITM_CD, T1.CO_CD ORDER BY T1.INAUD_DT) AS RN
          , T1.ITM_CD
          , T1.CO_CD
          , T3.CO_NM
          , T2.ITM_NM
          , CONVERT(VARCHAR, T1.INAUD_DT, 23) AS INAUD_DT
          , T1.BAT_CD
          , T1.MST_LOT_NO
          , T1.SER_NO
          , T1.EXP_NO
          , T1.ITM_QTY - T4.O_QTY AS STK_QTY
          , dbo.FF_ITM_AL_BAD_QTY(T1.CHNL_CD, T1.ITM_CD, T1.BAT_CD) AS BAD_QTY
          , 0 AS OUT_QTY
        FROM TB_COM_INAUD_DTL T1
          CROSS APPLY 
          (
            SELECT ISNULL(SUM(X.ITM_QTY), 0)  AS O_QTY
              FROM TB_COM_INAUD_DTL X
              WHERE 1 = 1
                AND X.ORD_NO  = T1.INSRL_NO
              AND X.IO_CD   = 'O'
          ) T4
        , TB_CD_ITM        T2
        , TB_CD_CO         T3
        WHERE 1 = 1
          AND T1.AREA_CD   = #AREA_CD#
          AND T1.CHNL_CD   = #CHNL_CD#
          AND T1.IO_CD     = 'I'
          AND T1.CHNL_CD   = T2.CHNL_CD
          AND T1.CHNL_CD   = T3.CHNL_CD
          AND T1.ITM_CD    = T2.ITM_CD
          AND T1.CO_CD     = T3.CO_NO
          AND T1.CLZ_FLG   = 'N'
      </select>
    
    

	  <!-- 편리사 입고 쿼리 -->
	  <select id="I66101SelectDtlPurList" resultClass="ModelsLibrary.Inv.InvVo" parameterClass="ModelsLibrary.Inv.InvVo">
		  SELECT
		        CHNL_CD
		      , RN
		      , PUR_ORD_NO
		      , PUR_ORD_SEQ
		      , N1ST_ITM_GRP_NM
		      , N2ND_ITM_GRP_NM
		      , CO_CD
		      , CO_NM
		      , ITM_CD
		      , ITM_NM
		      , N1ST_ITM_SZ_NM
		      , N2ND_ITM_SZ_NM
		      , ITM_SZ_NM
		      , BSS_WGT
		      , UOM_NM
		      , ITM_QTY        AS TMP_RMK_QTY
		      , PUR_QTY
		      , PUR_QTY * 500  AS PUR_ITM_QTY
		      , ITM_MD_QTY
		      , RMN_QTY
		      , CO_UT_PRC
		      , DC_RT
		      , PUR_AMT    
		      , PUR_RMK
		      , ITM_QTY
		      , ITM_QTY * 500       AS IN_PUR_ITM_QTY
		      , INAUD_ORG_NO
		      , INAUD_ORG_NM
		      , CLZ_FLG
		  FROM (
		        SELECT  ROW_NUMBER() OVER (PARTITION BY T1.AREA_CD ORDER BY T3.N1ST_ITM_GRP_CD, T3.ITM_CD, T1.PUR_DT ) AS RN
		              , T1.CHNL_CD
		              , T2.PUR_ORD_NO
		              , T2.PUR_ORD_SEQ
		              , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD)                    AS N1ST_ITM_GRP_NM
		              , dbo.PUR_N2ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD,  N2ND_ITM_GRP_CD)  AS N2ND_ITM_GRP_NM
		              , T1.PUR_CO_CD                         AS CO_CD
		              , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.PUR_CO_CD)  AS CO_NM
		              , T3.ITM_CD
		              , T3.ITM_NM
		              , T2.N1ST_ITM_SZ_NM
		              , T2.N2ND_ITM_SZ_NM
		              , T2.N1ST_ITM_SZ_NM + '*' + T2.N2ND_ITM_SZ_NM AS ITM_SZ_NM
		              , T2.BSS_WGT
		              , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD) AS UOM_NM   
		              , T2.PUR_QTY
		              , (T2.PUR_QTY * T2.BUN_WGT)  AS ITM_MD_QTY
		              , 0 AS RMN_QTY
		              , T2.CO_UT_PRC
		              , T2.DC_RT
		              , T2.PUR_AMT
		              , T2.PUR_ITM_RMK AS PUR_RMK
		              , (T2.PUR_QTY  - ISNULL(dbo.FF_INV_ORD_QTY(T1.CHNL_CD, T2.PUR_ORD_NO, T2.PUR_ORD_SEQ), 0))  AS ITM_QTY
		              , '300' AS INAUD_ORG_NO
		              , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'P-008', '300') AS INAUD_ORG_NM
		              , T2.CLZ_FLG
		          FROM TB_PUR_ORD         T1
		             , TB_PUR_ORD_DTL      T2
		             , TB_CD_ITM           T3
		         WHERE 1 = 1
		           AND T1.CHNL_CD    = #CHNL_CD#
		           AND T1.CHNL_CD    = T2.CHNL_CD
		           AND T1.CHNL_CD    = T3.CHNL_CD
		           AND T1.PUR_ORD_NO = T2.PUR_ORD_NO
		           AND T2.ITM_CD     = T3.ITM_CD
		           AND T2.PUR_QTY  - ISNULL(dbo.FF_INV_ORD_QTY( #CHNL_CD# , T2.PUR_ORD_NO, T2.PUR_ORD_SEQ), 0)  > 0
		           AND T1.PUR_CLZ_FLG = 'N'
		           AND T1.PUR_DT   >= CAST(#FM_DT#+ ' 00:00:00' AS DATETIME)
		           AND T1.PUR_DT  <![CDATA[<=]]> CAST(#TO_DT#+ ' 23:59:59' AS DATETIME)
		           AND T2.CLZ_FLG = 'N'
		           AND NOT EXISTS (SELECT 'X'
		                              FROM TB_PUR_CTRT_CLZ  X
		                             WHERE 1 = 1
		                               AND X.CHNL_CD   = T1.CHNL_CD
		                               AND X.ORD_NO    = T2.PUR_ORD_NO
		                               AND X.ORD_SEQ   = T2.PUR_ORD_SEQ
		                              )
		      <isNotNull property="CO_NO">
			      AND T1.PUR_CO_CD   = #CO_NO#
		      </isNotNull>
		  ) T1
		  ORDER BY RN
	  </select>

	  <insert id="I66101InsertPurMst" parameterClass="ModelsLibrary.Inv.InvVo">
		  INSERT INTO TB_INAUD_TMP
		  (
		  INAUD_TMP_NO
		  , INAUD_TMP_SEQ
		  , INAUD_DT
		  , AREA_CD
		  , PUR_ORD_NO
		  , PUR_ORD_SEQ
		  , CO_CD
		  , LOC_CD
		  , ITM_CD
		  , ITM_QTY
		  , ITM_RMK
		  , CRE_USR_ID
		  , CRE_DT
		  , UPD_USR_ID
		  , UPD_DT
		  , ITM_PRC
		  , ITM_AMT
		  , CHNL_CD
		  , N1ST_ITM_SZ_NM
		  , N2ND_ITM_SZ_NM
		  )
		  SELECT
		  #INAUD_TMP_NO#
		  , ISNULL((SELECT MAX(INAUD_TMP_SEQ) + 1
		  FROM TB_INAUD_TMP
		  WHERE INAUD_TMP_NO = #INAUD_TMP_NO# AND CHNL_CD = #CHNL_CD#
		  ), 1)
		  , GETDATE()
		  , #AREA_CD#
		  , #PUR_ORD_NO#
		  , #PUR_ORD_SEQ#
		  , #CO_CD#
		  , #LOC_CD#
		  , #ITM_CD#
		  , #ITM_QTY#
		  , #ITM_RMK#
		  , #CRE_USR_ID# 
		  , GETDATE()
		  , #UPD_USR_ID#
		  , GETDATE()
		  , #CO_UT_PRC#
		  , ROUND(#ITM_QTY#  * #CO_UT_PRC#, 0)
		  , #CHNL_CD#
		  , #N1ST_ITM_SZ_NM#
		  , #N2ND_ITM_SZ_NM#
	  </insert>

	  <delete id="I66101DeleteMst" parameterClass="ModelsLibrary.Inv.InvVo" >
		  DELETE FROM TB_INAUD_TMP
		  WHERE 1=1
		  AND CHNL_CD      = #CHNL_CD#
		  AND INAUD_TMP_NO  = #INAUD_TMP_NO#
		  AND INAUD_TMP_SEQ = #INAUD_TMP_SEQ#
	  </delete>


	  <!--발주 입고 - CO_UT_PRC 단가-->
	  <select id="I66101SelectCoUtPrc" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
		  SELECT TOP 1 CONVERT(NUMERIC(13, 4), (CONVERT(NUMERIC(13, 4), #N1ST_ITM_SZ_NM#) * CONVERT(NUMERIC(13, 4), #N2ND_ITM_SZ_NM#) * #BSS_WGT#)/1000000000 * WGT_PER_PRC * 500) AS CO_UT_PRC
		    FROM TB_CD_CO_PPR_PRC_DTL T1
		       <!--, MV_TB_CD_ITM       T2-->
		   WHERE 1 = 1
		     <!--AND T1.CHNL_CD         = T2.CHNL_CD-->
		     <!--AND T1.N2ND_ITM_GRP_CD = T2.N2ND_ITM_GRP_NM-->
		     AND T1.CHNL_CD         = #CHNL_CD#
			 AND T1.N2ND_ITM_GRP_CD = #N2ND_ITM_GRP_NM#
		     AND T1.BSS_WGT         = #BSS_WGT#
	  </select>

	  <select id="I66101SelectNo" resultClass="string">
		  SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'ST', #AREA_CD#) AS LST_FMT_NO FROM CPY_T WHERE NO = 1
	  </select>
	  
	  <update id="I66101UpdateNo" parameterClass="ModelsLibrary.Inv.InvVo">
		  UPDATE TB_SYS_NO_FMT
		     SET LST_FMT_NO = #INAUD_TMP_NO#
	 	   WHERE 1 = 1
		     AND CHNL_CD   = #CHNL_CD#
		     AND TBL_ID    = 'ST'
		     AND AREA_CD   = #AREA_CD#
	  </update>

	  <update id="I66101UpdateNo_2" parameterClass="ModelsLibrary.Inv.InvVo">
		  UPDATE TB_PUR_ORD_DTL
		  SET CLZ_FLG = 'Y'
		  WHERE 1 = 1
		  AND CHNL_CD     =  #CHNL_CD#
		  AND PUR_ORD_NO  =  #PUR_ORD_NO#
		  AND PUR_ORD_SEQ =  #PUR_ORD_SEQ#
	  </update>

     <!--품목그룹별 대그룹 재고장 조회-->
     <select id="I6621SelectMstList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
        SELECT  T2.N1ST_ITM_GRP_CD
              , T3.N1ST_ITM_GRP_NM
              , SUM(T1.ITM_QTY)        AS N1ST_ITM_QTY
              , ROUND(SUM(T1.ITM_QTY * ISNULL(T2.UOM_RUN_WGT, 0)), 0)  AS N1ST_ITM_WGT
              , #CHNL_CD# AS CHNL_CD
          FROM  TB_INVT_DLY_STK  T1
              , TB_CD_ITM        T2
        OUTER APPLY (
            SELECT ITM_GRP_NM     AS N1ST_ITM_GRP_NM
              FROM TB_CD_ITM_GRP  X
             WHERE 1 = 1
               AND X.CHNL_CD          = #CHNL_CD#
               AND X.ITM_GRP_CLSS_CD  = 'M'
               AND X.PRNT_ITM_GRP_CD  = 'T'
               AND X.DELT_FLG         = 'N'
               AND X.ITM_GRP_CD       = T2.N1ST_ITM_GRP_CD
            ) T3
         WHERE 1 = 1
           AND T1.CHNL_CD         = #CHNL_CD#
           AND T1.CHNL_CD         = T2.CHNL_CD
           AND T1.ITM_CD          = T2.ITM_CD
           AND T2.ITM_GRP_CLSS_CD = 'M'
        GROUP BY T2.N1ST_ITM_GRP_CD
               , T3.N1ST_ITM_GRP_NM
	    ORDER BY T2.N1ST_ITM_GRP_CD
     </select>
	  
     <!--품목그룹별 중그룹 재고장 조회-->
      <select id="I6621SelectDtlList" parameterClass="ModelsLibrary.Inv.InvVo" resultClass="ModelsLibrary.Inv.InvVo">
        SELECT T2.N2ND_ITM_GRP_CD
             , T3.N2ND_ITM_GRP_NM
             , SUM(T1.ITM_QTY) AS N2ND_ITM_QTY
             , ROUND(SUM(T1.ITM_QTY * ISNULL(T2.UOM_RUN_WGT, 0)), 0)  AS N2ND_ITM_WGT
          FROM TB_INVT_DLY_STK  T1
             , TB_CD_ITM        T2
        OUTER APPLY (
            SELECT ITM_GRP_NM     AS N2ND_ITM_GRP_NM
              FROM TB_CD_ITM_GRP  X
             WHERE 1 = 1
               AND X.CHNL_CD          = #CHNL_CD#
               AND X.ITM_GRP_CLSS_CD  = 'M'
               AND X.PRNT_ITM_GRP_CD  <![CDATA[<>]]> 'T'
               AND X.DELT_FLG         = 'N'
               AND X.ITM_GRP_CD       = T2.N2ND_ITM_GRP_CD
            ) T3
         WHERE 1 = 1
           AND T1.CHNL_CD         = #CHNL_CD#
           AND T1.CHNL_CD         = T2.CHNL_CD
           AND T1.ITM_CD          = T2.ITM_CD
           AND T2.ITM_GRP_CLSS_CD = 'M'
           AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#
         GROUP BY T2.N2ND_ITM_GRP_CD
                , T3.N2ND_ITM_GRP_NM
	     ORDER BY T2.N2ND_ITM_GRP_CD
     </select>
	  
  </statements>
</sqlMap>