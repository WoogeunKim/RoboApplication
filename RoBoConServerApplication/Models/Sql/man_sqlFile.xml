<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="man" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <statements>
    <!-- 표준 공정 관리  -->
     <select id="M6611SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT 
              ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY ROUT_ORD_SEQ) AS RN
            , ROUT_ORD_SEQ
            , ROUT_CD
            , SUB_CD
            , ROUT_NM
            , ROUT_MV_CTNT
            , CHNL_CD
			, ROUT_PRC
        FROM TB_PROD_ROUT
         WHERE CHNL_CD = #CHNL_CD#
        <isNotNull property="ROUT_CD" >
            AND ROUT_CD = #ROUT_CD#
        </isNotNull>
    </select>

    <insert id="M6611InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_PROD_ROUT (
            ROUT_ORD_SEQ
          , ROUT_CD
          , SUB_CD
          , ROUT_NM
          , ROUT_MV_CTNT
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , CHNL_CD
		  , ROUT_PRC
      ) VALUES (
            #ROUT_ORD_SEQ#
          , #ROUT_CD#
          , #SUB_CD#
          , #ROUT_NM#
          , #ROUT_MV_CTNT#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          , #CHNL_CD#
		  , #ROUT_PRC#
      )
    </insert>

    <update id="M6611UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_ROUT
       SET ROUT_ORD_SEQ = #ROUT_ORD_SEQ#
         , SUB_CD       = #SUB_CD#
         , ROUT_NM      = #ROUT_NM#
         , ROUT_MV_CTNT = #ROUT_MV_CTNT#
		 , ROUT_PRC     = #ROUT_PRC#
         , UPD_USR_ID   = #UPD_USR_ID#
         , UPD_DT       = GETDATE()
     WHERE 1 = 1
       AND CHNL_CD = #CHNL_CD#
       AND ROUT_CD = #ROUT_CD#
    </update>
    
    <delete id="M6611DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_ROUT
        WHERE 1 = 1
         AND CHNL_CD = #CHNL_CD#
         AND ROUT_CD = #ROUT_CD#
    </delete>
    
    
    <!-- 설비 관리  -->
    <select id="M6622SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT 
           ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY PROD_EQ_NO) AS RN
         , PROD_EQ_NO
         , EQ_MDL_NM
         , EQ_NM
         , EQ_SZ_NM
         , MN_MTR_CSM_CTNT
         , EQ_QTY
         , EQ_MKR_NM
         , EQ_PUR_AMT
         , EQ_PUR_YRMON
         , EQ_GRD_CD
         , BALL_STAR_AREA_CTNT
         , USG_DESC
         , EQ_LOC_CD
         , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'L-002', EQ_LOC_CD) AS EQ_LOC_NM
         , EQ_DESC
         , CHNL_CD
         , CONVERT(VARCHAR, INSP_DT, 23) AS INSP_DT
         , EQ_IMG
         , EQ_SNOR_NO
         , EQ_SNOR_IMG
         , EQ_TP_CD
         , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'L-700', EQ_TP_CD) AS EQ_TP_NM
      FROM TB_PROD_EQ
       WHERE CHNL_CD = #CHNL_CD#  
        <isNotNull property="PROD_EQ_NO" >
            AND PROD_EQ_NO = #PROD_EQ_NO#
        </isNotNull>
        <isNotNull property="EQ_TP_CD" >
            AND EQ_TP_CD = #EQ_TP_CD#
        </isNotNull>
    </select>

    <insert id="M6622InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
       INSERT INTO TB_PROD_EQ (
           PROD_EQ_NO
         , EQ_MDL_NM
         , EQ_NM
         , EQ_SZ_NM
         , MN_MTR_CSM_CTNT
         , EQ_QTY
         , EQ_MKR_NM
         , EQ_PUR_AMT
         , EQ_PUR_YRMON
         , EQ_GRD_CD
         , BALL_STAR_AREA_CTNT
         , USG_DESC
         , EQ_LOC_CD
         , EQ_DESC
         , CRE_USR_ID
         , CRE_DT
         , UPD_USR_ID
         , UPD_DT
         , CHNL_CD
         , INSP_DT
         , EQ_IMG
         , EQ_SNOR_NO
         , EQ_SNOR_IMG
         , EQ_TP_CD
      ) VALUES (
          #PROD_EQ_NO#
         ,#EQ_MDL_NM#
         ,#EQ_NM#
         ,#EQ_SZ_NM#
         ,#MN_MTR_CSM_CTNT#
         ,#EQ_QTY#
         ,#EQ_MKR_NM#
         ,#EQ_PUR_AMT#
         ,#EQ_PUR_YRMON#
         ,#EQ_GRD_CD#
         ,#BALL_STAR_AREA_CTNT#
         ,#USG_DESC#
         ,#EQ_LOC_CD#
         ,#EQ_DESC#
         ,#CRE_USR_ID#
         ,GETDATE()
         ,#UPD_USR_ID#
         ,GETDATE()  
         ,#CHNL_CD#
         ,#INSP_DT#
         ,#EQ_IMG#
         ,#EQ_SNOR_NO#
         ,#EQ_SNOR_IMG#
         ,#EQ_TP_CD#
      )
    </insert>

    <update id="M6622UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
        UPDATE TB_PROD_EQ
         SET    EQ_MDL_NM            = #EQ_MDL_NM#
              , EQ_NM                = #EQ_NM#
              , EQ_SZ_NM             = #EQ_SZ_NM#
              , MN_MTR_CSM_CTNT      = #MN_MTR_CSM_CTNT#
              , EQ_QTY               = #EQ_QTY#
              , EQ_MKR_NM            = #EQ_MKR_NM#
              , EQ_PUR_AMT           = #EQ_PUR_AMT#
              , EQ_PUR_YRMON         = #EQ_PUR_YRMON#
              , EQ_GRD_CD            = #EQ_GRD_CD#
              , BALL_STAR_AREA_CTNT  = #BALL_STAR_AREA_CTNT#
              , USG_DESC             = #USG_DESC#
              , EQ_LOC_CD            = #EQ_LOC_CD#
              , EQ_DESC              = #EQ_DESC#
              , UPD_USR_ID           = #UPD_USR_ID#
              , UPD_DT               = GETDATE()
              , INSP_DT              = #INSP_DT#
              , EQ_IMG               = #EQ_IMG#
              , EQ_SNOR_NO           = #EQ_SNOR_NO#
              , EQ_SNOR_IMG          = #EQ_SNOR_IMG#
              , EQ_TP_CD             = #EQ_TP_CD#
       WHERE 1 = 1
         AND PROD_EQ_NO = #PROD_EQ_NO#
         AND CHNL_CD = #CHNL_CD#
    </update>
    
    <delete id="M6622DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_EQ
        WHERE 1 = 1
          AND PROD_EQ_NO = #PROD_EQ_NO#
          AND CHNL_CD = #CHNL_CD#
    </delete>
    
    
    
     <!-- 계측기 관리  -->
    <select id="M6626SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT  
        ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY INSRT_MGMT_NO) AS RN
      , CHNL_CD
      , INSRT_MGMT_NO
      , INSRT_NM
      , INSRT_SZ
      , SER_NO
      , MAKE_CO_NM
      , PUR_CO_NM
      , CONVERT(VARCHAR, PUR_DT, 23) AS PUR_DT
      , INSRT_FX_RMK
      , CONVERT(VARCHAR, INSRT_FX_DT, 23) AS INSRT_FX_DT
      , CONVERT(VARCHAR, INSRT_NXT_FX_DT, 23) AS INSRT_NXT_FX_DT
      , INSRT_USE_LOC_RMK
      , INSRT_RMK
      , INSRT_IMG
     FROM  TB_INSRT_MGMT_LEGR
      WHERE CHNL_CD       = #CHNL_CD#
      <isNotNull property="INSRT_MGMT_NO" >
        AND INSRT_MGMT_NO = #INSRT_MGMT_NO#
      </isNotNull>
    </select>

    <insert id="M6626InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
       INSERT INTO TB_INSRT_MGMT_LEGR
        (
            CHNL_CD
          , INSRT_MGMT_NO
          , INSRT_NM
          , INSRT_SZ
          , SER_NO
          , MAKE_CO_NM
          , PUR_CO_NM
          , PUR_DT
          , INSRT_FX_RMK
          , INSRT_FX_DT
          , INSRT_NXT_FX_DT
          , INSRT_USE_LOC_RMK
          , INSRT_RMK
          , INSRT_IMG
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
        )
        VALUES
        (
            #CHNL_CD#
          , #INSRT_MGMT_NO#
          , #INSRT_NM#
          , #INSRT_SZ#
          , #SER_NO#
          , #MAKE_CO_NM#
          , #PUR_CO_NM#
          , #PUR_DT#
          , #INSRT_FX_RMK#
          , #INSRT_FX_DT#
          , #INSRT_NXT_FX_DT#
          , #INSRT_USE_LOC_RMK#
          , #INSRT_RMK#
          , #INSRT_IMG#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
         )
    </insert>

    <update id="M6626UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
        UPDATE TB_INSRT_MGMT_LEGR
          SET
              INSRT_NM      = #INSRT_NM#
            , INSRT_SZ      = #INSRT_SZ#
            , SER_NO        = #SER_NO#
            , MAKE_CO_NM    = #MAKE_CO_NM#
            , PUR_CO_NM     = #PUR_CO_NM#
            , PUR_DT        = #PUR_DT#
            , INSRT_FX_RMK  = #INSRT_FX_RMK#
            , INSRT_FX_DT   = #INSRT_FX_DT#
            , INSRT_NXT_FX_DT = #INSRT_NXT_FX_DT#
            , INSRT_USE_LOC_RMK = #INSRT_USE_LOC_RMK#
            , INSRT_RMK     = #INSRT_RMK#
            , INSRT_IMG     = #INSRT_IMG#
            , UPD_USR_ID    = #UPD_USR_ID#
            , UPD_DT        = GETDATE() 
        WHERE CHNL_CD       = #CHNL_CD#
          AND INSRT_MGMT_NO = #INSRT_MGMT_NO#
    </update>
    
    <delete id="M6626DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_INSRT_MGMT_LEGR
        WHERE 1 = 1
          AND INSRT_MGMT_NO = #INSRT_MGMT_NO#
          AND CHNL_CD = #CHNL_CD#
    </delete>
    
    
     <!-- 인원 자격 관리     -->
    <select id="M6627SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT 
          ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY CERTI_NO) AS RN
        , CHNL_CD
        , CERTI_USR_ID
        , dbo.USR_NM_FNC(CHNL_CD, CERTI_USR_ID) AS CERTI_USR_NM
        , (SELECT  dbo.FF_GRP_NM_FNC(T1.CHNL_CD, X.GRP_ID) FROM TB_SYS_USR X WHERE 1 = 1 AND X.USR_ID = T1.CERTI_USR_ID AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N' ) AS GRP_NM
        , (SELECT  dbo.CD_SYS_CLSS_FNC(X.CHNL_CD, 'G-001', X.OFC_PSN_CD) FROM TB_SYS_USR X WHERE 1 = 1 AND X.USR_ID = T1.CERTI_USR_ID AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N' ) AS OFC_PSN_NM
        , (SELECT  CONVERT(VARCHAR, X.JOIN_CO_DT, 23) FROM TB_SYS_USR X WHERE 1 = 1 AND X.USR_ID = T1.CERTI_USR_ID AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N' ) AS JOIN_CO_DT
        , CERTI_PSN_RMK
        , CERTI_NO
        , CERTI_GRD_CD
        , CONVERT(VARCHAR, CERTI_DT, 23) AS CERTI_DT
        , CONVERT(VARCHAR, CERTI_NXT_DT, 23) AS CERTI_NXT_DT
        , CERTI_YR
        , CERTI_RMK
        , CERTI_IMG
      FROM TB_HR_CERTI_MGMT T1
        WHERE CHNL_CD       = #CHNL_CD#
        <isNotNull property="CERTI_NO" >
          AND CERTI_NO = #CERTI_NO#
        </isNotNull>
    </select>

    <insert id="M6627InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_HR_CERTI_MGMT
      (
          CHNL_CD
        , CERTI_USR_ID
        , CERTI_PSN_RMK
        , CERTI_NO
        , CERTI_GRD_CD
        , CERTI_DT
        , CERTI_NXT_DT
        , CERTI_YR
        , CERTI_RMK
        , CERTI_IMG
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      )
      VALUES
      (
          #CHNL_CD#
        , #CERTI_USR_ID#
        , #CERTI_PSN_RMK#
        , #CERTI_NO#
        , #CERTI_GRD_CD#
        , #CERTI_DT#
        , #CERTI_NXT_DT#
        , #CERTI_YR#
        , #CERTI_RMK#
        , #CERTI_IMG#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>

    <update id="M6627UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
         UPDATE TB_HR_CERTI_MGMT
           SET
             CERTI_PSN_RMK  = #CERTI_PSN_RMK#
            ,CERTI_USR_ID   = #CERTI_USR_ID#
            ,CERTI_GRD_CD   = #CERTI_GRD_CD#
            ,CERTI_DT       = #CERTI_DT#
            ,CERTI_NXT_DT   = #CERTI_NXT_DT#
            ,CERTI_YR       = #CERTI_YR#
            ,CERTI_RMK      = #CERTI_RMK#
            ,CERTI_IMG      = #CERTI_IMG#
            ,UPD_USR_ID     = #UPD_USR_ID#
            ,UPD_DT         = GETDATE() 
          WHERE CHNL_CD     = #CHNL_CD#
            AND CERTI_NO = #CERTI_NO#
    </update>
    
    <delete id="M6627DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_HR_CERTI_MGMT
        WHERE 1 = 1
          AND CERTI_NO = #CERTI_NO#
          AND CHNL_CD = #CHNL_CD#
    </delete>
    
    
    
    <!-- 계측기 검교정 계획서 관리  -->
    <select id="M6628SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT
          ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.INSRT_MGMT_NO) AS RN
        , T1.CHNL_CD
        , T1.INSRT_MGMT_NO
        , T1.INSRT_NM
        , T1.INSRT_SZ
        , T1.SER_NO
        , T1.MAKE_CO_NM
        , T1.PUR_CO_NM
        , '12개월' AS PUR_DT
        , T1.INSRT_FX_RMK
        , CONVERT(VARCHAR, T1.INSRT_FX_DT, 23) AS INSRT_FX_DT
        , CONVERT(VARCHAR, T1.INSRT_NXT_FX_DT, 23) AS INSRT_NXT_FX_DT
        , T1.INSRT_USE_LOC_RMK
        , T1.INSRT_RMK
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '01' ) AS MM_01
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '02' ) AS MM_02
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '03' ) AS MM_03
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '04' ) AS MM_04
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '05' ) AS MM_05
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '06' ) AS MM_06
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '07' ) AS MM_07
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '08' ) AS MM_08
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '09' ) AS MM_09
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '10' ) AS MM_10
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '11' ) AS MM_11
        , (SELECT X.INSRT_MGMT_CD FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND X.INSRT_MGMT_YRMON = #FM_DT# + '12' ) AS MM_12
        , (SELECT MAX(X.INSRT_MGMT_RMK) FROM TB_INSRT_MGMT_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD AND X.INSRT_MGMT_NO = T1.INSRT_MGMT_NO AND SUBSTRING(X.INSRT_MGMT_YRMON, 1, 4) = #FM_DT#) AS MM_RMK
      FROM TB_INSRT_MGMT_LEGR  AS T1
          WHERE 1 = 1
            AND T1.CHNL_CD = #CHNL_CD#
    </select>
    
    <insert id="M6628InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_INSRT_MGMT_PLN
      (
          CHNL_CD
        , INSRT_MGMT_NO
        , INSRT_MGMT_YRMON
        , INSRT_MGMT_CD
        , INSRT_MGMT_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      )
      VALUES
      (
          #CHNL_CD#
        , #INSRT_MGMT_NO#
        , #INSRT_MGMT_YRMON#
        , #INSRT_MGMT_CD#
        , #INSRT_MGMT_RMK#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <delete id="M6628DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_INSRT_MGMT_PLN
       WHERE 1=1
          AND CHNL_CD          = #CHNL_CD#
          AND INSRT_MGMT_NO    = #INSRT_MGMT_NO# 
        <isNotNull property="INSRT_MGMT_YRMON" >
          AND INSRT_MGMT_YRMON = #INSRT_MGMT_YRMON#
        </isNotNull>
    </delete>
    
    
    <!-- 칭량 BOM 관리  -->
    <select id="M6623SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT T1.BSE_WEIH_VAL
             , T1.ASSY_ITM_CD
             , T2.ITM_NM
             , T1.CHNL_CD  
          FROM TB_PROD_WEIH_TBL T1
             , TB_CD_ITM T2
         WHERE 1 = 1
           AND T1.CHNL_CD     = #CHNL_CD#  
           AND T1.CHNL_CD     = T2.CHNL_CD
           AND T1.ASSY_ITM_CD = T2.ITM_CD
        <isNotNull property="ITM_GRP_CLSS_CD" > 
           AND T2.ITM_GRP_CLSS_CD = #ITM_GRP_CLSS_CD#
        </isNotNull>
        <isNotNull property="N1ST_ITM_GRP_CD" >
           AND T2.N1ST_ITM_GRP_CD = #N1ST_ITM_GRP_CD#   
        </isNotNull>
        GROUP BY T1.BSE_WEIH_VAL, T1.ASSY_ITM_CD, T2.ITM_NM, T1.CHNL_CD
          ORDER BY T1.ASSY_ITM_CD
    </select>
    
    <select id="M6623SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT 
             ROW_NUMBER() OVER (PARTITION BY ASSY_ITM_CD ORDER BY ASSY_ITM_SEQ) AS RN
           , T1.BSE_WEIH_VAL
           , T1.ASSY_ITM_CD
           , T2.ITM_NM
           , T1.ASSY_ITM_SEQ
           , T1.CMPO_CD
           , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.CMPO_CD) AS CMPO_NM
           <!--
           , (SELECT dbo.PUR_N1ST_GRP_NM_FNC(X.CHNL_CD, X.ITM_GRP_CLSS_CD, X.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM  FROM TB_CD_ITM AS X WHERE 1=1 AND X.ITM_CD = T1.CMPO_CD)  AS MM_01
           -->
           , T1.WEIH_VAL
           , T2.MAX_TOR_VAL
           , T2.MIN_TOR_VAL
           , T1.CMPO_RMK
           , T2.ITM_GRP_CLSS_CD
           , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-001', T2.ITM_GRP_CLSS_CD) AS ITM_GRP_CLSS_NM   
           , T2.N1ST_ITM_GRP_CD
           , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD, T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM 
           , T1.CHNL_CD
		   , T1.CMPO_TOR_VAL
		   , T1.ORD_CLS_CD
        FROM TB_PROD_WEIH_TBL T1
           , TB_CD_ITM T2
       WHERE 1 = 1
         AND T1.CHNL_CD         = #CHNL_CD#  
         AND T1.CHNL_CD         = T2.CHNL_CD
         AND T1.ASSY_ITM_CD     = T2.ITM_CD
        <isNotNull property="ASSY_ITM_CD" >
         AND T1.ASSY_ITM_CD     = #ASSY_ITM_CD#
        </isNotNull>
        <isNotNull property="BSE_WEIH_VAL" >
         AND T1.BSE_WEIH_VAL    = #BSE_WEIH_VAL#
        </isNotNull>
        <isNotNull property="ASSY_ITM_SEQ" >
         AND T1.ASSY_ITM_SEQ    = #ASSY_ITM_SEQ#
        </isNotNull>
    </select>
    
     <insert id="M6623InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
       INSERT INTO TB_PROD_WEIH_TBL (
          CHNL_CD
        , ASSY_ITM_CD
        , BSE_WEIH_VAL
        , ASSY_ITM_SEQ
        , CMPO_CD
        , WEIH_VAL
        , CMPO_RMK
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
		, CMPO_TOR_VAL
		, ORD_CLS_CD
       ) VALUES (
          #CHNL_CD#
        , #ASSY_ITM_CD#
        , #BSE_WEIH_VAL#
        , #ASSY_ITM_SEQ#
        , #CMPO_CD#
        , #WEIH_VAL#
        , #CMPO_RMK#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
		, #CMPO_TOR_VAL#
		, #ORD_CLS_CD#
       )
    </insert>

    <update id="M6623UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
       UPDATE TB_PROD_WEIH_TBL
         SET 	
		      CMPO_CD	    = #CMPO_CD#   
            , WEIH_VAL      = #WEIH_VAL#  
            , CMPO_RMK      = #CMPO_RMK#  
            , UPD_DT        = GETDATE()  
            , UPD_USR_ID    = #UPD_USR_ID#
			, CMPO_TOR_VAL  = #CMPO_TOR_VAL#
			, ORD_CLS_CD    = #ORD_CLS_CD#
          <isNotNull property="RN" >
            , ASSY_ITM_SEQ  = #RN#
           </isNotNull>
       WHERE CHNL_CD      = #CHNL_CD#
         AND ASSY_ITM_CD  = #ASSY_ITM_CD#
         AND BSE_WEIH_VAL = #BSE_WEIH_VAL#
         AND ASSY_ITM_SEQ = #ASSY_ITM_SEQ#
    </update>
    
    <delete id="M6623DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_WEIH_TBL
        WHERE CHNL_CD     = #CHNL_CD#
         AND ASSY_ITM_CD  = #ASSY_ITM_CD#
         AND BSE_WEIH_VAL = #BSE_WEIH_VAL#
        <isNotNull property="ASSY_ITM_SEQ" >
         AND ASSY_ITM_SEQ = #ASSY_ITM_SEQ#
        </isNotNull>
    </delete>
    
    
    <!-- 포장 코드 관리 -->
    <select id="M6625SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY PCK_PLST_CD) AS RN
         , CHNL_CD
         , PCK_PLST_CLSS_CD     
         , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'M-009', PCK_PLST_CLSS_CD) AS PCK_PLST_CLSS_NM
         , PCK_PLST_CD     
         , PCK_PLST_NM
         , PCK_PLST_VAL
         , CONVERT(VARCHAR, CRE_DT, 23) AS CRE_DT
      FROM TB_CD_PCK_PLST
      WHERE CHNL_CD = #CHNL_CD#
        <isNotNull property="ITM_GRP_CLSS_CD" > 
          AND PCK_PLST_CLSS_CD = #PCK_PLST_CLSS_CD#
        </isNotNull>
        <isNotNull property="PCK_PLST_CD" > 
          AND PCK_PLST_CD = #PCK_PLST_CD#
        </isNotNull>
    </select>
    
     <insert id="M6625InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
       INSERT INTO TB_CD_PCK_PLST 
       (
            CHNL_CD
          , PCK_PLST_CLSS_CD
          , PCK_PLST_CD
          , PCK_PLST_NM
          , PCK_PLST_VAL
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
       )  
        VALUES
       (
		    #CHNL_CD#
          , #PCK_PLST_CLSS_CD#
          , #PCK_PLST_CD#
          , #PCK_PLST_NM#
          , #PCK_PLST_VAL#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
       )
    </insert>

    <update id="M6625UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
       UPDATE TB_CD_PCK_PLST
        SET PCK_PLST_NM		= #PCK_PLST_NM# 
          , PCK_PLST_VAL  = #PCK_PLST_VAL#
          , UPD_USR_ID    = #UPD_USR_ID#  
          , UPD_DT        = GETDATE()     
       WHERE CHNL_CD  = #CHNL_CD#
         AND PCK_PLST_CLSS_CD = #PCK_PLST_CLSS_CD#
         AND PCK_PLST_CD = #PCK_PLST_CD#
    </update>
    
    <delete id="M6625DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_CD_PCK_PLST
       WHERE CHNL_CD  = #CHNL_CD#
         AND PCK_PLST_CLSS_CD = #PCK_PLST_CLSS_CD#
         AND PCK_PLST_CD = #PCK_PLST_CD#
    </delete>



	 <!-- 칭량 작업 계획 -->
	 <select id="M6630SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
	    SELECT
		      ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.CRE_DT) AS RN
		    , T1.PROD_WEIGH_PLN_NO AS PROD_PLN_NO
		    , T1.PROD_WEIGH_PLN_RMK AS PROD_PLN_RMK
		    , T1.CHNL_CD
			, CONVERT(VARCHAR, T1.CRE_DT, 23) AS CRE_DT
			, ISNULL(T1.DELT_FLG, 'N') AS DELT_FLG
			, T2.SL_ITM_QTY
			, T2.ITM_NM
			, T2.ITM_SZ_NM
		FROM TB_PROD_WEIGH_PLN AS T1 LEFT OUTER JOIN 
		(
		       SELECT
			          SUM(T2.SL_ITM_QTY) AS SL_ITM_QTY
			        , T1.PROD_WEIGH_PLN_NO
			        , MAX(T1.CHNL_CD) AS CHNL_CD
					, MAX(T2.ITM_NM) AS ITM_NM
					, MAX(T2.ITM_SZ_NM) AS ITM_SZ_NM
		         FROM TB_PROD_WEIGH_PLN_DTL AS T1 LEFT OUTER JOIN 
		         (
		             SELECT
		                   ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SO_DT) AS RN
		                 , T1.SO_NB        AS SL_ORD_NO
		                 , T2.SO_SQ        AS SL_ORD_SEQ
		                 , T2.SO_QT        AS SL_ITM_QTY
		                 , T3.CHNL_CD
						 , T4.ITM_NM
						 , T4.ITM_SZ_NM
		             FROM DZICUBE.dbo.LSO    T1 , DZICUBE.dbo.LSO_D  T2 LEFT OUTER JOIN TB_CD_ITM  T4
		                ON (     
			                        T2.ITEM_CD = T4.ITM_CD
		                        AND T4.CHNL_CD = #CHNL_CD#
		                    )
		                LEFT OUTER JOIN TB_SL_ORD_CLZ T5
		                    ON (    
				                        T2.SO_NB    = T5.SL_ORD_NO
		                            AND T2.SO_SQ    = T5.SL_ORD_SEQ
		                            AND T5.CHNL_CD  = #CHNL_CD#
		                        )
		                , TB_CD_CO           T3
		             WHERE 1 = 1
		                 AND T1.CO_CD      = T2.CO_CD
		                 AND T1.SO_NB      = T2.SO_NB
		                 AND T1.TR_CD      = T3.CO_NO
		                 AND T3.CHNL_CD    = #CHNL_CD#
		                 AND ISNULL(T5.CLZ_FLG, 'N' ) = 'N'
		         ) AS T2 ON ( T1.SL_ORD_NO = T2.SL_ORD_NO AND T1.SL_ORD_SEQ = T2.SL_ORD_SEQ AND T1.CHNL_CD = T2.CHNL_CD)
		            WHERE 1=1
		                AND T1.CHNL_CD           = #CHNL_CD#
					  GROUP BY T1.PROD_WEIGH_PLN_NO
            ) AS T2 ON ( T1.PROD_WEIGH_PLN_NO  = T2.PROD_WEIGH_PLN_NO AND T1.CHNL_CD = T2.CHNL_CD)
            WHERE 1 = 1
                AND T1.CHNL_CD = #CHNL_CD#
			<isNotNull property="PROD_PLN_NO" >
				AND T1.PROD_WEIGH_PLN_NO = #PROD_PLN_NO#
			</isNotNull>
			<isNotNull property="FM_DT" >
                AND T1.CRE_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
		  	    AND T1.CRE_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
			</isNotNull>
		    <isNotNull property="DELT_FLG" >
				AND ISNULL(T1.DELT_FLG, 'N') = #DELT_FLG#
			</isNotNull>
	 </select>

	  <!-- 칭량 작업 계획 - 계획 번호 -->
	  <select id="M6630SelectProdPlnNo" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT TOP 1 ISNULL('WC' + FORMAT(GETDATE(), 'yyyyMMdd') + RIGHT('000' + CONVERT(VARCHAR, RIGHT(MAX(X.PROD_WEIGH_PLN_NO), 3) + 1), 3), ('WC' + FORMAT(GETDATE(), 'yyyyMMdd') + '001'))
		        FROM TB_PROD_WEIGH_PLN AS X  WHERE X.CHNL_CD = #CHNL_CD# AND X.PROD_WEIGH_PLN_NO LIKE 'WC' + FORMAT(GETDATE(), 'yyyyMMdd') + '%'
	  </select>

	  <insert id="M6630InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_WEIGH_PLN
		  (
		        PROD_WEIGH_PLN_NO
		  	  , PROD_WEIGH_PLN_RMK
		      , CHNL_CD
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		  )
		  VALUES
		  (
		        #PROD_PLN_NO#
		      , #PROD_PLN_RMK#
		      , #CHNL_CD#
		      , #CRE_USR_ID#
		      , GETDATE()
		      , #UPD_USR_ID#
		      , GETDATE()
		  )
	  </insert>

	  <update id="M6630UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_PROD_WEIGH_PLN
		    SET  
			    PROD_WEIGH_PLN_RMK = #PROD_PLN_RMK#
		      , UPD_DT             = GETDATE()
		      , UPD_USR_ID         = #UPD_USR_ID#
			  , DELT_FLG           = #DELT_FLG#
		  WHERE CHNL_CD            = #CHNL_CD#
		    AND PROD_WEIGH_PLN_NO  = #PROD_PLN_NO#
	  </update>


       <!-- -->
	  <select id="M6630SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		 SELECT
		       T1.PROD_WEIGH_PLN_NO AS PROD_PLN_NO
		     , T1.SL_ORD_NO
		     , T1.SL_ORD_SEQ
		     , T1.CHNL_CD
		     , T2.CO_NM
		     , T2.SO_DT
		     , T2.DUE_DT
		     , T2.ITM_CD
		     , T2.ITM_NM
			 , T2.ITM_SZ_NM
		     , T2.SL_ITM_QTY
			 , T1.CRE_USR_ID
			 , T1.UPD_USR_ID
			 , '' AS GBN
		 FROM TB_PROD_WEIGH_PLN_DTL AS T1 LEFT OUTER JOIN 
		 (
		     SELECT
		           ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SO_DT) AS RN
		         , CONVERT(VARCHAR, CAST(T1.SO_DT  AS   DATETIME), 23) AS SO_DT
		         , ISNULL(CONVERT(VARCHAR, CAST(T2.DUE_DT AS   DATETIME), 23), '') AS DUE_DT
		         , T1.TR_CD        AS CO_NO
		         , T3.CO_NM
		         , T1.SO_NB        AS SL_ORD_NO
		         , T2.SO_SQ        AS SL_ORD_SEQ
		         , T2.ITEM_CD      AS ITM_CD
		         , T4.ITM_NM
				 , T4.ITM_SZ_NM
		         , T2.SO_QT        AS SL_ITM_QTY
		         , T3.CHNL_CD
		     FROM DZICUBE.dbo.LSO    T1 , DZICUBE.dbo.LSO_D  T2 LEFT OUTER JOIN TB_CD_ITM  T4
		        ON (     
			                T2.ITEM_CD = T4.ITM_CD
		                AND T4.CHNL_CD = #CHNL_CD#
		            )
		        LEFT OUTER JOIN TB_SL_ORD_CLZ T5
		            ON (    
				                T2.SO_NB    = T5.SL_ORD_NO
		                    AND T2.SO_SQ    = T5.SL_ORD_SEQ
		                    AND T5.CHNL_CD  = #CHNL_CD#
		                )
		        , TB_CD_CO           T3
		     WHERE 1 = 1
		         AND T1.CO_CD      = T2.CO_CD
		         AND T1.SO_NB      = T2.SO_NB
		         AND T1.TR_CD      = T3.CO_NO
		         AND T3.CHNL_CD    = #CHNL_CD#
		         AND ISNULL(T5.CLZ_FLG, 'N' ) = 'N'
		 ) AS T2 ON ( T1.SL_ORD_NO = T2.SL_ORD_NO AND T1.SL_ORD_SEQ = T2.SL_ORD_SEQ AND T1.CHNL_CD = T2.CHNL_CD)
		 WHERE 1=1
		    AND T1.CHNL_CD           = #CHNL_CD#
			AND T1.PROD_WEIGH_PLN_NO = #PROD_PLN_NO#
	 </select>

	  <insert id="M6630InsertDetail" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_WEIGH_PLN_DTL
		  (
		        PROD_WEIGH_PLN_NO
		      , SL_ORD_NO
			  , SL_ORD_SEQ
		      , CHNL_CD
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		  )
		  VALUES
		  (
		        #PROD_PLN_NO#
			  , #SL_ORD_NO#
			  , #SL_ORD_SEQ#
		      , #CHNL_CD#
		      , #CRE_USR_ID#
		      , GETDATE()
		      , #UPD_USR_ID#
		      , GETDATE()
		  )
	  </insert>

	  <delete id="M6630DeleteDetail" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_WEIGH_PLN_DTL
		      WHERE 1=1
		        AND CHNL_CD             = #CHNL_CD#
		        AND PROD_WEIGH_PLN_NO   = #PROD_PLN_NO#
	  </delete>


	  <!-- 칭량 시작 시간 ~ 끝 시간 -->
	  <select id="M6631SelectTime" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT TOP 1
		    '시작: ' + '[' + CONVERT(VARCHAR, DATEPART(HOUR, MIN(CRE_DT)))  + '] 시  [' + CONVERT(VARCHAR, DATEPART(MINUTE, MIN(CRE_DT))) + '] 분   ~   종료: ' + '[' + CONVERT(VARCHAR, DATEPART(HOUR, MAX(CRE_DT)))  + '] 시  [' + CONVERT(VARCHAR, DATEPART(MINUTE, MAX(CRE_DT))) + '] 분'
		  FROM TB_FPRF_LIFO_MAP
		    WHERE 1=1
		        AND LOT_NO      = #LOT_NO#
		        AND CHNL_CD     = #CHNL_CD#
	  </select>

	  <!-- 칭량 지시 관리 -->
     <select id="M6631SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT 
		      <!--(dbo.FN_splitValue(T1.LOT_NO, '-', 1)
                + '-' + dbo.FN_splitValue(T1.LOT_NO, '-', 2)
                + '-' + dbo.FN_splitValue(T1.LOT_NO, '-', 3)
                + '-' + dbo.FN_splitValue(T1.LOT_NO, '-', 4) ) AS GRP_LOT_NO-->  
              T1.LOT_NO         
            , T1.ASSY_ITM_CD    
            , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ASSY_ITM_CD) AS ASSY_ITM_NM 
            , T1.BSE_WEIH_VAL 
            , T1.TOT_WEIH_VAL 
            <!--, MIX_WEIH_VAL--> 
		    , (SELECT SUM(X.WEIH_BSE_VAL) /1000 AS WEIH_BSE_VAL FROM TB_PROD_WEIGH_WRK_DTL AS X WHERE 1=1 AND X.LOT_NO = T1.LOT_NO) AS MIX_WEIH_VAL
            , T1.WRK_KNT_VAL  
            , T1.MIX_CD
            , CASE WHEN T1.MIX_CD = 'A' THEN '신내리' ELSE '재내리' END AS MIX_NM
            , T1.WRK_MAN_ID   
            , dbo.USR_NM_FNC(T1.CHNL_CD, T1.WRK_MAN_ID) AS WRK_MAN_NM
			, CONVERT(VARCHAR, T1.WRK_DT, 23) AS WRK_DT
            , CASE WHEN T1.WRK_END_FLG = 'Y' THEN '예' ELSE '아니요' END AS WRK_END_FLG
            , T1.CHNL_CD 
            , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'M-011', T1.ITM_CLSS_CD) AS ITM_CLSS_NM 
            , T1.ITM_CLSS_CD
            , (CASE WHEN ISNULL((SELECT MIN(X.WEIH_VAL) FROM TB_PROD_WEIGH_WRK_DTL AS X WHERE 1=1 AND X.LOT_NO = T1.LOT_NO AND X.CHNL_CD = T1.CHNL_CD) , 0) > 0  THEN 'Y' ELSE 'N' END) AS GBN
            <!--, (CASE WHEN (SELECT SUM(X.WEIH_VAL) FROM TB_FPRF_LIFO_MAP AS X WHERE 1=1 AND X.LOT_NO = T1.LOT_NO AND X.CHNL_CD = T1.CHNL_CD) > 0  THEN 'Y' ELSE 'N' END) AS GBN-->
		    , T1.WRK_DESC
			, T1.INP_LOT_NO
			, T1.SL_ORD_NO
			, T1.SL_ORD_SEQ
			, T2.ITM_GRP_CLSS_CD
			, T2.ITM_GRP_CLSS_NM
			, T1.CRE_USR_ID   
            , dbo.USR_NM_FNC(T1.CHNL_CD, T1.CRE_USR_ID) AS CRE_USR_NM
			, ISNULL((SELECT MAX(X.ITM_QTY) AS ITM_QTY FROM TB_INAUD_TMP AS X WHERE 1=1 AND X.PUR_ORD_NO = T1.LOT_NO ), 0) AS SL_ITM_QTY
         FROM TB_PROD_WEIGH_WO AS T1  LEFT OUTER JOIN MV_TB_CD_ITM AS T2 ON (T1.ASSY_ITM_CD = T2.ITM_CD AND T1.CHNL_CD = T2.CHNL_CD)
          WHERE 1 = 1
            AND T1.CHNL_CD = #CHNL_CD#
            AND T1.WRK_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
		  	AND T1.WRK_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
          <isNotNull property="LOT_NO" >
			  AND T1.LOT_NO = #LOT_NO#
		  </isNotNull>
          <isNotNull property="ITM_CLSS_CD" >
			  AND T1.ITM_CLSS_CD = #ITM_CLSS_CD#
		  </isNotNull>
		  <isNotNull property="INP_LOT_NO" >
			  AND ISNULL(T1.INP_LOT_NO, '') != ''
		  </isNotNull>
    </select>
    
	 <!-- 칭량 작업 계획 / 지시 관리 - 시험 번호 -->
    <select id="M6632SelectInspNo" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT TOP 1 ISNULL(X.INSP_NO, '') FROM TB_INAUD_TMP AS X WHERE 1 = 1 AND X.CHNL_CD = #CHNL_CD# AND X.LOT_NO = #MTRL_LOT_NO#
    </select>  
		  
		  
    <select id="M6631SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT T1.CHNL_CD
             , T1.LOT_NO
			 , ISNULL(T2.N1ST_ITM_GRP_CD, '') AS N1ST_ITM_GRP_CD
             , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD , T2.N1ST_ITM_GRP_CD) AS  N1ST_ITM_GRP_NM 
             , T1.ASSY_ITM_SEQ 
             , T1.CMPO_CD  
             , T2.ITM_NM  
             , T1.WEIH_BSE_VAL
			 , (ISNULL(T1.WEIH_VAL, 0) + ISNULL((SELECT SUM(X.WEIH_VAL) FROM TB_PROD_WEIGH_WRK_IRR_DTL AS X WHERE 1=1 AND X.ASSY_ITM_SEQ = T1.ASSY_ITM_SEQ AND X.LOT_NO = T1.LOT_NO AND X.CHNL_CD = T1.CHNL_CD AND X.GBN = '100'), 0)) AS WEIH_VAL
			 <!--
             , T1.WEIH_VAL 
			 -->
             , ISNULL(T1.MIN_TOR_VAL, 0) AS MIN_TOR_VAL
             , ISNULL(T1.MAX_TOR_VAL, 0) AS MAX_TOR_VAL
             , T1.WEIGH_WRK_DESC 
			 <!--
             , (SELECT X.PCK_PLST_CD FROM TB_FPRF_N1ST_PCK_PLST X WHERE X.CHNL_CD = T1.CHNL_CD AND X.LOT_NO = T1.LOT_NO AND X.ASSY_ITM_SEQ = T1.ASSY_ITM_SEQ) AS PCK_PLST_CD
             , (SELECT X.PCK_PLST_NM FROM TB_CD_PCK_PLST X WHERE X.CHNL_CD = T1.CHNL_CD AND X.PCK_PLST_CD = (SELECT Z.PCK_PLST_CD FROM TB_FPRF_N1ST_PCK_PLST Z WHERE Z.CHNL_CD = T1.CHNL_CD AND Z.LOT_NO = T1.LOT_NO AND Z.ASSY_ITM_SEQ = T1.ASSY_ITM_SEQ)) AS PCK_PLST_NM
			 -->
             , T1.CRE_USR_ID
             , T1.UPD_USR_ID
             , ISNULL(T2.ITM_SZ_NM, '100 x 80') AS ITM_SZ_NM  
             , T1.LOT_NO + '-' + CAST(T1.ASSY_ITM_SEQ AS VARCHAR) AS PRN_LOT_NO 
             , '칭량' AS ROUT_NM 
             , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD) AS UOM_NM 
             , T3.CO_NM        
             , T3.ITM_IN_DT AS IN_DT   
             , T3.EXP_DT  
			 , T3.MTRL_LOT_NO
			 , T3.MTRL_LOT_NO AS GRP_LOT_NO
			 , (SELECT TOP 1 X.INSP_NO FROM TB_INAUD_TMP AS X WHERE 1 = 1 AND X.CHNL_CD =  T1.CHNL_CD AND X.LOT_NO = T3.MTRL_LOT_NO) AS INSP_NO
			 , T1.ORD_CLS_CD
			 , T1.CMPO_RMK
			 , #ASSY_ITM_CD#    AS ASSY_ITM_CD
			 , #INP_LOT_NO#     AS INP_LOT_NO
			 , #SL_ORD_NO#      AS SL_ORD_NO
			 , #SL_ORD_SEQ#     AS SL_ORD_SEQ
        FROM TB_PROD_WEIGH_WRK_DTL  T1
             <!--LEFT OUTER JOIN (  SELECT    T1.ASSY_ITM_SEQ
                                        , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.CO_CD) AS CO_NM  
                                        , MAX(CONVERT(VARCHAR(10), T2.ITM_IN_DT, 121)) AS ITM_IN_DT  
                                        , MAX(CONVERT(VARCHAR(10), DATEADD(dd, T2.MTRL_EXP_DY, T2.MTRL_MAKE_DT), 121)) AS EXP_DT 
										, T2.MTRL_LOT_NO
                                 FROM TB_FPRF_LIFO_MAP  T1
                                    , TB_FPRF_N1ST_STEP_ROUT T2 
                                WHERE T1.CHNL_CD = T2.CHNL_CD
                                  AND T1.CHNL_CD = #CHNL_CD#
                                  AND T1.PRNT_LOT_NO = T2.MTRL_LOT_NO
								  AND T1.LOT_NO  = #LOT_NO# 
                             GROUP BY  T1.ASSY_ITM_SEQ
                                    , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.CO_CD)
									--><!--, T2.MTRL_LOT_NO--><!--
                               ) T3
             ON ( T1.ASSY_ITM_SEQ = T3.ASSY_ITM_SEQ )-->    
		   LEFT OUTER JOIN (  
                                  SELECT T1.ASSY_ITM_SEQ
                                       , T1.CO_NM
                                       , T1.ITM_IN_DT
                                       , T1.EXP_DT
                                       , T1.MTRL_LOT_NO
                                 FROM (
                                  SELECT T1.ASSY_ITM_SEQ
                                       , T2.CO_NM
                                       , T2.ITM_IN_DT
                                       , T2.EXP_DT
                                       , ROW_NUMBER() OVER (PARTITION BY LOT_NO, MTRL_LOT_NO, ASSY_ITM_SEQ ORDER BY CRE_DT DESC) AS RN 
                                       , T2.MTRL_LOT_NO
                                    FROM TB_FPRF_LIFO_MAP   T1
                                      CROSS  APPLY ( 
                                          SELECT CO_NM
                                               , CONVERT(VARCHAR(10), X.ITM_IN_DT, 121) AS ITM_IN_DT  
                                               , CONVERT(VARCHAR(10), DATEADD(dd, X.MTRL_EXP_DY, X.MTRL_MAKE_DT), 121) AS EXP_DT   
                                               , X.MTRL_LOT_NO
                                            FROM TB_FPRF_N1ST_STEP_ROUT  X
                                               , TB_CD_CO                Z
                                           WHERE 1 = 1 
                                             AND X.CHNL_CD = #CHNL_CD#
                                             AND X.CHNL_CD = Z.CHNL_CD
                                             AND X.CO_CD   = Z.CO_NO
                                             AND X.MTRL_LOT_NO  = T1.PRNT_LOT_NO
                                         ) T2
                                   WHERE 1 = 1
                                     AND LOT_NO = #LOT_NO# 
                                     ) T1
                                 WHERE RN = 1
                        ) T3
             ON ( T1.ASSY_ITM_SEQ = T3.ASSY_ITM_SEQ )                       
           , TB_CD_ITM  T2
       WHERE 1 = 1
         AND T1.CMPO_CD = T2.ITM_CD
         AND T1.CHNL_CD = T2.CHNL_CD        
         AND T1.CHNL_CD = #CHNL_CD#
         AND T1.LOT_NO  = #LOT_NO# 
    </select>
    
    <statement id="ProcM6631" parameterClass="ModelsLibrary.Man.ManVo" resultClass="int">
		declare @RTN VARCHAR(MAX)
		exec @RTN = sp_ProductWeighWork #CHNL_CD#, #CRE_USR_ID#, #ASSY_ITM_CD#, #BSE_WEIH_VAL#, #TOT_WEIH_VAL#, #MIX_WEIH_VAL#, #MIX_CD#, #WRK_DT#, #WRK_MAN_ID#, #WRK_DESC#, #SL_ORD_NO#, #SL_ORD_SEQ#, #INP_LOT_NO#
		select @RTN AS R_value
	</statement>
    
    <update id="M6631UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
       UPDATE TB_PROD_WEIGH_WO
         SET  WRK_END_FLG = #WRK_END_FLG#   
		    , WRK_DESC    = #WRK_DESC#
			, WRK_CON_FLG = #WRK_CON_FLG#
			, INP_LOT_NO  = #INP_LOT_NO#
            , UPD_DT      = GETDATE()  
            , UPD_USR_ID  = #UPD_USR_ID#
            , CRE_USR_ID  = #CRE_USR_ID#
			, WRK_MAN_ID  = #WRK_MAN_ID#
			, SL_ORD_NO   = #SL_ORD_NO#
       WHERE CHNL_CD      = #CHNL_CD#
         AND LOT_NO       = #LOT_NO#
    </update>
    
    <delete id="M6631DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_WEIGH_WO
        WHERE CHNL_CD     = #CHNL_CD#
         AND LOT_NO       = #LOT_NO#
    </delete>
    
    
    <update id="M6631UpdateDetail" parameterClass="ModelsLibrary.Man.ManVo">
       UPDATE TB_PROD_WEIGH_WRK_DTL
         SET 	
		      WEIH_VAL	  = #WEIH_VAL#
            , UPD_DT      = GETDATE()  
            , UPD_USR_ID  = #UPD_USR_ID#
        WHERE CHNL_CD     = #CHNL_CD#
         AND LOT_NO       = #LOT_NO#
         AND ASSY_ITM_SEQ = #ASSY_ITM_SEQ#
    </update>
    
    <delete id="M6631DeleteDetail" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_WEIGH_WRK_DTL
        WHERE CHNL_CD    = #CHNL_CD#
         AND LOT_NO      = #LOT_NO#
    </delete>
        
    <delete id="M6631DeleteDetail2" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_FPRF_LIFO_MAP
        WHERE CHNL_CD    = #CHNL_CD#
         AND LOT_NO      = #LOT_NO#
    </delete>
    
    
   <insert id="M6632InsertDetail" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_FPRF_N1ST_PCK_PLST ( 
          CHNL_CD
        , LOT_NO
        , ASSY_ITM_SEQ
        , PCK_SEQ
        , PCK_PLST_CD
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
          #CHNL_CD#
        , #LOT_NO#
        , #ASSY_ITM_SEQ#
        , ( SELECT ISNULL(MAX(PCK_SEQ) + 1, 1) 
              FROM TB_FPRF_N1ST_PCK_PLST 
             WHERE CHNL_CD = #CHNL_CD# AND LOT_NO = #LOT_NO# AND ASSY_ITM_SEQ = #ASSY_ITM_SEQ#) 
        , #PCK_PLST_CD#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <delete id="M6632DeleteDetail" parameterClass="ModelsLibrary.Man.ManVo">
       DELETE FROM TB_FPRF_N1ST_PCK_PLST
        WHERE CHNL_CD       = #CHNL_CD#
          AND LOT_NO        = #LOT_NO#
          AND ASSY_ITM_SEQ  = #ASSY_ITM_SEQ#
    </delete>
    
    <statement id="ProcM6632" parameterClass="ModelsLibrary.Man.ManVo" resultClass="int">
       declare @RTN VARCHAR(MAX)
       exec @RTN = sp_ProductWeightChk_HS #CHNL_CD#, #CRE_USR_ID#, #LOT_NO#, #GRP_LOT_NO#, #ITM_CD#, #ASSY_ITM_SEQ#
       select @RTN AS R_value
    </statement>
    
    
    <update id="M6631UpdateMapDetail" parameterClass="ModelsLibrary.Man.ManVo">
       UPDATE TB_FPRF_LIFO_MAP
         SET 	WEIH_VAL  = #WEIH_VAL#   
        WHERE CHNL_CD     = #CHNL_CD#
         AND LOT_NO       = #LOT_NO#
         AND PRNT_LOT_NO  = #GRP_LOT_NO#
         AND ASSY_ITM_SEQ = #ASSY_ITM_SEQ#
    </update>
    
      <!-- 
	    통합 수불 < TB_INAUD_HIS > 
		    - 칭량 완료 : IGF (생산출고)
		-->
	<insert id="M6631InsertInaudHis" parameterClass="ModelsLibrary.Man.ManVo">
     INSERT INTO TB_INAUD_HIS
	    (
		      CHNL_CD
		    , AREA_CD
		    , INAUD_DT
		    , INAUD_TP_CD
		    , IO_CD
		    , FM_LOC_CD
		    , TO_LOC_CD
		    , CO_CD
		    , ITM_CD
		    , ITM_PRC
			, ITM_QTY
		    , ORD_NO
		    , ORD_SEQ
		    , CONN_NO
		    , CONN_SEQ
		    , CRE_USR_ID
		    , CRE_DT
		    , DELT_FLG
	    )
		SELECT 
				T1.CHNL_CD
		      , (SELECT EMPE_PLC_NM FROM TB_SYS_USR AS X WHERE 1 =1 AND X.CHNL_CD = T1.CHNL_CD AND USR_ID =  T1.CRE_USR_ID) AS AREA_CD
		      , GETDATE()       AS INAUD_DT
		      , 'IGF'           AS GBN
		      , 'O'             AS IO_CD
		      , NULL            AS FM_LOC_CD
		      , '400'           AS TO_LOC_CD
		      , '99999'         AS CO_CD
		      , T1.CMPO_CD      AS ITM_CD
		      , NULL            AS ITM_PRC
			  , T2.WEIH_VAL * 0.001		AS ITM_QTY
		      , T3.SL_ORD_NO    AS PUR_ORD_NO
		      , T3.SL_ORD_SEQ   AS PUR_ORD_SEQ
		      , NULL            AS CONN_NO
		      , NULL            AS CONN_SEQ
		      , T1.CRE_USR_ID   AS CRE_USR_ID
		      , GETDATE()       AS CRE_DT
		      , 'N'             AS DELT_FLG
			FROM TB_PROD_WEIGH_WRK_DTL AS T1
			   , TB_FPRF_LIFO_MAP AS T2
			   , TB_PROD_WEIGH_WO AS T3
			 WHERE 1=1 
					AND T1.CHNL_CD      = #CHNL_CD#
					AND T1.CHNL_CD      = T2.CHNL_CD
					AND T1.CHNL_CD      = T3.CHNL_CD
					AND T1.LOT_NO       = T2.LOT_NO
					AND T1.LOT_NO       = T3.LOT_NO
					AND T1.ASSY_ITM_SEQ = T2.ASSY_ITM_SEQ
					AND T2.LOT_NO       = #LOT_NO#
					AND T1.WEIH_VAL IS NOT NULL
					AND T2.WEIH_VAL IS NOT NULL
	</insert>	 
	  
	  
	<!-- 추가 칭량 -->
	  <select id="M6637SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT 
		        T1.CHNL_CD
		      , T1.LOT_NO
		      , T1.ASSY_ITM_SEQ
		      , T1.WEIH_SEQ
		      , T1.GBN  AS ROUT_CD
		      , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'W-001', T1.GBN) AS ROUT_NM
		      , T1.MTRL_LOT_NO
		      , T1.WEIH_VAL
		  FROM TB_PROD_WEIGH_WRK_IRR_DTL T1
            WHERE CHNL_CD        = #CHNL_CD#
			<isNotNull property="LOT_NO" >
              AND LOT_NO         = #LOT_NO#
			</isNotNull>
		    <isNotNull property="ASSY_ITM_SEQ" >
			  AND ASSY_ITM_SEQ   = #ASSY_ITM_SEQ#
		    </isNotNull>
	  </select>
	  <insert id="M6637InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_WEIGH_WRK_IRR_DTL 
		  (
		        CHNL_CD
		      , LOT_NO
		      , ASSY_ITM_SEQ
		      , WEIH_SEQ
		      , GBN
		      , MTRL_LOT_NO
		      , WEIH_VAL
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		  ) 
		  VALUES
		  (
		        #CHNL_CD#
		      , #LOT_NO#
		      , #ASSY_ITM_SEQ#
		      , ( SELECT ISNULL(MAX(WEIH_SEQ) + 1, 1)  FROM TB_PROD_WEIGH_WRK_IRR_DTL  WHERE CHNL_CD = #CHNL_CD# AND LOT_NO = #LOT_NO# AND ASSY_ITM_SEQ = #ASSY_ITM_SEQ#)
		      , #ROUT_CD#
		      , #MTRL_LOT_NO#
		      , #WEIH_VAL#
		      , #CRE_USR_ID#
		      , GETDATE()
		      , #UPD_USR_ID#
		      , GETDATE()
		  )
	  </insert>
	  <update id="M6637UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_PROD_WEIGH_WRK_IRR_DTL
		  SET  
		        WEIH_VAL    = #WEIH_VAL#
		      , UPD_DT      = GETDATE()
		      , UPD_USR_ID  = #UPD_USR_ID#
		  WHERE CHNL_CD          = #CHNL_CD#
		      AND LOT_NO         = #LOT_NO#
		      AND ASSY_ITM_SEQ   = #ASSY_ITM_SEQ#
		      AND WEIH_SEQ       = #WEIH_SEQ#
	  </update>

	  <delete id="M6637DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_WEIGH_WRK_IRR_DTL
		  WHERE CHNL_CD          = #CHNL_CD#
		      AND LOT_NO         = #LOT_NO#
		      AND ASSY_ITM_SEQ   = #ASSY_ITM_SEQ#
		      AND WEIH_SEQ       = #WEIH_SEQ#
	  </delete>


	  <!-- 칭량일지 -->
	  <select id="M66321SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		 SELECT       
				T1.CHNL_CD       
              , T1.ASSY_ITM_SEQ  
              , T1.LOT_NO        
              , T4.ASSY_ITM_CD   
			  , T4.BSE_WEIH_VAL  
			  , T3.MTRL_LOT_NO   
              , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T2.ITM_GRP_CLSS_CD , T2.N1ST_ITM_GRP_CD) AS  N1ST_ITM_GRP_NM  
              , T2.ITM_NM     
			  , T1.CMPO_CD    
			  , ISNULL(T2.ITM_SZ_NM, '') AS ITM_SZ_NM     
              , T1.WEIH_VAL      
              , T1.WEIH_BSE_VAL  
              , T1.LOT_NO + '-' + CAST(T1.ASSY_ITM_SEQ AS VARCHAR) AS PRN_LOT_NO 
              , '칭량' AS ROUT_NM  
              , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD) AS UOM_NM   
              , (SELECT TOP 1 X.INSP_NO FROM TB_INAUD_TMP AS X WHERE 1 = 1 AND X.CHNL_CD =  T1.CHNL_CD AND X.LOT_NO = T3.MTRL_LOT_NO) AS INSP_NO   
              , T1.ORD_CLS_CD
              , T1.CMPO_RMK
			  , CONVERT(VARCHAR, T4.WRK_DT, 23) AS UPD_DT
        FROM TB_PROD_WEIGH_WRK_DTL  T1
             LEFT OUTER JOIN (  
			                    SELECT    T1.ASSY_ITM_SEQ
                                        , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.CO_CD) AS CO_NM  
                                        , MAX(CONVERT(VARCHAR(10), T2.ITM_IN_DT, 121)) AS ITM_IN_DT  
                                        , MAX(CONVERT(VARCHAR(10), DATEADD(dd, T2.MTRL_EXP_DY, T2.MTRL_MAKE_DT), 121)) AS EXP_DT 
                                        , T2.MTRL_LOT_NO
									    , T1.LOT_NO
									FROM TB_FPRF_LIFO_MAP  T1
										,TB_FPRF_N1ST_STEP_ROUT T2 
									WHERE T1.CHNL_CD            = T2.CHNL_CD
									      AND T1.CHNL_CD        = #CHNL_CD#
									      AND T1.PRNT_LOT_NO    = T2.MTRL_LOT_NO
									  GROUP BY  T1.ASSY_ITM_SEQ ,dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.CO_CD) , T2.MTRL_LOT_NO , T1.LOT_NO 
			     ) T3  ON ( T1.ASSY_ITM_SEQ = T3.ASSY_ITM_SEQ AND T1.LOT_NO = T3.LOT_NO )                             
            , TB_CD_ITM  T2
            , TB_PROD_WEIGH_WO T4
                    WHERE 1 = 1
						AND T1.CMPO_CD = T2.ITM_CD
						AND T1.CHNL_CD = T2.CHNL_CD        
						AND T1.CHNL_CD = #CHNL_CD#
						AND T1.LOT_NO = T4.LOT_NO
						AND T1.CHNL_CD = T4.CHNL_CD
						AND T4.ITM_CLSS_CD = '100'
						AND T4.WRK_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
		  				AND T4.WRK_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
	  </select>
	  
	  
    <!-- 산업용 --><!--
    --><!-- 칭량 작업 계획 / 지시 관리 --><!--
    <select id="M6635SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT (dbo.FN_splitValue(LOT_NO, '-', 1)
                + '-' + dbo.FN_splitValue(LOT_NO, '-', 2)
                + '-' + dbo.FN_splitValue(LOT_NO, '-', 3)
                + '-' + dbo.FN_splitValue(LOT_NO, '-', 4) ) AS GRP_LOT_NO  
            , LOT_NO         
            , ASSY_ITM_CD    
            , dbo.CD_ITEM_NM_FNC(CHNL_CD, ASSY_ITM_CD) AS ASSY_ITM_NM 
            , BSE_WEIH_VAL 
            , TOT_WEIH_VAL 
            , MIX_WEIH_VAL 
            , WRK_KNT_VAL  
            , MIX_CD
            , CASE WHEN MIX_CD = 'A' THEN '신내리' ELSE '재내리' END AS MIX_NM
            , WRK_MAN_ID   
            , dbo.USR_NM_FNC(CHNL_CD, WRK_MAN_ID) AS WRK_MAN_NM
				    , CONVERT(VARCHAR, WRK_DT, 23) AS WRK_DT
            , CASE WHEN WRK_END_FLG = 'Y' THEN '예' ELSE '아니요' END AS WRK_END_FLG
            , CHNL_CD 
            , dbo.CD_COMPANY_NM_FNC(CHNL_CD, CO_CD) AS CO_NM  
            , CO_CD
            , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'M-011', ITM_CLSS_CD) AS ITM_CLSS_NM 
            , ITM_CLSS_CD
            , (CASE WHEN (SELECT MIN(X.WEIH_VAL) FROM TB_PROD_WEIGH_WRK_DTL AS X WHERE 1=1 AND X.LOT_NO = T1.LOT_NO AND X.CHNL_CD = T1.CHNL_CD) > 0  THEN 'Y' ELSE 'N' END) AS GBN
            , #FM_DT# AS FM_DT
            , #TO_DT# AS TO_DT
         FROM TB_PROD_WEIGH_WO AS T1
          WHERE 1 = 1
            AND CHNL_CD = #CHNL_CD#
            AND WRK_DT >= CAST(CONVERT(VARCHAR, #FM_DT#, 112) + ' 00:00:00' AS DATETIME)
		  	    AND WRK_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR, #TO_DT#, 112) + ' 23:59:59' AS DATETIME)
          <isNotNull property="LOT_NO" >
            AND LOT_NO = #LOT_NO#
          </isNotNull>
          <isNotNull property="ITM_CLSS_CD" >
            AND ITM_CLSS_CD = #ITM_CLSS_CD#
          </isNotNull>
          <isNotNull property="GRP_LOT_NO" >
            AND (dbo.FN_splitValue(LOT_NO, '-', 1)
                  + '-' + dbo.FN_splitValue(LOT_NO, '-', 2)
                  + '-' + dbo.FN_splitValue(LOT_NO, '-', 3)
                  + '-' + dbo.FN_splitValue(LOT_NO, '-', 4) ) = #GRP_LOT_NO#
          </isNotNull>
    </select>
    
     <update id="M6635UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
       UPDATE TB_PROD_WEIGH_WO
         SET 	CO_CD       = #CO_CD#
            , WRK_END_FLG	= #WRK_END_FLG#   
            , UPD_DT      = GETDATE()  
            , UPD_USR_ID  = #UPD_USR_ID#
       WHERE CHNL_CD      = #CHNL_CD#
         AND LOT_NO       = #LOT_NO#
    </update>
    
    <delete id="M6635DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_WEIGH_WO
        WHERE CHNL_CD     = #CHNL_CD#
         AND LOT_NO       = #LOT_NO#
    </delete>
    
     <statement id="ProcM6635" parameterClass="ModelsLibrary.Man.ManVo" resultClass="int">
       declare @RTN VARCHAR(MAX)
       exec @RTN = sp_ProductWeighWorkEtc #CHNL_CD#, #CRE_USR_ID#, #ASSY_ITM_CD#, #BSE_WEIH_VAL#, #TOT_WEIH_VAL#, #MIX_WEIH_VAL#, #MIX_CD#, #WRK_DT#, #WRK_MAN_ID#, #CO_CD#, #ITM_CLSS_CD#
       select @RTN AS R_value
    </statement>-->



    <!-- 공정제품맵핑 -->
    <select id="M66210SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT ITM_CD
        , ITM_NM
        , ITM_SZ_NM
        , N1ST_ITM_GRP_CD
        , dbo.PUR_N1ST_GRP_NM_FNC(CHNL_CD, ITM_GRP_CLSS_CD , N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
        , N2ND_ITM_GRP_CD
        , dbo.PUR_N2ST_GRP_NM_FNC(CHNL_CD, ITM_GRP_CLSS_CD , N1ST_ITM_GRP_CD, N2ND_ITM_GRP_CD) AS N2ND_ITM_GRP_NM
        , CHNL_CD
        , #CRE_USR_ID#  AS CRE_USR_ID
        , #UPD_USR_ID#  AS UPD_USR_ID
      FROM TB_CD_ITM
        WHERE 1 = 1
          AND CHNL_CD = #CHNL_CD#
    </select>
    
    <select id="M66210SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT T1.ITM_CD
        , T3.ITM_NM
        , T2.ROUT_TP_CD
        , T2.ROUT_TP_NM
        , T1.CHNL_CD
      FROM TB_PROD_ITM_ROUT T1
        , TB_PROD_ROUT_TP  T2
        , TB_CD_ITM        T3
      WHERE 1 = 1
        AND T1.CHNL_CD    = #CHNL_CD#
        AND T1.CHNL_CD    = T2.CHNL_CD
        AND T1.CHNL_CD    = T3.CHNL_CD
        AND T1.ROUT_TP_CD = T2.ROUT_TP_CD
        AND T1.ITM_CD     = T3.ITM_CD 
        AND T1.ITM_CD     = #ITM_CD#
    </select>
    
    <select id="M66210SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT CHNL_CD
        , ROUT_TP_CD
        , ROUT_TP_NM
        , ROUT_TP_DESC
        , #CRE_USR_ID#  AS CRE_USR_ID
        , #UPD_USR_ID#  AS UPD_USR_ID
        , #ITM_CD#      AS ITM_CD
      FROM TB_PROD_ROUT_TP
       WHERE 1 = 1
        AND CHNL_CD = #CHNL_CD#
    </select>

 <insert id="M66210InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
    INSERT INTO TB_PROD_ITM_ROUT
    (
        CHNL_CD
      , ITM_CD
      , ROUT_TP_CD
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
    ) VALUES (
        #CHNL_CD#
      , #ITM_CD#
      , #ROUT_TP_CD#
      , #CRE_USR_ID#
      , GETDATE()
      , #UPD_USR_ID#
      , GETDATE()
    )
  </insert>

  <delete id="M66210DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
     DELETE FROM TB_PROD_ITM_ROUT
      WHERE 1 = 1
        AND CHNL_CD     = #CHNL_CD#
        AND ITM_CD      = #ITM_CD#
        AND ROUT_TP_CD  = #ROUT_TP_CD#
  </delete>

    
    <!-- 공정유형맵핑 -->
  <select id="M6629SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
     SELECT CHNL_CD
       , ROUT_TP_CD
       , ROUT_TP_NM
       , ROUT_TP_DESC
       , CONVERT(VARCHAR(16), UPD_DT, 120) AS UPD_DT
       , #CRE_USR_ID# AS CRE_USR_ID
       , UPD_USR_ID
    FROM TB_PROD_ROUT_TP
      WHERE 1 = 1
        AND CHNL_CD = #CHNL_CD#
    </select>
    
  <insert id="M6629InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
   INSERT INTO TB_PROD_ROUT_TP 
   (
       CHNL_CD
     , ROUT_TP_CD
     , ROUT_TP_NM
     , ROUT_TP_DESC
     , CRE_USR_ID
     , CRE_DT
     , UPD_USR_ID
     , UPD_DT
    ) VALUES (
       #CHNL_CD#
     , #ROUT_TP_CD#
     , #ROUT_TP_NM#
     , #ROUT_TP_DESC#
     , #CRE_USR_ID#
     , GETDATE()
     , #UPD_USR_ID#
     , GETDATE()
    )
  </insert>

  <update id="M6629UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
   UPDATE TB_PROD_ROUT_TP
     SET ROUT_TP_NM     = #ROUT_TP_NM#
       , ROUT_TP_DESC   = #ROUT_TP_DESC#
       , UPD_USR_ID     = #UPD_USR_ID#
       , UPD_DT         = GETDATE()
    WHERE 1 = 1
      AND CHNL_CD     = #CHNL_CD#
      AND ROUT_TP_CD  = #ROUT_TP_CD#
  </update>
      
  <delete id="M6629DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
    DELETE FROM TB_PROD_ROUT_TP
      WHERE 1 = 1
        AND CHNL_CD     = #CHNL_CD#
        AND ROUT_TP_CD  = #ROUT_TP_CD#
  </delete>  

    
 <select id="M6629SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
    SELECT T1.CHNL_CD
       , T1.ROUT_TP_CD
       , T1.ROUT_CD
       , T2.ROUT_NM
       , T1.ROUT_SEQ
       , T1.UPD_USR_ID
    FROM TB_PROD_ROUT_MAP T1
       , TB_PROD_ROUT     T2
   WHERE 1 = 1
     AND T1.CHNL_CD     = #CHNL_CD#
     AND T1.ROUT_TP_CD  = #ROUT_TP_CD#
     AND T1.CHNL_CD     = T2.CHNL_CD
     AND T1.ROUT_CD     = T2.ROUT_CD
  ORDER BY T1.ROUT_SEQ   
  </select>
    
  <insert id="M6629InsertDetail" parameterClass="ModelsLibrary.Man.ManVo">
   INSERT INTO TB_PROD_ROUT_MAP ( 
       CHNL_CD
     , ROUT_TP_CD
     , ROUT_CD
     , ROUT_SEQ
     , CRE_USR_ID
     , CRE_DT
     , UPD_USR_ID
     , UPD_DT
    ) VALUES (
       #CHNL_CD#
     , #ROUT_TP_CD#
     , #ROUT_CD#
     , ISNULL((SELECT MAX(ROUT_SEQ) + 1 FROM TB_PROD_ROUT_MAP WHERE ROUT_TP_CD = #ROUT_TP_CD#), 1)
     , #CRE_USR_ID#
     , GETDATE()
     , #UPD_USR_ID#
     , GETDATE()
    )
  </insert>

  <delete id="M6629DeleteDetail" parameterClass="ModelsLibrary.Man.ManVo">
   DELETE FROM TB_PROD_ROUT_MAP
      WHERE 1 = 1
        AND CHNL_CD     = #CHNL_CD#
        AND ROUT_TP_CD  = #ROUT_TP_CD#
        AND ROUT_CD     = #ROUT_CD#
  </delete>
    
  <select id="M6629SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT CHNL_CD
         , ROUT_CD
         , SUB_CD
         , ROUT_NM
         , ROUT_MV_CTNT
         , ROUT_ORD_SEQ
         , #CRE_USR_ID#  AS CRE_USR_ID
         , #CRE_USR_ID#  AS UPD_USR_ID
         , #ROUT_TP_CD#  AS ROUT_TP_CD
     FROM TB_PROD_ROUT
      WHERE 1 = 1
        AND CHNL_CD = #CHNL_CD#
  </select>    
  

    <!-- M66211 센서 관리 -->
    <select id="M66211SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
       SELECT 
          CHNL_CD
        , SENS_CD
        , SENS_NM
        , SENS_BSE_VAL
        , SENS_TOL_VAL
        , (CASE WHEN DELT_FLG = 'N' THEN '사용' ELSE '미사용' END) AS DELT_FLG
      FROM TB_CD_EQ_SENS
        WHERE 1=1 
          AND CHNL_CD = #CHNL_CD#
        <isNotNull property="DELT_FLG" >
          AND DELT_FLG = #DELT_FLG#
        </isNotNull>
    </select>
    
  <insert id="M66211InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
   INSERT INTO TB_CD_EQ_SENS 
   (
        CHNL_CD
      , SENS_CD
      , SENS_NM
      , SENS_BSE_VAL
      , SENS_TOL_VAL
      , DELT_FLG
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
    ) VALUES (
       #CHNL_CD#
     , #SENS_CD#
     , #SENS_NM#
     , #SENS_BSE_VAL#
     , #SENS_TOL_VAL#
     , #DELT_FLG#
     , #CRE_USR_ID#
     , GETDATE()
     , #UPD_USR_ID#
     , GETDATE()
    )
  </insert>

  <update id="M66211UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
   UPDATE TB_CD_EQ_SENS
     SET SENS_NM      = #SENS_NM#
       , SENS_BSE_VAL = #SENS_BSE_VAL#
       , SENS_TOL_VAL = #SENS_TOL_VAL#
       , DELT_FLG     = #DELT_FLG#
       , UPD_USR_ID   = #UPD_USR_ID#
       , UPD_DT       = GETDATE()
    WHERE 1 = 1
      AND CHNL_CD  = #CHNL_CD#
      AND SENS_CD  = #SENS_CD#
  </update>
      
  <delete id="M66211DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
    DELETE FROM TB_CD_EQ_SENS
      WHERE 1 = 1
        AND CHNL_CD  = #CHNL_CD#
        AND SENS_CD  = #SENS_CD#
  </delete>  
    
    
    <!-- M66110 휴무일 관리 -->
     <select id="M66110SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT  
            CHNL_CD
          , CONVERT(VARCHAR(10), EXPT_DT, 120) AS EXPT_DT
          , EXPT_RMK 
          , UPD_USR_ID
        FROM TB_PROD_MON_CLD
          WHERE 1=1 
            AND CHNL_CD = #CHNL_CD#
      </select>

     <insert id="M66110InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
        INSERT INTO TB_PROD_MON_CLD
        (
            CHNL_CD
          , EXPT_DT
          , EXPT_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
        )
        VALUES
        (
              #CHNL_CD#
            , #EXPT_DT#
            , #EXPT_RMK#
            , #CRE_USR_ID#
	        , GETDATE()
	        , #UPD_USR_ID#
	        , GETDATE()
        )
    </insert>
    
    <update id="M66110UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
     UPDATE TB_PROD_MON_CLD
       SET EXPT_RMK      = #EXPT_RMK#
         , UPD_USR_ID   = #UPD_USR_ID#
         , UPD_DT       = GETDATE()
      WHERE 1 = 1
          AND CONVERT(VARCHAR(10), EXPT_DT, 120) = #EXPT_DT#
          AND CHNL_CD = #CHNL_CD#
    </update>
    
    <delete id="M66110DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_MON_CLD
        WHERE CONVERT(VARCHAR(10), EXPT_DT, 120) = #EXPT_DT#
          AND CHNL_CD = #CHNL_CD#
    </delete>
    
	  
	  <!-- M665100  주간 계획 관리 -->
     <select id="M665100SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT	  CHNL_CD
		        , CONVERT(VARCHAR, WKY_FM_DT, 23) AS FM_DT
	            , CONVERT(VARCHAR, WKY_TO_DT, 23) AS TO_DT
		        , WKY_YRMON
		        , WK
			    , (WKY_YRMON + ' / ' + CONVERT(VARCHAR, WK)) AS GBN
	        FROM TB_PROD_WKY
                WHERE 1=1 
                    AND CHNL_CD = #CHNL_CD#
      </select>

     <insert id="M665100InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
        INSERT INTO TB_PROD_WKY
        (
            CHNL_CD
          , WKY_FM_DT
          , WKY_TO_DT
		  , WKY_YRMON
		  , WK
        )
        VALUES
        (
            #CHNL_CD#
          , #FM_DT#
          , #TO_DT#
		  , #WKY_YRMON#
		  , #WK#
        )
    </insert>
    
    <update id="M665100UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
     UPDATE TB_PROD_WKY
       SET WKY_FM_DT    = #FM_DT#
         , WKY_TO_DT    = #TO_DT#
		 , WKY_YRMON    = #WKY_YRMON#
		 , WK           = #WK#
      WHERE 1 = 1
          AND WKY_YRMON = #MM_RMK#
		  AND WK        = #MM_12#
          AND CHNL_CD   = #CHNL_CD#
    </update>
    
    <delete id="M665100DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_WKY
        WHERE 1 = 1
          AND WKY_YRMON = #WKY_YRMON#
		  AND WK        = #WK#
          AND CHNL_CD   = #CHNL_CD#
    </delete>
	  
    
    
    <!-- M6651 월 생산계획수립 -->    
   <select id="M6651SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
     <!--WITH TMP AS (
        SELECT T1.CHNL_CD
              , T1.PROD_PLN_NO
              , SUM(T3.PROD_GD_QTY) AS PROD_QTY
          FROM TB_PROD_MON_PLN   T1 
              , TB_PROD_LOT_DIV   T2
              , TB_PROD_JB_ORD    T3
          WHERE 1 = 1
            AND T1.CHNL_CD     = #CHNL_CD#     
            AND T1.CHNL_CD     = T2.CHNL_CD
            AND T1.CHNL_CD     = T3.CHNL_CD
            AND T2.LOT_DIV_NO  = T3.LOT_DIV_NO
            AND T1.PROD_PLN_DT >= CAST(#FM_DT# + '01 00:00:00' AS DATETIME)
            AND T1.PROD_PLN_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST(#FM_DT# + '01 00:00:00' AS DATETIME)), 112) + ' 23:59:59' AS DATETIME) 
      GROUP BY T1.CHNL_CD
              , T1.PROD_PLN_NO     
      )    
      SELECT  
          ROW_NUMBER() OVER (PARTITION BY T1.MCHN_NO ORDER BY T1.PROD_PLN_DT) AS RN
        , T1.CHNL_CD
        , T1.PROD_PLN_NO
        , T1.SL_PLN_NO
        , CONVERT(VARCHAR(10), T1.PLN_APLY_ST_DT, 120) AS PLN_APLY_ST_DT
        , CONVERT(VARCHAR(10), T1.PLN_APLY_END_DT, 120) AS PLN_APLY_END_DT
        , T1.PLN_DYS
        , T1.MCHN_NO
        , dbo.FF_EQ_NM_FNC(T1.CHNL_CD, T1.MCHN_NO) AS MCHN_NM
        , T1.PROD_PLN_QTY
        , T1.PROD_PLN_RMK
        , T1.CLZ_FLG
        , CONVERT(VARCHAR(10), T1.PROD_PLN_DT, 120) AS PROD_PLN_DT
        , T2.N1ST_ITM_GRP_CD
        , dbo.PUR_N1ST_GRP_NM_FNC(T2.CHNL_CD, 'G', T2.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM 
        , T2.SL_PLN_QTY
        , T2.SL_PLN_RMK
        , T3.PROD_QTY
        , dbo.FF_N1ST_ITM_STK_QTY(T1.CHNL_CD,  T2.N1ST_ITM_GRP_CD)  AS N1ST_ITM_STK_QTY
		, T2.SL_PLN_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'S-050', T2.SL_PLN_CD)  AS SL_PLN_NM  
		, T2.SL_ORD_NO
	    , T2.SL_ORD_SEQ
     FROM TB_PROD_MON_PLN   T1          
           LEFT OUTER JOIN TMP T3
           ON ( T1.CHNL_CD = T3.CHNL_CD AND T1.PROD_PLN_NO = T3.PROD_PLN_NO )
        , TB_SL_MON_PLN     T2  
      WHERE 1=1 
        AND T1.CHNL_CD      = T2.CHNL_CD
        AND T1.SL_PLN_NO    = T2.SL_PLN_NO
        AND T1.CHNL_CD      = #CHNL_CD#-->
	   
	   SELECT 
	            ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY  T5.PROD_PLN_NO) AS RN
	          , dbo.PUR_N1ST_GRP_NM_FNC(T3.CHNL_CD, 'G', T4.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
              , T1.SO_NB AS SL_ORD_NO
              , T2.SO_SQ AS SL_ORD_SEQ
	          , dbo.CD_COMPANY_NM_FNC(T3.CHNL_CD, T3.SL_CO_CD) AS  CO_NM
              , T2.ITEM_CD AS ITM_CD
              , T4.ITM_NM
              , T4.ITM_SZ_NM
              , T2.SO_QT AS SL_PLN_QTY
	          , T5.SL_PLN_NO
              , T5.PROD_PLN_NO
	          , T5.PROD_PLN_QTY
			  , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD, 'L-003', T4.UOM_CD)  AS UOM_NM
              , CONVERT(VARCHAR(10), CONVERT(DATETIME, T2.DUE_DT), 120) AS DUE_DT
              , T3.SL_PLN_CD
              , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD, 'S-050', T3.SL_PLN_CD)  AS SL_PLN_NM
              , T3.SL_PLN_RMK
			  , CONVERT(VARCHAR(10), T5.PLN_APLY_ST_DT, 120) AS PLN_APLY_ST_DT
              , CONVERT(VARCHAR(10), T5.PLN_APLY_END_DT, 120) AS PLN_APLY_END_DT
			  , CONVERT(VARCHAR(5), T5.WRK_ST_DT,108) AS WRK_ST_DT
              , CONVERT(VARCHAR(5), T5.WRK_END_DT,108) AS WRK_END_DT
			  , T5.INP_STAFF_VAL
              , T5.PLN_DYS
			  , T5.MCHN_NO
              , dbo.FF_EQ_NM_FNC(T5.CHNL_CD, T5.MCHN_NO) AS MCHN_NM
              , T5.PROD_PLN_RMK
              , T5.CLZ_FLG
              , CONVERT(VARCHAR(10), T5.PROD_PLN_DT, 120) AS PROD_PLN_DT
			  , T4.CHNL_CD
         FROM DZICUBE.dbo.LSO T1
             ,DZICUBE.dbO.LSO_D T2
	        LEFT OUTER JOIN TB_SL_MON_PLN T3
              ON(
		            T2.SO_NB = T3.SL_ORD_NO
		        AND T2.SO_SQ  = T3.SL_ORD_SEQ
		        AND T3.CHNL_CD = #CHNL_CD#
		        AND T2.ITEM_CD = T3.ITM_CD
	          )
             , TB_CD_ITM T4
	         , TB_PROD_MON_PLN T5
        WHERE 1 = 1 
          AND T1.CO_CD = T2.CO_CD
          AND T1.SO_NB = T2.SO_NB
          AND T3.ITM_CD = T4.ITM_CD
          AND T4.CHNL_CD = #CHNL_CD#
          AND T4.ITM_GRP_CLSS_CD = 'G'
          AND T3.CHNL_CD = T5.CHNL_CD 
          AND T3.SL_PLN_NO = T5.SL_PLN_NO
        <isNotNull property="FM_DT" >
         AND T5.PROD_PLN_DT >= CAST(#FM_DT# + '01 00:00:00' AS DATETIME)
         AND T5.PROD_PLN_DT <![CDATA[<=]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST(#FM_DT# + '01 00:00:00' AS DATETIME)), 112) + ' 23:59:59' AS DATETIME)
         <!--AND CONVERT(VARCHAR(6), T1.PROD_PLN_DT, 112) = #FM_DT# -->
       </isNotNull>
        <isNotNull property="PROD_PLN_NO" >
          AND T5.PROD_PLN_NO = #PROD_PLN_NO#
        </isNotNull>
        <isNotNull property="SL_PLN_NO" >
          AND T5.SL_PLN_NO = #SL_PLN_NO#
        </isNotNull>
    </select>
	  

    <insert id="M6651InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
       INSERT INTO TB_PROD_MON_PLN
        (
            CHNL_CD
          , PROD_PLN_NO
          , SL_PLN_NO
          , PLN_APLY_ST_DT
          , PLN_APLY_END_DT
          , PLN_DYS
          , MCHN_NO
          , PROD_PLN_QTY
          , PROD_PLN_RMK
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , CLZ_FLG
          , PROD_PLN_DT
          , INP_STAFF_VAL
		  , WRK_ST_DT
		  , WRK_END_DT
        )
        VALUES
        (   
            #CHNL_CD#
          , #PROD_PLN_NO# 
          , #SL_PLN_NO#
          , #PLN_APLY_ST_DT#
          , #PLN_APLY_END_DT#
          , #PLN_DYS#
          , #MCHN_NO#
          , #PROD_PLN_QTY#
          , #PROD_PLN_RMK#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          , #CLZ_FLG#
          , #PROD_PLN_DT#
          , #INP_STAFF_VAL#
          , #WRK_ST_DT#
          , #WRK_END_DT#
        )

    </insert>
    
    <update id="M6651UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_MON_PLN
       SET
          SL_PLN_NO       = #SL_PLN_NO#
        <!--
        , PLN_APLY_ST_DT  = #PLN_APLY_ST_DT#
        , PLN_APLY_END_DT = #PLN_APLY_END_DT#
        , PLN_DYS         = #PLN_DYS#
        -->
        , MCHN_NO         = #MCHN_NO#
        , PROD_PLN_QTY    = #PROD_PLN_QTY#
        , PROD_PLN_RMK    = #PROD_PLN_RMK#
        , UPD_USR_ID      = #UPD_USR_ID#
        , UPD_DT          = GETDATE() 
        , CLZ_FLG         = #CLZ_FLG#
        , PROD_PLN_DT     = #PROD_PLN_DT#
        , INP_STAFF_VAL   = #INP_STAFF_VAL#
        , WRK_ST_DT       = #WRK_ST_DT#
        , WRK_END_DT      = #WRK_END_DT#
      WHERE CHNL_CD       = #CHNL_CD#
        AND PROD_PLN_NO   = #PROD_PLN_NO#
    </update>
    
    <delete id="M6651DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_MON_PLN
        WHERE PROD_PLN_NO = #PROD_PLN_NO#
          AND CHNL_CD     = #CHNL_CD#
    </delete>

    
   <!-- M6682 금형도면이력관리 -->    
    <select id="M6682SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY MOLD_CD ORDER BY ITM_MOLD_SEQ DESC) AS RN
        , CONVERT(VARCHAR, CRE_DT, 20) AS CRE_DT
        , CRE_USR_ID
        , MOLD_CD
        , ITM_MOLD_SEQ
        , MOLD_NM
        , MOLD_FILE
        , MOLD_FILE_NM
        , MOLD_RMK
        , CHNL_CD
      FROM TB_CD_ITM_MOLD_RVIS
        WHERE 1 = 1
          AND DELT_FLG  = 'N'
          AND CHNL_CD   = #CHNL_CD#
        <isNotNull property="MOLD_NO" >
          AND MOLD_CD     = #MOLD_NO#
        </isNotNull>
    </select>
    
    <!-- 금형도면이력 - 추가 -->
    <insert id="M6682InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_CD_ITM_MOLD_RVIS
      (
          CHNL_CD
        , MOLD_CD
        , ITM_MOLD_SEQ
        , MOLD_NM
        , MOLD_FILE
        , MOLD_FILE_NM
        , MOLD_RMK
        , DELT_FLG
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      )
      VALUES
      (
          #CHNL_CD#
        , #MOLD_NO#
        , (SELECT ISNULL(MAX(ITM_MOLD_SEQ), 0) + 1 FROM TB_CD_ITM_MOLD_RVIS WHERE MOLD_CD = #MOLD_NO# AND CHNL_CD = #CHNL_CD#)
        , #MOLD_NM#
        , #MOLD_FILE#
        , #MOLD_FILE_NM#
        , #MOLD_RMK#
        , #DELT_FLG#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <!-- 금형도면이력 - 수정 -->
    <update id="M6682UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_CD_ITM_MOLD_RVIS
      SET   MOLD_NM       = #MOLD_NM#
          , MOLD_FILE     = #MOLD_FILE#
          , MOLD_FILE_NM  = #MOLD_FILE_NM#
          , MOLD_RMK      = #MOLD_RMK#
          , DELT_FLG      = #DELT_FLG#
          , UPD_USR_ID    = #UPD_USR_ID#
          , UPD_DT        = GETDATE()
          , CHNL_CD       = #CHNL_CD#
      WHERE 1 = 1
        AND MOLD_CD       = #MOLD_NO#
        AND ITM_MOLD_SEQ  = #ITM_MOLD_SEQ#
        AND CHNL_CD       = #CHNL_CD#
    </update>
    
    <!-- 금형도면이력 - 삭제 -->
    <delete id="M6682DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_CD_ITM_MOLD_RVIS
        WHERE 1 = 1
          AND MOLD_CD       = #MOLD_NO#
          AND ITM_MOLD_SEQ  = #ITM_MOLD_SEQ#
          AND CHNL_CD       = #CHNL_CD#
    </delete>
    
    

   <!-- M6683 설비도면이력관리 -->    
    <select id="M6683SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY EQ_CD ORDER BY ITM_EQ_SEQ DESC) AS RN
        , CONVERT(VARCHAR, CRE_DT, 20) AS CRE_DT
        , CRE_USR_ID
        , EQ_NM
        , EQ_FILE
        , EQ_FILE_NM
        , EQ_RMK
        , EQ_CD AS PROD_EQ_NO
        , ITM_EQ_SEQ
        , CHNL_CD
      FROM TB_CD_ITM_EQ_RVIS
        WHERE 1 = 1
          AND DELT_FLG  = 'N'
          AND CHNL_CD   = #CHNL_CD#
        <isNotNull property="PROD_EQ_NO" >
          AND EQ_CD     = #PROD_EQ_NO#
        </isNotNull>
    </select>
    
    <!-- 설비도면이력 - 추가 -->
    <insert id="M6683InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_CD_ITM_EQ_RVIS
      (
          CHNL_CD
        , EQ_CD
        , ITM_EQ_SEQ
        , EQ_NM
        , EQ_FILE_NM
        , EQ_RMK
        , EQ_FILE
        , DELT_FLG
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      )
      VALUES
      (
          #CHNL_CD#
        , #PROD_EQ_NO#
        , (SELECT ISNULL(MAX(ITM_EQ_SEQ), 0) + 1 FROM TB_CD_ITM_EQ_RVIS WHERE EQ_CD = #PROD_EQ_NO# AND CHNL_CD = #CHNL_CD#)
        , #EQ_NM#
        , #EQ_FILE_NM#
        , #EQ_RMK#
        , #EQ_FILE#
        , #DELT_FLG#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <!-- 설비도면이력 - 수정 -->
    <update id="M6683UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_CD_ITM_EQ_RVIS
      SET   EQ_NM         = #EQ_NM#
          , EQ_FILE       = #EQ_FILE#
          , EQ_RMK        = #EQ_RMK#
          , EQ_FILE_NM    = #EQ_FILE_NM#
          , DELT_FLG      = #DELT_FLG#
          , UPD_USR_ID    = #UPD_USR_ID#
          , UPD_DT        = GETDATE()
          , CHNL_CD       = #CHNL_CD#
      WHERE 1 = 1
        AND EQ_CD       = #PROD_EQ_NO#
        AND ITM_EQ_SEQ  = #ITM_EQ_SEQ#
        AND CHNL_CD     = #CHNL_CD#
    </update>
    
    <!-- 설비도면이력 - 삭제 -->
    <delete id="M6683DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_CD_ITM_EQ_RVIS
        WHERE 1 = 1
          AND EQ_CD      = #PROD_EQ_NO#
          AND ITM_EQ_SEQ = #ITM_EQ_SEQ#
          AND CHNL_CD    = #CHNL_CD#
    </delete>
    
    
    <!-- M6681 제품도면이력관리 -->    
     <select id="M6681SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.ITM_CD) AS RN 
           , T1.ITM_CD
           , T1.ITM_NM
           , T1.ITM_SZ_NM
           , dbo.CD_SYS_CLSS_FNC( T1.CHNL_CD, 'DH02', T1.MTRL_NM_CD) AS GBN
           , T1.N1ST_ITM_GRP_CD
           , (SELECT X.CAR_TP_NM FROM TB_CD_CAR_TP AS X  WHERE 1=1 AND X.CAR_TP_CD = T1.N1ST_ITM_GRP_CD AND X.CHNL_CD = T1.CHNL_CD) AS N1ST_ITM_GRP_NM
           <!--, (SELECT MAX(X.DWG_NM) FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N') AS DWG_NM
           , (SELECT MAX(X.DWG_FILE_NM)_NM FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N') AS DWG_FILE_NM
           , (SELECT MAX(X.DWG_RMK) FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N') AS DWG_RMK-->
           , (SELECT TOP 1 X.DWG_NM FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N'  ORDER BY X.UPD_DT DESC) AS DWG_NM
           , (SELECT TOP 1 X.DWG_FILE_NM FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N'  ORDER BY X.UPD_DT DESC) AS DWG_FILE_NM
           , (SELECT TOP 1 X.DWG_RMK FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N' ORDER BY X.UPD_DT DESC) AS DWG_RMK
       FROM TB_CD_ITM   T1
       <!--LEFT OUTER JOIN TB_CD_ITM_DWG_RVIS T2
          ON ( T1.ITM_CD      = T2.ITM_CD
              AND T1.CHNL_CD  = T2.CHNL_CD 
              AND T2.DELT_FLG = 'N' 
              )-->
       WHERE 1 = 1
         AND T1.CHNL_CD          = #CHNL_CD#
         AND T1.ITM_GRP_CLSS_CD  = 'G' 
         AND T1.DELT_FLG         = 'N'   
      </select>
    
    <!-- 도면이력 - 조회 -->
    <select id="M6681SelectDwg" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY ITM_CD ORDER BY ITM_DWG_SEQ DESC) AS RN
        , CONVERT(VARCHAR, CRE_DT, 20) AS CRE_DT
        , CRE_USR_ID
        , DWG_NM
        , DWG_FILE
        , DWG_FILE_NM
        , DWG_RMK
        , ITM_CD
        , ITM_DWG_SEQ
        , CHNL_CD
      FROM TB_CD_ITM_DWG_RVIS
        WHERE 1 = 1
          AND DELT_FLG = 'N'
          AND ITM_CD   = #ITM_CD#
          AND CHNL_CD  = #CHNL_CD#
    </select>
    <!-- 도면이력 - 추가 -->
    <insert id="M6681InsertDwg" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_CD_ITM_DWG_RVIS 
      (
          ITM_CD
        , ITM_DWG_SEQ
        , DWG_NM
        , DWG_FILE
        , DWG_FILE_NM
        , DWG_RMK
        , DELT_FLG
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , CHNL_CD
      ) 
      VALUES 
      (
          #ITM_CD#
        , (SELECT ISNULL(MAX(ITM_DWG_SEQ), 0) + 1 FROM TB_CD_ITM_DWG_RVIS WHERE ITM_CD = #ITM_CD# AND CHNL_CD = #CHNL_CD#)
        , #DWG_NM#
        , #DWG_FILE#
        , #DWG_FILE_NM#
        , #DWG_RMK#
        , #DELT_FLG#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
        , #CHNL_CD#
      )
    </insert>
    <!-- 도면이력 - 수정 -->
    <update id="M6681UpdateDwg" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_CD_ITM_DWG_RVIS
      SET   DWG_NM       = #DWG_NM#
          , DWG_FILE     = #DWG_FILE#
          , DWG_RMK      = #DWG_RMK#
          , DWG_FILE_NM  = #DWG_FILE_NM#
          , DELT_FLG     = #DELT_FLG#
          , UPD_USR_ID   = #UPD_USR_ID#
          , UPD_DT       = GETDATE()
      WHERE 1 = 1
        AND ITM_CD      = #ITM_CD#
        AND ITM_DWG_SEQ = #ITM_DWG_SEQ#
        AND CHNL_CD     = #CHNL_CD#
    </update>
    <!-- 도면이력 - 삭제 -->
    <delete id="M6681DeleteDwg" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_CD_ITM_DWG_RVIS
        WHERE 1 = 1
          AND ITM_CD      = #ITM_CD#
          AND ITM_DWG_SEQ = #ITM_DWG_SEQ#
          AND CHNL_CD     = #CHNL_CD#
    </delete>

    <!-- 작업표준서이력 - 조회 -->
    <select id="M6681SelectWrk" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY ITM_CD ORDER BY ITM_WRK_DOC_SEQ DESC) AS RN
        , CONVERT(VARCHAR, CRE_DT, 20) AS CRE_DT
        , CRE_USR_ID
        , WRK_DOC_NM
        , WRK_DOC_FILE
        , WRK_DOC_FILE_NM
        , WRK_DOC_RMK
        , ITM_CD
        , ITM_WRK_DOC_SEQ
        , CHNL_CD
      FROM TB_CD_ITM_WRK_DOC_RVIS
      WHERE 1 = 1
        AND DELT_FLG = 'N'
        AND ITM_CD   = #ITM_CD#
        AND CHNL_CD  = #CHNL_CD#
      
    </select>
    <!-- 작업표준서이력 - 추가 -->
    <insert id="M6681InsertWrk" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_CD_ITM_WRK_DOC_RVIS
      (
          ITM_CD
        , ITM_WRK_DOC_SEQ
        , WRK_DOC_FILE
        , WRK_DOC_FILE_NM
        , WRK_DOC_RMK
        , WRK_DOC_NM
        , DELT_FLG
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , CHNL_CD
      )
      VALUES
      (
          #ITM_CD#
        , (SELECT ISNULL(MAX(ITM_WRK_DOC_SEQ), 0) + 1 FROM TB_CD_ITM_WRK_DOC_RVIS WHERE ITM_CD = #ITM_CD# AND  CHNL_CD = #CHNL_CD#)
        , #WRK_DOC_FILE#
        , #WRK_DOC_FILE_NM#
        , #WRK_DOC_RMK#
        , #WRK_DOC_NM#
        , #DELT_FLG#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
        , #CHNL_CD#
      )
    </insert>
    <!-- 작업표준서이력 - 수정 -->
    <update id="M6681UpdateWrk" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_CD_ITM_WRK_DOC_RVIS
      SET   WRK_DOC_NM       = #WRK_DOC_NM#
          , WRK_DOC_FILE     = #WRK_DOC_FILE#
          , WRK_DOC_RMK      = #WRK_DOC_RMK#
          , WRK_DOC_FILE_NM  = #WRK_DOC_FILE_NM#
          , DELT_FLG         = #DELT_FLG#
          , UPD_USR_ID       = #UPD_USR_ID#
          , UPD_DT           = GETDATE()
      WHERE 1 = 1
      AND ITM_CD          = #ITM_CD#
      AND ITM_WRK_DOC_SEQ = #ITM_WRK_DOC_SEQ#
      AND CHNL_CD         = #CHNL_CD#
    </update>
    <!-- 작업표준서이력 - 삭제 -->
    <delete id="M6681DeleteWrk" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_CD_ITM_WRK_DOC_RVIS
        WHERE 1 = 1
          AND CHNL_CD         = #CHNL_CD#
          AND ITM_CD          = #ITM_CD#
          AND ITM_WRK_DOC_SEQ = #ITM_WRK_DOC_SEQ#
    </delete>
    
    
	  <!-- 목형코드관리 - 조회 -->
	  <select id="M6661SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT ROW_NUMBER() OVER (PARTITION BY T1.ITM_CD ORDER BY T1.MOLD_NO DESC) AS RN
		      , T1.CHNL_CD
		      , T1.MOLD_NO
		      , T1.MOLD_SEQ
		      , T1.MOLD_NO + '-' + CONVERT(VARCHAR, T1.MOLD_SEQ) AS GBN
		      , T1.MOLD_SZ
		      , T1.ITM_CD
		      , T1.ITM_NM
		      , T1.MAKE_CO_CD
		      , T3.MAKE_CO_NM
		      , T1.MOLD_CAPA_QTY
		      , CONVERT(VARCHAR(10), T1.DISCRD_DT, 120) AS DISCRD_DT
		      , T1.DISCRD_RSN
		      , T1.MOLD_RMK
		      , (CASE WHEN T1.DELT_FLG = 'N' THEN '사용' ELSE '미사용' END) AS DELT_FLG
		      , T1.BSS_WGT
		      , T1.MTRL_SZ_NM
		      , T1.CUT_SZ_NM
		   FROM TB_PROD_MOLD_CD T1
		        OUTER APPLY (
		              SELECT CO_NM AS MAKE_CO_NM
		                FROM TB_CD_CO X
		               WHERE 1 = 1
		                 AND X.CHNL_CD  = #CHNL_CD#
		                 AND X.CO_NO    = T1.MAKE_CO_CD
		         ) T3
		  WHERE 1 = 1
		    AND CHNL_CD   = #CHNL_CD#
          <isNotNull property="ITM_CD" >
	        AND ITM_CD    = #ITM_CD#
		  </isNotNull>
		  <isNotNull property="DELT_FLG" >
			AND DELT_FLG  =  #DELT_FLG#
		  </isNotNull>
	  </select>

	  <!-- 목형코드관리 - 추가 -->
	  <insert id="M6661InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_MOLD_CD
		  (
		        CHNL_CD
		      , MOLD_NO
		      , MOLD_SEQ
		      , MOLD_SZ
		      , ITM_CD
		      , ITM_NM
		      , MAKE_CO_CD
		      , MOLD_CAPA_QTY
		      , DISCRD_DT
		      , DISCRD_RSN
		      , MOLD_RMK
		      , DELT_FLG
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		      , BSS_WGT
		      , MTRL_SZ_NM
		      , CUT_SZ_NM
		  )
		  VALUES
		  (
		        #CHNL_CD#
		      , #MOLD_NO#
		      , #MOLD_SEQ#
		      , #MOLD_SZ#
		      , #ITM_CD#
		      , #ITM_NM#
		      , #MAKE_CO_CD#
		      , #MOLD_CAPA_QTY#
		      , #DISCRD_DT#
		      , #DISCRD_RSN#
		      , #MOLD_RMK#
		      , #DELT_FLG#
		      , #CRE_USR_ID#
		      , GETDATE()
		      , #UPD_USR_ID#
		      , GETDATE()
		      , #BSS_WGT#
		      , #MTRL_SZ_NM#
		      , #CUT_SZ_NM#
		  )
	  </insert>


	  <!-- 목형코드관리 - 수정 -->
	  <update id="M6661UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_PROD_MOLD_CD
		      SET
		        MOLD_SZ          = #MOLD_SZ#
		      , ITM_CD          = #ITM_CD#
		      , MAKE_CO_CD      = #MAKE_CO_CD#
		      , MOLD_CAPA_QTY   = #MOLD_CAPA_QTY#
		      , DISCRD_DT       = #DISCRD_DT#
		      , DISCRD_RSN      = #DISCRD_RSN#
		      , MOLD_RMK        = #MOLD_RMK#
		      , DELT_FLG        = #DELT_FLG#
		      , UPD_USR_ID      = #UPD_USR_ID#
		      , UPD_DT          = GETDATE()
		      , MOLD_SEQ        = #MOLD_SEQ#
		      , ITM_NM          = #ITM_NM#
		      , BSS_WGT         = #BSS_WGT#
		      , MTRL_SZ_NM      = #MTRL_SZ_NM#
		      , CUT_SZ_NM       = #CUT_SZ_NM#
	      WHERE 1 = 1
		    AND CHNL_CD   = #CHNL_CD#
		    AND MOLD_NO + '-' + CONVERT(VARCHAR, MOLD_SEQ)    = #GBN#
	  </update>


	  <!-- 목형코드관리 - 삭제   -->
	  <delete id="M6661DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_MOLD_CD
		   WHERE 1 = 1
		     AND CHNL_CD   = #CHNL_CD#
		     AND MOLD_NO + '-' + CONVERT(VARCHAR, MOLD_SEQ)  = #GBN#
	  </delete>
  
    
    
  
    <!-- (BOM)공정품목맵핑 -->  
    <select id="M66212SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
           SELECT T1.ITM_CD
            , T1.ITM_NM
            , T1.ITM_SZ_NM
            , T1.N1ST_ITM_GRP_CD
            , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T1.ITM_GRP_CLSS_CD , T1.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
            , dbo.PUR_N2ST_GRP_NM_FNC(T1.CHNL_CD, T1.ITM_GRP_CLSS_CD , T1.N1ST_ITM_GRP_CD, T1.N2ND_ITM_GRP_CD) AS N2ND_ITM_GRP_NM
            , T1.CHNL_CD
            , #CRE_USR_ID#  AS CRE_USR_ID
            , #UPD_USR_ID#  AS UPD_USR_ID
            , ISNULL(T2.MTRL_ITM_CD, '') AS MTRL_ITM_CD
            , ISNULL(dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T2.MTRL_ITM_CD), '')  AS MTRL_ITM_NM
            , ISNULL(T2.USE_QTY, 0) AS USE_QTY
            , ISNULL(T2.TOL_QTY, 0) AS TOL_QTY
           FROM TB_CD_ITM AS T1 LEFT OUTER JOIN TB_PROD_PROC_ITM_BOM AS T2 ON ( T1.CHNL_CD = T2.CHNL_CD AND T1.ITM_CD  = T2.ITM_CD AND T2.MTRL_ITM_SEQ = 1 ) 
            WHERE 1 = 1
              AND T1.CHNL_CD = #CHNL_CD#
              AND T1.ITM_GRP_CLSS_CD = 'G'
            <isNotNull property="ITM_CD" >
              AND T1.ITM_CD = #ITM_CD#
            </isNotNull>
    </select>
    
    <select id="M66212SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
     SELECT 
          ROW_NUMBER() OVER (PARTITION BY T1.ITM_CD ORDER BY T1.ROUT_SEQ) AS RN
        , T1.CHNL_CD
        , T1.ITM_CD
        , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD) AS ITM_NM
        , T1.ROUT_CD
        , T2.ROUT_NM
        , T1.ROUT_SEQ
        , T1.PROD_CLSS_CD
        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-005', T1.PROD_CLSS_CD) AS PROD_CLSS_NM
      FROM TB_PROD_ROUT_ITM_MAP AS T1, 
           TB_PROD_ROUT AS T2
       WHERE 1=1 
        AND T1.CHNL_CD = T2.CHNL_CD
        AND T1.ROUT_CD = T2.ROUT_CD
        AND T1.ITM_CD  = #ITM_CD#
        AND T1.CHNL_CD = #CHNL_CD#
    </select>
    
    <select id="M66212SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT 
              ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY ROUT_ORD_SEQ) AS RN
            , ROUT_ORD_SEQ
            , ROUT_CD
            , SUB_CD
            , ROUT_NM
            , ROUT_MV_CTNT
            , CHNL_CD
            , #CRE_USR_ID#  AS CRE_USR_ID
            , #UPD_USR_ID#  AS UPD_USR_ID
            , #ITM_CD#      AS ITM_CD
        FROM TB_PROD_ROUT
         WHERE CHNL_CD = #CHNL_CD#
    </select>

    <select id="M66212SelectMasterList" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
      SELECT
          ROW_NUMBER() OVER (PARTITION BY T1.ITM_CD ORDER BY T1.MTRL_ITM_SEQ) AS RN
        , T1.CHNL_CD
        , T1.ITM_CD
        , T1.MTRL_ITM_SEQ
        , T1.MTRL_ITM_CD
        , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD) AS MTRL_ITM_NM
        , T1.USE_QTY
        , T1.TOL_QTY
        , #CRE_USR_ID# AS CRE_USR_ID
        , #UPD_USR_ID# AS UPD_USR_ID
      FROM TB_PROD_PROC_ITM_BOM AS T1
        WHERE 1=1
          AND CHNL_CD = #CHNL_CD#
          AND ITM_CD  = #ITM_CD#
    </select>
    
     <!-- (BOM)공정품목맵핑 MST - 추가 -->
    <insert id="M66212InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_PROD_PROC_ITM_BOM
      (
          CHNL_CD
        , ITM_CD
        , MTRL_ITM_CD
        , MTRL_ITM_SEQ
        , USE_QTY
        , TOL_QTY
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
	        #CHNL_CD#
        , #ITM_CD#
        , #MTRL_ITM_CD#
        , #MTRL_ITM_SEQ#
        , #USE_QTY#
        , #TOL_QTY#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <!-- (BOM)공정품목맵핑 MST - 삭제   -->
    <delete id="M66212DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_PROC_ITM_BOM
         WHERE 1 = 1 
          AND CHNL_CD         = #CHNL_CD#
          AND ITM_CD          = #ITM_CD#
        <isNotNull property="MTRL_ITM_CD" >
          AND MTRL_ITM_CD     = #MTRL_ITM_CD#
        </isNotNull>
        <isNotNull property="MTRL_ITM_SEQ" >
          AND MTRL_ITM_SEQ    = #MTRL_ITM_SEQ#
        </isNotNull>
    </delete>
    
     <!-- (BOM)공정품목맵핑 DTL - 추가 -->
    <insert id="M66212InsertDetail" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_PROD_ROUT_ITM_MAP
      (
          CHNL_CD
        , ITM_CD
        , ROUT_CD
        , ROUT_SEQ
        , PROD_CLSS_CD
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , ROUT_ITM_CD
      ) VALUES (
	        #CHNL_CD#
        , #ITM_CD#
        , #ROUT_CD#
        , (SELECT ISNULL(MAX(ROUT_SEQ), 0) + 1 FROM TB_PROD_ROUT_ITM_MAP WHERE ITM_CD = #ITM_CD# AND  CHNL_CD = #CHNL_CD# )
        , #PROD_CLSS_CD#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
        , (#ROUT_CD# + '-' + #ITM_CD#)
      )
    </insert>
    
    <!-- (BOM)공정품목맵핑 DTL - 수정 -->
    <update id="M66212UpdateDetail" parameterClass="ModelsLibrary.Man.ManVo">
       UPDATE TB_PROD_ROUT_ITM_MAP
        SET 
            ROUT_SEQ      = #ROUT_SEQ#
          , PROD_CLSS_CD  = #PROD_CLSS_CD#
          , UPD_USR_ID    = #UPD_USR_ID#
          , UPD_DT        = GETDATE()
      WHERE 1 = 1 
          AND CHNL_CD   = #CHNL_CD#
          AND ITM_CD    = #ITM_CD#
          AND ROUT_CD   = #ROUT_CD#
    </update>
    
    <!-- (BOM)공정품목맵핑 DTL - 삭제   -->
    <delete id="M66212DeleteDetail" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_ROUT_ITM_MAP
         WHERE 1 = 1 
          AND CHNL_CD   = #CHNL_CD#
          AND ITM_CD    = #ITM_CD#
          AND ROUT_CD   = #ROUT_CD#
    </delete>
    
    
    <!-- (BOM)공정품목맵핑 DTL ITM 동기화 - 삭제   -->
    <delete id="M66212DeleteDetailSyncItm" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_CD_ITM
       WHERE ITM_GRP_CLSS_CD = 'H'
         AND CHNL_CD = #CHNL_CD#
    </delete>
    
    <!-- (BOM)공정품목맵핑 DTL ITM 동기화 - 추가 -->
    <insert id="M66212InsertDetailSyncItm" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_CD_ITM 
       ( 
            CHNL_CD
          , ITM_CD
          , PROD_LOC_CD
          , ITM_NM
          , ITM_GRP_CLSS_CD
          , UOM_CD
          , N1ST_ITM_GRP_CD
          , N2ND_ITM_GRP_CD
          , DELT_FLG
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
        )
         SELECT #CHNL_CD#
               , T1.ROUT_ITM_CD
               , '005'
               , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD) + '_' + T2.ITM_CD
               , 'H'
               , '001'
               , T2.N1ST_ITM_GRP_CD
               , T2.N2ND_ITM_GRP_CD
               , 'N'
               , #CRE_USR_ID#
               , GETDATE()
               , #UPD_USR_ID#
               , GETDATE()
           FROM TB_PROD_ROUT_ITM_MAP T1
              , TB_CD_ITM   T2
          WHERE 1 = 1
            AND T1.CHNL_CD = #CHNL_CD# 
            AND T1.CHNL_CD = T2.CHNL_CD
            AND T1.ITM_CD = T2.ITM_CD
            AND NOT EXISTS (SELECT 'X' 
                              FROM TB_CD_ITM X
                            WHERE 1 = 1
                              AND T1.ROUT_ITM_CD = X.ITM_CD
                              AND X.CHNL_CD = #CHNL_CD# )
    </insert>
    
    <!-- (BOM)공정품목맵핑 DTL BOM 동기화 - 삭제   -->
    <delete id="M66212DeleteDetailSyncBom" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_BOM WHERE 1 = 1 AND CHNL_CD = #CHNL_CD#
    </delete>
    
    <!-- (BOM)공정품목맵핑 DTL BOM 동기화 - 추가 -->
    <insert id="M66212InsertDetailSyncBom" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_PROD_BOM
        ( 
            ASSY_CD
          , ASSY_SEQ
          , CMPO_CD
          , INP_QTY
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , CHNL_CD
          , ROUT_ITM_CD
          , PROD_CLSS_CD
        )
        SELECT ASSY_CD
             , ASSY_SEQ
             , ISNULL(CMPO_CD, ISNULL(dbo.FF_PROD_PROC_MTRL_CD(#CHNL_CD#, ROUT_ITM_CD), 'XX')) AS CMPO_CD
             , 1
             , #CRE_USR_ID#
             , GETDATE()
             , #UPD_USR_ID#
             , GETDATE()
             , #CHNL_CD#
             , ROUT_ITM_CD
             , PROD_CLSS_CD
          FROM (
            SELECT ROUT_ITM_CD
                 , ASSY_CD
                 , ASSY_SEQ
                 , LEAD(ASSY_CD) OVER (PARTITION BY ROUT_ITM_CD ORDER BY ASSY_SEQ) AS CMPO_CD
                 , PROD_CLSS_CD
                 , ROUT_NM
              FROM (
                      SELECT ROUT_ITM_CD 
                           , ASSY_CD
                           , ROW_NUMBER() OVER (PARTITION BY ROUT_ITM_CD ORDER BY ASSY_SEQ DESC) AS ASSY_SEQ
                           , PROD_CLSS_CD
                           , dbo.FF_NM_ROUT(#CHNL_CD#, SUBSTRING(ASSY_CD, 1, 3)) AS ROUT_NM
                        FROM (
                                SELECT ROUT_ITM_CD   AS ASSY_CD
                                     , ROUT_SEQ      AS ASSY_SEQ
                                     , ITM_CD        AS ROUT_ITM_CD
                                     , PROD_CLSS_CD  
                                  FROM TB_PROD_ROUT_ITM_MAP
                                 WHERE 1 = 1
                                   AND CHNL_CD = #CHNL_CD#
                                UNION ALL 
                                SELECT ITM_CD
                                     , 99    
                                     , ITM_CD
                                     , '100'
                                  FROM TB_PROD_ROUT_ITM_MAP
                                 WHERE 1 = 1          
                                   AND CHNL_CD = #CHNL_CD#
                                GROUP BY ITM_CD  
                            ) T1
                      WHERE 1 = 1      
                   ) T1
        ) T1       
        WHERE ASSY_CD IS NOT NULL
    </insert>



	  
	<!-- (PDM)재공품번생성 및 제품데이터관리 -->
	<select id="M66213SelectMdl" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		<!--SELECT
		      MTRL_NM_CD AS MDL_CD
		    , (SELECT X.CAR_TP_NM  FROM TB_CD_CAR_TP X WHERE 1=1 AND X.CAR_TP_CD =  T2.MTRL_NM_CD AND X.CHNL_CD = #CHNL_CD#) AS MDL_NM
		FROM
		(
		    SELECT MTRL_NM_CD
	    	FROM TB_CD_ITM T1
		     WHERE 1 = 1
		        AND T1.CHNL_CD = #CHNL_CD#
		        AND T1.ITM_GRP_CLSS_CD = 'G'
		    GROUP BY T1.MTRL_NM_CD
		) AS T2
		ORDER BY MDL_CD-->

		SELECT 
		      CAR_TP_CD AS MDL_CD
		    , CAR_TP_NM AS MDL_NM
		FROM TB_CD_CAR_TP 
		    WHERE 1=1 
			    AND CHNL_CD = #CHNL_CD#
				AND DELT_FLG = 'N'
		ORDER BY CAR_TP_CD

	</select>
	  
	<select id="M66213SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		SELECT
		      TT.CHNL_CD
		    , TT.MDL_CD
		    , TT.MDL_NM
		    , TT.ITM_CD
		    , TT.ITM_NM
		    , TT.ITM_SZ_NM
		    , TT.N1ST_ITM_GRP_CD
		    , TT.N1ST_ITM_GRP_NM
		    , TT.UOM_NM
			, #CHNL_CD# AS CHNL_CD
			, MAX(TT.MTRL_ITM_CD) AS MTRL_ITM_CD
			, MAX(dbo.CD_ITEM_NM_FNC(TT.CHNL_CD, TT.MTRL_ITM_CD)) AS MTRL_ITM_NM
			, MAX(TT.USE_QTY) AS USE_QTY
			, MAX(TT.TOL_QTY) AS TOL_QTY
		FROM
		(
		    SELECT
		          T1.CHNL_CD
		        , T3.CAR_TP_CD   AS MDL_CD
		        , T3.CAR_TP_NM   AS MDL_NM
		        , T1.ITM_CD
		        , T1.ITM_NM
		        , T1.ITM_SZ_NM
		        , T1.N1ST_ITM_GRP_CD
		        , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T1.ITM_GRP_CLSS_CD , T1.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
		        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T1.UOM_CD) AS UOM_NM
			    , ISNULL(T2.MTRL_ITM_CD, '') AS MTRL_ITM_CD
                , ISNULL(T2.USE_QTY, 0) AS USE_QTY
                , ISNULL(T2.TOL_QTY, 0) AS TOL_QTY
		      FROM MV_TB_CD_ITM AS T1 LEFT OUTER JOIN TB_PROD_PROC_ITM_BOM AS T2 ON ( T1.CHNL_CD = T2.CHNL_CD AND T1.ITM_CD  = T2.ITM_CD AND T2.MTRL_ITM_SEQ = 1 AND T1.ITM_GRP_CLSS_CD = 'G')
		            LEFT OUTER JOIN TB_CD_CAR_TP T3 ON ( T3.CHNL_CD = #CHNL_CD# AND T3.CAR_TP_CD = T1.MTRL_NM_CD)
		      WHERE 1 = 1
		          AND T1.CHNL_CD = #CHNL_CD#
		          AND T1.ITM_GRP_CLSS_CD = 'G'
			      AND T1.MTRL_NM_CD = T3.CAR_TP_CD
		      <isNotNull property="ITM_CD" >
			      AND T1.ITM_CD = #ITM_CD#
		      </isNotNull>
		      <isNotNull property="MDL_CD" >
			      AND T3.CAR_TP_CD  = #MDL_CD#
		      </isNotNull>
		) AS TT
	    GROUP BY TT.CHNL_CD, TT.MDL_CD, TT.MDL_NM, TT.ITM_CD, TT.ITM_NM, TT.ITM_SZ_NM, TT.N1ST_ITM_GRP_CD, TT.N1ST_ITM_GRP_NM, TT.UOM_NM 
	  </select>

	  <select id="M66213SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  <!--SELECT	  
		        T1.CMPO_CD
		      , T1.CMPO_NM
		      , T1.ROUT_CD
		      , (SELECT X.ROUT_NM FROM TB_PROD_ROUT X WHERE 1=1 AND X.CHNL_CD = T1.CHNL_CD AND X.ROUT_CD = T1.ROUT_CD ) AS ROUT_NM
		      , T1.ITM_CLSS_CD
		      , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-021', T1.ITM_CLSS_CD) AS ITM_CLSS_NM
		      , T1.SERS_COLR_CD
		      , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-022', T1.SERS_COLR_CD) AS SERS_COLR_NM
		      , T1.CHNL_CD AS CHNL_CD
		  FROM
		  (
		    SELECT T1.CMPO_CD
		            , ISNULL(T1.CMPO_SUB_NM, CMPO_NM) CMPO_NM
		            , MAX(T1.ROUT_CD ) AS ROUT_CD
		            , MAX(T1.ITM_CLSS_CD) AS ITM_CLSS_CD
		            , MAX(T1.SERS_COLR_CD ) AS SERS_COLR_CD
		            , MAX(T1.CHNL_CD) AS CHNL_CD
		      FROM TB_PROD_BOM  T1
		        , TB_CD_ITM    T2 
		      WHERE 1 = 1
		        AND T1.CHNL_CD        = #CHNL_CD#
		        AND T1.CHNL_CD        = T2.CHNL_CD
		        AND T1.ROUT_ITM_CD    = T2.ITM_CD
		        --><!--AND T2.MTRL_NM_CD     = #MDL_CD#--><!--
		      GROUP BY T1.CMPO_CD , ISNULL(T1.CMPO_SUB_NM, CMPO_NM)
			UNION ALL
                SELECT  T3.ITM_CD AS CMPO_CD
                  , T3.ITM_NM AS CMPO_NM
                  , SUBSTRING(T3.ITM_CD,10,2) AS ROUT_CD
                  , T3.N1ST_ITM_GRP_CD AS ITM_CLSS_CD
                  , T3.N2ND_ITM_GRP_CD AS SERS_COLR_CD
                  , T3.CHNL_CD AS CHNL_CD
             FROM TB_CD_ITM T3
            WHERE 1 = 1  
              AND T3.CHNL_CD =  #CHNL_CD#
              AND T3.ITM_GRP_CLSS_CD = 'W' 
              AND NOT EXISTS (SELECT 'X' FROM TB_PROD_BOM X WHERE 1 = 1 AND X.CMPO_CD = T3.ITM_CD )
		  ) AS T1-->
		  
		  SELECT T1.CMPO_CD
                 , T1.ITM_NM            AS CMPO_NM
                 , T1.ROUT_CD
                 , T2.ROUT_NM
                 , T1.ITM_CLSS_CD
                 , T1.N1ST_ITM_GRP_NM   AS ITM_CLSS_NM
                 , T1.SERS_COLR_CD
                 , T1.N2ND_ITM_GRP_NM   AS SERS_COLR_NM
				 , #CHNL_CD# AS CHNL_CD
              FROM (
                  SELECT T1.CMPO_CD
                       , T2.ITM_NM
                       , T1.ROUT_CD
                       , T2.MTRL_NM_CD
                       , T2.N1ST_ITM_GRP_CD   AS ITM_CLSS_CD
                       , T2.N2ND_ITM_GRP_CD   AS SERS_COLR_CD
                       , T2.N1ST_ITM_GRP_NM
                       , T2.N2ND_ITM_GRP_NM
                    FROM TB_PROD_BOM    T1
                       , MV_TB_CD_ITM   T2
                   WHERE 1 = 1 
                     AND T1.CHNL_CD = #CHNL_CD#
                     AND T1.CHNL_CD = T2.CHNL_CD
                     AND T1.CMPO_CD = T2.ITM_CD
                 <!--    AND T2.MTRL_NM_CD = 'AB018'-->
                  <!--UNION ALL 
                  SELECT T1.ITM_CD
                       , T1.ITM_NM
                       , SUBSTRING(T1.ITM_CD,10,2) AS ROUT_CD
                       , T1.MTRL_NM_CD
                       , T1.N1ST_ITM_GRP_CD
                       , T1.N2ND_ITM_GRP_CD           
                       , T1.N1ST_ITM_GRP_NM
                       , T1.N2ND_ITM_GRP_NM      
                    FROM MV_TB_CD_ITM T1
                   WHERE 1 = 1 
                     AND T1.CHNL_CD = #CHNL_CD#
                     AND T1.ITM_GRP_CLSS_CD = 'W'
                  --><!--   AND T1.MTRL_NM_CD = 'AB018'--><!--
                     AND NOT EXISTS (SELECT 'X'
                                       FROM TB_PROD_BOM X
                                      WHERE 1 = 1
                                        AND X.CHNL_CD = #CHNL_CD#
                                        AND X.CMPO_CD = T1.ITM_CD
                                     )-->
                ) T1, TB_PROD_ROUT T2
             WHERE 1 = 1
               AND T2.CHNL_CD = #CHNL_CD#
               AND T1.ROUT_CD = T2.ROUT_CD
            GROUP BY T1.CMPO_CD
                 , T1.ITM_NM
                 , T1.ROUT_CD
                 , T2.ROUT_NM
                 , T1.MTRL_NM_CD
                 , T1.N1ST_ITM_GRP_NM
                 , T1.N2ND_ITM_GRP_NM
                 , T1.ITM_CLSS_CD
                 , T1.SERS_COLR_CD
	  </select>


	   <select id="M66213SelectTree" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        WITH CTE_TABLE  AS
                    (
                        SELECT    0 AS LEVEL 
                                , T1.CMPO_CD
                                , T1.ASSY_CD 
                                , T3.ITM_NM
                                , CONVERT(VARCHAR(100), CAST(T1.CMPO_NM AS VARCHAR(100)) + ' > ' )  AS ITM_NM 
                                , T1.ASSY_SEQ
                                , T1.XCH_ITM_FLG
                                , T1.WRK_ENGER_NM
                                , T1.WRK_LOC_NM
                                , T1.BOM_DESC
                                , dbo.CD_ITEM_NM_FNC(#CHNL_CD#, T1.ASSY_CD) AS ASSY_NM
                                , dbo.CD_ITEM_NM_FNC(#CHNL_CD#, T1.CMPO_CD) AS CMPO_NM
                                , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T3.UOM_CD) AS UOM_NM  
                                , T1.ROUT_ITM_CD
                                , T1.PROD_CLSS_CD  
                                , T1.MOLD_CD  
                                , T1.MOLD_NO 
                                , T1.INP_QTY  
                                , T1.TOR_VAL 
                                , T1.SEQ, T1.UPSEQ
                          FROM TB_PROD_MULT_BOM T1
                             , TB_CD_ITM   T3  
                         WHERE T1.ASSY_CD = T3.ITM_CD      
                           AND T1.CHNL_CD = T3.CHNL_CD
                           AND T1.CHNL_CD = #CHNL_CD#
                           AND T1.ASSY_CD = #ITM_CD#       
                           AND T1.ROUT_ITM_CD = #ITM_CD#       
                        UNION ALL    
                          SELECT  LEVEL
                               , T1.CMPO_CD
                               , T1.ASSY_CD 
                               , T3.ITM_NM
                               , CONVERT(VARCHAR(100), CAST(T1.CMPO_NM AS VARCHAR(100)) + ' > ' )  AS ITM_NM             
                               , T1.ASSY_SEQ
                               , T1.XCH_ITM_FLG
                               , T1.WRK_ENGER_NM
                               , T1.WRK_LOC_NM
                               , T1.BOM_DESC
                               , dbo.CD_ITEM_NM_FNC(#CHNL_CD#, T1.ASSY_CD) AS ASSY_NM
                               , dbo.CD_ITEM_NM_FNC(#CHNL_CD#, T1.CMPO_CD) AS CMPO_NM
                               , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-003', T3.UOM_CD) AS UOM_NM   
                               , T1.ROUT_ITM_CD
                               , T1.PROD_CLSS_CD  
                               , T1.MOLD_CD  
                               , T1.MOLD_NO 
                               , T1.INP_QTY  
                               , T1.TOR_VAL 
                               , T1.SEQ
                               , T1.UPSEQ
                            FROM (
                                   SELECT LEVEL + 1  AS LEVEL 
                                        , T1.CMPO_CD
                                        , T1.ASSY_CD
                                        , T1.ASSY_SEQ
                                        , T1.XCH_ITM_FLG
                                        , T1.WRK_ENGER_NM
                                        , T1.WRK_LOC_NM
                                        , T1.BOM_DESC
                                        , T1.ROUT_ITM_CD
                                        , T1.PROD_CLSS_CD  
                                        , T1.MOLD_CD  
                                        , T1.MOLD_NO 
                                        , T1.INP_QTY  
                                        , T1.TOR_VAL 
                                                  , T1.CMPO_NM
                                        , T1.SEQ, T1.UPSEQ
                                     FROM TB_PROD_MULT_BOM T1  JOIN CTE_TABLE T2 
                                      ON T1.UPSEQ  = T2.SEQ
                                    WHERE T1.CHNL_CD =  #CHNL_CD#
                                      AND T1.ROUT_ITM_CD = T2.ROUT_ITM_CD
                                  ) T1, TB_CD_ITM T3 
                          WHERE T1.CMPO_CD = T3.ITM_CD
                            AND T3.CHNL_CD = #CHNL_CD#    
                      )  
              SELECT T1.ASSY_CD
                   , T1.ASSY_SEQ       
                   , CASE WHEN RN = 1 THEN T1.CMPO_CD       
                          ELSE T1.CMPO_CD + '-' + CAST(RN AS VARCHAR) END AS CMPO_CD
                   , T1.XCH_ITM_FLG
                   , T1.WRK_ENGER_NM
                   , T1.WRK_LOC_NM
                   , T1.BOM_DESC
                   , T1.ASSY_NM
                   , T1.CMPO_NM
                   , T1.IMAGE
                   , T1.UOM_NM
                   , T1.ROUT_ITM_CD
                   , T1.PROD_CLSS_CD
                   , T1.PROD_CLSS_NM
                   , T1.MOLD_CD  
                   , T1.MOLD_NO  
                       , T1.INP_QTY  
                   , T1.TOR_VAL  
                       , T1.CMPO_CD  AS GBN
                FROM (
                      SELECT T1.ASSY_CD
                           , T1.ASSY_SEQ       
                           , T1.CMPO_CD       
                           , T1.XCH_ITM_FLG
                           , T1.WRK_ENGER_NM
                           , T1.WRK_LOC_NM
                           , T1.BOM_DESC
                           , T1.ASSY_NM
                           , T1.CMPO_NM
                           , T2.IMG AS IMAGE
                           , T1.UOM_NM
                           , T1.ROUT_ITM_CD
                           , T1.PROD_CLSS_CD
                           , dbo.CD_SYS_CLSS_FNC(#CHNL_CD#, 'L-005', T1.PROD_CLSS_CD) AS PROD_CLSS_NM
                           , T1.MOLD_CD  
                           , T1.MOLD_NO  
                           , T1.INP_QTY  
                           , T1.TOR_VAL                 
                           , ROW_NUMBER() OVER (PARTITION BY T1.ROUT_ITM_CD, CMPO_CD ORDER BY LEVEL, ASSY_CD) AS RN 
                           , LEVEL   AS LVL
                        FROM CTE_TABLE T1 LEFT OUTER JOIN TB_CD_ITM_IMG T2
                          ON (T1.CMPO_CD = T2.ITM_CD AND T2.CHNL_CD = #CHNL_CD#)
                      WHERE 1 = 1
                        AND T1.ASSY_CD <![CDATA[ <> ]]> T1.CMPO_CD
              ) T1     
            WHERE 1 = 1  
            ORDER BY LVL, ASSY_CD
     </select>            

	  
	<select id="M66213SelectTreeMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		SELECT TOP 1 '(' + T2.MTRL_NM_CD + ') ' + T3.CAR_TP_NM     AS MDL_NM 
                 , T1.ROUT_CD      
                 , T1.ITM_CLSS_CD  
                 , T1.SERS_COLR_CD 
                 , T1.COLR_DESC    
                 , T1.CMPO_SZ_DESC 
                 , T1.CMPO_MTRL_DESC 
                 , T1.ROUT_MZD_CD    
                 , T1.CMPO_BRT_DESC  
                 , T4.CO_NO           
	               , T4.CO_NM          
                 , T1.BOM_DGR_SEQ    
                 , T1.BOM_DESC       
                 , T1.CMPO_CD        
                 , T1.CMPO_SUB_NM    
                 , T1.CMPO_NM        
                 , T1.ASSY_CD        
                 , T1.INP_QTY        
	               , T2.MTRL_NM_CD  AS MDL_CD
	               , T1.CHNL_CD 
				         , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD, 'L-003', T2.UOM_CD) AS UOM_NM  
				         , T1.MOLD_CD
		             , T1.MOLD_NO
				         , T1.MOLD_SEQ AS WEIH_SEQ
				         , T1.MOLD_CD + '-' + CONVERT(VARCHAR,  T1.MOLD_SEQ) AS GBN
		             , T1.MTRL_CD
              FROM TB_PROD_BOM    T1
                   LEFT OUTER JOIN (
                                        SELECT T1.ITM_CD
                                             , T1.ITM_PRC
                                             , T1.CO_NO 
                                             , T2.CO_NM
                                          FROM (
                                                  SELECT ITM_CD     
                                                       , CO_NO
                                                       , CO_UT_PRC   AS ITM_PRC 
                                                       , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY CNG_APLY_DT DESC) AS RN 
                                                    FROM TB_CD_CO_UT_PRC
                                                  WHERE 1 = 1
                                                     AND CHNL_CD        = #CHNL_CD#
                                                     AND ITM_BZTP_FLG   = 'P'
                                                     AND MN_CO_FLG      = 'Y'
                                                     AND CRNT_PRC_FLG   = 'Y'
                                                ) T1, TB_CD_CO T2
                                          WHERE 1 = 1
                                            AND RN = 1
                                            AND T1.CO_NO    = T2.CO_NO 
                                           AND T2.CHNL_CD  =  #CHNL_CD#
                                    ) T4 ON (
                    T1.CMPO_CD   = T4.ITM_CD                        
                   )                        
                 , TB_CD_ITM      T2
                 , TB_CD_CAR_TP   T3
             WHERE 1 = 1
               AND T1.CHNL_CD       = #CHNL_CD#
               AND T1.CHNL_CD       = T2.CHNL_CD
               AND T1.CHNL_CD       = T3.CHNL_CD
               AND T1.ROUT_ITM_CD   = T2.ITM_CD
               AND T2.MTRL_NM_CD    = T3.CAR_TP_CD
               AND T1.CMPO_CD       = #CMPO_CD#
            ORDER BY T1.UPD_DT 
	</select>


    <insert id="M66213InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
    INSERT INTO TB_PROD_BOM
    (     CHNL_CD
        , ASSY_CD
        , ASSY_SEQ
        , CMPO_CD
        , INP_QTY
        , BOM_DESC  
        , ROUT_ITM_CD
        , ROUT_CD
        , ITM_CLSS_CD
        , SERS_COLR_CD
        , ROUT_MZD_CD
        , COLR_DESC
        , CMPO_SZ_DESC
        , CMPO_MTRL_DESC
        , CMPO_BRT_DESC
        , CMPO_SUB_NM
        , CMPO_NM
        , BOM_DGR_SEQ
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
		    , MOLD_CD
		    , MOLD_NO
		    , MOLD_SEQ
		    , MTRL_CD
    ) 
	VALUES 
	(
	      #CHNL_CD# 
        , #ASSY_CD# 
        , #ASSY_SEQ#
        , #MDL_CD# + '-' + #ITM_CLSS_CD# + #ROUT_CD# + '-' + #SERS_COLR_CD# + dbo.F_RPAD(
		        (
		            SELECT ISNULL(MAX(BOM_DGR_SEQ), 0) + 1 FROM TB_PROD_BOM T1, TB_CD_ITM T2, TB_CD_CAR_TP T3
                        WHERE 1 = 1
                           AND T1.CHNL_CD       = #CHNL_CD# 
                           AND T1.CHNL_CD       = T2.CHNL_CD
                           AND T1.CHNL_CD       = T3.CHNL_CD
                           AND T1.CMPO_CD       IN (SELECT ITM_CD FROM TB_CD_ITM WHERE CHNL_CD = #CHNL_CD# AND ITM_GRP_CLSS_CD = 'W')
                           AND T1.ROUT_ITM_CD   = T2.ITM_CD
                           AND T2.MTRL_NM_CD    = T3.CAR_TP_CD      
                           AND T2.MTRL_NM_CD    = #MDL_CD#
                           AND T1.ROUT_CD       = #ROUT_CD#
                           AND T1.ITM_CLSS_CD   = #ITM_CLSS_CD#
                           AND T1.SERS_COLR_CD  = #SERS_COLR_CD#
		        ), '3', '0')
        , #INP_QTY#
        , #BOM_DESC#
        , #ROUT_ITM_CD#
        , #ROUT_CD#
        , #ITM_CLSS_CD#
        , #SERS_COLR_CD#
        , #ROUT_MZD_CD#
        , #COLR_DESC#
        , #CMPO_SZ_DESC#
        , #CMPO_MTRL_DESC#  
        , #CMPO_BRT_DESC#
        , #CMPO_SUB_NM#
        , #CMPO_NM#
        <!--, #BOM_DGR_SEQ#-->
		, (
		    SELECT ISNULL(MAX(BOM_DGR_SEQ), 0) + 1 FROM TB_PROD_BOM T1, TB_CD_ITM T2, TB_CD_CAR_TP T3
                WHERE 1 = 1
                   AND T1.CHNL_CD       = #CHNL_CD# 
                   AND T1.CHNL_CD       = T2.CHNL_CD
                   AND T1.CHNL_CD       = T3.CHNL_CD
                   AND T1.CMPO_CD       IN (SELECT ITM_CD FROM TB_CD_ITM WHERE CHNL_CD = #CHNL_CD# AND ITM_GRP_CLSS_CD = 'W')
                   AND T1.ROUT_ITM_CD   = T2.ITM_CD
                   AND T2.MTRL_NM_CD    = T3.CAR_TP_CD      
                   AND T2.MTRL_NM_CD    = #MDL_CD#
                   AND T1.ROUT_CD       = #ROUT_CD#
                   AND T1.ITM_CLSS_CD   = #ITM_CLSS_CD#
                   AND T1.SERS_COLR_CD  = #SERS_COLR_CD#
		  )
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
		    , #MOLD_CD#
		    , #MOLD_NO#
		    , #WEIH_SEQ#
		    , #MTRL_CD#
    )
    </insert>
    
    <update id="M66213UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
        UPDATE TB_PROD_BOM
           SET 
	           ASSY_CD            = #ASSY_CD#
	           , ROUT_MZD_CD        = #ROUT_MZD_CD#
             , COLR_DESC        = #COLR_DESC#
             , CMPO_SZ_DESC     = #CMPO_SZ_DESC#
             , CMPO_MTRL_DESC   = #CMPO_MTRL_DESC#     
             , CMPO_BRT_DESC    = #CMPO_BRT_DESC#
             , CMPO_SUB_NM      = #CMPO_SUB_NM#
             , CMPO_NM            = #CMPO_NM#
             , UPD_USR_ID         = #UPD_USR_ID#
             , UPD_DT             = GETDATE()
             , MOLD_CD            = #MOLD_CD#
		         , MOLD_NO            = #MOLD_NO#
			       , MOLD_SEQ           = #WEIH_SEQ#
		         , MTRL_CD            = #MTRL_CD#
         WHERE 1 = 1
           AND CHNL_CD       = #CHNL_CD#
           AND CMPO_CD       = #CMPO_CD#
	       AND ROUT_ITM_CD  = #ROUT_ITM_CD#
    </update>

    <!-- 삭제 체크 -->
    <select id="M66213SelectCheckdDelete" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT ASSY_CD, CMPO_CD FROM TB_PROD_BOM
        WHERE 1=1
          AND CHNL_CD      = #CHNL_CD#
          AND ASSY_CD      = #CMPO_CD#
          AND ROUT_ITM_CD  = #ROUT_ITM_CD#
    </select>
    
    
    <delete id="M66213DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
     DELETE FROM TB_PROD_BOM 
        WHERE 1 = 1
            AND CHNL_CD      = #CHNL_CD#
            AND CMPO_CD      = #CMPO_CD#
            AND ROUT_ITM_CD  = #ROUT_ITM_CD#
    </delete>

	  <insert id="M66213InsertCopy" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_BOM
            (
                   ASSY_CD
                 , ROUT_ITM_CD            
                 , ASSY_SEQ
                 , CMPO_CD
                 , INP_QTY
                 , TOR_VAL
                 , XCH_ITM_FLG
                 , WRK_ENGER_NM
                 , WRK_LOC_NM
                 , BOM_DESC
                 , CRE_USR_ID
                 , CRE_DT
                 , UPD_USR_ID
                 , UPD_DT
                 , CHNL_CD
                 , MOLD_CD
                 , EQ_NO
                 , PROD_CLSS_CD
                 , MOLD_NO
                 , LOSS_RT
                 , STD_INP_QTY
                 , ROUT_CD
                 , ITM_CLSS_CD
                 , SERS_COLR_CD
                 , ROUT_MZD_CD
                 , COLR_DESC
                 , CMPO_SZ_DESC
                 , CMPO_BRT_DESC
                 , CMPO_SUB_NM
                 , CMPO_NM
                 , BOM_DGR_SEQ
                 , CMPO_MTRL_DESC
				 , MTRL_CD
            )
		  SELECT 
		        CASE WHEN ASSY_CD = ROUT_ITM_CD THEN #TO_DT#
		             ELSE ASSY_CD END AS ASSY_CD
		      , #TO_DT# AS ROUT_ITM_CD
		      , ASSY_SEQ
		      , CMPO_CD
		      , INP_QTY
		      , TOR_VAL
		      , XCH_ITM_FLG
		      , WRK_ENGER_NM
		      , WRK_LOC_NM
		      , BOM_DESC
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		      , CHNL_CD
		      , MOLD_CD
		      , EQ_NO
		      , PROD_CLSS_CD
		      , MOLD_NO
		      , LOSS_RT
		      , STD_INP_QTY
		      , ROUT_CD
		      , ITM_CLSS_CD
		      , SERS_COLR_CD
		      , ROUT_MZD_CD
		      , COLR_DESC
		      , CMPO_SZ_DESC
		      , CMPO_BRT_DESC
		      , CMPO_SUB_NM
		      , CMPO_NM
		      , BOM_DGR_SEQ
		      , CMPO_MTRL_DESC
			  , MTRL_CD
		  FROM TB_PROD_BOM
		    WHERE 1 = 1
		        AND CHNL_CD      = #CHNL_CD#
		        AND ROUT_ITM_CD  = #FM_DT#
	  </insert>
	  
	  <delete id="M66213DeleteCopy" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_BOM
		    WHERE 1 = 1
		        AND CHNL_CD      = #CHNL_CD#
		        AND ROUT_ITM_CD  = #TO_DT#
	  </delete>

	  <select id="M66213SelectPopupList" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT
		  ROW_NUMBER() OVER (PARTITION BY T1.ITM_CD ORDER BY T1.MTRL_ITM_SEQ) AS RN
		  , T1.CHNL_CD
		  , T1.ITM_CD
		  , T1.MTRL_ITM_SEQ
		  , T1.MTRL_ITM_CD
		  , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD) AS MTRL_ITM_NM
		  , T1.USE_QTY
		  , T1.TOL_QTY
		  , #CRE_USR_ID# AS CRE_USR_ID
		  , #UPD_USR_ID# AS UPD_USR_ID
		  FROM TB_PROD_PROC_ITM_BOM AS T1
		  WHERE 1=1
		  AND CHNL_CD = #CHNL_CD#
		  AND ITM_CD  = #ITM_CD#
	  </select>
	  
	<!-- (PDM)재공품번생성 및 제품데이터관리  (자재 투입) - 추가 -->
    <insert id="M66213InsertDetail" parameterClass="ModelsLibrary.Man.ManVo">
      INSERT INTO TB_PROD_PROC_ITM_BOM
      (
          CHNL_CD
        , ITM_CD
        , MTRL_ITM_CD
        , MTRL_ITM_SEQ
        , USE_QTY
        , TOL_QTY
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
	      #CHNL_CD#
        , #ITM_CD#
        , #MTRL_ITM_CD#
        , #MTRL_ITM_SEQ#
        , #USE_QTY#
        , #TOL_QTY#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <!-- (PDM)재공품번생성 및 제품데이터관리 (자재 투입) - 삭제 -->
    <delete id="M66213DeleteDetail" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_PROC_ITM_BOM
         WHERE 1 = 1 
          AND CHNL_CD         = #CHNL_CD#
          AND ITM_CD          = #ITM_CD#
        <isNotNull property="MTRL_ITM_CD" >
          AND MTRL_ITM_CD     = #MTRL_ITM_CD#
        </isNotNull>
        <isNotNull property="MTRL_ITM_SEQ" >
          AND MTRL_ITM_SEQ    = #MTRL_ITM_SEQ#
        </isNotNull>
    </delete>
	  



	  <!-- 예측보전계획등록 -->  
    <select id="M6646SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT  
          CHNL_CD
        , EQ_NO
        , dbo.FF_EQ_NM_FNC(CHNL_CD, EQ_NO) AS EQ_NM
        , PLN_MON
        , PLN_DY
        , PLN_CD
        , EQ_DESC 
      FROM TB_PROD_FCAST_PRESVE_PLN
      WHERE 1=1
        AND CHNL_CD = #CHNL_CD#
        AND PLN_CD = 'A'
    </select>
    
    <insert id="M6646InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
     INSERT INTO TB_PROD_FCAST_PRESVE_PLN
      (
          CHNL_CD
        , EQ_NO
        , PLN_MON
        , PLN_DY
        , PLN_CD
        , EQ_DESC
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
          #CHNL_CD#
        , #EQ_NO#
        , #TMP_PLN_MON#
        , #TMP_PLN_DY#
        , 'A'
        , #EQ_DESC#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <update id="M6646UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_FCAST_PRESVE_PLN
       SET
          PLN_MON     = #TMP_PLN_MON#
        , PLN_DY      = #TMP_PLN_DY#
        , EQ_DESC     = #EQ_DESC#
        , UPD_USR_ID  = #UPD_USR_ID#
        , UPD_DT      = GETDATE() 
      WHERE CHNL_CD  = #CHNL_CD#
        AND EQ_NO    = #EQ_NO#
        AND PLN_MON  = #PLN_MON#
        AND PLN_DY   = #PLN_DY#
        AND PLN_CD   = 'A'
    </update>
    
    <delete id="M6646DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_FCAST_PRESVE_PLN
         WHERE 1 = 1 
          AND CHNL_CD  = #CHNL_CD#
          AND EQ_NO    = #EQ_NO#
          AND PLN_MON  = #PLN_MON#
          AND PLN_DY   = #PLN_DY#
          AND PLN_CD   = 'A'
    </delete>

    
    <!-- 예측보전실적입력 -->  
    <select id="M6647SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT  
          T1.CHNL_CD
        , T1.EQ_NO
        , dbo.FF_EQ_NM_FNC(T1.CHNL_CD, T1.EQ_NO) AS EQ_NM
        , T1.PLN_MON
        , T1.PLN_DY
        , T1.PLN_ST_DY
        , T1.PLN_CD
        , T1.USR_ID
        , dbo.USR_NM_FNC(T1.CHNL_CD, T1.USR_ID) AS USR_NM 
        , T1.OK_FLG
        , T1.EQ_DESC 
        , T1.CLSS_CD
        , (SELECT X.EQ_DESC FROM TB_PROD_FCAST_PRESVE_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD  AND X.EQ_NO = T1.EQ_NO  AND X.PLN_MON = T1.PLN_MON  AND X.PLN_DY = T1.PLN_DY AND X.PLN_CD = T1.PLN_CD) AS GBN
      FROM TB_PROD_FCAST_PRESVE AS T1
      WHERE 1=1
        AND T1.CHNL_CD = #CHNL_CD#
        AND T1.PLN_CD = 'A'
    </select>
    
    <insert id="M6647InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
     INSERT INTO TB_PROD_FCAST_PRESVE
      (
          CHNL_CD
        , EQ_NO
        , PLN_MON
        , PLN_DY
        , PLN_ST_DY
        , PLN_CD
        , USR_ID
        , OK_FLG
        , EQ_DESC
        , CLSS_CD   
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
          #CHNL_CD#
        , #EQ_NO#
        , #PLN_MON#
        , #PLN_DY#
        , #TMP_PLN_ST_DY#
        , 'A'
        , #USR_ID#
        , #OK_FLG#
        , #EQ_DESC#
        , #CLSS_CD#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <update id="M6647UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_FCAST_PRESVE
       SET
          PLN_ST_DY   = #TMP_PLN_ST_DY#
        , USR_ID      = #USR_ID#
        , OK_FLG      = #OK_FLG#
        , EQ_DESC     = #EQ_DESC#
        , UPD_USR_ID  = #UPD_USR_ID#
        , UPD_DT      = GETDATE() 
        , CLSS_CD     = #CLSS_CD#
      WHERE CHNL_CD  = #CHNL_CD#
        AND EQ_NO    = #EQ_NO#
        AND PLN_MON  = #PLN_MON#
        AND PLN_DY   = #PLN_DY#
        AND PLN_ST_DY = #PLN_ST_DY#
        AND PLN_CD   = 'A'
    </update>
    
    <delete id="M6647DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_FCAST_PRESVE
         WHERE 1 = 1 
          AND CHNL_CD   = #CHNL_CD#
          AND EQ_NO     = #EQ_NO#
          AND PLN_MON   = #PLN_MON#
          AND PLN_DY    = #PLN_DY#
          AND PLN_ST_DY = #PLN_ST_DY#
          AND PLN_CD    = 'A'
    </delete>
    
    
      <!-- 예방 보전계획 등록 -->  
    <select id="M6649SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT  
          CHNL_CD
        , EQ_NO
        , dbo.FF_EQ_NM_FNC(CHNL_CD, EQ_NO) AS EQ_NM
        , PLN_MON
        , PLN_DY
        , PLN_CD
        , EQ_DESC 
      FROM TB_PROD_FCAST_PRESVE_PLN
      WHERE 1=1
        AND CHNL_CD = #CHNL_CD#
        AND PLN_CD = 'B'
    </select>
    
    <insert id="M6649InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
     INSERT INTO TB_PROD_FCAST_PRESVE_PLN
      (
          CHNL_CD
        , EQ_NO
        , PLN_MON
        , PLN_DY
        , PLN_CD
        , EQ_DESC
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
          #CHNL_CD#
        , #EQ_NO#
        , #TMP_PLN_MON#
        , #TMP_PLN_DY#
        , 'B'
        , #EQ_DESC#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <update id="M6649UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_FCAST_PRESVE_PLN
       SET
          PLN_MON     = #TMP_PLN_MON#
        , PLN_DY      = #TMP_PLN_DY#
        , EQ_DESC     = #EQ_DESC#
        , UPD_USR_ID  = #UPD_USR_ID#
        , UPD_DT      = GETDATE() 
      WHERE CHNL_CD  = #CHNL_CD#
        AND EQ_NO    = #EQ_NO#
        AND PLN_MON  = #PLN_MON#
        AND PLN_DY   = #PLN_DY#
        AND PLN_CD   = 'B'
    </update>
    
    <delete id="M6649DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_FCAST_PRESVE_PLN
         WHERE 1 = 1 
          AND CHNL_CD  = #CHNL_CD#
          AND EQ_NO    = #EQ_NO#
          AND PLN_MON  = #PLN_MON#
          AND PLN_DY   = #PLN_DY#
          AND PLN_CD   = 'B'
    </delete>

    
    <!-- 예측보전실적입력 -->  
    <select id="M66410SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT  
          T1.CHNL_CD
        , T1.EQ_NO
        , dbo.FF_EQ_NM_FNC(T1.CHNL_CD, T1.EQ_NO) AS EQ_NM
        , T1.PLN_MON
        , T1.PLN_DY
        , T1.PLN_ST_DY
        , T1.PLN_CD
        , T1.USR_ID
        , dbo.USR_NM_FNC(T1.CHNL_CD, T1.USR_ID) AS USR_NM 
        , T1.OK_FLG
        , T1.EQ_DESC 
        , T1.CLSS_CD
        , (SELECT X.EQ_DESC FROM TB_PROD_FCAST_PRESVE_PLN AS X WHERE X.CHNL_CD = T1.CHNL_CD  AND X.EQ_NO = T1.EQ_NO  AND X.PLN_MON = T1.PLN_MON  AND X.PLN_DY = T1.PLN_DY AND X.PLN_CD = T1.PLN_CD) AS GBN
      FROM TB_PROD_FCAST_PRESVE AS T1
      WHERE 1=1
        AND T1.CHNL_CD = #CHNL_CD#
        AND T1.PLN_CD = 'B'
    </select>
    
    <insert id="M66410InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
     INSERT INTO TB_PROD_FCAST_PRESVE
      (
          CHNL_CD
        , EQ_NO
        , PLN_MON
        , PLN_DY
        , PLN_ST_DY
        , PLN_CD
        , USR_ID
        , OK_FLG
        , EQ_DESC
        , CLSS_CD
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
      ) VALUES (
          #CHNL_CD#
        , #EQ_NO#
        , #PLN_MON#
        , #PLN_DY#
        , #TMP_PLN_ST_DY#
        , 'B'
        , #USR_ID#
        , #OK_FLG#
        , #EQ_DESC#
        , #CLSS_CD#
        , #CRE_USR_ID#
        , GETDATE()
        , #UPD_USR_ID#
        , GETDATE()
      )
    </insert>
    
    <update id="M66410UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_FCAST_PRESVE
       SET
          PLN_ST_DY   = #TMP_PLN_ST_DY#
        , USR_ID      = #USR_ID#
        , OK_FLG      = #OK_FLG#
        , EQ_DESC     = #EQ_DESC#
        , CLSS_CD     = #CLSS_CD#
        , UPD_USR_ID  = #UPD_USR_ID#
        , UPD_DT      = GETDATE() 
      WHERE CHNL_CD  = #CHNL_CD#
        AND EQ_NO    = #EQ_NO#
        AND PLN_MON  = #PLN_MON#
        AND PLN_DY   = #PLN_DY#
        AND PLN_ST_DY = #PLN_ST_DY#
        AND PLN_CD   = 'B'
    </update>
    
    <delete id="M66410DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_FCAST_PRESVE
         WHERE 1 = 1 
          AND CHNL_CD   = #CHNL_CD#
          AND EQ_NO     = #EQ_NO#
          AND PLN_MON   = #PLN_MON#
          AND PLN_DY    = #PLN_DY#
          AND PLN_ST_DY = #PLN_ST_DY#
          AND PLN_CD    = 'B'
    </delete>
    
    
    

    <!-- 예측보전실적입력 -->  
    <select id="M66412SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.PROD_EQ_NO) AS RN 
           , T1.EQ_NM
           , T1.WRK_TM_VAL
           , T1.FAIL_TM_VAL
           , T1.FAIL_QTY
           , CASE WHEN T1.WRK_TM_VAL = 0 THEN 0 ELSE ROUND(T1.FAIL_TM_VAL / T1.WRK_TM_VAL, 0) END AS FAIL_RT
           , CASE WHEN T1.FAIL_QTY = 0 THEN 0 ELSE ROUND((T1.WRK_TM_VAL -  T1.FAIL_TM_VAL) / FAIL_QTY, 0) END AS MTBF
           , CASE WHEN T1.FAIL_QTY = 0 THEN 0 ELSE ROUND(T1.FAIL_TM_VAL / T1.FAIL_QTY, 0) END AS MTTR
           , CASE WHEN T1.FAIL_QTY = 0 THEN 0 ELSE ROUND((T1.WRK_TM_VAL -  T1.FAIL_TM_VAL) / FAIL_QTY, 0) END - CASE WHEN T1.FAIL_QTY = 0 THEN 0 ELSE ROUND(T1.FAIL_TM_VAL / T1.FAIL_QTY, 0) END  AS MTTF
        FROM (
              SELECT T1.PROD_EQ_NO
                   , T1.EQ_NM
                   , ISNULL(T2.WRK_TM_VAL, 0 ) AS WRK_TM_VAL
                   , T1.FAIL_TM_VAL
                   , T1.FAIL_QTY
                FROM (
                      SELECT T1.PROD_EQ_NO
                           , T1.EQ_NM
                           , ISNULL(T2.FAIL_TM_VAL, 0) AS FAIL_TM_VAL
                           , ISNULL(T2.FAIL_QTY, 0) AS FAIL_QTY
                        FROM TB_PROD_EQ T1
                             LEFT OUTER JOIN (       
                                    SELECT PROD_EQ_CD
                                         , SUM(WRK_FAIL_TM_VAL)   AS FAIL_TM_VAL
                                         , SUM(WRK_FAIL_QTY)      AS FAIL_QTY
                                      FROM TB_PROD_EQ_IRR 
                                     WHERE 1 = 1
                                       AND CHNL_CD = #CHNL_CD#
                                       AND EQ_IRR_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
                                       AND EQ_IRR_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)         
                                  GROUP BY PROD_EQ_CD ) T2                                 
                             ON ( 1 = 1
                              AND T1.PROD_EQ_NO = T2.PROD_EQ_CD
                                )
                       WHERE 1 = 1 
                         AND T1.CHNL_CD = #CHNL_CD#
                      ) T1 LEFT OUTER JOIN 
                        ( SELECT  PROD_EQ_CD
                                , SUM(WRK_TM_VAL) AS WRK_TM_VAL  
                            FROM TB_PROD_EQ_RUN_TM
                           WHERE 1 = 1
                             AND CHNL_CD = #CHNL_CD#
                             AND EQ_RUN_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
                             AND EQ_RUN_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)                       
                        GROUP BY PROD_EQ_CD                
                        ) T2  ON (
                                    1 = 1 AND T1.PROD_EQ_NO = T2.PROD_EQ_CD
                                  )
               WHERE 1  = 1         
      ) T1     
    </select>


    

    
      <!-- 설비별 수율관리  -->
     <select id="M6693SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT T1.EQ_NM
           , T2.PLN_QTY
           , T2.PLN_USR_NM
           , T2.CO_NM
           , T2.N1ST_ITM_GRP_NM    
        FROM TB_PROD_EQ  T1
             LEFT OUTER JOIN (
              SELECT T1.CO_CD
                   , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD) AS CO_NM
                   , T2.PLN_QTY
                   , T2.PLN_USR_ID
                   , dbo.USR_NM_FNC(T1.CHNL_CD, T2.PLN_USR_ID)  AS PLN_USR_NM
                   , T2.N1ST_ITM_GRP_CD
                   , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, 'G', T2.N1ST_ITM_GRP_CD) AS N1ST_ITM_GRP_NM
                   , T2.EQ_NO
                FROM TB_CD_CAR_TP     T1
                   , TB_PROD_N1ST_PLN T2 
              WHERE 1 = 1
                AND T1.CHNL_CD    = #CHNL_CD#
                AND T1.CHNL_CD    = T2.CHNL_CD
                AND T1.CAR_TP_CD  = T2.N1ST_ITM_GRP_CD
                AND  T2.PLN_YRMON = #FM_DT#
              ) T2          
             ON ( 
                  T1.PROD_EQ_NO = T2.EQ_NO   
             )
       WHERE 1 = 1
         AND T1.EQ_TP_CD  = '3'
         AND T1.CHNL_CD   = #CHNL_CD#
      ORDER BY CAST(dbo.FF_GET_NUMBER(T1.EQ_NM) AS INT) DESC   
    </select>


	  <!-- 칭량현황 -->
	  <select id="M663100SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.SO_DT) AS RN
		      , CONVERT(VARCHAR, CAST(T1.SO_DT  AS   DATETIME), 23) AS SO_DT
		      , ISNULL(CONVERT(VARCHAR, CAST(T1.DUE_DT AS   DATETIME), 23), '') AS DUE_DT
		      , T1.TR_CD     AS CO_NO
		      , T3.CO_NM    
		      , T1.SO_NB    AS SL_ORD_NO
		      , T2.SO_SQ    AS SL_ORD_SEQ
		      , T2.ITEM_CD   AS ITM_CD
		      , T4.ITM_NM
		      , T2.SO_QT     AS SL_ITM_QTY
		      , T5.ASSY_ITM_CD
		      , T5.LOT_NO
		      , CONVERT(VARCHAR, T5.WRK_DT, 23) AS WRK_DT
		      , T5.TOT_WEIH_VAL
		  FROM DZICUBE.dbo.LSO    T1 , DZICUBE.dbo.LSO_D  T2
		  LEFT OUTER JOIN TB_CD_ITM     T4
		    ON ( T2.ITEM_CD = T4.ITM_CD
		        AND T4.CHNL_CD = #CHNL_CD#
		        )
		  LEFT OUTER JOIN  TB_PROD_WEIGH_WO T5
		  ON (      T2.SO_NB = T5.SL_ORD_NO
		        AND T2.SO_SQ = T5.SL_ORD_SEQ
		        AND T5.WRK_END_FLG = 'Y'
		        AND T5.CHNL_CD = #CHNL_CD#
		  )
		    , TB_CD_CO           T3
		  WHERE 1 = 1
		  AND T1.CO_CD   = T2.CO_CD
		  AND T1.SO_NB   = T2.SO_NB
		  AND T1.TR_CD   = T3.CO_NO
		  AND T3.CHNL_CD = #CHNL_CD#
		  AND T1.SO_DT      >= #FM_DT#
		  AND T1.SO_DT      <![CDATA[<=]]> #TO_DT#
	  </select>

	  
	  <!-- F/Proof 위배처리 -->
	  <select id="M663300SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT
		        ROW_NUMBER() OVER (PARTITION BY CHNL_CD ORDER BY FPRF_DT) AS RN
		      , CHNL_CD
		      , CONVERT(VARCHAR, CAST(FPRF_DT AS DATETIME), 23) AS FPRF_DT
		      , LOT_NO
		      , IRR_CD
		      , OK_FLG
		      , FPRF_RMK
		      , RSON_NT
		  FROM TB_FPRF_IRR
		   WHERE 1=1
		    AND CHNL_CD = #CHNL_CD#
		    AND FPRF_DT >= #FM_DT#
		    AND FPRF_DT <![CDATA[<=]]> #TO_DT#
	  </select>


	  <update id="M663300UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_FPRF_IRR
		  SET
              OK_FLG   = #OK_FLG#
		    , RSON_NT  = #RSON_NT#
		  WHERE 1=1
		    AND CHNL_CD  = #CHNL_CD#
		    AND LOT_NO   = #LOT_NO#
		    AND IRR_CD   = #IRR_CD#
	  </update>


	  
	  
	  
	   <!-- M66520  HS 작업지시서 발행 -->    
    <select id="M66520SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
	   <!-- 판매 계획 -> 생산 계획
	   SELECT T1.PROD_PLN_NO
	        , T2.ITM_CD
	        , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T2.ITM_CD)  AS ITM_NM
	        , T1.PROD_PLN_QTY
	        , T1.PROD_PLN_RMK
	        , T2.SL_CO_CD
	        , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.SL_CO_CD)  AS CO_NM
	        , T2.SL_ORD_NO
	        , T2.SL_ORD_SEQ
	        , T1.CHNL_CD
			, CONVERT(VARCHAR, T1.PROD_PLN_DT, 23) AS PROD_PLN_DT
	   FROM TB_PROD_MON_PLN   T1
	      , TB_SL_MON_PLN     T2
	   WHERE 1 = 1
	       AND T1.CHNL_CD         = #CHNL_CD#
	       AND T1.CHNL_CD         = T2.CHNL_CD
	       AND T1.SL_PLN_NO       = T2.SL_PLN_NO
	       AND T1.PROD_PLN_DT     >= CAST ( #FM_DT# + ' 00:00:00' AS DATETIME)
	       AND T1.PROD_PLN_DT     <![CDATA[ <= ]]> CAST ( #TO_DT# + ' 23:59:59' AS DATETIME)
		   -->
		SELECT
		      CONVERT(VARCHAR, CAST(T1.SO_DT  AS DATETIME), 23) AS SO_DT
		    , CONVERT(VARCHAR, CAST(T2.DUE_DT AS DATETIME), 23) AS DUE_DT
		    , T2.SO_NB AS SL_ORD_NO
		    , T2.SO_SQ AS SL_ORD_SEQ
		    , T1.TR_CD AS SL_CO_CD
		    , dbo.CD_COMPANY_NM_FNC(T3.CHNL_CD, T1.TR_CD) AS CO_NM
		    , T3.ITM_NM
		    , T3.ITM_CD
		    , T3.ITM_SZ_NM
		    , T2.SO_QT AS PROD_PLN_QTY
		    , T3.CHNL_CD
		    , (SELECT COUNT(*) CNT  FROM TB_PROD_LOT_DIV AS X WHERE 1=1 AND X.CHNL_CD = T3.CHNL_CD AND X.ORD_NO = T2.SO_NB AND X.ORD_SEQ = T2.SO_SQ AND X.PCK_FLG = #PCK_FLG#) AS RN
		    <!--, (SELECT CONVERT(VARCHAR, MAX(X.PROD_PLN_DT), 23)  AS UPD_DT   FROM TB_PROD_LOT_DIV AS X WHERE 1=1 AND X.CHNL_CD = T3.CHNL_CD AND X.ORD_NO = T2.SO_NB AND X.ORD_SEQ = T2.SO_SQ) AS PROD_PLN_DT-->
      , T4.UPD_DT AS PROD_PLN_DT
      FROM  DZICUBE.dbo.LSO    T1
      , DZICUBE.dbo.LSO_D  T2 LEFT OUTER JOIN( SELECT MAX(CONVERT(VARCHAR, PROD_PLN_DT, 23))  AS UPD_DT, ORD_NO, ORD_SEQ , MAX(CHNL_CD) AS CHNL_CD  FROM TB_PROD_LOT_DIV  GROUP BY ORD_NO, ORD_SEQ ) AS T4 ON ( T4.CHNL_CD = #CHNL_CD# AND T4.ORD_NO = T2.SO_NB AND T4.ORD_SEQ = T2.SO_SQ)
      , TB_CD_ITM T3
      WHERE 1 = 1
      AND T1.SO_NB	= T2.SO_NB
      AND T2.ITEM_CD	= T3.ITM_CD
      AND T3.CHNL_CD	= #CHNL_CD#
      <isEqual property="GBN" compareValue ="A" >
		      AND T1.SO_DT	>= CAST (#FM_DT# + ' 00:00:00' AS DATETIME)
		      AND T1.SO_DT	<![CDATA[ <= ]]> CAST (#TO_DT# + ' 23:59:59' AS DATETIME)
        </isEqual>
        <isEqual property="GBN" compareValue ="B" >
          AND T4.UPD_DT   >= CAST (#FM_DT# + ' 00:00:00' AS DATETIME)
          AND T4.UPD_DT   <![CDATA[ <= ]]> CAST (#TO_DT# + ' 23:59:59' AS DATETIME)
        </isEqual>
    </select>


	 <select id="M66520SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		    SELECT   
			     ROW_NUMBER() OVER ( PARTITION BY  T1.LOT_DIV_NO ORDER BY T2.ROUT_ITM_CD, T1.LOT_DIV_SEQ ) AS RN
               , CONVERT(VARCHAR, T1.PROD_PLN_DT  , 23)  AS UPD_DT 
               , T1.LOT_DIV_NO 
			         , T1.LOT_DIV_SEQ
               , CASE WHEN T1.DY_NGT_FLG = 'A' THEN '오전' 
			              WHEN T1.DY_NGT_FLG = 'B' THEN '오후' 
					          WHEN T1.DY_NGT_FLG = 'C' THEN '연장' 
					          WHEN T1.DY_NGT_FLG = 'D' THEN '기타' 
					          WHEN T1.DY_NGT_FLG = 'E' THEN '내부1' 
					          WHEN T1.DY_NGT_FLG = 'F' THEN '내부2' 
				          END AS DY_NGT_NM   
			          , T1.DY_NGT_FLG
                , T1.EQ_NO 
			          , dbo.FF_EQ_NM_FNC(T1.CHNL_CD, T1.EQ_NO) AS EQ_NM
                , T2.INP_STAFF_VAL 
			   <!--
               , CONVERT(VARCHAR, T2.MAKE_DT , 23)  AS MAKE_DT
               , CONVERT(VARCHAR(5),T2.MAKE_ST_DT,8)  AS WRK_ST_DT
               , CONVERT(VARCHAR(5),T2.MAKE_END_DT,8)  AS WRK_END_DT
			   -->
			        , T1.LOT_DIV_QTY  AS PROD_PLN_QTY
              , T1.LOT_DIV_QTY 
			        , T1.WRK_DIR_PPR_FLG
			        , T1.CHNL_CD
			        , #ITM_CD#           AS ITM_CD
			        , T1.LOT_DIV_RMK     AS MM_RMK
			        , T1.PCK_FLG         AS PCK_FLG
			        , dbo.FF_NM_ROUT(T2.CHNL_CD , LEFT(T2.ROUT_ITM_CD,3)) AS ROUT_NM
			        , ISNULL(T2.CLZ_FLG, 'N') AS CLZ_FLG
			        , T1.DY_NGT_RMK
			        , T1.LOT_DIV_NO + ' / ' + dbo.FF_NM_ROUT(T2.CHNL_CD , LEFT(T2.ROUT_ITM_CD,3))  AS GBN
          FROM TB_PROD_LOT_DIV  T1 LEFT OUTER JOIN TB_FPRF_N2ND_STEP_ROUT T2 ON (T1.CHNL_CD = T2.CHNL_CD AND T1.LOT_DIV_NO = T2.PROD_ORD_NO  AND T1.LOT_DIV_SEQ = T2.PROD_ORD_SEQ)
             WHERE 1 = 1
                AND T1.CHNL_CD   = #CHNL_CD#
	            AND T1.ORD_NO    = #SL_ORD_NO#
	            AND T1.ORD_SEQ   = #SL_ORD_SEQ# 
			<isNotNull property="PCK_FLG" >
			  AND T1.PCK_FLG       = #PCK_FLG#
			</isNotNull>
	  </select>


	  <select id="M66520SelectDetail_two" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT  MAX(RN) AS RN
                , MAX(ROUT_CD) AS ROUT_CD
                , MAX(ROUT_NM) AS ROUT_NM
                , CMPO_CD AS CMPO_CD
                , MAX(ITM_NM) AS ITM_NM
                , MAX(ITM_SZ_NM) AS ITM_SZ_NM 
                , CEILING(MAX(INP_QTY)) AS INP_QTY
                , MAX(USE_FLG) AS GBN    
				        , MAX(UOM_NM) AS UOM_NM    
                , MAX(PRNT_ROUT_NM) AS PRNT_ROUT_NM
            FROM (  
                      SELECT 0 AS RN
                            , dbo.FN_splitValue(T3.ITM_CD, '-', 1) AS ROUT_CD
							              , dbo.FF_PROD_ROUT_NM_FNC(#CHNL_CD#, dbo.FN_splitValue(T3.ITM_CD, '-', 1)) AS ROUT_NM
						                , T2.ROUT_ITM_CD AS CMPO_CD
                            , T3.ITM_NM AS ITM_NM
                            , T3.ITM_SZ_NM AS ITM_SZ_NM
                            , #PROD_PLN_QTY#  AS INP_QTY
                            , 'Y' AS USE_FLG
							              , T3.UOM_NM
                            , '반제품' AS PRNT_ROUT_NM
                        FROM TB_FPRF_N2ND_STEP_ROUT T1
                            ,TB_FPRF_N2ND_JOIN_ROUT T2
							              ,MV_TB_CD_ITM T3
                       WHERE 1 = 1 
                         AND T1.PROC_LOT_NO = T2.PROC_LOT_NO
                         AND T1.CHNL_CD = T2.CHNL_CD
						             AND T2.ROUT_ITM_CD = T3.ITM_CD
                         AND T1.CHNL_CD = #CHNL_CD#
                         AND T1.PROD_ORD_NO = #LOT_DIV_NO#
                   UNION ALL 
                   SELECT ROW_NUMBER() OVER (ORDER BY ROUT_CD) AS RN
                      , T1.ROUT_CD
                      , dbo.FF_PROD_ROUT_NM_FNC(#CHNL_CD#,T1.ROUT_CD) AS ROUT_NM
                      , T1.CMPO_CD
                      , T2.ITM_NM 
                      , T2.ITM_SZ_NM 
                      , (#PROD_PLN_QTY# * T1.INP_QTY) AS INP_QTY
                      , 'N' AS USE_FLG
					            , T2.UOM_NM
                      , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-908', T1.PRNT_ROUT_CD) AS PRNT_ROUT_NM
                  FROM TB_PROD_BOM T1
                      ,MV_TB_CD_ITM T2
                 WHERE 1 = 1 
                   AND T1.CHNL_CD = T2.CHNL_CD
                   AND T1.CMPO_CD = T2.ITM_CD
                   AND T1.CHNL_CD = #CHNL_CD#
                   AND T1.ASSY_CD = #ITM_CD#
           ) AS TT 
         GROUP BY TT.CMPO_CD
		 ORDER BY RN
	  </select>



	  <select id="M66520SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		 <!--SELECT 
                ROW_NUMBER() OVER (PARTITION BY  ROUT_CD ORDER BY T1.ASSY_SEQ) AS RN
              , T1.PRNT_ROUT_CD
              , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-908', T1.PRNT_ROUT_CD) AS PRNT_ROUT_NM
              , T1.ROUT_CD
              , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD) AS ROUT_NM
              , T1.CMPO_CD
              , T2.ITM_NM 
              , T2.ITM_SZ_NM
              , CEILING((#PROD_PLN_QTY# * T1.INP_QTY)) AS INP_QTY 
			        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-003', T2.UOM_CD) AS UOM_NM
			        , #PROD_PLN_NO# AS PROD_PLN_NO
			        , #CRE_USR_ID# AS CRE_USR_ID
			        , #UPD_USR_ID# AS UPD_USR_ID
			        , (T1.ROUT_CD + '-' +  T1.ASSY_CD) AS  ROUT_ITM_CD
			        , T1.CHNL_CD
			        , T1.ASSY_CD
			        --><!--, '오전'          AS DY_NGT_NM
			        , 'A'                 AS DY_NGT_FLG--><!--
			        , #PROD_EQ_NO#        AS PROD_EQ_NO
			        , #EQ_NM#             AS EQ_NM
			        , #INP_STAFF_VAL#     AS INP_STAFF_VAL
			        , #PCK_FLG#           AS PCK_FLG
			        , #PROD_PLN_QTY#      AS PROD_PLN_QTY
			        , #PROD_PLN_QTY_A#    AS PROD_PLN_QTY_A
			        , #PROD_PLN_QTY_B#    AS PROD_PLN_QTY_B
			        , #PROD_PLN_QTY_C#    AS PROD_PLN_QTY_C
			        , #SL_ORD_NO#         AS SL_ORD_NO
	            , #SL_ORD_SEQ#        AS SL_ORD_SEQ
			        , #ITM_CD#            AS ITM_CD 
			        , #DY_NGT_NM#         AS DY_NGT_NM
			        , #DY_NGT_FLG#        AS DY_NGT_FLG
		          , #MM_RMK#            AS MM_RMK
		          , #DY_NGT_RMK#        AS DY_NGT_RMK
			        , #PROD_PLN_DT#       AS PROD_PLN_DT
          FROM TB_PROD_BOM T1
              ,TB_CD_ITM T2
         WHERE 1 = 1 
           AND T1.CHNL_CD = T2.CHNL_CD
           AND T1.CMPO_CD = T2.ITM_CD
           AND T1.CHNL_CD = #CHNL_CD#
           AND T1.ASSY_CD = #ITM_CD#-->
      
           SELECT   
                 ROW_NUMBER() OVER (PARTITION BY GBN, ROUT_CD ORDER BY T1.ASSY_SEQ, ROUT_CD) AS RN ,
                 T1.PRNT_ROUT_CD ,
                 T1.PRNT_ROUT_NM ,
                 T1.ROUT_CD ,
                 DBO.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD)            AS ROUT_NM ,
                 T1.CMPO_CD ,
                 T1.ITM_NM ,
                 T1.ITM_SZ_NM ,
                 CEILING(( #PROD_PLN_QTY#  * T1.INP_QTY))                     AS INP_QTY ,
                 DBO.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-003', T1.UOM_CD)         AS UOM_NM ,
                 #PROD_PLN_NO#                                              AS PROD_PLN_NO ,
                 #CRE_USR_ID#                                              AS CRE_USR_ID ,
                 #UPD_USR_ID#                                              AS UPD_USR_ID ,
                 (T1.ROUT_CD + '-' + T1.ASSY_CD)                      AS ROUT_ITM_CD ,
                 T1.CHNL_CD ,
                 T1.ASSY_CD ,
                 #PROD_EQ_NO#  AS PROD_EQ_NO ,
                 #EQ_NM#  AS EQ_NM ,
                 #INP_STAFF_VAL#   AS INP_STAFF_VAL ,
                 #PCK_FLG#   AS PCK_FLG ,
                 #PROD_PLN_QTY#  AS PROD_PLN_QTY ,
                 #PROD_PLN_QTY_A#  AS PROD_PLN_QTY_A ,
                 #PROD_PLN_QTY_B#  AS PROD_PLN_QTY_B ,
                 #PROD_PLN_QTY_C#  AS PROD_PLN_QTY_C ,
                 #SL_ORD_NO#  AS SL_ORD_NO ,
                 #SL_ORD_SEQ#  AS SL_ORD_SEQ ,
                 #ITM_CD#  AS ITM_CD ,
                 #DY_NGT_NM# AS DY_NGT_NM ,
                 #DY_NGT_FLG#  AS DY_NGT_FLG ,
                 #MM_RMK#  AS MM_RMK ,
                 #DY_NGT_RMK#  AS DY_NGT_RMK ,
                 #PROD_PLN_DT# AS PROD_PLN_DT
          FROM (
              SELECT  'A' AS GBN 
                    , T1.CHNL_CD
                    , T1.ASSY_CD
                    , T1.ASSY_SEQ        
                    , T1.PRNT_ROUT_CD
                    , DBO.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-908', T1.PRNT_ROUT_CD) AS PRNT_ROUT_NM
                    , T1.ROUT_CD
                    , T1.CMPO_CD
                    , T2.ITM_NM
                    , T2.ITM_SZ_NM
                    , T1.INP_QTY
                    , T2.UOM_CD
               FROM TB_PROD_BOM T1 
                  , TB_CD_ITM T2
              WHERE 1 = 1
                AND T1.CHNL_CD = T2.CHNL_CD
                AND T1.CMPO_CD = T2.ITM_CD
                AND T1.CHNL_CD = #CHNL_CD#
                AND T1.ASSY_CD = #ITM_CD#
            UNION ALL 
            SELECT 'B' 
                 , T1.CHNL_CD
                 , #ITM_CD#
                 , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY ITM_CD) AS RN 
                 , ''
                 , '반제품'
                 , dbo.FN_splitValue(T1.ITM_CD, '-', 1)
                 , ITM_CD
                 , ITM_NM
                 , T1.ITM_SZ_NM
                 , 1
                 , T1.UOM_CD
              FROM MV_TB_CD_ITM  T1
             WHERE 1 = 1
               AND CHNL_CD          = #CHNL_CD#
               AND ITM_GRP_CLSS_CD  = 'H'
               AND (ITM_CD           LIKE '201%' + #ITM_CD#  OR   ITM_CD           LIKE '202%' + #ITM_CD#)
            ) T1       
	  </select>



	  <select id="M66520SelectMstTmp" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  <!--SELECT PROD_PLN_NO + dbo.F_RPAD(((SELECT SUBSTRING(ISNULL(MAX(LOT_DIV_NO), 0), 24, 4) FROM TB_PROD_LOT_DIV Z WHERE 1 = 1 AND Z.CHNL_CD = #CHNL_CD# AND LOT_DIV_NO LIKE T1.PROD_PLN_NO+'%' ) + T3.NO), 4, '0') AS LOT_DIV_NO
		  FROM TB_PROD_MON_PLN   T1
		      , TB_SL_MON_PLN     T2
			  , (SELECT NO
                    FROM CPY_T 
                   WHERE 1 = 1
                     AND NO <![CDATA[ <= ]]> 1) T3
		  WHERE 1 = 1
		  AND T1.CHNL_CD         = #CHNL_CD#
		  AND T1.CHNL_CD         = T2.CHNL_CD
		  AND T1.SL_PLN_NO       = T2.SL_PLN_NO
		  AND T1.PROD_PLN_NO     = #PROD_PLN_NO#-->
		  <!--SELECT #SL_ORD_NO# + '_' + CONVERT(VARCHAR,#SL_ORD_SEQ#)  + '-'+ #ITM_CD# + dbo.F_RPAD(((SELECT SUBSTRING(ISNULL(MAX(LOT_DIV_NO), 0), LEN(ISNULL(MAX(LOT_DIV_NO), 0))-3, 4) FROM TB_PROD_LOT_DIV Z WHERE 1 = 1 AND Z.CHNL_CD = #CHNL_CD# AND Z.ORD_NO = #SL_ORD_NO# AND Z.ORD_SEQ = #SL_ORD_SEQ# ) + 1 + T3.NO), 4, '0') AS LOT_DIV_NO
		  FROM CPY_T AS  T3
		  WHERE 1 = 1
		  AND NO <![CDATA[ <= ]]> 1-->
		  <!--SELECT #SL_ORD_NO# + '_' +  RIGHT('00' + CONVERT(VARCHAR,#SL_ORD_SEQ#),2)  + '-' + dbo.F_RPAD(((SELECT SUBSTRING(ISNULL(MAX(LOT_DIV_NO), 0), LEN(ISNULL(MAX(LOT_DIV_NO), 0))-3, 4) FROM TB_PROD_LOT_DIV Z WHERE 1 = 1 AND Z.CHNL_CD = #CHNL_CD# AND Z.ORD_NO = #SL_ORD_NO# AND Z.ORD_SEQ = #SL_ORD_SEQ# ) + 1), 4, '0') AS LOT_DIV_NO
		  FROM CPY_T AS  T3
		  WHERE 1 = 1
		  AND NO <![CDATA[ <= ]]> 1-->
		  <!--
		  SELECT TOP 1 ISNULL('WO' + FORMAT(GETDATE(), 'yyMM') + RIGHT('000000' + CONVERT(VARCHAR, RIGHT(MAX(X.LOT_DIV_NO), 6) + 1), 6), ('WO' + FORMAT(GETDATE(), 'yyMM') + '000001')) AS LOT_DIV_NO
		  FROM TB_PROD_LOT_DIV AS X  WHERE X.CHNL_CD = #CHNL_CD# AND X.LOT_DIV_NO LIKE 'WO' + FORMAT(GETDATE(), 'yyMM') + '%'
		  -->
		  SELECT dbo.FF_PROD_WO_CRT( #CHNL_CD#, dbo.FN_splitValue(#ROUT_ITM_CD#, '-', 1), #SL_ORD_NO#, #SL_ORD_SEQ# ) AS LOT_DIV_NO
	  </select>


	  <insert id="M66520InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
         INSERT INTO TB_PROD_LOT_DIV
          (
                CHNL_CD 
              , LOT_DIV_NO
              , LOT_DIV_SEQ
              , PROD_ORD_NO
              , PROD_PLN_DT
              , ITM_CD
              , LOT_DIV_QTY    
              , WRK_DIR_PPR_FLG
              , CRE_USR_ID
              , CRE_DT
              , UPD_USR_ID
              , UPD_DT    
              , DY_NGT_FLG
			        , PCK_FLG
			        , ORD_NO
			        , ORD_SEQ
			        , LOT_DIV_RMK
			        , ROUT_ITM_CD
			        , EQ_NO
			        , DY_NGT_RMK
          )
		  VALUES
		  (
              #CHNL_CD#
            , #LOT_DIV_NO#
			      , #LOT_DIV_SEQ#
            , #LOT_DIV_NO#
			      , #PROD_PLN_DT#
            , #ITM_CD#
            , ROUND(#PROD_PLN_QTY# / 1, 0) 
            , 'N'
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()    
            , #DY_NGT_FLG#
			      , #PCK_FLG#
			      , #SL_ORD_NO#
			      , #SL_ORD_SEQ#
			      , #MM_RMK#
			      , #ROUT_ITM_CD#
			      , #PROD_EQ_NO#
			      , #DY_NGT_RMK#
          )
		  <!--
          SELECT T1.CHNL_CD
               , #LOT_DIV_NO# 
               , T1.PROD_PLN_NO
               , T1.PROD_PLN_DT
               , (SELECT MAX(ITM_CD) FROM TB_CD_ITM  Z WHERE 1 = 1 AND Z.CHNL_CD = #CHNL_CD# AND Z.ITM_CD  = T2.ITM_CD AND Z.ITM_GRP_CLSS_CD  = 'G' )  AS ITM_CD
               , ROUND(T1.PROD_PLN_QTY / 1, 0) AS LOT_DIV_QTY
               , 'N'
               , #CRE_USR_ID#
               , GETDATE()
               , #UPD_USR_ID#
               , GETDATE()    
               , #DY_NGT_FLG#
			   , #PCK_FLG#
            FROM TB_PROD_MON_PLN   T1
               , TB_SL_MON_PLN     T2 
               , (SELECT NO
                    FROM CPY_T 
                   WHERE 1 = 1
                     AND NO <![CDATA[ <= ]]> 1) T3
           WHERE 1 = 1
             AND T1.CHNL_CD         = #CHNL_CD#
             AND T1.CHNL_CD         = T2.CHNL_CD   
             AND T1.SL_PLN_NO       = T2.SL_PLN_NO
             AND T1.PROD_PLN_NO     = #PROD_PLN_NO#-->
    </insert>

	  <update id="M66520UpdateMst" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_PROD_LOT_DIV
		  SET
		      WRK_DIR_PPR_FLG   = #WRK_DIR_PPR_FLG#
			  , LOT_DIV_QTY       = #LOT_DIV_QTY#
        , PROD_PLN_DT       = #UPD_DT#
		    , UPD_USR_ID        = #UPD_USR_ID#
		    , UPD_DT            = GETDATE()
		  WHERE 1=1
		    AND CHNL_CD    = #CHNL_CD#
		    AND LOT_DIV_NO = #LOT_DIV_NO#
		<isNotNull property="LOT_DIV_SEQ" >
		    AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
	    </isNotNull>
	  </update>

	  
	<select id="M66520SelectDtlTmp" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		SELECT dbo.FF_FPRF_N2ND_STEP_LOTNO(#CHNL_CD#, CONVERT(DATETIME, GETDATE())) AS PROC_LOT_NO
	</select>
	  
	<insert id="M66520InsertDtl" parameterClass="ModelsLibrary.Man.ManVo">
        INSERT INTO TB_FPRF_N2ND_STEP_ROUT
        (     
		          CHNL_CD
            , PROC_LOT_NO
            , ROUT_ITM_CD 
            , MAKE_DT
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
            , CUST_ITM_CD
            , CO_CD
            , CLZ_FLG
            , PROD_ORD_NO
            , PROD_ORD_SEQ
			      , EQ_NO
			      , ITM_QTY
			      , INP_STAFF_VAL
			      , MAKE_ST_DT
			      , MAKE_END_DT
        ) 
		    VALUES
		    (
              #CHNL_CD#
            , #PROC_LOT_NO#
            , #ROUT_ITM_CD#
            , GETDATE()
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()      
            , #ASSY_CD#
            , #CO_CD#
            , 'N'
            , #LOT_DIV_NO#
            , #LOT_DIV_SEQ#
			      , #PROD_EQ_NO#
			      , 0
		        , #INP_STAFF_VAL#
			      , CONVERT(DATETIME, #MAKE_ST_DT#)
			      , CONVERT(DATETIME, #MAKE_END_DT#)
        )
	</insert>
	  
	  
	<insert id="M66520InsertDtlItm" parameterClass="ModelsLibrary.Man.ManVo">
          INSERT INTO TB_FPRF_N2ND_JOIN_ROUT
            ( 
                  CHNL_CD
                , PROC_LOT_NO
                , PROC_LOT_SEQ
                , PRNT_LOT_NO
                , ROUT_ITM_CD
                , CRE_USR_ID
                , CRE_DT
                , UPD_USR_ID
                , UPD_DT
            ) 
			VALUES
			(
                  #CHNL_CD#                   
                , #PROC_LOT_NO#
                , ISNULL((SELECT MAX(PROC_LOT_SEQ) + 1 FROM TB_FPRF_N2ND_JOIN_ROUT WHERE CHNL_CD = #CHNL_CD# AND PROC_LOT_NO = #PROC_LOT_NO#), 1) 
                , #PRNT_LOT_NO#
                , #CMPO_CD#
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()                    
            ) 
	</insert>



	  <delete id="M66520DeleteDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_FPRF_N2ND_STEP_ROUT
		  WHERE 1 = 1
		  AND CHNL_CD   = #CHNL_CD#
		  AND PROD_ORD_NO = #PROD_ORD_NO#
	  </delete>

	  <delete id="M66520DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_LOT_DIV
		  WHERE 1 = 1
		  AND CHNL_CD   = #CHNL_CD#
		  AND LOT_DIV_NO = #LOT_DIV_NO#
	  </delete>


	  <select id="M66520SelectReport" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		   SELECT
              T7.ITM_CD
		        , T7.ITM_NM
		        , T7.ITM_SZ_NM
		        , T7.UOM_NM
		        , SUM(T7.LOT_DIV_QTY)   AS LOT_DIV_QTY
		        , T7.CMPO_CD
		        , T7.CMPO_NM
		        , MAX(T7.MM_01) AS MM_01
		        , MAX(T7.MM_02) AS MM_02
		        , CEILING(SUM(T7.SL_ITM_QTY))    AS SL_ITM_QTY
		        , MAX(T7.DY_NGT_NM)     AS DY_NGT_NM
		        , T7.SL_ORD_NO
		        , T7.SL_ORD_SEQ
		        , MAX(T7.SL_PLN_QTY)    AS SL_PLN_QTY
		        , T7.PROC_LOT_NO
			    <!--
			      , '충전' AS ROUT_NM
			    -->
		        , #ROUT_NM# AS ROUT_NM
		        , T7.ROUT_ITM_CD
			      , T7.GBN
			      , T7.UPD_DT
			      , MAX(T7.PROD_PLN_DT)   AS PROD_PLN_DT
			      , T7.LOT_DIV_NO
			      , MAX(T7.CMPO_RMK)      AS CMPO_RMK
			      , ROW_NUMBER() OVER (ORDER BY T7.CMPO_CD) AS RN
            , T7.PRNT_ROUT_NM
            , T7.EQ_NO
            , T7.MM_RMK
        FROM (
		       SELECT T1.ITM_CD
		          , dbo.CD_ITEM_NM_FNC(T3.CHNL_CD, T3.ITM_CD) AS ITM_NM
		          , T3.ITM_SZ_NM
		          , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD , 'L-003', T3.UOM_CD) AS UOM_NM
		          , T1.LOT_DIV_QTY
		          , ROW_NUMBER() OVER (ORDER BY T2.CMPO_CD) AS RN
		          , T2.CMPO_CD
		          , dbo.CD_ITEM_NM_FNC(T2.CHNL_CD, T2.CMPO_CD) AS CMPO_NM
		          , (SELECT ITM_SZ_NM FROM TB_CD_ITM AS X WHERE 1 = 1  AND  X.CHNL_CD = T1.CHNL_CD AND X.ITM_CD = T2.CMPO_CD) AS MM_01
		          , dbo.CD_ITEM_UOM_FNC(T2.CHNL_CD, T2.CMPO_CD) AS MM_02
		          , (T1.LOT_DIV_QTY * T2.INP_QTY) AS SL_ITM_QTY
			      <!--
		          , CASE WHEN T1.DY_NGT_FLG = 'A' THEN '오전' WHEN  T1.DY_NGT_FLG='B' THEN '오후'  WHEN T1.DY_NGT_FLG = 'C' THEN '연장'  WHEN T1.DY_NGT_FLG = 'D' THEN '기타' END AS DY_NGT_NM
			      -->
		          , '오전, 오후, 연장' AS DY_NGT_NM
		          , T1.ORD_NO       AS SL_ORD_NO
		          , T1.ORD_SEQ      AS SL_ORD_SEQ
		          , (SELECT SO_QT FROM DZICUBE.dbO.LSO_D X WHERE 1 = 1 AND X.SO_NB = T1.ORD_NO AND X.SO_SQ = T1.ORD_SEQ) AS SL_PLN_QTY
		          , T4.PROC_LOT_NO
		          , T4.ROUT_NM
		          , T4.ROUT_ITM_CD
			        , (CASE WHEN T4.ROUT_ITM_CD IS NULL THEN 'N' ELSE 'Y' END) AS GBN
			        , (SELECT TOP 1 REMARK_DC FROM DZICUBE.dbO.LSO_D X WHERE 1 = 1 AND X.SO_NB = T1.ORD_NO AND X.SO_SQ = T1.ORD_SEQ ) AS CMPO_RMK 
			        , CONVERT(VARCHAR, GETDATE(), 23) AS UPD_DT
			        , CONVERT(VARCHAR, T1.PROD_PLN_DT, 23) AS PROD_PLN_DT
			        , T1.LOT_DIV_NO
			        , T1.LOT_DIV_RMK  AS MM_RMK
			        , T1.DY_NGT_RMK
              , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-908', T2.PRNT_ROUT_CD) AS PRNT_ROUT_NM
              , T1.EQ_NO
		        FROM TB_PROD_LOT_DIV T1
		             , TB_PROD_BOM T2 LEFT OUTER JOIN
				     (
		                    SELECT Z1.PROC_LOT_NO AS PROC_LOT_NO, dbo.FF_NM_ROUT(Z1.CHNL_CD , LEFT(Z1.ROUT_ITM_CD,3))AS ROUT_NM, Z2.ROUT_ITM_CD AS ROUT_ITM_CD
		                        FROM  TB_FPRF_N2ND_STEP_ROUT Z1
		                            , TB_FPRF_N2ND_JOIN_ROUT Z2
		                          WHERE 1 = 1
		                            AND Z1.CHNL_CD      = Z2.CHNL_CD
		                            AND Z1.PROC_LOT_NO  = Z2.PROC_LOT_NO
		                            AND Z1.PROD_ORD_NO  = #LOT_DIV_NO#
		                            AND Z1.CHNL_CD      = #CHNL_CD#
								    <!--AND Z1.PROD_ORD_SEQ = 1 -->
				    ) T4 ON (T2.CMPO_CD = T4.ROUT_ITM_CD)
		          , TB_CD_ITM T3
		      WHERE 1 = 1
		          AND T1.CHNL_CD = T2.CHNL_CD
		          AND T1.CHNL_CD = T3.CHNL_CD
		          AND T2.CHNL_CD = T3.CHNL_CD
		          AND T1.CHNL_CD = #CHNL_CD#
		          AND T1.ITM_CD  = T2.ASSY_CD
		          AND T1.ITM_CD  = T3.ITM_CD
		          AND T2.ASSY_CD = T3.ITM_CD
		          AND T1.LOT_DIV_NO = #LOT_DIV_NO#
			  	) AS T7
	    GROUP BY 
				    T7.ITM_CD
		      , T7.ITM_NM
		      , T7.ITM_SZ_NM
		      , T7.UOM_NM
		      , T7.CMPO_CD
		      , T7.CMPO_NM
		      , T7.SL_ORD_NO
		      , T7.SL_ORD_SEQ
		      , T7.PROC_LOT_NO
		      , T7.ROUT_NM
		      , T7.ROUT_ITM_CD
			    , T7.GBN
			    , T7.UPD_DT
			    , T7.LOT_DIV_NO
          , T7.PRNT_ROUT_NM
          , T7.EQ_NO
          , T7.MM_RMK
	  </select>

    <!-- M66520 공정별 합계 수량 표시-->
    <!-- 21/10/14 포장작지발행 : 지시수량에따른 각 실적공정의 총 지시수량 출력 쿼리-->
   <select id="M66520PopupRoutQty" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
       SELECT   
                 MAX( DY_NGT_NM) AS DY_NGT_NM
               , MAX( DY_NGT_FLG) AS DY_NGT_FLG
               , SUM( LOT_DIV_QTY) AS LOT_DIV_QTY
               , MAX( ITM_CD) AS ITM_CD
               , MAX( PCK_FLG) AS PCK_FLG
               , MAX( ROUT_NM) AS ROUT_NM
        FROM(   SELECT 
                 CONVERT(VARCHAR, T1.PROD_PLN_DT , 23)      AS UPD_DT 
               , T1.LOT_DIV_NO 
               , T1.LOT_DIV_SEQ 
               , CASE
                      WHEN T1.DY_NGT_FLG = 'A' THEN '오전'
                      WHEN T1.DY_NGT_FLG = 'B' THEN '오후'
                      WHEN T1.DY_NGT_FLG = 'C' THEN '연장'
                      WHEN T1.DY_NGT_FLG = 'D' THEN '기타'
                      WHEN T1.DY_NGT_FLG = 'E' THEN '내부1'
                      WHEN T1.DY_NGT_FLG = 'F' THEN '내부2'
                    END AS DY_NGT_NM 
               , T1.DY_NGT_FLG 
               , T1.EQ_NO 
               , DBO.FF_EQ_NM_FNC(T1.CHNL_CD, T1.EQ_NO) AS EQ_NM 
               , T2.INP_STAFF_VAL 
               , T1.LOT_DIV_QTY AS PROD_PLN_QTY 
               , T1.LOT_DIV_QTY 
               , T1.WRK_DIR_PPR_FLG 
               , T1.CHNL_CD 
               , #ITM_CD#                                            AS ITM_CD 
               , T1.LOT_DIV_RMK                                      AS MM_RMK 
               , T1.PCK_FLG                                          AS PCK_FLG 
               , DBO.FF_NM_ROUT(T2.CHNL_CD , LEFT(T2.ROUT_ITM_CD,3)) AS ROUT_NM 
               , ISNULL(T2.CLZ_FLG, 'N')                             AS CLZ_FLG 
               , T1.DY_NGT_RMK 
               , T1.LOT_DIV_NO + ' / ' + DBO.FF_NM_ROUT(T2.CHNL_CD , LEFT(T2.ROUT_ITM_CD,3)) AS GBN
        FROM             TB_PROD_LOT_DIV T1
        LEFT OUTER JOIN  TB_FPRF_N2ND_STEP_ROUT T2
        ON (             T1.CHNL_CD = T2.CHNL_CD
                        AND    T1.LOT_DIV_NO = T2.PROD_ORD_NO
                        AND    T1.LOT_DIV_SEQ = T2.PROD_ORD_SEQ)
        WHERE 1 = 1
                AND T1.CHNL_CD   = #CHNL_CD#
               AND T1.ORD_NO    = #SL_ORD_NO#
               AND T1.ORD_SEQ   = #SL_ORD_SEQ# 
         <isNotNull property="PCK_FLG" >
                AND T1.PCK_FLG       = #PCK_FLG#
         </isNotNull>
        )  AS T5
        GROUP BY T5.ROUT_NM
      </select>
    
    
    
    

	  
	  
	  
	  
	  <!-- M66540 ANP 작업 지시서-->
	    <select id="M66540SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
			SELECT ROW_NUMBER() OVER(PARTITION BY NULL ORDER BY T1.SCM_RLSE_DT) AS RN
			, T1.ITM_CD
			, T2.ITM_NM
			, T2.ITM_SZ_NM
			, T1.ITM_QTY                              AS PROD_PLN_QTY
			, T1.CHNL_CD
			, T1.SCM_RLSE_NO                          AS SL_PLN_NO
			, T1.SCM_RLSE_NO                          AS PROD_PLN_NO
			, CONVERT(VARCHAR(6),T1.SCM_RLSE_DT,112)  AS SL_PLN_YRMON
			, T1.CUST_CO_CD                           AS SL_CO_CD
			, dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CUST_CO_CD) AS CO_NM
			, CONVERT(VARCHAR, T1.SCM_RLSE_DT, 23) AS PROD_PLN_DT
			, T1.ORD_NO                            AS SL_ORD_NO
			, T1.ORD_SEQ                          AS SL_ORD_SEQ
			FROM  TB_SCM_ORD_RLSE T1
			, TB_CD_ITM T2
			WHERE 1 = 1
			AND T1.CHNL_CD = T2.CHNL_CD
			AND T1.ITM_CD  = T2.ITM_CD
			AND T1.CHNL_CD = #CHNL_CD#
			AND T1.SCM_RLSE_DT   >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
			AND T1.SCM_RLSE_DT  <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
   </select>


	  <select id="M66540SelectDetail" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		<!--SELECT ROW_NUMBER() OVER ( PARTITION BY  NULL ORDER BY T1.LOT_DIV_SEQ) AS RN
		      , T1.LOT_DIV_NO
		      , T1.LOT_DIV_SEQ
		      , T1.PROD_ORD_NO
		      , T2.MCHN_NO     AS EQ_NO
		      , dbo.FF_EQ_NM_FNC(T1.CHNL_CD, T2.MCHN_NO)  AS EQ_NM
		      , T2.PROD_PLN_QTY
		      , T1.LOT_DIV_QTY
		      , T1.DY_NGT_FLG
		      , CASE WHEN T1.DY_NGT_FLG = 'N' THEN '주간' ELSE '야간' END AS DY_NGT_NM
		      , T1.WRK_DIR_PPR_FLG
		      , T3.ITM_CD
		      , dbo.PUR_N1ST_GRP_NM_FNC(T3.CHNL_CD, 'G', T3.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM
		      , T2.PROD_PLN_NO
		      , CONVERT(VARCHAR, T2.PROD_PLN_DT, 23) AS PROD_PLN_DT
		      , T1.CHNL_CD
			  , CONVERT(VARCHAR, T1.UPD_DT  , 23)  AS      UPD_DT        
			  , CONVERT(VARCHAR(5),T2.WRK_ST_DT,8)  AS WRK_ST_DT
              , CONVERT(VARCHAR(5),T2.WRK_END_DT,8)  AS WRK_END_DT
              , T2.INP_STAFF_VAL 
              , T2.PROD_PLN_RMK  
			  , T1.PCK_FLG      AS PCK_FLG
			  , (SELECT TOP 1 MOLD_NM FROM TB_PROD_MOLD_CD X WHERE 1 = 1 AND T1.MOLD_CD = X.MOLD_NO ) AS MOLD_NM
			  , T1.MOLD_CD
			  , CONVERT(VARCHAR, GETDATE(), 120) WRK_ST_DT
			  , CONVERT(VARCHAR, GETDATE(), 120) WRK_END_DT
		  FROM TB_PROD_LOT_DIV  T1
		      , TB_PROD_MON_PLN  T2
		      , TB_CD_ITM        T3
		  WHERE 1 = 1
		      AND T1.CHNL_CD         = #CHNL_CD#
		      AND T1.CHNL_CD         = T2.CHNL_CD
		      AND T1.CHNL_CD         = T3.CHNL_CD
		      AND T1.ITM_CD          = T3.ITM_CD
		      AND T1.PROD_ORD_NO     = T2.PROD_PLN_NO
		      AND T1.PROD_ORD_NO     = #PROD_PLN_NO#
			<isNotNull property="PCK_FLG" >
			  AND T1.PCK_FLG       = #PCK_FLG#
			</isNotNull>-->
		  
		     SELECT   
			     ROW_NUMBER() OVER ( PARTITION BY  NULL ORDER BY T1.UPD_DT) AS RN
               , CONVERT(VARCHAR, T1.UPD_DT  , 23)  AS UPD_DT 
               , T1.LOT_DIV_NO 
               , CONVERT(VARCHAR, T2.MAKE_DT , 23)  AS MAKE_DT
               , CASE WHEN T1.DY_NGT_FLG = 'A' THEN '오전' WHEN  T1.DY_NGT_FLG='B' THEN '오후'  WHEN T1.DY_NGT_FLG = 'C' THEN '연장'  WHEN T1.DY_NGT_FLG = 'D' THEN '기타' END AS DY_NGT_NM   
			   , T1.DY_NGT_FLG
               , T2.EQ_NO 
			   , dbo.FF_EQ_NM_FNC(#CHNL_CD#, T2.EQ_NO) AS EQ_NM
               , T2.INP_STAFF_VAL 
               , CONVERT(VARCHAR(5),T2.MAKE_ST_DT,8)  AS WRK_ST_DT
               , CONVERT(VARCHAR(5),T2.MAKE_END_DT,8)  AS WRK_END_DT
               , T1.LOT_DIV_QTY 
			   , T1.WRK_DIR_PPR_FLG
			   , T1.LOT_DIV_QTY  AS PROD_PLN_QTY
			   , T1.CHNL_CD
			   , #ITM_CD#           AS ITM_CD
			   , T1.LOT_DIV_RMK     AS MM_RMK
			   , T1.PCK_FLG         AS PCK_FLG
			   , dbo.FF_NM_ROUT(T2.CHNL_CD , LEFT(T2.ROUT_ITM_CD,3)) AS ROUT_NM
			   , ISNULL(T2.CLZ_FLG, 'N') AS CLZ_FLG
          FROM TB_PROD_LOT_DIV  T1 LEFT OUTER JOIN TB_FPRF_N2ND_STEP_ROUT T2 ON (T1.CHNL_CD = T2.CHNL_CD AND T1.PROD_ORD_NO = T2.PROD_ORD_NO)
             WHERE 1 = 1
                AND T1.CHNL_CD   = #CHNL_CD#
	            AND T1.ORD_NO    = #PROD_PLN_NO#
			<!--
			<isNotNull property="SL_ORD_SEQ" >
	            AND T1.ORD_SEQ   = #SL_ORD_SEQ# 
			</isNotNull>
			-->
			<isNotNull property="PCK_FLG" >
			  AND T1.PCK_FLG       = #PCK_FLG#
			</isNotNull>
	  </select>


	  <select id="M66540SelectDetail_two" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT  MAX(RN) AS RN
                , MAX(ROUT_CD) AS ROUT_CD
                , MAX(ROUT_NM) AS ROUT_NM
                , CMPO_CD AS CMPO_CD
                , MAX(ITM_NM) AS ITM_NM
                , MAX(ITM_SZ_NM) AS ITM_SZ_NM 
                , MAX(INP_QTY) AS INP_QTY
                , MAX(USE_FLG) AS GBN    
            FROM (  
                      SELECT 0 AS RN
                             ,'' AS ROUT_CD
                             ,'' AS ROUT_NM
                             ,T2.ROUT_ITM_CD AS CMPO_CD
                             ,'' AS ITM_NM
                             ,'' AS ITM_SZ_NM
                             ,0  AS INP_QTY
                             ,'Y' AS USE_FLG
                        FROM TB_FPRF_N2ND_STEP_ROUT T1
                            ,TB_FPRF_N2ND_JOIN_ROUT T2
                       WHERE 1 = 1 
                         AND T1.PROC_LOT_NO = T2.PROC_LOT_NO
                         AND T1.CHNL_CD = T2.CHNL_CD
                         AND T1.CHNL_CD = #CHNL_CD#
                         AND T1.PROD_ORD_NO = #LOT_DIV_NO#
                   UNION ALL 
                   SELECT ROW_NUMBER() OVER (ORDER BY ROUT_CD) AS RN
                      ,T1.ROUT_CD
                      ,dbo.FF_PROD_ROUT_NM_FNC(#CHNL_CD#,T1.ROUT_CD) AS ROUT_NM
                      ,T1.CMPO_CD
                      ,T2.ITM_NM 
                      ,T2.ITM_SZ_NM 
                      ,(#PROD_PLN_QTY# * T1.INP_QTY) AS INP_QTY
                      ,'N' AS USE_FLG
                  FROM TB_PROD_BOM T1
                      ,TB_CD_ITM T2
                 WHERE 1 = 1 
                   AND T1.CHNL_CD = T2.CHNL_CD
                   AND T1.CMPO_CD = T2.ITM_CD
                   AND T1.CHNL_CD = #CHNL_CD#
                   AND T1.ASSY_CD = #ITM_CD#
           ) AS TT 
         GROUP BY TT.CMPO_CD
		 ORDER BY RN
	  </select>



	  <select id="M66540SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		 SELECT ROW_NUMBER() OVER (ORDER BY ROUT_CD) AS RN
              , T1.ROUT_CD
              , dbo.FF_PROD_ROUT_NM_FNC(#CHNL_CD#,T1.ROUT_CD) AS ROUT_NM
              , T1.CMPO_CD
              , T2.ITM_NM 
              , T2.ITM_SZ_NM
              , (#PROD_PLN_QTY# * T1.INP_QTY) AS INP_QTY 
			        , dbo.CD_SYS_CLSS_FNC(T1.CHNL_CD , 'L-003', T2.UOM_CD) AS UOM_NM
			        , #PROD_PLN_NO# AS PROD_PLN_NO
			        , #PROD_PLN_NO# AS SL_ORD_NO
			        , #CRE_USR_ID# AS CRE_USR_ID
			        , #UPD_USR_ID# AS UPD_USR_ID
			        , (T1.ROUT_CD + '-' +  T1.ASSY_CD) AS  ROUT_ITM_CD
			        , T1.CHNL_CD
			        , T1.ASSY_CD
			        , #PCK_FLG#  AS PCK_FLG
			        , '신내리'   AS GBN
			        , ' '        AS MCHN_NO
			        , ' '        AS MOLD_CD
          FROM TB_PROD_BOM T1
              ,TB_CD_ITM T2
         WHERE 1 = 1 
           AND T1.CHNL_CD = T2.CHNL_CD
           AND T1.CMPO_CD = T2.ITM_CD
           AND T1.CHNL_CD = #CHNL_CD#
		   <!--
           AND T1.ASSY_CD = #ITM_CD#
		   -->
           AND T1.ROUT_ITM_CD = #ITM_CD#
		<isNotNull property="A_ROUT_CD" >
			  <iterate property="A_ROUT_CD" prepend=" AND T1.ROUT_CD IN " open = "(" close=")" conjunction=",">
                #A_ROUT_CD[]#
              </iterate>
            <!--
			AND T1.ROUT_CD = #ROUT_CD#
			-->
		</isNotNull>
	  </select>



	  <select id="M66540SelectMstTmp" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT PROD_PLN_NO + dbo.F_RPAD(((SELECT SUBSTRING(ISNULL(MAX(LOT_DIV_NO), 0), 20, 4) FROM TB_PROD_LOT_DIV Z WHERE 1 = 1 AND Z.CHNL_CD = #CHNL_CD# AND LOT_DIV_NO LIKE T1.PROD_PLN_NO+'%' ) + T3.NO), 4, '0') AS LOT_DIV_NO
		  FROM TB_PROD_MON_PLN   T1
		      , TB_SL_MON_PLN     T2
			  , (SELECT NO
                    FROM CPY_T 
                   WHERE 1 = 1
                     AND NO <![CDATA[ <= ]]> 1) T3
		  WHERE 1 = 1
		  AND T1.CHNL_CD         = #CHNL_CD#
		  AND T1.CHNL_CD         = T2.CHNL_CD
		  AND T1.SL_PLN_NO       = T2.SL_PLN_NO
		  AND T1.PROD_PLN_NO     = #PROD_PLN_NO#
	  </select>

	  
	      
      <insert id="M66540InsertTmp1" parameterClass="ModelsLibrary.Sale.SaleVo">
	    INSERT INTO TB_SL_MON_PLN 
          (
              CHNL_CD
            , SL_PLN_NO
            , SL_PLN_YRMON
            , N1ST_ITM_GRP_CD
            , ITM_CD
            , SL_CO_CD
            , SL_PLN_CD
            , SL_PLN_QTY
            , SL_PLN_RMK
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
            , CLZ_FLG
		    , SL_ORD_NO
	        , SL_ORD_SEQ
        ) 
        VALUES 
        (
            #CHNL_CD#
	      , #GBN#
	      , #SL_PLN_YRMON#
	      , #N1ST_ITM_GRP_CD#
	      , #ITM_CD#
	      , #CO_CD#
	      , #SL_PLN_CD#
	      , #SL_PLN_QTY#
	      , #SL_PLN_RMK#
	      , #CRE_USR_ID#
	      , GETDATE()
	      , #UPD_USR_ID#
	      , GETDATE()
	      , #CLZ_FLG#
	      , #SL_ORD_NO#
	      , #SL_ORD_SEQ#
	    )
      </insert>


	  <insert id="M66540InsertTmp2" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_MON_PLN
		  (
		      CHNL_CD
		      , PROD_PLN_NO
		      , SL_PLN_NO
		      , PLN_APLY_ST_DT
		      , PLN_APLY_END_DT
		      , PLN_DYS
		      , MCHN_NO
		      , PROD_PLN_QTY
		      , PROD_PLN_RMK
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		      , CLZ_FLG
		      , PROD_PLN_DT
		      , INP_STAFF_VAL
		      , WRK_ST_DT
		      , WRK_END_DT
		  )
		  VALUES
		  (
		      #CHNL_CD#
		      , #PROD_PLN_NO#
		      , #SL_PLN_NO#
		      , #PLN_APLY_ST_DT#
		      , #PLN_APLY_END_DT#
		      , #PLN_DYS#
		      , #MCHN_NO#
		      , #PROD_PLN_QTY#
		      , #PROD_PLN_RMK#
		      , #CRE_USR_ID#
		      , GETDATE()
		      , #UPD_USR_ID#
		      , GETDATE()
		      , #CLZ_FLG#
		      , GETDATE()
		      , #INP_STAFF_VAL#
		      , #WRK_ST_DT#
		      , #WRK_END_DT#
		  )
	  </insert>



	  <insert id="M66540InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
         INSERT INTO TB_PROD_LOT_DIV
          (
                CHNL_CD 
              , LOT_DIV_NO
			  , LOT_DIV_SEQ
              , PROD_ORD_NO
              , PROD_PLN_DT
              , ITM_CD
              , LOT_DIV_QTY    
              , WRK_DIR_PPR_FLG
              , CRE_USR_ID
              , CRE_DT
              , UPD_USR_ID
              , UPD_DT    
              , DY_NGT_FLG
			  , PCK_FLG
			  , MOLD_CD
		      , ORD_NO
	          , ORD_SEQ
          )
          SELECT T1.CHNL_CD
               , #LOT_DIV_NO# 
			   , ISNULL((SELECT MAX(LOT_DIV_SEQ) + 1 FROM TB_PROD_LOT_DIV WHERE CHNL_CD = #CHNL_CD# AND LOT_DIV_NO = #LOT_DIV_NO# ), 1) 
               , T1.PROD_PLN_NO
               , T1.PROD_PLN_DT
               , (SELECT MAX(ITM_CD) FROM TB_CD_ITM  Z WHERE 1 = 1 AND Z.CHNL_CD = #CHNL_CD# AND Z.ITM_CD  = T2.ITM_CD AND Z.ITM_GRP_CLSS_CD  = 'G' )  AS ITM_CD
               , ROUND(T1.PROD_PLN_QTY / 1, 0) AS LOT_DIV_QTY
               , 'N'
               , #CRE_USR_ID#
               , GETDATE()
               , #UPD_USR_ID#
               , GETDATE()    
               , 'N'
			   , #PCK_FLG#
			   , #MOLD_CD#
			   , #SL_ORD_NO#
			   , #SL_ORD_SEQ#
            FROM TB_PROD_MON_PLN   T1
               , TB_SL_MON_PLN     T2 
               , (SELECT NO
                    FROM CPY_T 
                   WHERE 1 = 1
                     AND NO <![CDATA[ <= ]]> 1) T3
           WHERE 1 = 1
             AND T1.CHNL_CD         = #CHNL_CD#
             AND T1.CHNL_CD         = T2.CHNL_CD   
             AND T1.SL_PLN_NO       = T2.SL_PLN_NO
             AND T1.PROD_PLN_NO     = #PROD_PLN_NO#
    </insert>


	<select id="M66540SelectDtlTmp" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		SELECT dbo.FF_FPRF_N2ND_STEP_LOTNO(#CHNL_CD#, CONVERT(DATETIME, GETDATE())) AS PROC_LOT_NO
	</select>
	  
	<insert id="M66540InsertDtl" parameterClass="ModelsLibrary.Man.ManVo">
        INSERT INTO TB_FPRF_N2ND_STEP_ROUT
        (     
		      CHNL_CD
            , PROC_LOT_NO
            , ROUT_ITM_CD 
            , MAKE_DT
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
            , CUST_ITM_CD
            , CO_CD
            , CLZ_FLG
            , PROD_ORD_NO
            , PROD_ORD_SEQ
        ) 
		VALUES
		(
              #CHNL_CD#
            , #PROC_LOT_NO#
            , #ROUT_ITM_CD#
            , GETDATE()
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()      
            , #ASSY_CD#
            , #CO_CD#
            , 'N'
            , #LOT_DIV_NO#
            , 1
        )
	</insert>
	  
	  
	<insert id="M66540InsertDtlItm" parameterClass="ModelsLibrary.Man.ManVo">
          INSERT INTO TB_FPRF_N2ND_JOIN_ROUT
            ( 
                  CHNL_CD
                , PROC_LOT_NO
                , PROC_LOT_SEQ
                , PRNT_LOT_NO
                , ROUT_ITM_CD
                , CRE_USR_ID
                , CRE_DT
                , UPD_USR_ID
                , UPD_DT
            ) 
			VALUES
			(
                  #CHNL_CD#                   
                , #PROC_LOT_NO#
                , ISNULL((SELECT MAX(PROC_LOT_SEQ) + 1 FROM TB_FPRF_N2ND_JOIN_ROUT WHERE CHNL_CD = #CHNL_CD# AND PROC_LOT_NO = #PROC_LOT_NO#), 1) 
                , #PRNT_LOT_NO#
                , #CMPO_CD#
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()                    
            ) 
	</insert>



	  <delete id="M66540DeleteDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_FPRF_N2ND_STEP_ROUT
		  WHERE 1 = 1
		  AND CHNL_CD   = #CHNL_CD#
		  AND PROD_ORD_NO = #PROD_ORD_NO#
	  </delete>

	  <delete id="M66540DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_LOT_DIV
		  WHERE 1 = 1
		  AND CHNL_CD   = #CHNL_CD#
		  AND LOT_DIV_NO = #LOT_DIV_NO#
	  </delete>


	  <select id="M66540SelectReport" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT T1.ITM_CD
		    , dbo.CD_ITEM_NM_FNC(T3.CHNL_CD, T3.ITM_CD) AS ITM_NM
		    , T3.ITM_SZ_NM
		    , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD , 'L-003', T3.UOM_CD) AS UOM_NM
		    , T1.LOT_DIV_QTY
		    , ROW_NUMBER() OVER (ORDER BY T2.CMPO_CD) AS RN
		    , T2.CMPO_CD
		    , dbo.CD_ITEM_NM_FNC(T2.CHNL_CD, T2.CMPO_CD) AS CMPO_NM
		    , (SELECT ITM_SZ_NM FROM TB_CD_ITM AS X WHERE 1 = 1  AND  X.CHNL_CD =#CHNL_CD# AND X.ITM_CD = T2.CMPO_CD) AS MM_01
		    , dbo.CD_ITEM_UOM_FNC(T2.CHNL_CD, T2.CMPO_CD) AS MM_02
		    , (T1.LOT_DIV_QTY * T2.INP_QTY) AS SL_ITM_QTY
			, T1.LOT_DIV_QTY  AS SL_PLN_QTY
		  FROM TB_PROD_LOT_DIV T1
		    , TB_PROD_BOM T2
		    , TB_CD_ITM T3
		  WHERE 1 = 1
		      AND T1.CHNL_CD = T2.CHNL_CD
		      AND T1.CHNL_CD = T3.CHNL_CD
		      AND T2.CHNL_CD = T3.CHNL_CD
		      AND T1.CHNL_CD = #CHNL_CD#
		      AND T1.ITM_CD  = T2.ASSY_CD
		      AND T1.ITM_CD  = T3.ITM_CD
		      AND T2.ASSY_CD = T3.ITM_CD
		      AND T1.LOT_DIV_NO = #LOT_DIV_NO#
	  </select>



      <!-- 실적 현황 -->
	  <select id="M661002SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT
		        ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T2.MAKE_DT) AS RN
		      , T1.LOT_DIV_NO AS LOT_DIV_NO
		      , T1.PROD_ORD_NO AS PROD_ORD_NO
			  , CONVERT(VARCHAR, T1.PROD_PLN_DT, 23) AS PROD_PLN_DT
		      , T1.ITM_CD AS ITM_CD
		      , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD) AS ITM_NM
		      , T1.LOT_DIV_QTY AS LOT_DIV_QTY
		      , LEFT (T2.ROUT_ITM_CD,3) AS ROUT_CD
		      , T3.ROUT_NM AS ROUT_NM
		      , T2.MAKE_USR_ID AS USR_ID
			  , dbo.USR_NM_FNC(T2.CHNL_CD, T2.MAKE_USR_ID) AS USR_NM
		      , CONVERT(VARCHAR,T2.MAKE_DT, 23) AS CRE_DT
		      , T2.EQ_NO AS EQ_NO
		      , CONVERT(VARCHAR, T2.MAKE_ST_DT, 21) AS MAKE_ST_DT
		      , CONVERT(VARCHAR, T2.MAKE_END_DT, 21) AS MAKE_END_DT
		      <!--, T2.CHAR_QTY
		      , T2.OB_PER_QTY
		      , T2.OB_QTY
		      , T2.PCS_QTYL-->
		      , T2.INP_STAFF_VAL
		      , T1.CHNL_CD  AS CHNL_CD
			  , T2.ITM_QTY  AS SL_ITM_QTY
			  , CASE WHEN T1.DY_NGT_FLG = 'A' THEN '오전' WHEN  T1.DY_NGT_FLG='B' THEN '오후'  WHEN T1.DY_NGT_FLG = 'C' THEN '연장'  WHEN T1.DY_NGT_FLG = 'D' THEN '기타' END AS DY_NGT_NM   
			  , T1.DY_NGT_FLG
			  , CASE WHEN T1.PCK_FLG = 'C' THEN '충전' WHEN  T1.PCK_FLG='P' THEN '포장' ELSE '기타' END AS PCK_FLG   
		  FROM TB_PROD_LOT_DIV T1
		      , TB_FPRF_N2ND_STEP_ROUT T2
		    LEFT OUTER JOIN TB_PROD_ROUT T3
		        ON(     LEFT(T2.ROUT_ITM_CD,3) = T3.ROUT_CD
		            AND T3.CHNL_CD = #CHNL_CD# )
		  WHERE 1=1
		      AND T1.CHNL_CD     = #CHNL_CD#
		      AND T1.CHNL_CD     = T2.CHNL_CD
		      AND T1.LOT_DIV_NO  = T2.PROD_ORD_NO
		      AND T1.LOT_DIV_SEQ  = T2.PROD_ORD_SEQ
		      AND T2.MAKE_DT >= CAST( #FM_DT# + ' 00:00:00' AS DATETIME)
		      AND T2.MAKE_DT <![CDATA[ <= ]]> CAST( #TO_DT# + ' 23:59:59' AS DATETIME)
		    <isNotNull property="PCK_FLG" >
				AND T1.PCK_FLG = #PCK_FLG#
			</isNotNull>
	  </select>



      <!-- 실적 현황 -->
	  <select id="M66111SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT
		        ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T2.MAKE_DT) AS RN
		      , T1.LOT_DIV_NO                       AS LOT_DIV_NO
		      , CONVERT(VARCHAR,T1.PROD_PLN_DT,23)  AS PROD_PLN_DT
		      , CONVERT(VARCHAR,T2.MAKE_DT, 23)     AS MAKE_DT
		      , T1.ITM_CD                           AS ITM_CD
		      , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD) AS ITM_NM
		      , T1.LOT_DIV_QTY                      AS LOT_DIV_QTY
		      , LEFT (T2.ROUT_ITM_CD,2)             AS ROUT_CD
		      , T3.ROUT_NM                          AS ROUT_NM
			  , dbo.USR_NM_FNC(T2.CHNL_CD, T2.MAKE_USR_ID) AS USR_NM
		      <!--, (SELECT USR_N1ST_NM FROM TB_SYS_USR X WHERE 1 = 1 AND T2.MAKE_USR_ID = X.USR_ID AND T2.CHNL_CD = X.CHNL_CD) AS USR_NM-->
		      , T2.ITM_QTY                          AS SL_ITM_QTY
		      , T2.EQ_NO                            AS EQ_NO
		      , CONVERT(VARCHAR, T2.MAKE_ST_DT, 21) AS MAKE_ST_DT
		      , CONVERT(VARCHAR, T2.MAKE_END_DT, 21) AS MAKE_END_DT
		      , T2.INP_STAFF_VAL                    AS INP_STAFF_VAL
		      , T1.CHNL_CD                          AS CHNL_CD
		  FROM TB_PROD_LOT_DIV T1
		    , TB_FPRF_N2ND_STEP_ROUT T2
		  LEFT OUTER JOIN TB_PROD_ROUT T3 ON(LEFT(T2.ROUT_ITM_CD,2) = T3.ROUT_CD AND T3.CHNL_CD = #CHNL_CD#)
		    WHERE 1=1
		        AND T1.CHNL_CD     = #CHNL_CD#
		        AND T1.CHNL_CD     = T2.CHNL_CD
		        AND T1.LOT_DIV_NO  = T2.PROD_ORD_NO
		        AND T2.ITM_QTY IS NOT NULL
		        AND T2.MAKE_DT >= CAST( #FM_DT# + ' 00:00:00' AS DATETIME)
		        AND T2.MAKE_DT <![CDATA[ <= ]]> CAST( #TO_DT# + ' 23:59:59' AS DATETIME)
	  </select>

		  <!--
	  <select id="SelectMovingTableRout" parameterClass="CpcErpServer.Service.Fproof.Vo.FproofVo" resultClass="CpcErpServer.Service.Fproof.Vo.FproofVo">
		  SELECT
           T1.ROUT_CD
         , T1.ROUT_SEQ
         , T2.ROUT_NM
		 , (CONVERT(VARCHAR, ROW_NUMBER() OVER (PARTITION BY T1.ITM_CD ORDER BY T1.ROUT_SEQ) ) + '. ' +  T2.ROUT_NM) AS GBN
		  FROM TB_PROD_ROUT_ITM_MAP   T1
		  , TB_PROD_ROUT          T2
		  WHERE 1 = 1
		  AND T1.CHNL_CD = #CHNL_CD#
		  AND T1.CHNL_CD = T2.CHNL_CD
		  AND T1.ROUT_CD = T2.ROUT_CD
		  AND T1.ITM_CD  = #ITM_CD#
	  </select>
            -->


	  <!-- 주간 생산계획 -->
	  <select id="M665101SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        WITH TMP AS (
              SELECT NO
                FROM CPY_T
               WHERE 1 = 1
                 AND NO <![CDATA[ <= ]]> (    
                    SELECT DATEDIFF(d, WKY_FM_DT, WKY_TO_DT)  
                                  FROM TB_PROD_WKY
                                 WHERE 1 = 1
                                   AND CHNL_CD    = #CHNL_CD#
                                   AND WKY_YRMON  = #WKY_YRMON#
                                   AND WK         = #WK#
                            )
        )
        , DY_NO AS (
        SELECT WKY_DT 
             , DY_NO
          FROM (
                SELECT T1.WKY_FM_DT
                     , T1.WKY_TO_DT
                     , T1.WKY_FM_DT + (NO-1)  AS WKY_DT 
                     , T2.NO  AS DY_NO
                  FROM TB_PROD_WKY T1
                     , TMP         T2
                 WHERE 1 = 1
                   AND T1.CHNL_CD    = #CHNL_CD#
                   AND T1.WKY_YRMON  = #WKY_YRMON#
                   AND T1.WK         = #WK#
                ) T1 
        ) 
         SELECT  T1.PROD_EQ_NO
               , T1.MDL_CD 
               , T1.PROD_CMPO_CD  AS CMPO_CD  
               , T1.CMPO_NM 
               , T1.ITM_NM 
               , T1.ITM_SZ_NM    
               , T1.MOLD_CAVITY_QTY 
               , T1.N1ST_ITM_GRP_NM 
               , T1.BRND_NM         AS CO_NM
               , T1.N1ST_PLN_QTY  
               , T1.N2ND_PLN_QTY  
               , T1.N3RD_PLN_QTY  
               , T1.N4TH_PLN_QTY  
               , T1.N5TH_PLN_QTY     
               , T1.N6TH_PLN_QTY 
               , T1.N7TH_PLN_QTY 
               , (T1.N1ST_PLN_QTY + T1.N2ND_PLN_QTY + T1.N3RD_PLN_QTY + T1.N4TH_PLN_QTY + T1.N5TH_PLN_QTY + T1.N6TH_PLN_QTY + T1.N7TH_PLN_QTY)  AS PLN_SUM_QTY        
            , #WKY_YRMON# AS WKY_YRMON
            , #WK# AS WK
            , #PROD_LOC_CD# AS PROD_LOC_CD
            , #CHNL_CD# AS CHNL_CD
          FROM (
                SELECT T1.PROD_EQ_NO
                     , T1.PROD_CMPO_CD    
                     , T1.MDL_CD
                     , T1.CMPO_NM
                     , T1.ITM_NM 
                     , T1.ITM_SZ_NM
                     , T1.MOLD_CAVITY_QTY 
                     , T1.N1ST_ITM_GRP_NM        
                     , T1.BRND_NM
                     , ISNULL(MAX(CASE WHEN DY_NO = 1 THEN PROD_QTY END), 0) AS N1ST_PLN_QTY  
                     , ISNULL(MAX(CASE WHEN DY_NO = 2 THEN PROD_QTY END), 0) AS N2ND_PLN_QTY  
                     , ISNULL(MAX(CASE WHEN DY_NO = 3 THEN PROD_QTY END), 0) AS N3RD_PLN_QTY  
                     , ISNULL(MAX(CASE WHEN DY_NO = 4 THEN PROD_QTY END), 0) AS N4TH_PLN_QTY  
                     , ISNULL(MAX(CASE WHEN DY_NO = 5 THEN PROD_QTY END), 0) AS N5TH_PLN_QTY       
                     , ISNULL(MAX(CASE WHEN DY_NO = 6 THEN PROD_QTY END), 0) AS N6TH_PLN_QTY   
                     , ISNULL(MAX(CASE WHEN DY_NO = 7 THEN PROD_QTY END), 0) AS N7TH_PLN_QTY
                  FROM (
                      SELECT T1.CHNL_CD
                           , T1.PROD_LOC_CD
                           , T1.PROD_WK
                           , T1.PROD_DLY_DT
                           , T1.PROD_ORD_NO
                           , T1.PROD_WKY_PLN_NO
                           , T1.PROD_BSE_MOLD_NO
                           , T1.PROD_CORE_MOLD_NO
                           , T1.PROD_QTY
                           , T1.PROD_DESC  AS BRND_NM
                           , T1.PROD_CMPO_CD
                           , T2.MDL_CD
                           , T2.CMPO_NM
                           , T2.ITM_NM
                           , T2.ITM_SZ_NM
                           , 0  AS MOLD_CAVITY_QTY 
                           , T2.N1ST_ITM_GRP_NM    
                           , T1.PROD_EQ_NO
                           , T3.DY_NO
                        FROM TB_PROD_WKY_PLN   T1           
                         , (
                              SELECT T1.SCM_RLSE_NO  
                                   , T1.SCM_ORD_CLSS_CD    
                                   , CASE WHEN T1.SCM_ORD_CLSS_CD = 'N' THEN '수주' ELSE '계획' END  AS SCM_ORD_CLSS_NM
                                   , T1.DUE_DT            
                                   , T3.MTRL_NM_CD          AS MDL_CD      
                                   , T1.ITM_CD             
                                   , T3.N1ST_ITM_GRP_CD     
                                   , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM 
                                   , T2.SCM_PUR_ITM_CD    
                                   , T3.ITM_NM    AS CMPO_NM
                                   , T2.SCM_PUR_ITM_QTY   
                                   , T4.ITM_NM    
                                   , T3.ITM_SZ_NM  
                                FROM TB_SCM_ORD_RLSE  T1
                                   , TB_SCM_PUR       T2
                                   , TB_CD_ITM        T3
                                   , TB_CD_ITM        T4
                               WHERE 1 = 1
                                 AND T1.CHNL_CD = #CHNL_CD#
                                 AND T1.CHNL_CD = T2.CHNL_CD   
                                 AND T1.CHNL_CD = T3.CHNL_CD   
                                 AND T1.SCM_RLSE_NO = T2.SCM_RLSE_NO
                                 AND T1.ITM_CD  = T3.ITM_CD
                                 AND T2.SCM_PUR_ITM_CD = T4.ITM_CD
                         <isNotNull property="A_ROUT_CD" >
                                 <iterate property="A_ROUT_CD" prepend=" AND T2.SCM_ROUT_CD IN " open = "(" close=")" conjunction=",">
                                        #A_ROUT_CD[]#
                                    </iterate>
                                </isNotNull>
                                 <!--AND T2.SCM_ROUT_CD = 'IN'-->
                                 <!--AND T1.CLZ_FLG = 'N'-->
                           ) T2
                           , DY_NO T3
                        WHERE 1 = 1
                          AND T1.CHNL_CD = #CHNL_CD#
                          AND T1.PROD_ORD_NO  = T2.SCM_RLSE_NO
                          AND T1.PROD_DLY_DT >= CAST(#WKY_YRMON# + '01' + ' 00:00:00' AS DATETIME)
                          AND T1.PROD_DLY_DT <![CDATA[ <= ]]> CAST(CONVERT(VARCHAR(8), dbo.SYS_LAST_DAY(CAST(#WKY_YRMON# + '01' + ' 00:00:00' AS DATETIME)), 112) + ' 23:59:59' AS DATETIME)
                          AND T1.PROD_WK = #WK#
                          AND CONVERT(VARCHAR, T1.PROD_DLY_DT, 23) = CONVERT(VARCHAR, T3.WKY_DT, 23)
                    AND T2.SCM_PUR_ITM_CD   = T1.PROD_CMPO_CD
                    <isNotNull property="PROD_LOC_CD" >
                          AND T1.PROD_LOC_CD = #PROD_LOC_CD#
                    </isNotNull>
                    ) T1
                GROUP BY T1.PROD_EQ_NO
                     , T1.PROD_CMPO_CD          
                     , T1.MDL_CD
                     , T1.CMPO_NM
                     , T1.ITM_NM
                     , T1.ITM_SZ_NM
                     , T1.MOLD_CAVITY_QTY 
                     , T1.N1ST_ITM_GRP_NM     
                     , T1.BRND_NM
                ) T1                       
	  </select>
	  
	  <insert id="M665101InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
               WITH TMP AS (
                      SELECT NO
                        FROM CPY_T
                       WHERE 1 = 1
                         AND NO <![CDATA[ <= ]]> (    
						               SELECT DATEDIFF(d, WKY_FM_DT, WKY_TO_DT)  
                                          FROM TB_PROD_WKY
                                         WHERE 1 = 1
                                           AND CHNL_CD    = #CHNL_CD#
                                           AND WKY_YRMON  = #WKY_YRMON#
                                           AND WK         = #WK#
                                    )
                )
                , DY_NO AS (
                SELECT WKY_DT 
                     , DY_NO
                  FROM (
                        SELECT T1.WKY_FM_DT
                             , T1.WKY_TO_DT
                             , T1.WKY_FM_DT + (NO-1)  AS WKY_DT 
                             , T2.NO  AS DY_NO
                          FROM TB_PROD_WKY T1
                             , TMP         T2
                         WHERE 1 = 1
                           AND T1.CHNL_CD    = #CHNL_CD#
                           AND T1.WKY_YRMON  = #WKY_YRMON#
                           AND T1.WK         = #WK#
                        ) T1 
                ) 
                INSERT INTO TB_PROD_WKY_PLN (
                    CHNL_CD
                  , PROD_LOC_CD                    
                  , PROD_WKY_PLN_NO                
                  , PROD_YRMON                     
                  , PROD_WK                        
                  , PROD_DLY_DT                    
                  , DY_NO
                  , CRE_USR_ID                        
                  , CRE_DT
                  , UPD_USR_ID
                  , UPD_DT 
				  , PROD_ORD_NO
				  , PROD_BSE_MOLD_NO
				  , PROD_CORE_MOLD_NO
				  , PROD_QTY
				  , PROD_CMPO_CD
				  , PROD_EQ_NO
				  , PUR_NO
				  , PUR_SEQ
                )  
                SELECT #CHNL_CD#
                     , #PROD_LOC_CD#
                     , PROD_WKY_NO + '-' + dbo.F_RPAD(MAX_SEQ + DY_NO, 3, '0')
                     , #WKY_YRMON#
                     , #WK#     
                     , WKY_DT
                     , DY_NO
                     , #CRE_USR_ID#
                     , GETDATE()
                     , #UPD_USR_ID#
                     , GETDATE()     
					 , #PROD_ORD_NO#
					 , #PROD_BSE_MOLD_NO#
					 , #PROD_CORE_MOLD_NO#
					 , 0
					 , #CMPO_CD#
					 , #PROD_EQ_NO#
					 , #SL_ORD_NO#
					 , #SL_ORD_SEQ#
                  FROM (
                      SELECT DY_NO 
                           , 'N'+'F' + CONVERT(VARCHAR(8), GETDATE(), 112)   AS PROD_WKY_NO
                           , ISNULL((SELECT MAX(CAST(dbo.FN_splitValue(PROD_WKY_PLN_NO, '-', 2) AS INT))
                                FROM TB_PROD_WKY_PLN WHERE 1 = 1 AND CHNL_CD = #CHNL_CD# AND PROD_YRMON = #WKY_YRMON#  AND PROD_WK = #WK#), 0)   AS MAX_SEQ
                           , WKY_DT                
                        FROM DY_NO T1
                        ) T1  
    </insert>

	<select id="M665101SelectProdWkyPlnNo" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		SELECT 
		    PROD_WKY_PLN_NO
		FROM TB_PROD_WKY_PLN
		    WHERE 1 = 1
		        AND CHNL_CD      = #CHNL_CD#
		        AND PROD_LOC_CD  = #PROD_LOC_CD#
		        AND PROD_YRMON   = #WKY_YRMON#
		        AND PROD_WK      = #WK#
		        AND PROD_CMPO_CD = #CMPO_CD#
		        AND PROD_EQ_NO   = #PROD_EQ_NO#
		        AND DY_NO        = #RN#
	</select>

	<select id="M665101SelectProdOrdNo" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT
		    PROD_ORD_NO
		  FROM TB_PROD_WKY_PLN
		  WHERE 1 = 1
		  AND CHNL_CD      = #CHNL_CD#
		  AND PROD_LOC_CD  = #PROD_LOC_CD#
		  AND PROD_YRMON   = #WKY_YRMON#
		  AND PROD_WK      = #WK#
		  AND PROD_CMPO_CD = #CMPO_CD#
		  AND PROD_EQ_NO   = #PROD_EQ_NO#
		  AND DY_NO        = #RN#
	</select>
	  
	<select id="M665101SelectProdCmpoCd" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT
		    PROD_CMPO_CD
		  FROM TB_PROD_WKY_PLN
		  WHERE 1 = 1
		  AND CHNL_CD      = #CHNL_CD#
		  AND PROD_LOC_CD  = #PROD_LOC_CD#
		  AND PROD_YRMON   = #WKY_YRMON#
		  AND PROD_WK      = #WK#
		  AND PROD_CMPO_CD = #CMPO_CD#
		  AND PROD_EQ_NO   = #PROD_EQ_NO#
		  AND DY_NO        = #RN#
	</select>

	  <select id="M665101SelectProdWkyPlnPurNo" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT
		    PUR_NO
		  FROM TB_PROD_WKY_PLN
		    WHERE 1 = 1
		      AND CHNL_CD      = #CHNL_CD#
		      AND PROD_LOC_CD  = #PROD_LOC_CD#
		      AND PROD_YRMON   = #WKY_YRMON#
		      AND PROD_WK      = #WK#
		      AND PROD_CMPO_CD = #CMPO_CD#
		      AND PROD_EQ_NO   = #PROD_EQ_NO#
		      AND DY_NO        = #RN#
	  </select>
	  
	<select id="M665101SelectProdWkyPlnPurSeq" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		SELECT 
		    CONVERT(VARCHAR, PUR_SEQ) AS PUR_SEQ
		FROM TB_PROD_WKY_PLN
		    WHERE 1 = 1
		        AND CHNL_CD      = #CHNL_CD#
		        AND PROD_LOC_CD  = #PROD_LOC_CD#
		        AND PROD_YRMON   = #WKY_YRMON#
		        AND PROD_WK      = #WK#
		        AND PROD_CMPO_CD = #CMPO_CD#
		        AND PROD_EQ_NO   = #PROD_EQ_NO#
		        AND DY_NO        = #RN#
	</select>
	  
	<select id="M665101SelectProdItm" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		SELECT          
		      T1.ITM_CD            
	        , T2.SCM_PUR_ITM_CD AS  ROUT_ITM_CD
		FROM TB_SCM_ORD_RLSE  T1
		    , TB_SCM_PUR       T2
		    , TB_CD_ITM        T3
		WHERE 1 = 1
		    AND T1.CHNL_CD      = #CHNL_CD#
		    AND T1.CHNL_CD      = T2.CHNL_CD
		    AND T1.CHNL_CD      = T3.CHNL_CD
		    AND T1.SCM_RLSE_NO  = T2.SCM_RLSE_NO
		    AND T1.ITM_CD       = T3.ITM_CD
		    <!--AND T2.SCM_ROUT_CD  = 'IN'-->
		<isNotNull property="A_ROUT_CD" >
			<iterate property="A_ROUT_CD" prepend=" AND T2.SCM_ROUT_CD IN " open = "(" close=")" conjunction=",">
				#A_ROUT_CD[]#
			</iterate>
		</isNotNull>
		    AND T1.CLZ_FLG IN ('N', 'C')
			AND T1.SCM_RLSE_NO      = #PROD_ORD_NO#
			AND T2.SCM_PUR_ITM_CD   = #ROUT_ITM_CD#
	</select>
	  
	<update id="M665101UpdateMst" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_PROD_WKY_PLN
		  SET
              PROD_QTY   = #PROD_QTY#
		    , UPD_USR_ID = #UPD_USR_ID#
            , UPD_DT     = GETDATE()    
		  WHERE 1=1
		    AND CHNL_CD         = #CHNL_CD#
		    AND PROD_WKY_PLN_NO = #PROD_WKY_PLN_NO#
			AND PROD_YRMON      = #WKY_YRMON#
		    AND PROD_WK         = #WK#
	</update>


	  <delete id="M665101DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_WKY_PLN
		  WHERE 1 = 1
		    AND CHNL_CD   = #CHNL_CD#
		    AND PROD_WKY_PLN_NO = #PROD_WKY_PLN_NO#
				AND PROD_YRMON   = #WKY_YRMON#
		    AND PROD_WK      = #WK#
	  </delete>

	
	<select id="M665101SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		SELECT          
		      ROW_NUMBER() OVER ( PARTITION BY  T1.SCM_RLSE_NO ORDER BY T1.SCM_RLSE_DT DESC ) AS RN
		    , T1.SCM_RLSE_NO    AS PROD_ORD_NO
		    <!--, CASE WHEN T1.SCM_ORD_CLSS_CD = 'N' THEN '수주' ELSE '계획' END  AS GBN-->
		    , T1.SCM_RLSE_NO + ' / ' + T2.SCM_PUR_ITM_CD  AS GBN
		    , T3.MTRL_NM_CD          AS MDL_CD         
		    , T1.ITM_CD            
		    , dbo.PUR_N1ST_GRP_NM_FNC(T1.CHNL_CD, T3.ITM_GRP_CLSS_CD, T3.N1ST_ITM_GRP_CD)  AS N1ST_ITM_GRP_NM 
		    , T2.SCM_PUR_ITM_CD AS CMPO_CD    
		    , T3.ITM_NM    AS CMPO_NM 
		    , T2.SCM_PUR_ITM_QTY    AS SL_ITM_QTY
		    , T3.ITM_SZ_NM  
			, CONVERT(VARCHAR, T1.SCM_RLSE_DT, 23)  AS SCM_RLSE_DT
			, '' AS CO_NM
			, T2.SCM_PUR_NO  AS SL_ORD_NO
			, T2.SCM_PUR_SEQ AS SL_ORD_SEQ
		FROM TB_SCM_ORD_RLSE  T1
		    , TB_SCM_PUR       T2
		    , TB_CD_ITM        T3
		WHERE 1 = 1
		    AND T1.CHNL_CD      = #CHNL_CD#
		    AND T1.CHNL_CD      = T2.CHNL_CD
		    AND T1.CHNL_CD      = T3.CHNL_CD
		    AND T1.SCM_RLSE_NO  = T2.SCM_RLSE_NO
		    AND T1.ITM_CD       = T3.ITM_CD
		    <!--AND T2.SCM_ROUT_CD  = 'IN'-->
		<isNotNull property="A_ROUT_CD" >
			<iterate property="A_ROUT_CD" prepend=" AND T2.SCM_ROUT_CD IN " open = "(" close=")" conjunction=",">
                #A_ROUT_CD[]#
            </iterate>
        </isNotNull>
		    AND T1.CLZ_FLG IN ('N', 'C')
		<isNotNull property="PROD_ORD_NO" >
			AND T1.SCM_RLSE_NO = #PROD_ORD_NO#
		</isNotNull>
		<isNotNull property="FM_DT" >
			AND T1.SCM_RLSE_DT >= GETDATE() - 10
			AND T1.SCM_RLSE_DT <![CDATA[ <= ]]> GETDATE()
		</isNotNull>
	</select>

	  
	  <select id="M665101SelectWrkTmp" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT #PROD_WKY_PLN_NO# + '-' + dbo.F_RPAD(((SELECT SUBSTRING(ISNULL(MAX(LOT_DIV_NO), 0), LEN(ISNULL(MAX(LOT_DIV_NO), 0))-3, 4) FROM TB_PROD_LOT_DIV Z WHERE 1 = 1 AND Z.CHNL_CD = #CHNL_CD# AND Z.ORD_NO = #PROD_ORD_NO# ) + 1), 4, '0') AS LOT_DIV_NO
		  FROM CPY_T AS  T3
		  WHERE 1 = 1
		  AND NO <![CDATA[ <= ]]> 1
	  </select>


	  <insert id="M665101InsertWrk" parameterClass="ModelsLibrary.Man.ManVo">
         INSERT INTO TB_PROD_LOT_DIV
          (
                CHNL_CD 
              , LOT_DIV_NO
			  , LOT_DIV_SEQ
              , PROD_ORD_NO
              , PROD_PLN_DT
              , ITM_CD
              , LOT_DIV_QTY    
              , WRK_DIR_PPR_FLG
              , CRE_USR_ID
              , CRE_DT
              , UPD_USR_ID
              , UPD_DT    
              , DY_NGT_FLG
			  , PCK_FLG
			  , ORD_NO
			  , ORD_SEQ
			  , LOT_DIV_RMK
			  , ROUT_ITM_CD
	      )
		  VALUES
		  (
              #CHNL_CD#
            , #LOT_DIV_NO#
			, ISNULL((SELECT MAX(LOT_DIV_SEQ) + 1 FROM TB_PROD_LOT_DIV WHERE CHNL_CD = #CHNL_CD# AND LOT_DIV_NO = #LOT_DIV_NO#), 1) 
            , #PROD_WKY_PLN_NO#
			, GETDATE()
            , #ITM_CD#
            , ROUND(#PROD_PLN_QTY# / 1, 0) 
            , 'N'
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()    
            , #DY_NGT_FLG#
			, #PCK_FLG#
			, #SL_ORD_NO#
			, #SL_ORD_SEQ#
			<!--, #PROD_ORD_NO#
			, #SL_ORD_SEQ#-->
			, #MM_RMK#
			, #ROUT_ITM_CD#
          )
	</insert>

	  <update id="M665101UpdateWrk" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_PROD_LOT_DIV
		  SET
		      WRK_DIR_PPR_FLG   = 'Y'
		    , UPD_USR_ID        = #UPD_USR_ID#
		    , UPD_DT            = GETDATE()
		  WHERE 1=1
		    AND CHNL_CD    = #CHNL_CD#
		    AND LOT_DIV_NO = #LOT_DIV_NO#
	  </update>


	<select id="M665101SelectWrkDtlTmp" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		SELECT dbo.FF_FPRF_N2ND_STEP_LOTNO(#CHNL_CD#, CONVERT(DATETIME, GETDATE())) AS PROC_LOT_NO
	</select>
	  
	<insert id="M665101InsertWrkDtl" parameterClass="ModelsLibrary.Man.ManVo">
        INSERT INTO TB_FPRF_N2ND_STEP_ROUT
        (     
		      CHNL_CD
            , PROC_LOT_NO
            , ROUT_ITM_CD 
            , MAKE_DT
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
            , CUST_ITM_CD
            , CO_CD
            , CLZ_FLG
            , PROD_ORD_NO
            , PROD_ORD_SEQ
			, EQ_NO
			<!--, ITM_QTY-->
			, INP_STAFF_VAL
			, MAKE_ST_DT
			, MAKE_END_DT
			, INSRL_NO
			, INSRL_SEQ
        ) 
		VALUES
		(
              #CHNL_CD#
            , #PROC_LOT_NO#
            , #ROUT_ITM_CD#
            , GETDATE()
            , #CRE_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()      
            , #ASSY_CD#
            , #CO_CD#
            , 'N'
            , #LOT_DIV_NO#
            , 1
			, #PROD_EQ_NO#
			<!--, #PROD_PLN_QTY#-->
		    , #INP_STAFF_VAL#
			, CONVERT(DATETIME, #MAKE_ST_DT#)
			, CONVERT(DATETIME, #MAKE_END_DT#)
			, #SL_ORD_NO#
			, #SL_ORD_SEQ#
        )
	</insert>
	  
	  
	<insert id="M665101InsertWrkDtlItm" parameterClass="ModelsLibrary.Man.ManVo">
          INSERT INTO TB_FPRF_N2ND_JOIN_ROUT
            ( 
                  CHNL_CD
                , PROC_LOT_NO
                , PROC_LOT_SEQ
                , PRNT_LOT_NO
                , ROUT_ITM_CD
                , CRE_USR_ID
                , CRE_DT
                , UPD_USR_ID
                , UPD_DT
            ) 
			VALUES
			(
                  #CHNL_CD#                   
                , #PROC_LOT_NO#
                , ISNULL((SELECT MAX(PROC_LOT_SEQ) + 1 FROM TB_FPRF_N2ND_JOIN_ROUT WHERE CHNL_CD = #CHNL_CD# AND PROC_LOT_NO = #PROC_LOT_NO#), 1) 
                , #PRNT_LOT_NO#
                , #CMPO_CD#
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()                    
            ) 
	</insert>

	  
	  <select id="M665101SelectReport" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
	    SELECT  TOP 1
		        T1.ITM_CD
		      , dbo.CD_ITEM_NM_FNC(T3.CHNL_CD, T3.ITM_CD) AS ITM_NM
		      , T3.ITM_SZ_NM
		      , dbo.CD_SYS_CLSS_FNC(T3.CHNL_CD , 'L-003', T3.UOM_CD) AS UOM_NM
		      , T1.LOT_DIV_QTY
		      , ROW_NUMBER() OVER (ORDER BY T2.CMPO_CD) AS RN
		      , T2.CMPO_CD
		      , dbo.CD_ITEM_NM_FNC(T2.CHNL_CD, T2.CMPO_CD) AS CMPO_NM
		      , (SELECT ITM_SZ_NM FROM TB_CD_ITM AS X WHERE 1 = 1  AND  X.CHNL_CD = T1.CHNL_CD AND X.ITM_CD = T2.CMPO_CD) AS MM_01
		      , dbo.CD_ITEM_UOM_FNC(T2.CHNL_CD, T2.CMPO_CD) AS MM_02
		      , (T1.LOT_DIV_QTY * T2.INP_QTY) AS SL_ITM_QTY
			  <!--
		      , CASE WHEN T1.DY_NGT_FLG = 'A' THEN '오전' WHEN  T1.DY_NGT_FLG='B' THEN '오후'  WHEN T1.DY_NGT_FLG = 'C' THEN '연장'  WHEN T1.DY_NGT_FLG = 'D' THEN '기타' END AS DY_NGT_NM
			  -->
		      , T1.ORD_NO       AS SL_ORD_NO
		      , T1.ORD_SEQ      AS SL_ORD_SEQ
		      , T1.LOT_DIV_QTY  AS SL_PLN_QTY
		      , T4.PROC_LOT_NO
		      , T4.ROUT_NM
		      , T4.ROUT_ITM_CD
			  , 'Y' AS GBN
			  <!--
			  , (SELECT TOP 1 REMARK_DC FROM DZICUBE.dbO.LSO_D X WHERE 1 = 1 AND X.SO_NB = T1.ORD_NO AND X.SO_SQ = T1.ORD_SEQ ) AS CMPO_RMK 
			  -->
			  , CONVERT(VARCHAR, GETDATE(), 23) AS UPD_DT
			  , T1.LOT_DIV_NO
			  , T1.LOT_DIV_RMK  AS MM_RMK
		    FROM TB_PROD_LOT_DIV T1
		         , TB_PROD_BOM T2 LEFT OUTER JOIN
				 (
		                SELECT Z1.PROC_LOT_NO AS PROC_LOT_NO, dbo.FF_NM_ROUT(Z1.CHNL_CD , LEFT(Z1.ROUT_ITM_CD,3))AS ROUT_NM, Z2.ROUT_ITM_CD AS ROUT_ITM_CD
		                    FROM  TB_FPRF_N2ND_STEP_ROUT Z1
		                        , TB_FPRF_N2ND_JOIN_ROUT Z2
		                      WHERE 1 = 1
		                        AND Z1.CHNL_CD      = Z2.CHNL_CD
		                        AND Z1.PROC_LOT_NO  = Z2.PROC_LOT_NO
		                        AND Z1.PROD_ORD_NO  = #LOT_DIV_NO#
		                        AND Z1.CHNL_CD      = #CHNL_CD#
				) T4 ON (T2.CMPO_CD = T4.ROUT_ITM_CD)
		        , TB_CD_ITM T3
		  WHERE 1 = 1
		      AND T1.CHNL_CD = T2.CHNL_CD
		      AND T1.CHNL_CD = T3.CHNL_CD
		      AND T1.ITM_CD  = T3.ITM_CD
			  AND T2.CMPO_CD = T1.ROUT_ITM_CD
			  <!--
		      AND T1.ITM_CD  = T2.ASSY_CD
		      AND T2.ASSY_CD = T3.ITM_CD
			  -->
		      AND T1.CHNL_CD = #CHNL_CD#
		      AND T1.LOT_DIV_NO = #LOT_DIV_NO#
	  </select>

    <!-- 투입 자재-->
	 <insert id="M665101InsertItm" parameterClass="ModelsLibrary.Man.ManVo">
         INSERT INTO TB_PROD_JB_ITM
            ( 
                LOT_DIV_NO
              , ROUT_CD
              , CHNL_CD
              , ITM_CD
              , ACT_QTY
              , LSS_RT
              , TTL_QTY
              , SRT_SEQ
              , INP_QTY
              , CRE_USR_ID
              , CRE_DT
              , UPD_USR_ID
              , UPD_DT
            )   
            SELECT LOT_DIV_NO    
                 , ROUT_CD
                 , #CHNL_CD#
                 , ITM_CD
                 , ACT_QTY
                 , 0
                 , ACT_QTY
                 , MTRL_ITM_SEQ
                 , INP_QTY
                 , #CRE_USR_ID#
                 , GETDATE()
                 , #UPD_USR_ID#
                 , GETDATE()
              FROM (
                  SELECT T1.ITM_CD          
                       , T1.ROUT_ITM_CD     
                       , T2.MTRL_ITM_CD     
                       , T2.MTRL_ITM_SEQ    
                       , T1.LOT_DIV_NO 
                       , T1.LOT_DIV_QTY * ISNULL(T2.USE_QTY, 1) AS ACT_QTY
                       , #PCK_FLG#  AS ROUT_CD
                       , T2.USE_QTY   AS INP_QTY
                    FROM TB_PROD_LOT_DIV        T1
                       , TB_PROD_PROC_ITM_BOM   T2
                   WHERE 1 = 1
                     AND T1.CHNL_CD     = #CHNL_CD#
                     AND T1.LOT_DIV_NO  = #LOT_DIV_NO#
                     AND T1.CHNL_CD     = T2.CHNL_CD
                     AND T1.ITM_CD      = T2.ITM_CD
                  UNION ALL 
                  SELECT T1.ITM_CD        
                       , T1.ROUT_ITM_CD   
                       , T2.MTRL_ITM_CD   
                       , T2.MTRL_ITM_SEQ  
                       , T1.LOT_DIV_NO 
                       , T1.LOT_DIV_QTY * ISNULL(T2.INP_QTY, 1) AS ACT_QTY 
                       , SUBSTRING(dbo.FN_splitValue(T2.ASSY_CD, '-',2), 4, 2) AS ROUT_CD
                       , T2.INP_QTY
                    FROM TB_PROD_LOT_DIV        T1
                       OUTER APPLY (
                        SELECT CMPO_CD   AS MTRL_ITM_CD
                             , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY ASSY_SEQ, CMPO_CD) AS MTRL_ITM_SEQ  
                             , ASSY_CD
                             , INP_QTY
                          FROM dbo.ufnGetBomChild(#CHNL_CD#, T1.ITM_CD, T1.ROUT_ITM_CD)
                        WHERE 1 = 1
                       ) T2 
                   WHERE 1 = 1
                     AND T1.CHNL_CD     = #CHNL_CD#
                     AND T1.LOT_DIV_NO  = #LOT_DIV_NO#
                ) T1
            WHERE 1 = 1
              AND MTRL_ITM_CD IS NOT NULL
	</insert>
	  


	  <!--<delete id="M665101DeleteDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_FPRF_N2ND_STEP_ROUT
		  WHERE 1 = 1
		  AND CHNL_CD   = #CHNL_CD#
		  AND PROD_ORD_NO = #PROD_ORD_NO#
	  </delete>-->

	  <!--<delete id="M665101DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_LOT_DIV
		  WHERE 1 = 1
		  AND CHNL_CD   = #CHNL_CD#
		  AND LOT_DIV_NO = #LOT_DIV_NO#
	  </delete>-->
	  



    <!-- 수주 별 입고 LIST-->
	 <select id="M6650SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT 
		          ROW_NUMBER() OVER (PARTITION BY SL_ORD_NO ORDER BY  SL_ORD_SEQ) AS RN
		        , ITM_CD
		        , ITM_NM
		        , ITM_SZ_NM
		        , CO_NM
		        , PRNT_LOT_NO
		        , CONVERT(VARCHAR, ITM_IN_DT, 23) AS MAKE_DT
		        , ITM_QTY AS INP_QTY
		        , SL_ORD_NO
		        , SL_ORD_SEQ
		        , SL_ITM_CD AS ASSY_ITM_CD
		        , SL_ITM_NM AS ASSY_ITM_NM
		        , SL_ITM_QTY
		        , SO_DT
		        , DUE_DT
				, ITM_GRP_CLSS_NM
        FROM
        (
	        <!--부자재 -->
	        SELECT
		          T5.ITM_CD
		        , T5.ITM_NM
		        , T5.ITM_SZ_NM
		        , T5.CO_NM
		        , T5.PRNT_LOT_NO
		        , T5.ITM_IN_DT
		        , T5.ITM_QTY
		        , T6.SL_ORD_NO
		        , T6.SL_ORD_SEQ
		        , T6.ITM_CD AS SL_ITM_CD
		        , T6.ITM_NM AS SL_ITM_NM
		        , T6.SL_ITM_QTY
		        , T6.SO_DT
		        , T6.DUE_DT
				, '부자재' AS ITM_GRP_CLSS_NM   
	        FROM
	        (
		        SELECT 
			          T4.ITM_CD
			        , T4.ITM_NM
			        , T4.ITM_SZ_NM
			        , T4.CO_NM
			        , T4.PRNT_LOT_NO
			        , MAX(T4.ITM_IN_DT) AS ITM_IN_DT
			        , ISNULL(SUM(T4.ITM_QTY), 0) AS ITM_QTY
		        FROM(
			        SELECT 
					          T1.ITM_CD AS ITM_CD
					        , T2.ITM_NM AS ITM_NM
					        , T2.ITM_SZ_NM AS ITM_SZ_NM
					        , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.CO_CD) AS CO_NM
					        , (CASE WHEN LEFT(T1.PRNT_LOT_NO, 1) = 'P' THEN T1.PRNT_LOT_NO ELSE T3.PUR_ORD_NO + '_' + CONVERT(VARCHAR, T3.PUR_ORD_SEQ) END) AS  PRNT_LOT_NO
					        , T1.ITM_IN_DT AS ITM_IN_DT
					        , T1.ITM_QTY AS ITM_QTY
			        FROM TB_FPRF_N1ST_STEP_ROUT AS T1 LEFT OUTER JOIN TB_INAUD_TMP AS T3 ON( T1.PRNT_LOT_NO = T3.STK_SER_NO AND T1.CHNL_CD = T3.CHNL_CD)
			           , TB_CD_ITM AS T2
			        WHERE 1=1 AND T1.CHNL_CD = T2.CHNL_CD 
					          AND T1.ITM_CD = T2.ITM_CD
					          AND T1.CHNL_CD = #CHNL_CD# 
					          AND T2.ITM_GRP_CLSS_CD = 'B'
		        ) AS T4	
		        GROUP BY T4.ITM_CD, T4.ITM_NM, T4.ITM_SZ_NM, T4.CO_NM, T4.PRNT_LOT_NO
	        ) AS T5 LEFT OUTER JOIN (SELECT 
									        X6.DUE_DT, X6.SO_DT, X6.ITM_CD, X6.ITM_NM, X6.SL_ITM_QTY
								          , (X1.PUR_ORD_NO + '_' + CONVERT(VARCHAR, X1.PUR_ORD_SEQ)) AS PRNT_LOT_NO
								          , X2.SL_ORD_NO
								          , X2.SL_ORD_SEQ FROM TB_PUR_ORD_DTL AS X1
													         , TB_PUR_MRP AS X2  LEFT OUTER JOIN (
																						        SELECT    T1.SO_NB        AS SL_ORD_NO
																								        , T2.SO_SQ        AS SL_ORD_SEQ
																								        , T2.ITEM_CD      AS ITM_CD
																								        , T4.ITM_NM
																								        , CONVERT(VARCHAR, CAST(T1.SO_DT  AS   DATETIME), 23) AS SO_DT  
																								        , ISNULL(CONVERT(VARCHAR, CAST(T2.DUE_DT AS   DATETIME), 23), '') AS DUE_DT  
																								        , T2.SO_QT        AS SL_ITM_QTY
																							          FROM DZICUBE.dbo.LSO    T1 , DZICUBE.dbo.LSO_D  T2 
																								        LEFT OUTER JOIN TB_CD_ITM          T4
																							        ON (      T2.ITEM_CD = T4.ITM_CD
																									        AND T4.CHNL_CD =  #CHNL_CD# 
																								        )
																							        WHERE 1 = 1
																							          AND T1.CO_CD      = T2.CO_CD
																							          AND T1.SO_NB      = T2.SO_NB
																						          <isNotNull property="FM_DT">
																						          AND T1.SO_DT      >= #FM_DT#
																						          </isNotNull>
																						          <isNotNull property="TO_DT">
																						          AND T1.SO_DT      <![CDATA[<=]]> #TO_DT#
																						          </isNotNull>
																						          ) AS X6 ON( X6.SL_ORD_NO = X2.SL_ORD_NO AND X6.SL_ORD_SEQ = X2.SL_ORD_SEQ)
																						        WHERE 1=1 AND X1.CHNL_CD = #CHNL_CD# 
																								          AND X1.CHNL_CD = X2.CHNL_CD 
																								          AND X1.ORD_NO = X2.UN_FOL_NO  ) AS T6 ON( T5.PRNT_LOT_NO = T6.PRNT_LOT_NO )

	        UNION
			        <!-- 칭량 -->
				        SELECT 
				          T5.ASSY_ITM_CD
				        , T5.ITM_NM
				        , T5.ITM_SZ_NM
				        , T5.CO_NM
				        , T5.PRNT_LOT_NO
				        , T5.WRK_DT
				        , T5.TOT_WEIH_VAL
				        , T6.SL_ORD_NO
				        , T6.SL_ORD_SEQ
				        , T6.ITM_CD AS SL_ITM_CD
				        , T6.ITM_NM AS SL_ITM_NM
				        , T6.SL_ITM_QTY
				        , T6.SO_DT
				        , T6.DUE_DT
						, '벌크' AS ITM_GRP_CLSS_NM   
				        FROM
				        (
					        SELECT  
						          T1.ASSY_ITM_CD
						        , T3.ITM_NM
						        , T3.ITM_SZ_NM
						        , MAX(T1.CO_CD) AS CO_NM
						        , ''			AS PRNT_LOT_NO
						        , T1.SL_ORD_NO
						        , T1.SL_ORD_SEQ
						        , SUM(T2.WEIH_VAL) / 1000 AS WEIH_VAL
						        , MAX(T1.TOT_WEIH_VAL)  AS TOT_WEIH_VAL
						        , MAX(T1.INP_LOT_NO) AS INP_LOT_NO
						        , MAX(T1.WRK_DT) AS WRK_DT
						        FROM TB_PROD_WEIGH_WO AS T1,
							         TB_PROD_WEIGH_WRK_DTL AS T2,
							         TB_CD_ITM AS T3
							        WHERE 1=1 
									        AND T1.CHNL_CD		=  #CHNL_CD# 
									        AND T1.CHNL_CD		= T2.CHNL_CD
									        AND T1.CHNL_CD		= T3.CHNL_CD
									        AND T1.LOT_NO		= T2.LOT_NO
									        AND T1.ASSY_ITM_CD	= T3.ITM_CD
							        GROUP BY  T1.ASSY_ITM_CD, T3.ITM_NM, T3.ITM_SZ_NM, T1.SL_ORD_NO,  T1.SL_ORD_SEQ
					        ) AS T5 LEFT OUTER JOIN (
											        SELECT    T1.SO_NB        AS SL_ORD_NO
													        , T2.SO_SQ        AS SL_ORD_SEQ
													        , T2.ITEM_CD      AS ITM_CD
													        , T4.ITM_NM
													        , CONVERT(VARCHAR, CAST(T1.SO_DT  AS   DATETIME), 23) AS SO_DT  
													        , ISNULL(CONVERT(VARCHAR, CAST(T2.DUE_DT AS   DATETIME), 23), '') AS DUE_DT  
													        , T2.SO_QT        AS SL_ITM_QTY
													        FROM DZICUBE.dbo.LSO    T1 , DZICUBE.dbo.LSO_D  T2 
													        LEFT OUTER JOIN TB_CD_ITM          T4
												        ON (      T2.ITEM_CD = T4.ITM_CD
														        AND T4.CHNL_CD =  #CHNL_CD# 
													        )
												        WHERE 1 = 1
													        AND T1.CO_CD      = T2.CO_CD
													        AND T1.SO_NB      = T2.SO_NB
												        <isNotNull property="FM_DT">
												        AND T1.SO_DT      >= #FM_DT#
												        </isNotNull>
												        <isNotNull property="TO_DT">
												        AND T1.SO_DT      <![CDATA[<=]]> #TO_DT#
												        </isNotNull>
											        ) AS T6 ON( T6.SL_ORD_NO = T5.SL_ORD_NO AND T6.SL_ORD_SEQ = T5.SL_ORD_SEQ)
			        ) AS TT
	 </select>



	  <!-- 사출 작업실적보고-->
    <select id="M6710Select" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
     SELECT 
              ROW_NUMBER() OVER (PARTITION BY T1.LOT_DIV_NO ORDER BY T1.PROD_PLN_DT) AS RN
            , CONVERT(VARCHAR, T1.PROD_PLN_DT, 23)  AS PROD_PLN_DT
            , T1.LOT_DIV_NO         AS LOT_DIV_NO
            , T1.LOT_DIV_SEQ        AS LOT_DIV_SEQ
            , T1.ROUT_CD            AS ROUT_CD
            , T3.ROUT_NM            AS ROUT_NM
            , T1.EQ_NO              AS EQ_NO
            , T4.EQ_NM              AS EQ_NM
            , ''                    AS MOLD_NM
            , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG
            , T1.ITM_CD                AS ITM_CD
            , T2.ITM_NM                AS ITM_NM
            , T1.LOT_DIV_QTY           AS LOT_DIV_QTY
            , T1.ROUT_ITM_CD
            , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ROUT_ITM_CD)  AS ROUT_ITM_NM    
            , T1.CHNL_CD
            , T5.ITM_SZ_NM
         FROM TB_PROD_LOT_DIV T1
            OUTER APPLY
                 (
                    SELECT X.ROUT_CD    AS ROUT_CD
                          ,X.ROUT_NM    AS ROUT_NM
                      FROM TB_PROD_ROUT X
                     WHERE 1 = 1 
                      AND  X.CHNL_CD     =  T1.CHNL_CD
		                  AND  X.CHNL_CD     = #CHNL_CD#
		                  AND  X.ROUT_CD     =  T1.ROUT_CD
                  )T3
            OUTER APPLY
		             (
		                SELECT X.PROD_EQ_NO    AS PROD_EQ_NO
		                      ,X.EQ_NM         AS EQ_NM
		                  FROM  TB_PROD_EQ X
		                 WHERE  1 = 1
		                   AND  X.CHNL_CD     =  T1.CHNL_CD
		                   AND  X.CHNL_CD     = #CHNL_CD#
		                   AND  X.PROD_EQ_NO  =  T1.EQ_NO 
                  )T4        
            OUTER APPLY 
                 (
                  SELECT X.N1ST_ITM_SZ_NM + '*' + X.N2ND_ITM_SZ_NM + '*' + X.N3RD_ITM_SZ_NM AS ITM_SZ_NM
                    FROM TB_SL_RLSE_DTL X
                   WHERE 1 = 1 
                     AND X.SL_RLSE_NO   = T1.ORD_NO
                     AND X.SL_RLSE_SEQ  = T1.ORD_SEQ
                  )T5
            , MV_TB_CD_ITM    T2 
        WHERE 1 = 1 
          AND T1.CHNL_CD = #CHNL_CD#
          AND T1.CHNL_CD = T2.CHNL_CD 
          AND T1.ITM_CD  = T2.ITM_CD 
      <!--SELECT  
              CONVERT(VARCHAR, T1.MAKE_ST_DT,  23) AS  PROD_PLN_DT 
            , T1.LOT_DIV_NO   
            , T1.ROUT_CD
            , T1.ROUT_NM
            , T1.EQ_NO
            , T1.GBN     
            , T1.DY_NGT_FLG        
            , T1.ITM_NM
            , T1.ITM_SZ_NM
            , T1.CMPO_CD       AS ROUT_ITM_CD
            , T1.CMPO_NM       AS ROUT_ITM_NM    
            , T1.LOT_DIV_QTY
            , T1.CHNL_CD
            , T1.SRT_SEQ      AS WEIH_SEQ
            , T1.RN 
            , CONVERT(VARCHAR, WRK_DY)          AS PLN_DY
            , CYC_TIME    
            , #FM_DT# AS FM_DT
            , #TO_DT# AS TO_DT
            , T1.MOLD_CD
            , T1.MOLD_SEQ AS ITM_MOLD_SEQ
        FROM (
              SELECT T1.MAKE_ST_DT   
                   , T1.LOT_DIV_NO   
                   , T2.SCM_ROUT_CD AS ROUT_CD
                   , dbo.FF_NM_ROUT(T1.CHNL_CD, T2.SCM_ROUT_CD)  AS ROUT_NM
                   , T1.EQ_NO
                   , T1.MOLD_CD  + '-' + CONVERT(VARCHAR, T1.MOLD_SEQ) AS GBN     
                   , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG        
                   , T5.ITM_NM
                   , T5.ITM_SZ_NM
                   , T4.ITM_CD        AS CMPO_CD    
                   , T4.ITM_NM        AS CMPO_NM    
                   , T1.LOT_DIV_QTY
                   , T1.CHNL_CD
                   , T6.SRT_SEQ
                   , ROW_NUMBER() OVER (PARTITION BY T1.EQ_NO ORDER BY T1.EQ_NO, T6.SRT_SEQ, T1.LOT_DIV_NO DESC) AS RN 
                   , T1.MOLD_CD
                   , T1.MOLD_SEQ
                   , CASE WHEN CYC_TIME IS NULL THEN 1.0 ELSE ROUND(T1.LOT_DIV_QTY / CYC_TIME *1.0, 1) END WRK_DY
                   , CYC_TIME                    
                FROM TB_PROD_LOT_DIV T1     
                   OUTER APPLY
                   (
                      SELECT X.CYC_TIME   AS CYC_TIME
                        FROM TB_PROD_MOLD_CD X
                          WHERE 1 = 1
                            AND X.CHNL_CD   = #CHNL_CD#
                            AND X.MOLD_NO   = T1.MOLD_CD 
                            AND X.MOLD_SEQ  = T1.MOLD_SEQ             
                   ) T7
                   , TB_SCM_PUR      T2
                   , MV_TB_CD_ITM    T4
                   , TB_SCM_ORD_RLSE T3
                   , MV_TB_CD_ITM    T5   
                   , TB_PROD_WKY_PLN T6
               WHERE 1 = 1
                 AND T1.CHNL_CD     = #CHNL_CD#
                 AND T1.CHNL_CD     = T2.CHNL_CD
                 AND T1.CHNL_CD     = T3.CHNL_CD
                 AND T1.CHNL_CD     = T4.CHNL_CD
                 AND T1.CHNL_CD     = T5.CHNL_CD   
                 AND T1.CHNL_CD     = T6.CHNL_CD      
                 AND T2.SCM_RLSE_NO = T3.SCM_RLSE_NO
                 AND T1.ORD_NO      = T2.SCM_PUR_NO
                 AND T1.ORD_SEQ     = T2.SCM_PUR_SEQ
                 AND T2.SCM_PUR_ITM_CD  = T4.ITM_CD
                 AND T3.ITM_CD      = T5.ITM_CD
                 AND T1.PROD_ORD_NO = T6.PROD_WKY_PLN_NO
                 AND T2.PUR_STS_CD  NOT IN ('A', 'D')
                 AND T2.SCM_ROUT_CD = 'IN'    
          ) T1    
      WHERE 1 = 1
        AND RN <![CDATA[ < ]]> 3
      ORDER BY EQ_NO, RN-->  
    </select>

    <select id="M6710SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER()OVER (PARTITION BY null ORDER BY T1.LOT_DIV_SEQ)  AS RN
             , T1.CHNL_CD
             , T1.LOT_DIV_NO
             , T1.LOT_DIV_SEQ
             , CONVERT(VARCHAR, T2.PROD_PLN_DT, 23)    AS PROD_PLN_DT
             , T1.PROD_QTY                             AS SL_PLN_QTY                 
             , T1.INTO_WRK_MAN_VAL                     AS INP_STAFF_VAL
             , CONVERT(CHAR(8), T1.ROUT_ST_DT, 24)     AS WRK_ST_DT 
             , CONVERT(CHAR(8), T1.ROUT_END_DT, 24)    AS WRK_END_DT
             , CONVERT(VARCHAR, T1.ROUT_ST_DT, 120)    AS MAKE_ST_DT
		         , CONVERT(VARCHAR, T1.ROUT_END_DT, 120)   AS MAKE_END_DT
             , T1.WRK_HRS                              AS WRK_HRS
             , T2.ROUT_ITM_CD
             , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T2.ROUT_ITM_CD)  AS ROUT_ITM_NM    
             , T1.ROUT_CD             AS ROUT_CD
             , (SELECT TOP 1 X.ROUT_NM FROM TB_PROD_ROUT X WHERE 1 = 1 AND X.CHNL_CD = T1.CHNL_CD AND X.ROUT_CD = T1.ROUT_CD) AS ROUT_NM
             , CONVERT(VARCHAR, T1.UPD_DT, 23)       AS UPD_DT  
             , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG
             , T2.ROUT_ITM_CD
             , T1.PROD_GD_QTY         AS SL_ITM_QTY
             , T1.TMP_NO
        FROM  TB_PROD_JB_ORD T1
            , TB_PROD_LOT_DIV T2
       WHERE 1 = 1 
         AND T1.CHNL_CD    = #CHNL_CD#
         AND T1.CHNL_CD    = T2.CHNL_CD
         AND T1.LOT_DIV_NO = T2.LOT_DIV_NO
         AND T2.LOT_DIV_NO = #LOT_DIV_NO# 
		 
            <!--SELECT    
                ROW_NUMBER() OVER (PARTITION BY T1.LOT_DIV_NO ORDER BY T6.MAKE_ST_DT) AS RN
			        , T1.LOT_DIV_NO          AS LOT_DIV_NO
              , T1.LOT_DIV_SEQ         AS LOT_DIV_SEQ
              , T6.ITM_CD
              , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T6.ITM_CD)  AS ITM_NM
              , T6.ROUT_ITM_CD
              , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T6.ROUT_ITM_CD)  AS ROUT_ITM_NM        
              , T3.ROUT_NM             AS ROUT_NM
				      , T3.ROUT_CD             AS ROUT_CD
              , CONVERT(CHAR(8), T1.ROUT_ST_DT, 24)      AS WRK_ST_DT
		          , CONVERT(CHAR(8), T1.ROUT_END_DT, 24)     AS WRK_END_DT
					    , CONVERT(VARCHAR, T1.ROUT_ST_DT, 120)      AS MAKE_ST_DT
		          , CONVERT(VARCHAR, T1.ROUT_END_DT, 120)     AS MAKE_END_DT
		          , T1.WRK_HRS             AS WRK_HRS
              , T1.INTO_WRK_MAN_VAL    AS INP_STAFF_VAL
              , T5.ITM_QTY             AS SL_PLN_QTY
					    , T1.PROD_GD_QTY         AS SL_ITM_QTY
					    , T1.PROD_BAD_QTY        AS BAD_QTY
              , dbo.USR_NM_FNC(T1.CHNL_CD, T1.UPD_USR_ID) AS UPD_USR_NM
              , CONVERT(VARCHAR, T1.UPD_DT, 23)       AS UPD_DT            
					    , CONVERT(VARCHAR, T6.MAKE_ST_DT, 23)   AS PROD_PLN_DT
					    , T1.CHNL_CD
					    , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG
					    , ISNULL(T1.MOLD_CD, T1.MOLD_NO) AS MOLD_CD
					    , T1.MOLD_SEQ AS WEIH_SEQ
					    , ISNULL(T1.MOLD_CD, T1.MOLD_NO)  + '-' + CONVERT(VARCHAR, T1.MOLD_SEQ) AS GBN
					    , T1.PROD_EQ_NO AS EQ_NO
					    , T6.LOT_DIV_QTY
            FROM  TB_PROD_JB_ORD T1     
                OUTER APPLY ( 
				            SELECT X.ROUT_CD
                                  ,X.ROUT_NM 
                               FROM TB_PROD_ROUT X
                              WHERE 1 = 1 
                                AND X.CHNL_CD = T1.CHNL_CD 
                                AND X.ROUT_CD = T1.ROUT_CD
                           ) T3
                OUTER APPLY (
				            SELECT X.ROUT_CD
                                 ,X.ROUT_NM 
                             FROM TB_PROD_ROUT X
                            WHERE 1 = 1 
                              AND X.CHNL_CD = T1.CHNL_CD 
                              AND X.ROUT_CD = T1.INTO_ROUT_CD
                           ) T4
                OUTER APPLY (
				            SELECT SUM(X.ITM_QTY) AS ITM_QTY
                             FROM TB_FPRF_N2ND_STEP_ROUT X
                            WHERE 1 = 1 
                              AND X.CHNL_CD      = T1.CHNL_CD 
                              AND X.PROD_ORD_NO  = T1.LOT_DIV_NO
                              AND X.PROD_ORD_SEQ = T1.LOT_DIV_SEQ
                           ) T5
                    , TB_PROD_LOT_DIV  T6        
             WHERE  1 = 1  
               AND  T1.CHNL_CD     = #CHNL_CD#
               AND  T1.CHNL_CD     = T6.CHNL_CD 
			         AND  T1.LOT_DIV_NO  = T6.LOT_DIV_NO 
               AND  T1.ROUT_CD = 'IN'
			         AND  T1.LOT_DIV_NO  = #LOT_DIV_NO#-->
	  </select>

	  <!-- 사출 작업실적보고 -  바코드 스캔 팝업-->
	  <select id="M6710SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT
		        T1.CHNL_CD
		      , T1.LOT_DIV_NO
			    , T1.LOT_DIV_SEQ
		      , T3.ROUT_CD
			    , T3.ROUT_NM
		      , T1.EQ_NO
			    , T1.MOLD_CD
			    , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG
			    , T1.ITM_CD
			    , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD)  AS ITM_NM
			    , T1.LOT_DIV_QTY AS PROD_PLN_QTY
			    , T1.LOT_DIV_QTY AS SL_ITM_QTY
			    , T1.ROUT_ITM_CD
			    , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ROUT_ITM_CD)  AS ROUT_ITM_NM        
			    , CONVERT(VARCHAR, T1.PROD_PLN_DT, 23) AS PROD_PLN_DT
		      , CONVERT(VARCHAR, T1.MAKE_ST_DT, 24) AS MAKE_ST_DT
		      , CONVERT(VARCHAR, T1.MAKE_END_DT, 24) AS MAKE_END_DT
		      , #CRE_USR_ID# AS CRE_USR_ID
			    , #UPD_USR_ID# AS UPD_USR_ID
		  FROM TB_PROD_LOT_DIV AS T1
		     OUTER APPLY 
			    ( 
				    SELECT X.ROUT_CD
                            ,X.ROUT_NM 
                        FROM TB_PROD_ROUT X
                        WHERE 1 = 1 
                        AND X.CHNL_CD = T1.CHNL_CD 
                        AND X.ROUT_CD = T1.PCK_FLG
          ) T3
		    WHERE 1 = 1
		        AND T1.CHNL_CD     = #CHNL_CD#
		        AND T1.PROD_PLN_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		        AND T1.PROD_PLN_DT <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
	  </select>
	  
	  <insert id="M6710InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_JB_ORD
		  (
		        CHNL_CD
		      , LOT_DIV_NO
		      , LOT_DIV_SEQ
		      , ROUT_CD
		      , INTO_ROUT_CD
		      , PROD_EQ_NO
		      , ROUT_ST_DT
		      , ROUT_END_DT
		      , WRK_HRS
			    , MOLD_CD
			    , MOLD_NO
			    , MOLD_SEQ
			    , DY_NGT_FLG
		      , INTO_WRK_MAN_VAL
			    , PROD_GD_QTY
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		  )
		  VALUES
		  (
		        #CHNL_CD#
		      , #LOT_DIV_NO#
		      , (SELECT ISNULL(MAX(LOT_DIV_SEQ), 0) + 1 FROM TB_PROD_JB_ORD WHERE CHNL_CD = #CHNL_CD# AND LOT_DIV_NO = #LOT_DIV_NO#)    
		      , #ROUT_CD#
		      , #ROUT_CD#
		      , #EQ_NO#
		      , GETDATE()
		      , #MAKE_END_DT#
		      , ROUND((DATEDIFF(mi, #MAKE_ST_DT#, #MAKE_END_DT#)  / 60.0), 2) 
			    , #MOLD_CD#
			    , #MOLD_CD#
			    , #ITM_MOLD_SEQ#
			    , (CASE WHEN #DY_NGT_FLG# = '야간' THEN 'N' ELSE 'D' END)
		      , #INP_STAFF_VAL#
			    , #SL_ITM_QTY#
		      , #CRE_USR_ID#
		      , GETDATE()
		      , #UPD_USR_ID#
		      , GETDATE()
		  )
	  </insert>

	   <update id="M6710UpdateMst" parameterClass="ModelsLibrary.Man.ManVo">
		UPDATE TB_PROD_JB_ORD
           SET
                UPD_USR_ID       = #UPD_USR_ID#
          <isNotNull property="UPD_DT" >
              , UPD_DT           = #UPD_DT#
          </isNotNull>
		  <isNotNull property="ROUT_CD" >
		      , ROUT_CD          = #ROUT_CD#
		  </isNotNull>
		  <isNotNull property="MOLD_CD" >
              , MOLD_CD          = #MOLD_CD#
              , MOLD_SEQ         = #WEIH_SEQ#
		  </isNotNull>
		   <isNotNull property="DY_NGT_FLG" >
		      , DY_NGT_FLG     = (CASE WHEN #DY_NGT_FLG# = '야간' THEN 'N' ELSE 'D' END)
		   </isNotNull>
		   <isNotNull property="SL_ITM_QTY" >
			  , PROD_GD_QTY        = #SL_ITM_QTY#
		   </isNotNull>
		   <isNotNull property="INP_STAFF_VAL" >
			  , INTO_WRK_MAN_VAL = #INP_STAFF_VAL#
		   </isNotNull>
		   <isNotNull property="WRK_HRS" >
			  , ROUT_ST_DT     = #MAKE_ST_DT#
			  , ROUT_END_DT    = #MAKE_END_DT#
		      , WRK_HRS        = #WRK_HRS#
		   </isNotNull>
          WHERE 1 = 1
		    AND CHNL_CD     = #CHNL_CD#
		    AND LOT_DIV_NO  = #LOT_DIV_NO#
		    AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
	 </update>
		  
	  <delete id="M6710DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_JB_ORD
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
          <isNotNull property="ROUT_CD" >
            AND ROUT_CD     = #ROUT_CD#
          </isNotNull>
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
		        AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
	  </delete>


    <!-- 사출 작업실적보고 : 시간 계산-->
    <select id="M6710SelectMstResult" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT   TOP 1 
                T1.LOT_DIV_NO
              , T1.LOT_DIV_SEQ
              , T1.ROUT_CD
              , T1.CHNL_CD
              , CONVERT(VARCHAR, T1.ROUT_ST_DT, 120)    AS MAKE_ST_DT
              , CONVERT(VARCHAR, T1.ROUT_END_DT, 120)   AS MAKE_END_DT
              , ((DATEDIFF(MI, T1.ROUT_ST_DT, T1.ROUT_END_DT ) )  / 60.0) - ISNULL(T2.IDLE_MNT, 0) AS WRK_HRS
              , T1.UPD_USR_ID
           FROM TB_PROD_JB_ORD AS T1 LEFT OUTER JOIN 
              (    
                  SELECT   
                        ISNULL(SUM(CONVERT(INT,T1.IDLE_MNT)) / 60.0, 0)    AS IDLE_MNT
                       , MAX(T1.CHNL_CD) AS CHNL_CD
                       , MAX(T1.LOT_DIV_NO) AS LOT_DIV_NO
                       , MAX(T1.ROUT_CD) AS ROUT_CD
                   FROM TB_PROD_CD_IDLE T1
                        OUTER APPLY 
                        (
                              SELECT  X.CLSS_TP_CD  AS IDLE_TM_CD
                                  , X.CLSS_DESC   AS IDLE_NM
                                 FROM TB_SYS_CLSS_CD X 
                                WHERE 1 = 1 
                                  AND X.CHNL_CD    = #CHNL_CD#
                                  AND X.CHNL_CD    = T1.CHNL_CD
                                  AND X.CLSS_CD    = T1.IDLE_TM_CD
                                  AND X.CLSS_TP_CD = 'Q-007'
                        ) T26
                  WHERE 1 = 1 
                    AND T1.CHNL_CD    = #CHNL_CD#
                    AND T1.LOT_DIV_NO = #LOT_DIV_NO#
                    AND T1.ROUT_CD    = #ROUT_CD#
             ) AS T2 ON( T1.CHNL_CD = T2.CHNL_CD AND T1.LOT_DIV_NO = T2.LOT_DIV_NO AND T1.ROUT_CD = T2.ROUT_CD )
         WHERE 1=1 
            AND T1.CHNL_CD      = #CHNL_CD#
            AND T1.ROUT_CD      = #ROUT_CD#
            AND T1.LOT_DIV_NO   = #LOT_DIV_NO#
            AND T1.LOT_DIV_SEQ  = #LOT_DIV_SEQ#
    </select>


    <!-- 사출 작업실적보고 -  비가동 현황-->
	  <select id="M6710SelectDtl1" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT   T1.IDLE_TM_CD     AS IDLE_TM_CD
               , T2.IDLE_NM        AS IDLE_NM
               , T1.IDLE_MNT       AS IDLE_MNT
			         , T1.LOT_DIV_NO
               , T1.LOT_DIV_SEQ
			         , T1.ROUT_CD        AS ROUT_CD
               , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD) AS ROUT_NM
			         , T1.CHNL_CD
			         , T1.CRE_USR_ID
			         , T1.UPD_USR_ID
           FROM TB_PROD_CD_IDLE T1
                OUTER APPLY 
                (
		                    SELECT  X.CLSS_TP_CD  AS IDLE_TM_CD
                          , X.CLSS_DESC   AS IDLE_NM
                         FROM TB_SYS_CLSS_CD X 
                        WHERE 1 = 1 
                          AND X.CHNL_CD    = #CHNL_CD#
                          AND X.CHNL_CD    = T1.CHNL_CD
                          AND X.CLSS_CD    = T1.IDLE_TM_CD
                          AND X.CLSS_TP_CD = 'Q-007'
                ) T2
          WHERE 1 = 1 
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.LOT_DIV_NO = #LOT_DIV_NO#
            AND T1.LOT_DIV_SEQ =  #LOT_DIV_SEQ#
			      AND T1.ROUT_CD    = #ROUT_CD# 
	  </select>

	  <insert id="M6710InsertDtl1" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_CD_IDLE
		  (
		      CHNL_CD
		    , ROUT_CD
		    , LOT_DIV_NO
        , LOT_DIV_SEQ
		    , IDLE_TM_CD
		    , IDLE_MNT
		    , CRE_USR_ID
		    , CRE_DT
		    , UPD_USR_ID
		    , UPD_DT
		  )
		  VALUES
		  (
		      #CHNL_CD#
		    , #ROUT_CD#
		    , #LOT_DIV_NO#
        , #LOT_DIV_SEQ#
		    , #IDLE_TM_CD#
		    , #IDLE_MNT#
		    , #CRE_USR_ID#
		    , GETDATE()
		    , #UPD_USR_ID#
		    , GETDATE()
		  )
	  </insert>

	  <delete id="M6710DeleteDtl1" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_CD_IDLE
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
				    AND ROUT_CD     = #ROUT_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
            AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
	  </delete>



	  <!-- 사출 작업실적보고 - 공정 불량 현황-->
	  <select id="M6710SelectDtl2" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT
              T1.BAD_CD        AS  BAD_CD
		        , T2.BAD_NM        AS  BAD_NM
		        , T1.BAD_QTY       AS  BAD_QTY
		        , T1.BAD_RSN       AS  BAD_RSN
				    , T1.LOT_DIV_NO
            , T1.LOT_DIV_SEQ
				    , T1.ROUT_CD       AS ROUT_CD
            , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD) AS ROUT_NM
				    , T1.CHNL_CD
				    , #ROUT_ITM_CD#    AS ROUT_ITM_CD
				    , T1.CRE_USR_ID
				    , T1.UPD_USR_ID
		  FROM   TB_PROD_CD_BAD T1
		       , TB_CD_ROUT_BAD T2
		  WHERE 1 = 1
		      AND T1.CHNL_CD     =  #CHNL_CD#
		      AND T1.CHNL_CD     =  T2.CHNL_CD
		      AND T1.BAD_CD      =  T2.BAD_CD
		      AND T1.ROUT_CD     =  T2.ROUT_CD
		      AND T1.LOT_DIV_NO  =  #LOT_DIV_NO#
          AND T1.LOT_DIV_SEQ =  #LOT_DIV_SEQ#
			    AND T1.ROUT_CD     =  #ROUT_CD# 
          AND T1.ROUT_ITM_CD =  #ROUT_ITM_CD#
	  </select>
	  
	   <insert id="M6710InsertDtl2" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_CD_BAD
          (
                  CHNL_CD
                , ROUT_CD
                , LOT_DIV_NO
                , LOT_DIV_SEQ
                , ROUT_ITM_CD
                , BAD_CD
                , BAD_QTY
                , BAD_RSN
                , CRE_USR_ID
                , CRE_DT
                , UPD_USR_ID
                , UPD_DT
                , WRK_MAN_CD
            )

            VALUES
            ( 
                  #CHNL_CD#
                , #ROUT_CD#
                , #LOT_DIV_NO#
                , #LOT_DIV_SEQ#
                , #ROUT_ITM_CD#
                , #BAD_CD#
                , #BAD_QTY#
                , #BAD_RSN#
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()
                , #CRE_USR_ID#
            )
	  </insert>
	  
	  
	  <delete id="M6710DeleteDtl2" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_CD_BAD
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
				    AND ROUT_CD     = #ROUT_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
            AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
            AND ROUT_ITM_CD = #ROUT_ITM_CD#
	  </delete>
	  
	  
	<!-- 사출 작업실적보고 - 투입자재 불량 현황-->
	  <select id="M6710SelectDtl3_M" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
	        SELECT 
              T1.CHNL_CD
            , T1.LOT_DIV_NO   
            , T1.LOT_DIV_SEQ
            , T1.SRT_SEQ      AS ROUT_ORD_SEQ
            , T1.ROUT_CD      
            , T1.ITM_CD       
            , T2.ITM_NM       
            , T2.ITM_SZ_NM    
            , T2.N1ST_ITM_GRP_NM
            , T1.INP_QTY       
            , T1.ACT_QTY      
            , T1.LSS_RT       
            , T3.TTL_QTY  AS TOR_VAL  
            , T4.BAD_QTY
            , T1.ITM_CD   AS MTRL_CD
            , T2.ITM_NM   AS MTRL_NM
        FROM TB_PROD_JB_ITM  T1
          OUTER APPLY (
              SELECT SUM(X.LOT_USE_QTY) AS TTL_QTY
                FROM TB_PROD_JB_ITM_LOT X
               WHERE 1 = 1
                 AND X.CHNL_CD      = #CHNL_CD#
                 AND X.LOT_DIV_NO   = T1.LOT_DIV_NO
                 AND X.LOT_DIV_SEQ  = T1.LOT_DIV_SEQ
                 AND X.ITM_CD       = T1.ITM_CD
            ) T3  
          OUTER APPLY ( 
                  SELECT 
                     MAX(X.CHNL_CD)     AS CHNL_CD
                   , MAX(X.LOT_DIV_NO) AS LOT_DIV_NO
                   , SUM(X.BAD_QTY)     AS BAD_QTY
                   , X.ROUT_ITM_CD     AS ROUT_ITM_CD
                 FROM TB_PROD_CD_BAD  X
                   , TB_CD_ROUT_BAD  Y
                WHERE 1 = 1
                  AND X.CHNL_CD    = #CHNL_CD#
                  AND X.CHNL_CD    = Y.CHNL_CD
                  AND X.BAD_CD     = Y.BAD_CD
                  AND X.LOT_DIV_NO = T1.LOT_DIV_NO 
                  AND X.LOT_DIV_SEQ = T1.LOT_DIV_SEQ 
                  AND X.ROUT_ITM_CD = T1.ITM_CD
                GROUP BY X.ROUT_ITM_CD
           ) AS T4
        , MV_TB_CD_ITM    T2
        WHERE 1 = 1
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.CHNL_CD    = T2.CHNL_CD
            AND T1.ITM_CD     = T2.ITM_CD
            AND T1.LOT_DIV_NO = #LOT_DIV_NO#
            AND T1.LOT_DIV_SEQ = #LOT_DIV_SEQ#
    </select>

	  <!-- 사출 작업실적보고 - 투입자재 불량 현황-->
	  <select id="M6710SelectDtl3_D" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT 
		        T1.CHNL_CD
		      , T1.LOT_DIV_NO
		      , T1.LOT_DIV_SEQ
		      , T1.ROUT_CD
		      , T1.ROUT_ITM_CD AS ITM_CD
		      , T1.BAD_CD      
		      , T2.BAD_NM      
		      , T1.BAD_RSN     
		      , T1.BAD_QTY     
			    , T1.CRE_USR_ID
		      , T1.UPD_USR_ID
		  FROM TB_PROD_CD_BAD  T1
		     , TB_CD_ROUT_BAD  T2
		  WHERE 1 = 1
		      AND T1.CHNL_CD     = #CHNL_CD#
		      AND T1.CHNL_CD     = T2.CHNL_CD
		      AND T1.BAD_CD      = T2.BAD_CD
		      AND T1.ROUT_ITM_CD = #ITM_CD#
		      AND T1.LOT_DIV_NO  = #LOT_DIV_NO#
		      AND T1.LOT_DIV_SEQ  = #LOT_DIV_SEQ#
	  </select>

	  <insert id="M6710InsertDtl3" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_CD_BAD
          (
                  CHNL_CD
                , ROUT_CD
                , LOT_DIV_NO
                , LOT_DIV_SEQ
				        , ROUT_ITM_CD
                , BAD_CD
                , BAD_QTY
                , BAD_RSN
                , CRE_USR_ID
                , CRE_DT
                , UPD_USR_ID
                , UPD_DT
                , WRK_MAN_CD
            )

            VALUES
            ( 
                  #CHNL_CD#
                , #ROUT_CD#
                , #LOT_DIV_NO#
                , #LOT_DIV_SEQ#
				        , #ITM_CD#
                , #BAD_CD#
                , #BAD_QTY#
                , #BAD_RSN#
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()
                , #CRE_USR_ID#
            )
	  </insert>
	  
   <update id="M6710UpdateDtl3" parameterClass="ModelsLibrary.Man.ManVo">
		 UPDATE TB_PROD_JB_ITM
        SET
            UPD_USR_ID   = #UPD_USR_ID#
          , UPD_DT       = GETDATE()
          , TTL_QTY      = #TOR_VAL#
     WHERE 1 = 1
        AND CHNL_CD      = #CHNL_CD# 
        AND LOT_DIV_NO   = #LOT_DIV_NO#
        AND LOT_DIV_SEQ  = #LOT_DIV_SEQ#
        AND ROUT_CD      = #ROUT_CD#
        AND ITM_CD       = #ITM_CD#   
	 </update>
    
	  <delete id="M6710DeleteDtl3" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_CD_BAD
		    WHERE 1 = 1
		        AND CHNL_CD    = #CHNL_CD#
				    AND ROUT_CD    = #ROUT_CD#
		        AND LOT_DIV_NO = #LOT_DIV_NO#
            AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
            AND ROUT_ITM_CD = #ITM_CD#
	  </delete>
    
    
      <!-- 사출 작업실적보고 - 투입자재 불량 현황 (투입 LOT)-->
	  <select id="M6710SelectDtl4_D" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT  '신재'  AS GBN 
              , CONVERT(VARCHAR, ITM_IN_DT, 23) AS CRE_DT
              , MTRL_LOT_NO
              , 0     AS RN
              , ITM_CD
              , ITM_QTY AS SL_ITM_QTY
              <!--, LOT_USE_QTY   AS USE_QTY-->
              , 0 AS USE_QTY
              , ITM_QTY - ISNULL(LOT_USE_QTY  , 0)  AS RMN_QTY                 
          FROM TB_FPRF_N1ST_STEP_ROUT  T1
            OUTER APPLY (
                SELECT SUM(X.LOT_USE_QTY) AS LOT_USE_QTY 
                  FROM TB_PROD_JB_ITM_LOT X
                 WHERE 1 = 1
                   AND X.CHNL_CD      = #CHNL_CD#
                   AND X.LOT_NO       = T1.MTRL_LOT_NO 
                   AND X.LOT_SEQ      = 0          
              ) T3
         WHERE 1 = 1
           AND T1.CHNL_CD      = #CHNL_CD#
           AND T1.CLZ_FLG      = 'N'
           AND T1.ITM_CD       = #ITM_CD#
           <!--
           AND ITM_QTY - ISNULL(LOT_USE_QTY  , 0)  > 0
           -->
        UNION ALL 
        SELECT '분쇄'  AS GBN 
              , CONVERT(VARCHAR, T2.CRE_DT, 23) AS CRE_DT
              , T1.MTRL_LOT_NO
              , T2.MTRL_REUES_SEQ    AS RN   
              , T1.ITM_CD
              , T2.REUES_QTY AS SL_ITM_QTY
              <!--, T3.LOT_USE_QTY AS USE_QTY-->
              , 0 AS USE_QTY
              , T2.REUES_QTY  - ISNULL(T3.LOT_USE_QTY  , 0)  AS RMN_QTY                      
          FROM  TB_FPRF_N1ST_STEP_ROUT    T1
              , TB_FPRF_N1ST_STEP_REUES   T2
               OUTER APPLY (
                SELECT SUM(X.LOT_USE_QTY) AS LOT_USE_QTY 
                  FROM TB_PROD_JB_ITM_LOT X
                 WHERE 1 = 1
                   AND X.CHNL_CD      = #CHNL_CD#
                   AND X.LOT_NO       = T2.MTRL_LOT_NO 
                   AND X.LOT_SEQ      = T2.MTRL_REUES_SEQ 
              ) T3      
        WHERE 1 = 1
           AND T1.CLZ_FLG      = 'N'
           AND T1.CHNL_CD      = #CHNL_CD#
           AND T1.CHNL_CD      = T2.CHNL_CD
           AND T1.MTRL_LOT_NO  = T2.MTRL_LOT_NO
           AND T1.ITM_CD       = #ITM_CD#
           <!--
           AND T2.REUES_QTY  - ISNULL(T3.LOT_USE_QTY  , 0) > 0
           -->
	  </select>
	  
    <insert id="M6710InsertDtl4" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_JB_ITM_LOT
      (   CHNL_CD
        , LOT_DIV_NO
        , LOT_DIV_SEQ
        , ROUT_CD
        , ITM_CD
        , LOT_NO
        , LOT_SEQ
        , LOT_USE_QTY
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , LOT_USE_DT
      )  
      SELECT  TOP 1
             CHNL_CD
           , LOT_DIV_NO
           , LOT_DIV_SEQ
           , ROUT_CD
           , ITM_CD
           , #MTRL_LOT_NO#
           , #RN#
           , #USE_QTY#
           , #CRE_USR_ID#
           , GETDATE()
           , #UPD_USR_ID#
           , GETDATE()     
           , GETDATE()     
        FROM TB_PROD_JB_ITM
       WHERE 1 = 1
         AND CHNL_CD      = #CHNL_CD#
         AND LOT_DIV_NO   = #LOT_DIV_NO#
         AND LOT_DIV_SEQ  = #LOT_DIV_SEQ#
         AND ROUT_CD      = #ROUT_CD#
         AND ITM_CD       = #ITM_CD#
	  </insert>

	  <delete id="M6710DeleteDtl4" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_JB_ITM_LOT
        WHERE 1 = 1
          AND CHNL_CD      = #CHNL_CD#
          AND LOT_DIV_NO   = #LOT_DIV_NO#
          AND LOT_DIV_SEQ  = #LOT_DIV_SEQ#
          AND ROUT_CD      = #ROUT_CD#
          AND ITM_CD       = #ITM_CD#
	  </delete>

    
    <!-- 사출 작업실적보고 - 투입자재 불량 현황 (투입 LOT)-->
    <select id="M6710SelectDtl5_D" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT CASE WHEN LOT_SEQ = 0 THEN '신재' ELSE '분쇄' END AS GBN
        , LOT_NO 
        , LOT_SEQ AS RN
        , LOT_USE_QTY AS USE_QTY
        , LOT_DIV_NO
        , LOT_DIV_SEQ
        , CHNL_CD
        , CONVERT(VARCHAR, CRE_DT, 23) AS CRE_DT
      FROM TB_PROD_JB_ITM_LOT
        WHERE 1 = 1
          AND CHNL_CD      = #CHNL_CD#
          AND LOT_DIV_NO   = #LOT_DIV_NO#
          AND LOT_DIV_SEQ  = #LOT_DIV_SEQ#
    </select>

    <delete id="M6710DeleteDtl5" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_JB_ITM_LOT
       WHERE 1 = 1
         AND CHNL_CD      = #CHNL_CD# 
         AND LOT_DIV_NO   = #LOT_DIV_NO#
         AND LOT_DIV_SEQ  = #LOT_DIV_SEQ#
         AND LOT_NO       = #LOT_NO#
         AND LOT_SEQ      = #RN#
	  </delete>



    <!-- 조립 작업실적보고-->
    <select id="M6730Select" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT  
              CONVERT(VARCHAR, T1.MAKE_ST_DT,  23) AS  PROD_PLN_DT 
            , T1.LOT_DIV_NO   
            , T1.ROUT_CD
            , T1.ROUT_NM
            , T1.EQ_NO
            , T1.GBN     
            , T1.DY_NGT_FLG        
            , T1.ITM_NM
            , T1.ITM_SZ_NM
            , T1.CMPO_CD       AS ROUT_ITM_CD
            , T1.CMPO_NM       AS ROUT_ITM_NM    
            , T1.LOT_DIV_QTY
            , T1.CHNL_CD
            , T1.SRT_SEQ      AS WEIH_SEQ
            , T1.RN 
            , CONVERT(VARCHAR, WRK_DY)          AS PLN_DY
            , CYC_TIME    
            , #FM_DT# AS FM_DT
            , #TO_DT# AS TO_DT
            , T1.MOLD_CD
            , T1.MOLD_SEQ AS ITM_MOLD_SEQ
        FROM (
              SELECT T1.MAKE_ST_DT   
                   , T1.LOT_DIV_NO   
                   , T2.SCM_ROUT_CD AS ROUT_CD
                   , dbo.FF_NM_ROUT(T1.CHNL_CD, T2.SCM_ROUT_CD)  AS ROUT_NM
                   , T1.EQ_NO
                   , T1.MOLD_CD  + '-' + CONVERT(VARCHAR, T1.MOLD_SEQ) AS GBN     
                   , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG        
                   , T5.ITM_NM
                   , T5.ITM_SZ_NM
                   , T4.ITM_CD        AS CMPO_CD    
                   , T4.ITM_NM        AS CMPO_NM    
                   , T1.LOT_DIV_QTY
                   , T1.CHNL_CD
                   , T6.SRT_SEQ
                   , ROW_NUMBER() OVER (PARTITION BY T1.EQ_NO ORDER BY T1.EQ_NO, T6.SRT_SEQ, T1.LOT_DIV_NO DESC) AS RN 
                   , T1.MOLD_CD
                   , T1.MOLD_SEQ
                   , CASE WHEN CYC_TIME IS NULL THEN 1.0 ELSE ROUND(T1.LOT_DIV_QTY / CYC_TIME *1.0, 1) END WRK_DY
                   , CYC_TIME                    
                FROM TB_PROD_LOT_DIV T1     
                   OUTER APPLY
                   (
                      SELECT X.CYC_TIME   AS CYC_TIME
                        FROM TB_PROD_MOLD_CD X
                          WHERE 1 = 1
                            AND X.CHNL_CD   = #CHNL_CD#
                            AND X.MOLD_NO   = T1.MOLD_CD 
                            AND X.MOLD_SEQ  = T1.MOLD_SEQ             
                   ) T7
                   , TB_SCM_PUR      T2
                   , MV_TB_CD_ITM    T4
                   , TB_SCM_ORD_RLSE T3
                   , MV_TB_CD_ITM    T5   
                   , TB_PROD_WKY_PLN T6
               WHERE 1 = 1
                 AND T1.CHNL_CD     = #CHNL_CD#
                 AND T1.CHNL_CD     = T2.CHNL_CD
                 AND T1.CHNL_CD     = T3.CHNL_CD
                 AND T1.CHNL_CD     = T4.CHNL_CD
                 AND T1.CHNL_CD     = T5.CHNL_CD   
                 AND T1.CHNL_CD     = T6.CHNL_CD      
                 AND T2.SCM_RLSE_NO = T3.SCM_RLSE_NO
                 AND T1.ORD_NO      = T2.SCM_PUR_NO
                 AND T1.ORD_SEQ     = T2.SCM_PUR_SEQ
                 AND T2.SCM_PUR_ITM_CD  = T4.ITM_CD
                 AND T3.ITM_CD      = T5.ITM_CD
                 AND T1.PROD_ORD_NO = T6.PROD_WKY_PLN_NO
                 AND T2.PUR_STS_CD  NOT IN ('A', 'D')
                 AND T2.SCM_ROUT_CD IN ('SA', 'TA')
          ) T1    
      WHERE 1 = 1
        AND RN <![CDATA[ < ]]> 3
      ORDER BY EQ_NO, RN  
    </select>
    
   <select id="M6730SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
            SELECT    
                ROW_NUMBER() OVER (PARTITION BY T1.LOT_DIV_NO ORDER BY T6.MAKE_ST_DT) AS RN
			        , T1.LOT_DIV_NO          AS LOT_DIV_NO
              , T1.LOT_DIV_SEQ         AS LOT_DIV_SEQ
              , T6.ITM_CD
              , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T6.ITM_CD)  AS ITM_NM
              , T6.ROUT_ITM_CD
              , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T6.ROUT_ITM_CD)  AS ROUT_ITM_NM        
              , T3.ROUT_NM             AS ROUT_NM
				      , T3.ROUT_CD             AS ROUT_CD
              <!--,T4.ROUT_NM             AS INTO_ROUT_NM-->
              <!--, CONVERT(CHAR(19), T1.ROUT_ST_DT, 20)      AS WRK_ST_DT
                  , CONVERT(CHAR(19), T1.ROUT_END_DT, 20)     AS WRK_END_DT-->
		          <!--,dbo.USR_NM_FNC(T1.CHNL_CD, T1.WRK_MAN_CD) AS MAKE_USR_NM-->
		          , CONVERT(CHAR(8), T1.ROUT_ST_DT, 24)      AS WRK_ST_DT
		          , CONVERT(CHAR(8), T1.ROUT_END_DT, 24)     AS WRK_END_DT
					    , CONVERT(VARCHAR, T1.ROUT_ST_DT, 120)      AS MAKE_ST_DT
		          , CONVERT(VARCHAR, T1.ROUT_END_DT, 120)     AS MAKE_END_DT
		          , T1.WRK_HRS             AS WRK_HRS
              , T1.INTO_WRK_MAN_VAL    AS INP_STAFF_VAL
              , T5.ITM_QTY             AS SL_PLN_QTY
					    , T1.PROD_GD_QTY         AS SL_ITM_QTY
					    , T1.PROD_BAD_QTY        AS BAD_QTY
              , dbo.USR_NM_FNC(T1.CHNL_CD, T1.UPD_USR_ID) AS UPD_USR_NM
              , CONVERT(VARCHAR,T1.UPD_DT,23)             AS UPD_DT            
					    , CONVERT(VARCHAR, T6.MAKE_ST_DT, 23) AS PROD_PLN_DT
					    , T1.CHNL_CD
					    , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG
					    , ISNULL(T1.MOLD_CD, T1.MOLD_NO) AS MOLD_CD
					    , T1.MOLD_SEQ AS WEIH_SEQ
					    , ISNULL(T1.MOLD_CD, T1.MOLD_NO)  + '-' + CONVERT(VARCHAR, T1.MOLD_SEQ) AS GBN
					    , T1.PROD_EQ_NO AS EQ_NO
					    , T6.LOT_DIV_QTY
            FROM  TB_PROD_JB_ORD T1     
                OUTER APPLY ( 
				            SELECT X.ROUT_CD
                                  ,X.ROUT_NM 
                               FROM TB_PROD_ROUT X
                              WHERE 1 = 1 
                                AND X.CHNL_CD = T1.CHNL_CD 
                                AND X.ROUT_CD = T1.ROUT_CD
                           ) T3
                OUTER APPLY (
				            SELECT X.ROUT_CD
                                 ,X.ROUT_NM 
                             FROM TB_PROD_ROUT X
                            WHERE 1 = 1 
                              AND X.CHNL_CD = T1.CHNL_CD 
                              AND X.ROUT_CD = T1.INTO_ROUT_CD
                           ) T4
                OUTER APPLY (
				            SELECT SUM(X.ITM_QTY) AS ITM_QTY
                             FROM TB_FPRF_N2ND_STEP_ROUT X
                            WHERE 1 = 1 
                              AND X.CHNL_CD      = T1.CHNL_CD 
                              AND X.PROD_ORD_NO  = T1.LOT_DIV_NO
                              AND X.PROD_ORD_SEQ = T1.LOT_DIV_SEQ
                           ) T5
                    , TB_PROD_LOT_DIV  T6        
             WHERE  1 = 1  
               AND  T1.CHNL_CD     = #CHNL_CD#
               AND  T1.CHNL_CD     = T6.CHNL_CD 
			         AND  T1.LOT_DIV_NO  = T6.LOT_DIV_NO 
			         <!--AND  T1.LOT_DIV_SEQ  = T6.LOT_DIV_SEQ -->
               AND  T1.ROUT_CD IN ('SA', 'TA')
               AND  T1.LOT_DIV_NO  = #LOT_DIV_NO#
			     <!--
			         AND  T6.MAKE_ST_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
               AND  T6.MAKE_ST_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
               AND  T1.LOT_DIV_NO  = 'UF210813-0002-0004'
               AND  T1.LOT_DIV_SEQ = '1'-->     
	  </select>

	  <!-- 조립 작업실적보고 -  바코드 스캔 팝업-->
	  <select id="M6730SelectPopup" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT
		        T1.CHNL_CD
		      , T1.LOT_DIV_NO
			    , T1.LOT_DIV_SEQ
		      , T3.ROUT_CD
			    , T3.ROUT_NM
		      , T1.EQ_NO
			    , T1.MOLD_CD
			    , (CASE WHEN T1.DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_FLG
			    , T1.ITM_CD
			    , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD)  AS ITM_NM
			    , T1.LOT_DIV_QTY AS PROD_PLN_QTY
			    , T1.LOT_DIV_QTY AS SL_ITM_QTY
			    , T1.ROUT_ITM_CD
			    , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ROUT_ITM_CD)  AS ROUT_ITM_NM        
			    , CONVERT(VARCHAR, T1.PROD_PLN_DT, 23) AS PROD_PLN_DT
		      , CONVERT(VARCHAR, T1.MAKE_ST_DT, 24) AS MAKE_ST_DT
		      , CONVERT(VARCHAR, T1.MAKE_END_DT, 24) AS MAKE_END_DT
		      , #CRE_USR_ID# AS CRE_USR_ID
			    , #UPD_USR_ID# AS UPD_USR_ID
		  FROM TB_PROD_LOT_DIV AS T1
		     OUTER APPLY 
			    ( 
				              SELECT X.ROUT_CD
                            ,X.ROUT_NM 
                        FROM TB_PROD_ROUT X
                          WHERE 1 = 1 
                            AND X.CHNL_CD = T1.CHNL_CD 
                            AND X.ROUT_CD = T1.PCK_FLG
                ) T3
		    WHERE 1 = 1
		        AND T1.CHNL_CD     = #CHNL_CD#
		        AND T1.PROD_PLN_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		        AND T1.PROD_PLN_DT <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
	  </select>
	  
	  <insert id="M6730InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_JB_ORD
		  (
		        CHNL_CD
		      , LOT_DIV_NO
		      , LOT_DIV_SEQ
		      , ROUT_CD
		      , INTO_ROUT_CD
		      , PROD_EQ_NO
		      , ROUT_ST_DT
		      , ROUT_END_DT
		      , WRK_HRS
			    , MOLD_CD
          , MOLD_NO
			    , MOLD_SEQ
			    , DY_NGT_FLG
		      , INTO_WRK_MAN_VAL
			    , PROD_GD_QTY
		      , CRE_USR_ID
		      , CRE_DT
		      , UPD_USR_ID
		      , UPD_DT
		  )
		  VALUES
		  (
		        #CHNL_CD#
		      , #LOT_DIV_NO#
		      , (SELECT ISNULL(MAX(LOT_DIV_SEQ), 0) + 1 FROM TB_PROD_JB_ORD WHERE CHNL_CD = #CHNL_CD# AND LOT_DIV_NO = #LOT_DIV_NO#)    
		      , #ROUT_CD#
		      , #ROUT_CD#
		      , #EQ_NO#
		      , GETDATE()
		      , #MAKE_END_DT#
		      , ROUND((DATEDIFF(mi, #MAKE_ST_DT#, #MAKE_END_DT#)  / 60.0), 2) 
			    , #MOLD_CD#
          , #MOLD_CD#
			    , #ITM_MOLD_SEQ#
			    , (CASE WHEN #DY_NGT_FLG# = '야간' THEN 'N' ELSE 'D' END)
		      , #INP_STAFF_VAL#
			    , #SL_ITM_QTY#
		      , #CRE_USR_ID#
		      , GETDATE()
		      , #UPD_USR_ID#
		      , GETDATE()
		  )
	  </insert>

	   <update id="M6730UpdateMst" parameterClass="ModelsLibrary.Man.ManVo">
		 UPDATE TB_PROD_JB_ORD
           SET
               UPD_USR_ID       = #UPD_USR_ID#
             , UPD_DT           = GETDATE()
		   <isNotNull property="MOLD_CD" >
             , MOLD_CD          = #MOLD_CD#
             , MOLD_SEQ         = #WEIH_SEQ#
		   </isNotNull>
		   <isNotNull property="DY_NGT_FLG" >
			   , DY_NGT_FLG     = (CASE WHEN #DY_NGT_FLG# = '야간' THEN 'N' ELSE 'D' END)
		   </isNotNull>
		   <isNotNull property="SL_ITM_QTY" >
			   , PROD_GD_QTY        = #SL_ITM_QTY#
		   </isNotNull>
		   <isNotNull property="INP_STAFF_VAL" >
			   , INTO_WRK_MAN_VAL = #INP_STAFF_VAL#
		   </isNotNull>
		   <isNotNull property="WRK_HRS" >
			   , ROUT_ST_DT     = #MAKE_ST_DT#
			   , ROUT_END_DT    = #MAKE_END_DT#
		     , WRK_HRS        = #WRK_HRS#
		   </isNotNull>
          WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
				AND ROUT_CD     = #ROUT_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
		        AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
	 </update>
		  
	  <delete id="M6730DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_JB_ORD
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
				    AND ROUT_CD     = #ROUT_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
		        AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
	  </delete>



	  <!-- 조립 작업실적보고 -  비가동 현황-->
	  <select id="M6730SelectDtl1" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT   T1.IDLE_TM_CD     AS IDLE_TM_CD
               , T2.IDLE_NM        AS IDLE_NM
               , T1.IDLE_MNT       AS IDLE_MNT
			         , T1.LOT_DIV_NO
               , T1.LOT_DIV_SEQ
			         , T1.ROUT_CD        AS ROUT_CD
			         , T1.CHNL_CD
			         , T1.CRE_USR_ID
			         , T1.UPD_USR_ID
           FROM TB_PROD_CD_IDLE T1
                OUTER APPLY (
		            SELECT  X.CLSS_TP_CD  AS IDLE_TM_CD
                          , X.CLSS_DESC   AS IDLE_NM
                         FROM TB_SYS_CLSS_CD X 
                        WHERE 1 = 1 
                          AND X.CHNL_CD    = #CHNL_CD#
                          AND X.CHNL_CD    = T1.CHNL_CD
                          AND X.CLSS_CD    = T1.IDLE_TM_CD
                          AND X.CLSS_TP_CD = 'Q-007'
                    ) T2
          WHERE 1 = 1 
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.LOT_DIV_NO = #LOT_DIV_NO#
            AND T1.LOT_DIV_SEQ =  #LOT_DIV_SEQ#
			      AND T1.ROUT_CD    = #ROUT_CD# 
	  </select>

	  <insert id="M6730InsertDtl1" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_CD_IDLE
		  (
		      CHNL_CD
		    , ROUT_CD
		    , LOT_DIV_NO
        , LOT_DIV_SEQ
		    , IDLE_TM_CD
		    , IDLE_MNT
		    , CRE_USR_ID
		    , CRE_DT
		    , UPD_USR_ID
		    , UPD_DT
		  )
		  VALUES
		  (
		      #CHNL_CD#
		    , #ROUT_CD#
		    , #LOT_DIV_NO#
        , #LOT_DIV_SEQ#
		    , #IDLE_TM_CD#
		    , #IDLE_MNT#
		    , #CRE_USR_ID#
		    , GETDATE()
		    , #UPD_USR_ID#
		    , GETDATE()
		  )
	  </insert>

	  <delete id="M6730DeleteDtl1" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_CD_IDLE
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
				    AND ROUT_CD     = #ROUT_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
            AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
	  </delete>



	  <!-- 조립 작업실적보고 - 불량 현황-->
	  <select id="M6730SelectDtl2" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT    T1.BAD_CD        AS  BAD_CD
		          , T2.BAD_NM        AS  BAD_NM
		          , T1.BAD_QTY       AS  BAD_QTY
		          , T1.BAD_RSN       AS  BAD_RSN
				      , T1.LOT_DIV_NO
              , T1.LOT_DIV_SEQ
				      , T1.ROUT_CD       AS ROUT_CD
				      , T1.CHNL_CD
				      , #ROUT_ITM_CD#    AS ROUT_ITM_CD
				      , T1.CRE_USR_ID
				      , T1.UPD_USR_ID
		      FROM   TB_PROD_CD_BAD T1
		           , TB_CD_ROUT_BAD T2
		      WHERE 1 = 1
		          AND T1.CHNL_CD     =  #CHNL_CD#
		          AND T1.CHNL_CD     =  T2.CHNL_CD
		          AND T1.BAD_CD      =  T2.BAD_CD
		          AND T1.ROUT_CD     =  T2.ROUT_CD
		          AND T1.LOT_DIV_NO  =  #LOT_DIV_NO#
              AND T1.LOT_DIV_SEQ =  #LOT_DIV_SEQ#
			        AND T1.ROUT_CD     =  #ROUT_CD# 
              AND T1.ROUT_ITM_CD =  #ROUT_ITM_CD#
	  </select>
	  
	   <insert id="M6730InsertDtl2" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_CD_BAD
          (
                  CHNL_CD
                , ROUT_CD
                , LOT_DIV_NO
                , LOT_DIV_SEQ
                , ROUT_ITM_CD
                , BAD_CD
                , BAD_QTY
                , BAD_RSN
                , CRE_USR_ID
                , CRE_DT
                , UPD_USR_ID
                , UPD_DT
                , WRK_MAN_CD
            )

            VALUES
            ( 
                  #CHNL_CD#
                , #ROUT_CD#
                , #LOT_DIV_NO#
                , #LOT_DIV_SEQ#
                , #ROUT_ITM_CD#
                , #BAD_CD#
                , #BAD_QTY#
                , #BAD_RSN#
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()
                , #CRE_USR_ID#
            )
	  </insert>
	  
	  
	  <delete id="M6730DeleteDtl2" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_CD_BAD
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
				    AND ROUT_CD     = #ROUT_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
            AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
            AND ROUT_ITM_CD = #ROUT_ITM_CD#
	  </delete>
	  
	  
	<!-- 조립 작업실적보고 - 투입자재 불량 현황-->
	  <select id="M6730SelectDtl3_M" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		    SELECT 
              T1.CHNL_CD
            , T1.LOT_DIV_NO   
            , T1.LOT_DIV_SEQ
            , T1.SRT_SEQ      AS ROUT_ORD_SEQ
            , T1.ROUT_CD      
            , T1.ITM_CD       
            , T2.ITM_NM       
            , T2.ITM_SZ_NM    
            , T2.N1ST_ITM_GRP_NM
            , T1.INP_QTY       
            , T1.ACT_QTY      
            , T1.LSS_RT       
            , T1.TTL_QTY  AS TOR_VAL  
            , T4.BAD_QTY
        FROM TB_PROD_JB_ITM  T1
          OUTER APPLY ( 
                  SELECT 
                     MAX(X.CHNL_CD)    AS CHNL_CD
                   , MAX(X.LOT_DIV_NO) AS LOT_DIV_NO
                   , SUM(X.BAD_QTY)    AS BAD_QTY
                   , X.ROUT_ITM_CD     AS ROUT_ITM_CD
                 FROM TB_PROD_CD_BAD  X
                   , TB_CD_ROUT_BAD  Y
                WHERE 1 = 1
                  AND X.CHNL_CD    = #CHNL_CD#
                  AND X.CHNL_CD    = Y.CHNL_CD
                  AND X.BAD_CD     = Y.BAD_CD
                  AND X.LOT_DIV_NO = T1.LOT_DIV_NO 
                  AND X.LOT_DIV_SEQ = T1.LOT_DIV_SEQ 
                  AND X.ROUT_ITM_CD = T1.ITM_CD
                GROUP BY X.ROUT_ITM_CD
           ) AS T4
          , MV_TB_CD_ITM    T2
        WHERE 1 = 1
            AND T1.CHNL_CD    = #CHNL_CD#
            AND T1.CHNL_CD    = T2.CHNL_CD           
            AND T1.ITM_CD     = T2.ITM_CD           
            AND T1.LOT_DIV_NO = #LOT_DIV_NO#
            AND T1.LOT_DIV_SEQ = #LOT_DIV_SEQ#
	  </select>

	  <!-- 조립 작업실적보고 - 투입자재 불량 현황-->
	  <select id="M6730SelectDtl3_D" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT 
		        T1.CHNL_CD
		      , T1.LOT_DIV_NO
		      , T1.LOT_DIV_SEQ
		      , T1.ROUT_CD
		      , T1.ROUT_ITM_CD AS ITM_CD
		      , T1.BAD_CD      
		      , T2.BAD_NM      
		      , T1.BAD_RSN     
		      , T1.BAD_QTY     
			    , T1.CRE_USR_ID
		      , T1.UPD_USR_ID
		  FROM TB_PROD_CD_BAD  T1
		     , TB_CD_ROUT_BAD  T2
		  WHERE 1 = 1
		      AND T1.CHNL_CD     = #CHNL_CD#
		      AND T1.CHNL_CD     = T2.CHNL_CD
		      AND T1.BAD_CD      = T2.BAD_CD
		      AND T1.ROUT_ITM_CD = #ITM_CD#
		      AND T1.LOT_DIV_NO  = #LOT_DIV_NO#
          AND T1.LOT_DIV_SEQ = #LOT_DIV_SEQ#
	  </select>

	  <insert id="M6730InsertDtl3" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_CD_BAD
          (
                  CHNL_CD
                , ROUT_CD
                , LOT_DIV_NO
                , LOT_DIV_SEQ
				        , ROUT_ITM_CD
                , BAD_CD
                , BAD_QTY
                , BAD_RSN
                , CRE_USR_ID
                , CRE_DT
                , UPD_USR_ID
                , UPD_DT
                , WRK_MAN_CD
            )

            VALUES
            ( 
                  #CHNL_CD#
                , #ROUT_CD#
                , #LOT_DIV_NO#
                , #LOT_DIV_SEQ#
				        , #ITM_CD#
                , #BAD_CD#
                , #BAD_QTY#
                , #BAD_RSN#
                , #CRE_USR_ID#
                , GETDATE()
                , #UPD_USR_ID#
                , GETDATE()
                , #CRE_USR_ID#
            )
	  </insert>
    
    	  
   <update id="M6730UpdateDtl3" parameterClass="ModelsLibrary.Man.ManVo">
		 UPDATE TB_PROD_JB_ITM
        SET
            UPD_USR_ID   = #UPD_USR_ID#
          , UPD_DT       = GETDATE()
          , TTL_QTY      = #TOR_VAL#
     WHERE 1 = 1
        AND CHNL_CD      = #CHNL_CD# 
        AND LOT_DIV_NO   = #LOT_DIV_NO#
        AND LOT_DIV_SEQ  = #LOT_DIV_SEQ#
        AND ROUT_CD      = #ROUT_CD#
        AND ITM_CD       = #ITM_CD#   
	 </update>
    
	  
	  <delete id="M6730DeleteDtl3" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_CD_BAD
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
				    AND ROUT_CD     = #ROUT_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
		        AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
            AND ROUT_ITM_CD = #ITM_CD#
	  </delete>
    
    
	  
  
     <!-- 사출 작업지시등록 - MST -->
	 <select id="M6500SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT 
            T1.WEIH_SEQ
          , T1.ROUT_SEQ
          , T1.WRK_DT
          , T1.EQ_NO
          , T1.DUE_DT
          , T1.ITM_NM  
          , T1.ITM_SZ_NM
          , T1.ITM_CD 
          , T1.CMPO_NM          
          , T1.N2ND_ITM_GRP_NM        
          , T1.SL_PLN_QTY
          , T1.PROD_QTY  
          , T1.PROD_BSE_MOLD_NO
          , T1.PROD_ORD_NO  
          , T1.ASSY_ITM_CD
          , T1.WKY_YRMON
          , T1.WK
          , T1.CHNL_CD      
          , T1.SL_ORD_NO
          , T1.SL_ORD_SEQ
          , T1.PCK_FLG
          , T1.RN
          , T1.MOLD_CD
          , T1.GBN
      FROM (
		      SELECT 
                ROW_NUMBER() OVER (PARTITION BY T1.PROD_EQ_NO ORDER BY T1.PROD_EQ_NO, T1.SRT_SEQ) AS SRT_RN 
              , T1.SRT_SEQ               AS ROUT_SEQ
              , CONVERT(VARCHAR, T1.PROD_DLY_DT, 23)  AS WRK_DT
              , T1.PROD_EQ_NO           AS EQ_NO
              , CONVERT(VARCHAR, T3.SCM_RLSE_ESTM_DT, 23)  AS DUE_DT
              , T4.ITM_NM  
              , T4.ITM_SZ_NM
              , T3.SCM_PUR_ITM_CD   AS ITM_CD 
              , T5.ITM_NM           AS CMPO_NM          
              , T5.N2ND_ITM_GRP_NM  AS N2ND_ITM_GRP_NM        
              , T3.SCM_PUR_ITM_QTY  AS SL_PLN_QTY
              , T1.PROD_QTY         AS PROD_QTY  
              , T1.PROD_BSE_MOLD_NO AS PROD_BSE_MOLD_NO
              , T1.PROD_WKY_PLN_NO  AS PROD_ORD_NO  
              , T1.PROD_CMPO_CD     AS ASSY_ITM_CD
              , T1.PROD_YRMON       AS WKY_YRMON
              , T1.PROD_WK          AS WK
              , T1.CHNL_CD      
			        , T3.SCM_PUR_NO       AS SL_ORD_NO
			        , T3.SCM_PUR_SEQ      AS SL_ORD_SEQ
			        , T3.SCM_ROUT_CD      AS PCK_FLG
			        , (SELECT COUNT(*) AS RN  FROM  TB_PROD_LOT_DIV AS X WHERE 1=1 AND X.CHNL_CD = T1.CHNL_CD AND X.PROD_ORD_NO = T1.PROD_WKY_PLN_NO) AS RN
              , T6.MOLD_CD
              , T6.MOLD_SEQ         AS WEIH_SEQ
              , T6.MOLD_CD + '-' + CONVERT(VARCHAR, T6.MOLD_SEQ) AS GBN
           FROM TB_PROD_WKY_PLN    T1
              , TB_SCM_ORD_RLSE    T2
              , TB_SCM_PUR         T3
              , TB_CD_ITM          T4
              , MV_TB_CD_ITM       T5
            OUTER APPLY
            (
               SELECT T1.MOLD_CD
                     , T1.MOLD_SEQ
              FROM(
                    SELECT X.MOLD_CD
                       , X.MOLD_SEQ                  
                       , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY X.MOLD_CD, X.MOLD_SEQ) AS RN 
                    FROM TB_PROD_BOM X
                   WHERE 1 = 1
                     AND X.CHNL_CD        = #CHNL_CD#
                     AND X.CMPO_CD        = T5.ITM_CD
                ) T1
              WHERE 1 = 1   
                    AND RN = 1
            ) T6
          WHERE 1 = 1
            AND T1.CHNL_CD        = #CHNL_CD#
            AND T1.CHNL_CD        = T2.CHNL_CD
            AND T1.CHNL_CD        = T3.CHNL_CD
            AND T1.CHNL_CD        = T4.CHNL_CD
            AND T1.CHNL_CD        = T5.CHNL_CD    
            AND T2.SCM_RLSE_NO    = T3.SCM_RLSE_NO
            AND T1.PUR_NO         = T3.SCM_PUR_NO
            AND T1.PUR_SEQ        = T3.SCM_PUR_SEQ
            AND T3.SCM_ROUT_CD IN ('IN')
            AND T2.ITM_CD         = T4.ITM_CD
            AND T3.SCM_PUR_ITM_CD = T5.ITM_CD
            AND T1.SRT_SEQ IS NOT NULL 
            AND T3.PUR_STS_CD     <![CDATA[<>]]> 'D'
		  <!--ORDER BY CONVERT(CHAR(10), T1.PROD_DLY_DT, 23)   DESC-->
        ) T1       
        WHERE T1.SRT_RN = 1
	 </select>

  <update id="M6500UpdateMst" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_LOT_DIV
        SET
          WRK_DIR_PPR_FLG   = 'Y'
        , UPD_USR_ID        = #UPD_USR_ID#
        , UPD_DT            = GETDATE()
      WHERE 1=1
        AND CHNL_CD    = #CHNL_CD#
        AND LOT_DIV_NO = #LOT_DIV_NO#
        AND LOT_DIV_SEQ = #LOT_DIV_SEQ#
   </update>


    <!-- 사출 작업지시등록  - 작지 번호 -->
	<select id="M6500SelectLotDivNo" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
		SELECT dbo.FF_PROD_WO_ANP_CRT(#CHNL_CD#, #PROD_ORD_NO# )
	</select>

    <!--사출 작업지시등록 - DTL -->
	 <select id="M6500SelectDtl" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT 
	          LOT_DIV_NO
	        , LOT_DIV_SEQ
			    , PROD_ORD_NO
			    , CONVERT(VARCHAR, PROD_PLN_DT, 23) AS PROD_PLN_DT
	        , CONVERT(VARCHAR, MAKE_ST_DT, 23) AS MAKE_ST_DT
	        , EQ_NO
	        , MOLD_CD
			    , MOLD_SEQ AS WEIH_SEQ
			    , MOLD_CD + '-' + CONVERT(VARCHAR, MOLD_SEQ) AS GBN
			    , DY_NGT_FLG
	        , (CASE WHEN DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_NM
	        , LOT_DIV_QTY
	        , LOT_DIV_RMK AS MM_RMK
			    , CHNL_CD
			    , #PROD_QTY# AS PROD_QTY
        FROM TB_PROD_LOT_DIV
		      WHERE 1=1 
		        AND CHNL_CD     = #CHNL_CD#
		        AND PROD_ORD_NO = #PROD_ORD_NO# 
		      ORDER BY CONVERT(CHAR(10), PROD_PLN_DT, 23)   DESC
	 </select>
	  
	 <insert id="M6500InsertDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_LOT_DIV
            ( 
               CHNL_CD
             , PROD_ORD_NO    
             , PROD_PLN_DT    
             , LOT_DIV_NO     
             , LOT_DIV_SEQ    
             , MAKE_ST_DT     
             , ITM_CD
			       , ROUT_ITM_CD
             , EQ_NO
             , MOLD_CD
			       , MOLD_SEQ
             , LOT_DIV_QTY    
             , DY_NGT_FLG     
             , CRE_USR_ID
             , CRE_DT
             , UPD_USR_ID
             , UPD_DT
			       , LOT_DIV_RMK
			       , PCK_FLG
			       , ORD_NO
			       , ORD_SEQ
            )
            VALUES (
               #CHNL_CD#
             , #PROD_ORD_NO#  
             , #PROD_PLN_DT#  
             <!--, dbo.FF_PROD_WO_ANP_CRT(#CHNL_CD#, #PROD_ORD_NO# )-->    
		         , #LOT_DIV_NO#
             , '1' 
             , #MAKE_ST_DT#   
             , #ITM_CD#
			       , #ITM_CD#
             , #EQ_NO#
             , #MOLD_CD#
			       , #WEIH_SEQ#
             , #LOT_DIV_QTY#  
             , #DY_NGT_FLG#   
             , #CRE_USR_ID#
             , GETDATE()
             , #UPD_USR_ID#
             , GETDATE()
			       , #MM_RMK#
			       , #PCK_FLG#
			       , #SL_ORD_NO#
			       , #SL_ORD_SEQ#
            )
	 </insert>
	  
	 <update id="M6500UpdateDtl" parameterClass="ModelsLibrary.Man.ManVo">
		 UPDATE TB_PROD_LOT_DIV
           SET MAKE_ST_DT   = #MAKE_ST_DT#
             , EQ_NO        = #EQ_NO#
             , MOLD_CD      = #MOLD_CD#
             , MOLD_SEQ     = #WEIH_SEQ#
             , DY_NGT_FLG   = #DY_NGT_FLG#
             , LOT_DIV_QTY  = #LOT_DIV_QTY#
             , UPD_USR_ID   = #UPD_USR_ID#
             , UPD_DT       = GETDATE()
			       , LOT_DIV_RMK  = #MM_RMK#
         WHERE 1 = 1
           AND CHNL_CD        = #CHNL_CD#
           AND LOT_DIV_NO     = #LOT_DIV_NO#
	 </update>

	 <delete id="M6500DeleteDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_LOT_DIV
		    WHERE 1 = 1
		        AND CHNL_CD     = #CHNL_CD#
		        AND LOT_DIV_NO  = #LOT_DIV_NO#
				AND LOT_DIV_SEQ     = #LOT_DIV_SEQ#
	 </delete>
	  
	  <!-- 작지 실적 생성-->
	 <insert id="M6500InsertDtlNew" parameterClass="ModelsLibrary.Man.ManVo">
		 INSERT INTO TB_PROD_JB_ORD 
		 (
		       CHNL_CD
		     , LOT_DIV_NO
		     , LOT_DIV_SEQ
		     , ROUT_CD
		     , PROD_EQ_NO
		     , MOLD_CD
		     , MOLD_NO
		     , MOLD_SEQ
		     , DY_NGT_FLG
		     , CRE_USR_ID
		     , CRE_DT
		     , UPD_USR_ID
		     , UPD_DT
		 )
		 SELECT 
		       CHNL_CD
		     , LOT_DIV_NO
		     , LOT_DIV_SEQ
		     , PCK_FLG
		     , EQ_NO
		     , MOLD_CD
         , MOLD_CD
		     , MOLD_SEQ
		     , DY_NGT_FLG
		     , #CRE_USR_ID#
		     , GETDATE()
		     , #UPD_USR_ID#
		     , GETDATE()
		 FROM TB_PROD_LOT_DIV
		    WHERE 1 = 1
		        AND CHNL_CD = #CHNL_CD#
		        AND LOT_DIV_NO = #LOT_DIV_NO#
	 </insert>
	  
	 <!-- 투입 자재-->
	 <insert id="M6500InsertDtlItm" parameterClass="ModelsLibrary.Man.ManVo">
		INSERT INTO TB_PROD_JB_ITM
        ( CHNL_CD
        , LOT_DIV_NO
        , ROUT_CD
        , ITM_CD
        , ACT_QTY
        , LSS_RT
        , TTL_QTY
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , SRT_SEQ
        , INP_QTY
        )
        SELECT T1.CHNL_CD      
             , T1.LOT_DIV_NO
             , T1.PCK_FLG
             , T4.MTRL_CD
             , T1.LOT_DIV_QTY
             , T4.INP_QTY
             , T1.LOT_DIV_QTY * T4.INP_QTY  
             , #CRE_USR_ID#
             , GETDATE()
             , #UPD_USR_ID#
             , GETDATE()
             , T4.ASSY_SEQ
             , T4.INP_QTY
          FROM TB_PROD_LOT_DIV  T1
             , TB_SCM_PUR       T2
             , TB_SCM_ORD_RLSE  T3
             , TB_PROD_BOM      T4          
			       , TB_CD_ITM        T5
         WHERE 1 = 1   
           AND T1.CHNL_CD     = #CHNL_CD#   
           AND T1.CHNL_CD     = T2.CHNL_CD
           AND T1.CHNL_CD     = T3.CHNL_CD   
           AND T1.CHNL_CD     = T4.CHNL_CD      
           AND T1.ORD_NO      = T2.SCM_PUR_NO 
           AND T1.ORD_SEQ     = T2.SCM_PUR_SEQ   
           AND T2.SCM_RLSE_NO = T3.SCM_RLSE_NO
           AND T3.ITM_CD      = T4.ROUT_ITM_CD
           AND T1.ITM_CD      = T4.CMPO_CD
		       AND T1.CHNL_CD     = T5.CHNL_CD           
           AND T4.MTRL_CD     = T5.ITM_CD
           AND T1.LOT_DIV_NO  = #LOT_DIV_NO#
	 </insert>


	  <select id="M6500SelectReport" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		    SELECT T1.ITM_CD
			      , T3.ITM_NM
			      , T3.ITM_SZ_NM
			      , T3.UOM_NM
			      , T1.LOT_DIV_QTY
			      , ROW_NUMBER() OVER (ORDER BY T2.SRT_SEQ) AS RN
			      , T2.CMPO_CD
			      , T2.CMPO_NM
			      , T2.ITM_SZ_NM AS  MM_01
			      , T2.UOM_NM    AS MM_02
			      , T2.SL_ITM_QTY AS SL_ITM_QTY
			      , T1.ORD_NO       AS SL_ORD_NO
			      , T1.ORD_SEQ      AS SL_ORD_SEQ
			      , T1.LOT_DIV_QTY  AS SL_PLN_QTY
			      , 'Y' AS GBN
			      , CONVERT(VARCHAR, GETDATE(), 23) AS UPD_DT
			      , T1.LOT_DIV_NO
			      , T1.LOT_DIV_RMK  AS MM_RMK
			  FROM TB_PROD_LOT_DIV T1
			    OUTER APPLY (
			          SELECT Z.ITM_CD    AS CMPO_CD
			              , Z.ITM_NM    AS CMPO_NM
			              , Z.ITM_SZ_NM
			              , Z.UOM_NM
			              , X.TTL_QTY  AS SL_ITM_QTY
			              , X.SRT_SEQ
			          FROM TB_PROD_JB_ITM  X
			            , MV_TB_CD_ITM    Z
			          WHERE 1 = 1
			              AND X.CHNL_CD     = #CHNL_CD#
			              AND X.CHNL_CD     = Z.CHNL_CD
			              AND X.ITM_CD      = Z.ITM_CD
			              AND X.LOT_DIV_NO  = #LOT_DIV_NO#
			  ) T2
			  , MV_TB_CD_ITM    T3
			  WHERE 1 = 1
			    AND T1.CHNL_CD = #CHNL_CD#
			    AND T1.CHNL_CD = T3.CHNL_CD
			    AND T1.ITM_CD  = T3.ITM_CD
			    AND T1.LOT_DIV_NO = #LOT_DIV_NO#
		  </select>


    
      <!-- 조립 작업지시등록 - MST -->
	 <select id="M6511SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
         SELECT   
             T1.WEIH_SEQ
            ,T1.ROUT_SEQ
            ,T1.WRK_DT
            ,T1.EQ_NO
            ,T1.DUE_DT
            ,T1.ITM_NM
            ,T1.ITM_SZ_NM
            ,T1.ITM_CD
            ,T1.CMPO_CD
            ,T1.CMPO_NM
            ,T1.N2ND_ITM_GRP_NM
            ,T1.SL_PLN_QTY
            ,T1.PROD_QTY
            ,T1.PROD_BSE_MOLD_NO
            ,T1.PROD_ORD_NO
            ,T1.ASSY_ITM_CD
            ,T1.WKY_YRMON
            ,T1.WK
            ,T1.CHNL_CD
            ,T1.SL_ORD_NO
            ,T1.SL_ORD_SEQ
            ,T1.PCK_FLG
            ,T1.RN
            ,T1.MOLD_CD
            ,T1.GBN
      FROM (
             SELECT 
               ROW_NUMBER() OVER (PARTITION BY T1.PROD_EQ_NO ORDER BY T1.PROD_EQ_NO, T1.SRT_SEQ) AS SRT_RN 
              , T1.SRT_SEQ               AS ROUT_SEQ
              , CONVERT(VARCHAR, T1.PROD_DLY_DT, 23)  AS WRK_DT
              , T1.PROD_EQ_NO           AS EQ_NO
              , CONVERT(VARCHAR, T3.SCM_RLSE_ESTM_DT, 23)  AS DUE_DT
              , T4.ITM_NM  
              , T4.ITM_SZ_NM
              , T3.SCM_PUR_ITM_CD   AS ITM_CD 
              , T1.PROD_CMPO_CD     AS CMPO_CD
              , T5.ITM_NM           AS CMPO_NM          
              , T5.N2ND_ITM_GRP_NM  AS N2ND_ITM_GRP_NM        
              , T3.SCM_PUR_ITM_QTY  AS SL_PLN_QTY
              , T1.PROD_QTY         AS PROD_QTY  
              , T1.PROD_BSE_MOLD_NO AS PROD_BSE_MOLD_NO
              , T1.PROD_WKY_PLN_NO  AS PROD_ORD_NO  
              , T1.PROD_CMPO_CD     AS ASSY_ITM_CD
              , T1.PROD_YRMON       AS WKY_YRMON
              , T1.PROD_WK          AS WK
              , T1.CHNL_CD      
			        , T3.SCM_PUR_NO       AS SL_ORD_NO
			        , T3.SCM_PUR_SEQ      AS SL_ORD_SEQ
			        , T3.SCM_ROUT_CD      AS PCK_FLG
			        , (SELECT COUNT(*) AS RN  FROM  TB_PROD_LOT_DIV AS X WHERE 1=1 AND X.CHNL_CD = T1.CHNL_CD AND X.PROD_ORD_NO = T1.PROD_WKY_PLN_NO) AS RN
              , T6.MOLD_CD
              , T6.MOLD_SEQ         AS WEIH_SEQ
              , T6.MOLD_CD + '-' + CONVERT(VARCHAR, T6.MOLD_SEQ) AS GBN
           FROM TB_PROD_WKY_PLN    T1
              , TB_SCM_ORD_RLSE    T2
              , TB_SCM_PUR         T3
              , TB_CD_ITM          T4
              , MV_TB_CD_ITM       T5
            OUTER APPLY
            (
              SELECT T1.MOLD_CD
                     , T1.MOLD_SEQ
                FROM(
                    SELECT X.MOLD_CD
                       , X.MOLD_SEQ                  
                       , ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY X.MOLD_CD, X.MOLD_SEQ) AS RN 
                    FROM TB_PROD_BOM X
                   WHERE 1 = 1
                     AND X.CHNL_CD        = #CHNL_CD#
                     AND X.CMPO_CD        = T5.ITM_CD
                ) T1
              WHERE 1 = 1   
                    AND RN = 1
            ) T6
          WHERE 1 = 1
            AND T1.CHNL_CD        = #CHNL_CD#
            AND T1.CHNL_CD        = T2.CHNL_CD
            AND T1.CHNL_CD        = T3.CHNL_CD
            AND T1.CHNL_CD        = T4.CHNL_CD
            AND T1.CHNL_CD        = T5.CHNL_CD    
            AND T2.SCM_RLSE_NO    = T3.SCM_RLSE_NO
            AND T1.PUR_NO         = T3.SCM_PUR_NO
            AND T1.PUR_SEQ        = T3.SCM_PUR_SEQ
            AND T3.SCM_ROUT_CD IN ('SA', 'TA')
            AND T2.ITM_CD         = T4.ITM_CD
            AND T3.SCM_PUR_ITM_CD = T5.ITM_CD
            AND T1.SRT_SEQ IS NOT NULL 
            AND T3.PUR_STS_CD     <![CDATA[<>]]> 'D'
	    	<!--ORDER BY CONVERT(CHAR(10), T1.PROD_DLY_DT, 23)   DESC-->
        )T1
         WHERE T1.SRT_RN = 1
   </select>
    
    <update id="M6511UpdateMst" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_LOT_DIV
        SET
            WRK_DIR_PPR_FLG   = 'Y'
          , UPD_USR_ID        = #UPD_USR_ID#
          , UPD_DT            = GETDATE()
      WHERE 1=1
          AND CHNL_CD    = #CHNL_CD#
          AND LOT_DIV_NO = #LOT_DIV_NO#
          AND LOT_DIV_SEQ = '1'
    </update>


    <!--조립 작업지시등록 - DTL -->
	 <select id="M6511SelectDtl" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT 
	          LOT_DIV_NO
	        , LOT_DIV_SEQ
			    , PROD_ORD_NO
			    , CONVERT(VARCHAR, PROD_PLN_DT, 23) AS PROD_PLN_DT
	        , CONVERT(VARCHAR, MAKE_ST_DT, 23) AS MAKE_ST_DT
	        , EQ_NO
	        , MOLD_CD
			    , MOLD_SEQ AS WEIH_SEQ
			    , MOLD_CD + '-' + CONVERT(VARCHAR, MOLD_SEQ) AS GBN
			    , DY_NGT_FLG
	        , (CASE WHEN DY_NGT_FLG = 'N' THEN '야간' ELSE '주간' END) AS DY_NGT_NM
	        , LOT_DIV_QTY
	        , LOT_DIV_RMK AS MM_RMK
			    , CHNL_CD
			    , #PROD_QTY# AS PROD_QTY
        FROM TB_PROD_LOT_DIV
		      WHERE 1=1 
		        AND CHNL_CD     = #CHNL_CD#
		        AND PROD_ORD_NO = #PROD_ORD_NO# 
		  ORDER BY CONVERT(CHAR(10), PROD_PLN_DT, 23)   DESC
	 </select>
    
    <!-- 조립 작업지시등록  - 작지 번호 -->
    <select id="M6511SelectLotDivNo" resultClass="string" parameterClass="ModelsLibrary.Man.ManVo">
      SELECT dbo.FF_PROD_WO_ANP_CRT(#CHNL_CD#, #PROD_ORD_NO# )
    </select>
    
    <insert id="M6511InsertDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  INSERT INTO TB_PROD_LOT_DIV
            ( 
               CHNL_CD
             , PROD_ORD_NO    
             , PROD_PLN_DT    
             , LOT_DIV_NO     
             , LOT_DIV_SEQ    
             , MAKE_ST_DT     
			       , ROUT_ITM_CD
             , ITM_CD
             , EQ_NO
             <!--, MOLD_CD
			       , MOLD_SEQ-->
             , LOT_DIV_QTY    
             , DY_NGT_FLG     
             , CRE_USR_ID
             , CRE_DT
             , UPD_USR_ID
             , UPD_DT
			       , LOT_DIV_RMK
			       , PCK_FLG
			       , ORD_NO
			       , ORD_SEQ
            )
            VALUES (
               #CHNL_CD#
             , #PROD_ORD_NO#  
             <!--, #PROD_PLN_DT#-->
             , GETDATE()
             <!--, dbo.FF_PROD_WO_ANP_CRT(#CHNL_CD#, #PROD_ORD_NO# )-->    
		         , #LOT_DIV_NO#
             , '1' 
             , #MAKE_ST_DT#   
             , #CMPO_CD#
			       , #ITM_CD#
             , #EQ_NO#
             <!--, #MOLD_CD#
			       , #WEIH_SEQ#-->
             , #LOT_DIV_QTY#  
             , #DY_NGT_FLG#   
             , #CRE_USR_ID#
             , GETDATE()
             , #UPD_USR_ID#
             , GETDATE()
			       , #MM_RMK#
			       , #PCK_FLG#
			       , #SL_ORD_NO#
			       , #SL_ORD_SEQ#
            )
	 </insert>
    
	 <update id="M6511UpdateDtl" parameterClass="ModelsLibrary.Man.ManVo">
		 UPDATE TB_PROD_LOT_DIV
           SET MAKE_ST_DT   = #MAKE_ST_DT#
             <!--, EQ_NO        = #EQ_NO#
             , MOLD_CD      = #MOLD_CD#
             , MOLD_SEQ      = #WEIH_SEQ#-->
             , DY_NGT_FLG   = #DY_NGT_FLG#
             , LOT_DIV_QTY  = #LOT_DIV_QTY#
             , UPD_USR_ID   = #UPD_USR_ID#
             , UPD_DT       = GETDATE()
			       , LOT_DIV_RMK  = #MM_RMK#
         WHERE 1 = 1
           AND CHNL_CD        = #CHNL_CD#
           AND LOT_DIV_NO     = #LOT_DIV_NO#
	 </update>

	 <delete id="M6511DeleteDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_PROD_LOT_DIV
		    WHERE 1 = 1
		        AND CHNL_CD    = #CHNL_CD#
		        AND LOT_DIV_NO = #LOT_DIV_NO#
				    AND LOT_DIV_SEQ = '1'
	 </delete>
    
     <!-- 작지 실적 생성-->
	 <insert id="M6511InsertDtlNew" parameterClass="ModelsLibrary.Man.ManVo">
		 INSERT INTO TB_PROD_JB_ORD 
		 (
		       CHNL_CD
		     , LOT_DIV_NO
		     , LOT_DIV_SEQ
		     , ROUT_CD
		     , PROD_EQ_NO
		     , MOLD_NO
		     , MOLD_SEQ
		     , DY_NGT_FLG
		     , CRE_USR_ID
		     , CRE_DT
		     , UPD_USR_ID
		     , UPD_DT
		 )
		 SELECT 
		       CHNL_CD
		     , LOT_DIV_NO
		     , LOT_DIV_SEQ
		     , PCK_FLG
		     , EQ_NO
		     , MOLD_CD
		     , MOLD_SEQ
		     , DY_NGT_FLG
		     , #CRE_USR_ID#
		     , GETDATE()
		     , #UPD_USR_ID#
		     , GETDATE()
		 FROM TB_PROD_LOT_DIV
		    WHERE 1 = 1
		        AND CHNL_CD = #CHNL_CD#
		        AND LOT_DIV_NO = #LOT_DIV_NO#
	 </insert>
	  
	 <!-- 투입 자재-->
	 <insert id="M6511InsertDtlItm" parameterClass="ModelsLibrary.Man.ManVo">
		INSERT INTO TB_PROD_JB_ITM
        ( CHNL_CD
        , LOT_DIV_NO
        , ROUT_CD
        , ITM_CD
        , ACT_QTY
        , LSS_RT
        , TTL_QTY
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT
        , SRT_SEQ
        , INP_QTY
        )
        <!--SELECT T1.CHNL_CD      
             , T1.LOT_DIV_NO
             , T1.PCK_FLG
             , T4.MTRL_CD
             , T1.LOT_DIV_QTY
             , T4.INP_QTY
             , T1.LOT_DIV_QTY * T4.INP_QTY  
             , #CRE_USR_ID#
             , GETDATE()
             , #UPD_USR_ID#
             , GETDATE()
             , T4.ASSY_SEQ
             , T4.INP_QTY
          FROM TB_PROD_LOT_DIV  T1
             , TB_SCM_PUR       T2
             , TB_SCM_ORD_RLSE  T3
             , TB_PROD_BOM      T4          
			 , TB_CD_ITM        T5
         WHERE 1 = 1   
           AND T1.CHNL_CD     = #CHNL_CD#   
           AND T1.CHNL_CD     = T2.CHNL_CD
           AND T1.CHNL_CD     = T3.CHNL_CD   
           AND T1.CHNL_CD     = T4.CHNL_CD      
           AND T1.ORD_NO      = T2.SCM_PUR_NO 
           AND T1.ORD_SEQ     = T2.SCM_PUR_SEQ   
           AND T2.SCM_RLSE_NO = T3.SCM_RLSE_NO
           AND T3.ITM_CD      = T4.ROUT_ITM_CD
           AND T1.ITM_CD      = T4.CMPO_CD
		   AND T1.CHNL_CD     = T5.CHNL_CD           
           AND T4.MTRL_CD     = T5.ITM_CD
           AND T1.LOT_DIV_NO  = #LOT_DIV_NO#-->
     
          SELECT T1.CHNL_CD
               , T1.LOT_DIV_NO
               , T2.ROUT_CD
               , T2.CMPO_CD
               , T2.SL_ITM_QTY
               , 0 
               , SL_ITM_QTY
               , #CRE_USR_ID#
               , GETDATE()
               , #UPD_USR_ID#
               , GETDATE()
               , T2.SRT_SEQ
               , T2.INP_QTY                
           FROM TB_PROD_LOT_DIV T1
             OUTER APPLY (
                SELECT Z.ITM_CD    AS CMPO_CD
                     , Z.ITM_NM    AS CMPO_NM
                     , Z.ITM_SZ_NM
                     , Z.UOM_NM     
                     , T1.LOT_DIV_QTY * X.INP_QTY  AS SL_ITM_QTY 
                     , X.BOM_SEQ  AS SRT_SEQ
                     , X.ROUT_CD
                     , X.INP_QTY
                  FROM dbo.ufnGetBomChild(#CHNL_CD#, #ITM_CD#, #CMPO_CD#)  X
                     , MV_TB_CD_ITM    Z
                 WHERE 1 = 1
                   AND Z.CHNL_CD     = #CHNL_CD#
                   AND X.CMPO_CD      = Z.ITM_CD
           ) T2
           , MV_TB_CD_ITM    T3
           WHERE 1 = 1
             AND T1.CHNL_CD = #CHNL_CD#
             AND T1.CHNL_CD = T3.CHNL_CD
             AND T1.ITM_CD  = T3.ITM_CD
             AND T1.LOT_DIV_NO = #LOT_DIV_NO#
	 </insert>


	  <select id="M6511SelectReport" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		    SELECT T1.ITM_CD
			      , T3.ITM_NM
			      , T3.ITM_SZ_NM
			      , T3.UOM_NM
			      , T1.LOT_DIV_QTY
			      , ROW_NUMBER() OVER (ORDER BY T2.SRT_SEQ) AS RN
			      , T2.CMPO_CD
			      , T2.CMPO_NM
			      , T2.ITM_SZ_NM AS  MM_01
			      , T2.UOM_NM    AS MM_02
			      , T2.SL_ITM_QTY AS SL_ITM_QTY
			      , T1.ORD_NO       AS SL_ORD_NO
			      , T1.ORD_SEQ      AS SL_ORD_SEQ
			      , T1.LOT_DIV_QTY  AS SL_PLN_QTY
			      , 'Y' AS GBN
			      , CONVERT(VARCHAR, GETDATE(), 23) AS UPD_DT
			      , T1.LOT_DIV_NO
			      , T1.LOT_DIV_RMK  AS MM_RMK
			  FROM TB_PROD_LOT_DIV T1
			    OUTER APPLY (
			          SELECT Z.ITM_CD    AS CMPO_CD
			              , Z.ITM_NM    AS CMPO_NM
			              , Z.ITM_SZ_NM
			              , Z.UOM_NM
			              , X.TTL_QTY  AS SL_ITM_QTY
			              , X.SRT_SEQ
			          FROM TB_PROD_JB_ITM  X
			            , MV_TB_CD_ITM    Z
			          WHERE 1 = 1
			              AND X.CHNL_CD     = #CHNL_CD#
			              AND X.CHNL_CD     = Z.CHNL_CD
			              AND X.ITM_CD      = Z.ITM_CD
			              AND X.LOT_DIV_NO  = #LOT_DIV_NO#
			  ) T2
			  , MV_TB_CD_ITM    T3
			  WHERE 1 = 1
			    AND T1.CHNL_CD = #CHNL_CD#
			    AND T1.CHNL_CD = T3.CHNL_CD
			    AND T1.ITM_CD  = T3.ITM_CD
			    AND T1.LOT_DIV_NO = #LOT_DIV_NO#
		  </select>


    <!-- 사출 생산현황-->
    <select id="M6720SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T2.ROUT_END_DT, T2.PROD_EQ_NO ,  T2.DY_NGT_FLG) AS RN 
           , CONVERT(VARCHAR,T2.ROUT_END_DT,23) AS MAKE_END_DT    
           , T2.ROUT_CD
           , T10.ROUT_NM                    AS ROUT_NM
           , T2.PROD_EQ_NO                  AS EQ_NO   
           , CASE WHEN T2.DY_NGT_FLG = 'D' THEN '주간' ELSE '야간' END AS   DY_NGT_NM  
           , T2.MOLD_CD     
           , T3.ITM_NM                          
           , T5.ITM_SZ_NM        
           , T7.IDLE_MNT       
           , (CASE WHEN T2.ROUT_ST_DT IS NULL OR T2.ROUT_END_DT IS NULL  THEN '비가동' ELSE '가동' END ) AS WRK_FLG  
           , T2.PROD_GD_QTY AS PROD_GD_QTY
           , T2.PROD_GD_QTY + T9.BAD_QTY AS PROD_QTY   
           <!--, T2.PROD_QTY         AS PROD_QTY-->             
           <!--, T2.PROD_QTY - T9.BAD_QTY AS PROD_GD_QTY-->    
           , T9.BAD_QTY               AS BAD_QTY
           , CASE WHEN (T2.PROD_QTY) = 0 THEN 0 ELSE ROUND(T2.PROD_QTY - T9.BAD_QTY / (T2.PROD_QTY) * 100, 1) END AS GD_RT    
           , CASE WHEN (T2.PROD_QTY) = 0 THEN 0 ELSE ROUND(T9.BAD_QTY / (T2.PROD_QTY) * 100, 1) END AS BAD_RT                
           , BAD_01_QTY  
           , BAD_02_QTY  
           , BAD_03_QTY  
           , BAD_04_QTY  
           , BAD_05_QTY  
           , BAD_06_QTY  
           , BAD_07_QTY  
           , BAD_08_QTY  
           , BAD_09_QTY  
           , T1.LOT_DIV_RMK  AS MM_RMK
        FROM TB_PROD_LOT_DIV  T1
           , TB_PROD_JB_ORD   T2 
           OUTER APPLY(
              SELECT MAX(ISNULL(Z.ITM_NM, '') + '  ' + ISNULL(Z.N1ST_ITM_GRP_NM, '')) AS ITM_SZ_NM
                FROM TB_PROD_JB_ITM X
                   , MV_TB_CD_ITM   Z
               WHERE 1 = 1
                 AND X.CHNL_CD      = #CHNL_CD#     
                 AND X.CHNL_CD      = Z.CHNL_CD
                 AND X.LOT_DIV_NO   = T2.LOT_DIV_NO
                 AND X.LOT_DIV_SEQ  = T2.LOT_DIV_SEQ
                 AND X.ITM_CD       = Z.ITM_CD
           ) T5
           OUTER APPLY (
              SELECT X.MOLD_CAPA_QTY
                   , X.CYC_TIME
                FROM TB_PROD_MOLD_CD X
                 WHERE 1 = 1
                   AND X.CHNL_CD      = #CHNL_CD#   
                   AND X.MOLD_NO      = T2.MOLD_CD
                   AND X.MOLD_SEQ     = T2.MOLD_SEQ
           ) T6
           OUTER APPLY (
              SELECT ISNULL(SUM(CAST(X.IDLE_MNT AS FLOAT)), 0) AS IDLE_MNT 
              FROM TB_PROD_CD_IDLE X
               WHERE 1 = 1
                 AND X.CHNL_CD      = #CHNL_CD#                    
                 AND X.LOT_DIV_NO   = T2.LOT_DIV_NO
                 AND X.LOT_DIV_SEQ  = T2.LOT_DIV_SEQ
           ) T7
           OUTER APPLY (
            SELECT ISNULL(SUM(CASE WHEN X.BAD_CD IN ('7') THEN X.BAD_QTY END), 0)         AS BAD_01_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('21') THEN X.BAD_QTY END), 0)        AS BAD_02_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('23') THEN X.BAD_QTY END), 0)        AS BAD_03_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('10', '11') THEN X.BAD_QTY END), 0)  AS BAD_04_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('9') THEN X.BAD_QTY END), 0)         AS BAD_05_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('4') THEN X.BAD_QTY END), 0)         AS BAD_06_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('5') THEN X.BAD_QTY END), 0)         AS BAD_07_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('6', '8') THEN X.BAD_QTY END), 0)    AS BAD_08_QTY
                 , ISNULL(SUM(CASE WHEN X.BAD_CD IN ('2') THEN X.BAD_QTY END), 0)         AS BAD_09_QTY
                 , ISNULL(SUM(X.BAD_QTY), 0) AS BAD_QTY
              FROM TB_PROD_CD_BAD X
               WHERE 1 = 1
                 AND X.CHNL_CD      = #CHNL_CD#                 
                 AND X.LOT_DIV_NO   = T2.LOT_DIV_NO
                 AND X.LOT_DIV_SEQ  = T2.LOT_DIV_SEQ
           ) T9     
           OUTER APPLY(  
            SELECT X.ROUT_CD      AS ROUT_CD
                  ,X.ROUT_NM      AS ROUT_NM
              FROM TB_PROD_ROUT X
             WHERE 1 = 1 
               AND X.CHNL_CD = #CHNL_CD#
               AND X.ROUT_CD = T2.ROUT_CD
           )T10          
           , MV_TB_CD_ITM     T3
           <!--, TB_CD_CAR_TP     T4-->
       WHERE 1 = 1
         AND T1.CHNL_CD       = #CHNL_CD#   
         AND T1.CHNL_CD       = T2.CHNL_CD
         AND T1.CHNL_CD       = T3.CHNL_CD   
         <!--AND T1.CHNL_CD       = T4.CHNL_CD-->      
         AND T1.LOT_DIV_NO    = T2.LOT_DIV_NO
         <!--AND T1.LOT_DIV_SEQ   = T2.LOT_DIV_SEQ-->
         AND T1.ITM_CD        = T3.ITM_CD
         <!--AND T3.MTRL_NM_CD    = T4.CAR_TP_CD-->
         AND T2.ROUT_END_DT  >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
         AND T2.ROUT_END_DT  <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
	<isNotNull property="ROUT_CD" >
	     AND T2.ROUT_CD = #ROUT_CD#
	</isNotNull>


	</select>




    <!-- 충전 일일생산 계획-->
    <select id="M66521SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT
             T3.EQ_NO
           , T3.INP_STAFF_VAL
           , T4.SL_ORD_NO
           , T4.SL_ORD_SEQ
           , T3.PROD_ORD_NO
           , T4.ITM_CD
           , T4.ITM_NM
           , T4.ITM_SZ_NM
           , T4.SO_DT
           , T4.DUE_DT
           , T4.TR_CD AS CO_NO
           , dbo.CD_COMPANY_NM_FNC(T3.CHNL_CD, T4.TR_CD) AS CO_NM  
           , T4.SL_ITM_QTY
          <!-- 계획 -->
           , T3.AM  AS PROD_PLN_QTY_A
           , T3.PM  AS PROD_PLN_QTY_B
           , T3.EX  AS PROD_PLN_QTY_C
           , (ISNULL(T3.AM, 0) + ISNULL(T3.PM,0) + ISNULL(T3.EX,0)) AS LOT_DIV_QTY
          <!-- 실적 -->
           , T3.W_AM AS N1ST_PLN_QTY
           , T3.W_PM AS N2ND_PLN_QTY
           , T3.W_EX AS N3RD_PLN_QTY
           , (ISNULL(T3.W_AM,0) + ISNULL(T3.W_PM,0) + ISNULL(T3.W_EX,0)) AS N6TH_PLN_QTY
           , CASE WHEN (ISNULL(T3.AM, 0) + ISNULL(T3.PM, 0) + ISNULL(T3.EX,0)) = 0 THEN 0 ELSE ((ISNULL(T3.W_AM,0) + ISNULL(T3.W_PM,0) + ISNULL(T3.W_EX,0)) / (ISNULL(T3.AM,0) + ISNULL(T3.PM,0) + ISNULL(T3.EX,0))) END AS N7TH_PLN_QTY 
           , T3.LOT_DIV_RMK  AS MM_01
           , T3.N2ND_ROUT_RMK AS MM_02
           , T3.CHNL_CD
           , CONVERT(VARCHAR, PROD_PLN_DT, 23) AS  PROD_PLN_DT
           , T3.MAKE_DT
           FROM   
              (
			        SELECT
				            X2.EQ_NO
			            , X2.INP_STAFF_VAL
			            , X2.PROD_ORD_NO
			            , X1.ORD_NO
			            , X1.ORD_SEQ
			            , X1.ITM_CD   
			            , MAX(CASE WHEN X1.DY_NGT_FLG ='A' THEN X1.LOT_DIV_QTY END) AS AM
			            , MAX(CASE WHEN X1.DY_NGT_FLG ='B' THEN X1.LOT_DIV_QTY END) AS PM
			            , MAX(CASE WHEN X1.DY_NGT_FLG ='C' THEN X1.LOT_DIV_QTY END) AS EX  
			            , MAX(CASE WHEN X2.PROD_ORD_SEQ ='1' THEN ITM_QTY END) AS W_AM
			            , MAX(CASE WHEN X2.PROD_ORD_SEQ ='2' THEN ITM_QTY END) AS W_PM
			            , MAX(CASE WHEN X2.PROD_ORD_SEQ ='3' THEN ITM_QTY END) AS W_EX    
			            , X1.LOT_DIV_RMK
			            , X2.N2ND_ROUT_RMK
			            , X1.CHNL_CD
			            , MAX(X1.PROD_PLN_DT) AS PROD_PLN_DT
                  , CONVERT(VARCHAR, X2.MAKE_DT, 23) AS MAKE_DT
			          FROM TB_PROD_LOT_DIV X1
				         LEFT JOIN TB_FPRF_N2ND_STEP_ROUT X2 ON X2.PROD_ORD_NO = X1.LOT_DIV_NO AND X2.CHNL_CD = X1.CHNL_CD
			          WHERE 1=1
				          AND X1.CHNL_CD      = #CHNL_CD#
				          AND X1.LOT_DIV_NO   = X2.PROD_ORD_NO    
				          AND X1.LOT_DIV_SEQ  = X2.PROD_ORD_SEQ    
				          AND X1.PCK_FLG      = 'C'
                  AND X1.PROD_PLN_DT >= CAST (#FM_DT# + ' 00:00:00' AS DATETIME)
                  AND X1.PROD_PLN_DT <![CDATA[<=]]>  CAST (#TO_DT# + ' 23:59:59' AS DATETIME)
			          GROUP BY X1.ITM_CD, X1.ORD_NO, X1.ORD_SEQ, X2.EQ_NO,X2.ITM_QTY, X1.CHNL_CD, X2.PROD_ORD_NO, X1.LOT_DIV_RMK, X2.INP_STAFF_VAL, N2ND_ROUT_RMK, MAKE_DT
                 )  AS T3 LEFT OUTER JOIN 
                          (
										        SELECT    
											           T1.SO_NB        AS SL_ORD_NO
											         , T2.SO_SQ        AS SL_ORD_SEQ
											         , T2.ITEM_CD      AS ITM_CD
											         , T4.ITM_NM
											         , T4.ITM_SZ_NM     AS ITM_SZ_NM
											         , T1.TR_CD
											         , CONVERT(VARCHAR, CAST(T1.SO_DT  AS   DATETIME), 23) AS SO_DT  
											         , ISNULL(CONVERT(VARCHAR, CAST(T2.DUE_DT AS   DATETIME), 23), '') AS DUE_DT  
											         , T2.SO_QT        AS SL_ITM_QTY
										         FROM DZICUBE.dbo.LSO    T1 , DZICUBE.dbo.LSO_D  T2 LEFT OUTER JOIN TB_CD_ITM  T4  ON ( T2.ITEM_CD = T4.ITM_CD   AND T4.CHNL_CD =  #CHNL_CD#)
										           WHERE 1 = 1
											         AND T1.CO_CD      = T2.CO_CD
											         AND T1.SO_NB      = T2.SO_NB
                          ) AS T4 ON(T3.ORD_NO = T4.SL_ORD_NO AND T3.ORD_SEQ = T4.SL_ORD_SEQ AND T3.ITM_CD = T4.ITM_CD)
    </select>


    <!-- 포장 일일생산 계획-->
    <select id="M66531SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT 
				        T4.SL_ORD_NO
              , T4.SL_ORD_SEQ
              , T4.EQ_NO
              , T4.RN
              , T4.PROD_PLN_DT
              , T4.INP_STAFF_VAL
              , T4.DUE_DT
              , T4.TR_CD AS CO_NO
              , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T4.TR_CD) AS CO_NM  
              , T4.LOT_DIV_NO
              , T4.ITM_CD
              , T4.ITM_NM
              , T4.ITM_SZ_NM
              , T4.SL_ITM_QTY
              , T4.LOT_DIV_QTY
              , T4.DY_NGT_FLG
              , T4.PROD_PLN_QTY_A 
              , T4.PROD_PLN_QTY_B
              , T4.PROD_PLN_QTY_C
              , T4.N1ST_PLN_QTY
			        , T4.N2ND_PLN_QTY
              , T4.N3RD_PLN_QTY
			        , (ISNULL(T4.N1ST_PLN_QTY,0) +  ISNULL(T4.N2ND_PLN_QTY,0) + ISNULL(T4.N3RD_PLN_QTY, 0))  AS N6TH_PLN_QTY
              , CASE WHEN (ISNULL(T4.N1ST_PLN_QTY,0) +  ISNULL(T4.N2ND_PLN_QTY,0) + ISNULL(T4.N3RD_PLN_QTY, 0)) = 0 THEN 0 ELSE ((ISNULL(T4.N1ST_PLN_QTY,0) 
                                                     +  ISNULL(T4.N2ND_PLN_QTY,0) + ISNULL(T4.N3RD_PLN_QTY, 0)) / T4.LOT_DIV_QTY)  END  AS N7TH_PLN_QTY
              , T4.MM_01
              , T4.MM_02
              , T4.MAKE_DT
        FROM 
        (
            SELECT
                      T3.SL_ORD_NO
                    , T3.SL_ORD_SEQ
                    , T1.EQ_NO
                    , ROW_NUMBER() OVER (PARTITION BY T1.EQ_NO  ORDER BY T1.LOT_DIV_NO ) AS RN
                    , CONVERT(VARCHAR, T1.PROD_PLN_DT, 23) AS PROD_PLN_DT
                    , T2.INP_STAFF_VAL
                    , CONVERT(VARCHAR, CAST(T3.DUE_DT AS DATETIME), 23)  AS DUE_DT
                    , T1.LOT_DIV_NO
                    , T3.ITM_CD
                    , T3.ITM_NM
                    , T3.ITM_SZ_NM
                    , T3.SL_ITM_QTY
                    , T1.LOT_DIV_QTY
                    , T1.DY_NGT_FLG
                    <!-- 기타-->
                    , CASE WHEN T1.DY_NGT_FLG = 'D' THEN T1.LOT_DIV_QTY END AS PROD_PLN_QTY_A 
                    <!-- 내부1-->
                    , CASE WHEN T1.DY_NGT_FLG = 'E' THEN T1.LOT_DIV_QTY END AS PROD_PLN_QTY_B
                    <!-- 내부2-->
                    , CASE WHEN T1.DY_NGT_FLG = 'F' THEN T1.LOT_DIV_QTY END AS PROD_PLN_QTY_C
                    , T2.ITM_QTY
                    <!--
                    , CASE WHEN T1.DY_NGT_FLG = 'D' THEN T2.ITM_QTY END AS N1ST_PLN_QTY
                    -->
                    , (
						          SELECT SUM(X1.ITM_QTY) AS ITM_QTY  FROM TB_FPRF_N2ND_STEP_ROUT AS X1 
							          WHERE 1=1 
								          AND X1.CHNL_CD      = #CHNL_CD#
								          AND X1.PROD_ORD_NO  =  T1.LOT_DIV_NO
								          AND NOT EXISTS ( 
                                            SELECT 'X' FROM TB_PROD_LOT_DIV AS X 
                                              WHERE 1=1 
                                                AND X.CHNL_CD = X1.CHNL_CD 
                                                AND X.LOT_DIV_NO = X1.PROD_ORD_NO 
                                                AND X.LOT_DIV_SEQ = X1.PROD_ORD_SEQ
                                          ) 
				              )  AS N1ST_PLN_QTY
                    , CASE WHEN T1.DY_NGT_FLG = 'E' THEN T2.ITM_QTY END AS N2ND_PLN_QTY
                    , CASE WHEN T1.DY_NGT_FLG = 'F' THEN T2.ITM_QTY END AS N3RD_PLN_QTY
                    , (CASE WHEN T1.DY_NGT_FLG = 'D' THEN  T2.ITM_QTY END + CASE WHEN T1.DY_NGT_FLG = 'E' THEN T2.ITM_QTY  END  +  CASE WHEN T1.DY_NGT_FLG = 'F' THEN T2.ITM_QTY  END   ) AS N6TH_PLN_QTY
                    , (T1.LOT_DIV_QTY / (CASE WHEN T1.DY_NGT_FLG = 'D' THEN T2.ITM_QTY END + CASE WHEN T1.DY_NGT_FLG = 'E' THEN T2.ITM_QTY END + CASE WHEN T1.DY_NGT_FLG = 'F' THEN T2.ITM_QTY END  )) AS N7TH_PLN_QTY
                    , T2.N2ND_ROUT_RMK  AS MM_01
                    , T1.LOT_DIV_RMK    AS MM_02
                    , T3.TR_CD
                    , CONVERT(VARCHAR, T2.MAKE_DT, 23) AS MAKE_DT
                FROM  TB_PROD_LOT_DIV T1  LEFT OUTER JOIN
                  (
                      SELECT
                            T1.SO_NB        AS SL_ORD_NO
                          , T2.SO_SQ        AS SL_ORD_SEQ
                          , T2.ITEM_CD      AS ITM_CD
                          , T4.ITM_NM
                          , T4.ITM_SZ_NM    AS ITM_SZ_NM
                          , CONVERT(VARCHAR, CAST(T1.SO_DT  AS   DATETIME), 23) AS SO_DT
                          , T2.DUE_DT       AS DUE_DT
                          , T2.SO_QT        AS SL_ITM_QTY
                          , T1.TR_CD
                      FROM DZICUBE.dbo.LSO T1,
                        DZICUBE.dbo.LSO_D T2 LEFT OUTER JOIN TB_CD_ITM  T4
                         ON (
                                  T2.ITEM_CD = T4.ITM_CD
                              AND T4.CHNL_CD = #CHNL_CD#
                            )
                        WHERE 1 = 1
                          AND T1.CO_CD = T2.CO_CD
                          AND T1.SO_NB = T2.SO_NB
                    ) AS T3  ON ( T1.ORD_NO = T3.SL_ORD_NO AND T1.ORD_SEQ = T3.SL_ORD_SEQ AND T1.ITM_CD = T3.ITM_CD)
                    , TB_FPRF_N2ND_STEP_ROUT T2
                    WHERE 1=1
                        AND T1.CHNL_CD     = #CHNL_CD#
                        AND T1.LOT_DIV_NO  = T2.PROD_ORD_NO
                        AND T1.LOT_DIV_SEQ = T2.PROD_ORD_SEQ
                        AND T1.CHNL_CD     = T2.CHNL_CD
                        AND T1.PCK_FLG = 'P'
                        AND T1.PROD_PLN_DT >= CAST (#FM_DT# + ' 00:00:00' AS DATETIME)
                        AND T1.PROD_PLN_DT <![CDATA[<=]]>  CAST (#TO_DT# + ' 23:59:59' AS DATETIME)
              ) AS T4
    </select>
    
    
   <!-- 설비 관리  -->
    <select id="M6641SelectMaster" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
      SELECT 
           ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY PROD_EQ_NO) AS RN
         , PROD_EQ_NO
         , EQ_MDL_NM
         , EQ_NM
         , EQ_SZ_NM
         , MN_MTR_CSM_CTNT
         , EQ_QTY
         , EQ_MKR_NM
         , EQ_PUR_AMT
         , EQ_PUR_YRMON
         , EQ_GRD_CD
         , BALL_STAR_AREA_CTNT
         , USG_DESC
         , EQ_LOC_CD
         , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'L-002', EQ_LOC_CD) AS EQ_LOC_NM
         , EQ_DESC
         , CHNL_CD
         , CONVERT(VARCHAR, INSP_DT, 23) AS INSP_DT
         , EQ_IMG
         , EQ_SNOR_NO
         , EQ_SNOR_IMG
         , EQ_TP_CD
         , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'L-700', EQ_TP_CD) AS EQ_TP_NM
         , CONVERT(VARCHAR, WRK_DT, 23) AS  WRK_DT 
         , CONVERT(VARCHAR, WRK_UPD_DT, 23) AS  WRK_UPD_DT  
         , CT_VAL
         , MTRL_CD   AS MTRL_ITM_CD
	       , dbo.CD_ITEM_NM_FNC( CHNL_CD, MTRL_CD) AS MTRL_ITM_NM
         , LOW_STND_LMT_CD
	       , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'L-910', LOW_STND_LMT_CD) AS LOW_STND_LMT_NM  
         , UPPR_STND_LMT_CD  
	       , dbo.CD_SYS_CLSS_FNC(CHNL_CD, 'L-910', UPPR_STND_LMT_CD) AS UPPR_STND_LMT_NM 
         , LOW_LEN_LMT_VAL  
         , UPPR_LEN_LMT_VAL 
         , LOW_CRV_LMT_CD   
         , UPPR_CRV_LMT_CD  
         , SPL_TM_VAL       
         , ROUT_TM_VAL      
         , BEND_TM_VAL      
         , N1ST_PCK_WGT     
         , N2ND_PCK_WGT     
         , PROD_HR          
         , PROD_DY          
         , PROD_REQ_CAPA_QTY 
         , DELT_FLG
        FROM TB_PROD_EQ
          WHERE CHNL_CD = #CHNL_CD#  
        <isNotNull property="PROD_EQ_NO" >
            AND PROD_EQ_NO = #PROD_EQ_NO#
        </isNotNull>
        <isNotNull property="EQ_TP_CD" >
            AND EQ_TP_CD = #EQ_TP_CD#
        </isNotNull>
    </select>

    <insert id="M6641InsertMaster" parameterClass="ModelsLibrary.Man.ManVo">
       INSERT INTO TB_PROD_EQ (
           PROD_EQ_NO
         , EQ_MDL_NM
         , EQ_NM
         , EQ_SZ_NM
         , MN_MTR_CSM_CTNT
         , EQ_QTY
         , EQ_MKR_NM
         , EQ_PUR_AMT
         , EQ_PUR_YRMON
         , EQ_GRD_CD
         , BALL_STAR_AREA_CTNT
         , USG_DESC
         , EQ_LOC_CD
         , EQ_DESC
         , CRE_USR_ID
         , CRE_DT
         , UPD_USR_ID
         , UPD_DT
         , CHNL_CD
         , INSP_DT
         , EQ_IMG
         , EQ_SNOR_NO
         , EQ_SNOR_IMG
         , EQ_TP_CD
         , WRK_DT
         , WRK_UPD_DT
         , CT_VAL
         , MTRL_CD
         , LOW_STND_LMT_CD
         , UPPR_STND_LMT_CD
         , LOW_LEN_LMT_VAL
         , UPPR_LEN_LMT_VAL
         , LOW_CRV_LMT_CD
         , UPPR_CRV_LMT_CD
         , SPL_TM_VAL
         , ROUT_TM_VAL
         , BEND_TM_VAL
         , N1ST_PCK_WGT  
         , N2ND_PCK_WGT
         , PROD_HR
         , PROD_DY
         , PROD_REQ_CAPA_QTY
         , DELT_FLG  
      ) VALUES (
          #PROD_EQ_NO#
         ,#EQ_MDL_NM#
         ,#EQ_NM#
         ,#EQ_SZ_NM#
         ,#MN_MTR_CSM_CTNT#
         ,#EQ_QTY#
         ,#EQ_MKR_NM#
         ,#EQ_PUR_AMT#
         ,#EQ_PUR_YRMON#
         ,#EQ_GRD_CD#
         ,#BALL_STAR_AREA_CTNT#
         ,#USG_DESC#
         ,#EQ_LOC_CD#
         ,#EQ_DESC#
         ,#CRE_USR_ID#
         ,GETDATE()
         ,#UPD_USR_ID#
         ,GETDATE()  
         ,#CHNL_CD#
         ,#INSP_DT#
         ,#EQ_IMG#
         ,#EQ_SNOR_NO#
         ,#EQ_SNOR_IMG#
         ,#EQ_TP_CD#
         ,#WRK_DT#
         ,#WRK_UPD_DT#
         ,#CT_VAL#
         ,#MTRL_ITM_CD#
         ,#LOW_STND_LMT_CD#
         ,#UPPR_STND_LMT_CD#
         ,#LOW_LEN_LMT_VAL#
         ,#UPPR_LEN_LMT_VAL#
         ,#LOW_CRV_LMT_CD#
         ,#UPPR_CRV_LMT_CD#
         ,#SPL_TM_VAL#
         ,#ROUT_TM_VAL#
         ,#BEND_TM_VAL#
         ,#N1ST_PCK_WGT#
         ,#N2ND_PCK_WGT#
         ,#PROD_HR#
         ,#PROD_DY#
         ,#PROD_REQ_CAPA_QTY#
         ,ISNULL(#DELT_FLG#, 'N')  
      )
    </insert>

    <update id="M6641UpdateMaster" parameterClass="ModelsLibrary.Man.ManVo">
        UPDATE TB_PROD_EQ
         SET    EQ_MDL_NM            = #EQ_MDL_NM#
              , EQ_NM                = #EQ_NM#
              , EQ_SZ_NM             = #EQ_SZ_NM#
              , MN_MTR_CSM_CTNT      = #MN_MTR_CSM_CTNT#
              , EQ_QTY               = #EQ_QTY#
              , EQ_MKR_NM            = #EQ_MKR_NM#
              , EQ_PUR_AMT           = #EQ_PUR_AMT#
              , EQ_PUR_YRMON         = #EQ_PUR_YRMON#
              , EQ_GRD_CD            = #EQ_GRD_CD#
              , BALL_STAR_AREA_CTNT  = #BALL_STAR_AREA_CTNT#
              , USG_DESC             = #USG_DESC#
              , EQ_LOC_CD            = #EQ_LOC_CD#
              , EQ_DESC              = #EQ_DESC#
              , UPD_USR_ID           = #UPD_USR_ID#
              , UPD_DT               = GETDATE()
              , INSP_DT              = #INSP_DT#
              , EQ_IMG               = #EQ_IMG#
              , EQ_SNOR_NO           = #EQ_SNOR_NO#
              , EQ_SNOR_IMG          = #EQ_SNOR_IMG#
              , EQ_TP_CD             = #EQ_TP_CD#
              , WRK_DT               = #WRK_DT#
              , WRK_UPD_DT           = #WRK_UPD_DT#
              , CT_VAL               = #CT_VAL#
              , MTRL_CD              = #MTRL_ITM_CD#
              , LOW_STND_LMT_CD      = #LOW_STND_LMT_CD#
              , UPPR_STND_LMT_CD     = #UPPR_STND_LMT_CD#
              , LOW_LEN_LMT_VAL      = #LOW_LEN_LMT_VAL#
              , UPPR_LEN_LMT_VAL     = #UPPR_LEN_LMT_VAL#
              , LOW_CRV_LMT_CD       = #LOW_CRV_LMT_CD#
              , UPPR_CRV_LMT_CD      = #UPPR_CRV_LMT_CD#
              , SPL_TM_VAL           = #SPL_TM_VAL#
              , ROUT_TM_VAL          = #ROUT_TM_VAL#
              , BEND_TM_VAL          = #BEND_TM_VAL#
              , N1ST_PCK_WGT         = #N1ST_PCK_WGT#
              , N2ND_PCK_WGT         = #N2ND_PCK_WGT#
              , PROD_HR              = #PROD_HR#
              , PROD_DY              = #PROD_DY#
              , PROD_REQ_CAPA_QTY    = #PROD_REQ_CAPA_QTY#
              , DELT_FLG             = #DELT_FLG#  
       WHERE 1 = 1
         AND PROD_EQ_NO = #PROD_EQ_NO#
         AND CHNL_CD = #CHNL_CD#
    </update>
    
    <delete id="M6641DeleteMaster" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_EQ
        WHERE 1 = 1
          AND PROD_EQ_NO = #PROD_EQ_NO#
          AND CHNL_CD = #CHNL_CD#
    </delete>


    
    

    <!-- 생산계획 - 조회-->
    <select id="M5210SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT   CHNL_CD
               , CONVERT(VARCHAR, PROD_PLN_DT, 23) AS PROD_PLN_DT 
               , MAX(PROD_PLN_NO)     AS PROD_PLN_NO  
               , MAX(dbo.FN_splitValue(PROD_PLN_NO, '-', 1))  AS GBN
          FROM TB_PROD_MON_PLN
           WHERE 1 = 1
             AND CHNL_CD      =  #CHNL_CD#
             AND CLZ_FLG      =  'N'    
             AND PROD_PLN_DT >= CAST (#FM_DT# + ' 00:00:00' AS DATETIME)
             AND PROD_PLN_DT <![CDATA[<=]]>  CAST (#TO_DT# + ' 23:59:59' AS DATETIME)
          GROUP BY CHNL_CD, CONVERT(VARCHAR, PROD_PLN_DT, 23)
     </select>

     
     <!--생산계획번호 자동생성-->
     <select id="M5210SelectNo" parameterClass="ModelsLibrary.Man.ManVo" resultClass="string">
       SELECT dbo.FF_NO_FMT(#CHNL_CD#, 'F_MPS', '001') AS PROD_PLN_NO  FROM CPY_T WHERE NO = 1
     </select>

     <update id="M5210UpdateNo" parameterClass="ModelsLibrary.Man.ManVo">
        UPDATE TB_SYS_NO_FMT
           SET LST_FMT_NO = #PROD_PLN_NO#
        WHERE 1 = 1
            AND TBL_ID = 'F_MPS'
            AND AREA_CD = '001'
            AND CHNL_CD = #CHNL_CD#
     </update>

    

     <!--생산계획 DTL - 조회-->
     <select id="M5210SelectDtl" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT    ROW_NUMBER() OVER (PARTITION BY T1.MCHN_NO ORDER BY T1.PROD_PLN_DT) AS RN
                , T4.EQ_NM           AS EQ_NM
                , T4.PROD_EQ_NO      AS EQ_NO
                , T2.ITM_CD          AS ITM_CD
                , T2.ITM_NM          AS ITM_NM
                , T2.ITM_SZ_NM       AS ITM_SZ_NM
                , T3.CO_NO           AS CO_CD
                , T3.CO_NM           AS CO_NM
                , T1.PROD_PLN_QTY    AS PROD_PLN_QTY
                , CONVERT(VARCHAR, T1.PROD_PLN_DT, 23) AS PROD_PLN_DT
                , T1.PROD_PLN_RMK    AS PROD_PLN_RMK
                , T1.PROD_PLN_NO
          FROM TB_PROD_MON_PLN T1
            OUTER APPLY
            (
                SELECT  
                    X.CO_NO       AS CO_NO
                  , X.CO_NM       AS CO_NM
                FROM  TB_CD_CO X
                  WHERE  1 = 1
                    AND  X.CHNL_CD  = T1.CHNL_CD
                    AND  X.CHNL_CD  = #CHNL_CD#
                    AND  X.CO_NO    = T1.CO_CD
            )T3
            OUTER APPLY
            (
                SELECT  
                      X.PROD_EQ_NO  AS PROD_EQ_NO
                    , X.EQ_NM         AS EQ_NM
                FROM   TB_PROD_EQ X
                  WHERE 1 = 1
                    AND  X.CHNL_CD    = T1.CHNL_CD
                    AND  X.CHNL_CD    = #CHNL_CD#
                    AND  T1.MCHN_NO   = X.PROD_EQ_NO
            )T4
            , TB_CD_ITM T2
            WHERE 1 = 1
              AND T1.CHNL_CD   =  #CHNL_CD#
              AND T1.CHNL_CD   =  T2.CHNL_CD
              AND T1.ITM_CD    =  T2.ITM_CD
              <!--AND PROD_PLN_NO  =  #PROD_PLN_NO#-->
              AND dbo.FN_splitValue(T1.PROD_PLN_NO, '-', 1) = #GBN#
     </select>


     <!--생산계획 - 추가-->
     <insert id="M5210InsertMst" parameterClass="ModelsLibrary.Man.ManVo">
        INSERT INTO TB_PROD_MON_PLN
        (
              CHNL_CD
            , PROD_PLN_NO
            , PROD_PLN_DT
            , ITM_CD
            , MCHN_NO
            , CO_CD
            , PROD_PLN_QTY
            , PROD_PLN_RMK
            , CLZ_FLG
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
        )
        VALUES
        (
              #CHNL_CD#
            , #PROD_PLN_NO#
            , #PROD_PLN_DT#
            , #ITM_CD#
            , #EQ_NO#
            , #CO_CD#
            , #PROD_PLN_QTY#
            , #PROD_PLN_RMK#
            , #CLZ_FLG#
            , #UPD_USR_ID#
            , GETDATE()
            , #UPD_USR_ID#
            , GETDATE()
        )
     </insert>
     
    
     <update id="M5210UpdateMst" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_MON_PLN
        SET 
            PROD_PLN_DT  = #PROD_PLN_DT#
          , ITM_CD       = #ITM_CD#
          , MCHN_NO      = #EQ_NO#
          , PROD_PLN_QTY = #PROD_PLN_QTY#
          , PROD_PLN_RMK = #PROD_PLN_RMK#
          , CO_CD        = #CO_CD#
          , UPD_USR_ID   = #UPD_USR_ID#
          , UPD_DT       = GETDATE()
          , CLZ_FLG      = #CLZ_FLG#
      WHERE 1=1
        AND CHNL_CD     = #CHNL_CD# 
        AND PROD_PLN_NO = #PROD_PLN_NO#
     </update>

    <delete id="M5210DeleteMst" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_MON_PLN
        WHERE 1 = 1
            AND CHNL_CD     = #CHNL_CD# 
            AND PROD_PLN_NO = #PROD_PLN_NO#
    </delete>
    
    
    
    
    
    
      <!-- 생산계획/작업지시 - MST -->
	 <select id="M6521SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
     SELECT 
         T1.SL_RLSE_NO
       , T2.SL_RLSE_SEQ  
       , CONVERT(VARCHAR, T1.SL_RLSE_DT , 23)  AS  SL_RLSE_DT
       , CONVERT(VARCHAR, T1.DUE_DT, 23) AS DUE_DT
       , T1.SL_CO_CD
       , dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T1.SL_CO_CD)  AS CO_NM
       , T2.SL_ITM_CD AS ITM_CD
       , T3.ITM_NM
       <!--, T3.ITM_SZ_NM-->
       , T2.N1ST_ITM_SZ_NM + '*' + T2.N2ND_ITM_SZ_NM + '*' + T2.N3RD_ITM_SZ_NM AS ITM_SZ_NM
       , T2.SL_ITM_QTY
       , T1.CHNL_CD
     FROM TB_SL_RLSE       T1
       , TB_SL_RLSE_DTL   T2
       , MV_TB_CD_ITM     T3
     WHERE 1 = 1
       AND T1.CHNL_CD     = #CHNL_CD#
       AND T1.CHNL_CD     = T2.CHNL_CD
       AND T1.CHNL_CD     = T3.CHNL_CD
       AND T1.SL_RLSE_NO  = T2.SL_RLSE_NO
       AND T2.SL_ITM_CD   = T3.ITM_CD
   </select>
    
    
      <!-- 생산계획/작업지시 DTL -->
	  <select id="M6521SelectDtl" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT ROW_NUMBER() OVER (PARTITION BY T2.SL_RLSE_DT ORDER BY T2.DUE_DT) AS RN
		      , T1.LOT_DIV_NO
		      , T1.LOT_DIV_SEQ
		      , CONVERT(VARCHAR, T1.PROD_PLN_DT , 23)  AS  PROD_PLN_DT
		      , CONVERT(VARCHAR, T1.PROD_PLN_DT , 23)  AS  MAKE_ST_DT
		      , T5.EQ_NM
              , T5.PROD_EQ_NO AS EQ_NO
		      , T1.MOLD_CD
		      , T1.MOLD_CD AS GBN
		      , CASE WHEN T1.DY_NGT_FLG = 'D' THEN '주간' ELSE '야간' END AS DY_NGT_NM
		      , T1.DY_NGT_FLG
		      , T1.LOT_DIV_QTY
		      , T1.LOT_DIV_RMK AS MM_RMK
			  , T2.SL_RLSE_NO
              , dbo.CD_ITEM_NM_FNC(T1.CHNL_CD, T1.ITM_CD) AS ITM_NM
              , T1.ITM_CD
              , T1.CHNL_CD
              , T1.ROUT_CD
              , dbo.FF_PROD_ROUT_NM_FNC(T1.CHNL_CD, T1.ROUT_CD) AS ROUT_NM
		      , T1.LOSS_VAL 
              , T1.PRT_VAL
			  , T3.N1ST_ITM_SZ_NM + '*' + T3.N2ND_ITM_SZ_NM + '*' + T3.N3RD_ITM_SZ_NM AS ITM_SZ_NM
		  FROM TB_PROD_LOT_DIV T1
		    OUTER APPLY
		    (
		        SELECT  
                X.PROD_EQ_NO    AS PROD_EQ_NO
		          , X.EQ_NM         AS EQ_NM
		        FROM  TB_PROD_EQ X
		          WHERE  1 = 1
		            AND  X.CHNL_CD     =  T1.CHNL_CD
		            AND  X.CHNL_CD     = #CHNL_CD#
		            AND  X.PROD_EQ_NO  =  T1.EQ_NO 
        ) T5
		    , TB_SL_RLSE      T2
		    , TB_SL_RLSE_DTL  T3
		    , MV_TB_CD_ITM    T4
		  WHERE 1 = 1
		    AND T1.CHNL_CD      =  #CHNL_CD#
		    AND T1.CHNL_CD      =  T3.CHNL_CD
		    AND T2.CHNL_CD      =  T3.CHNL_CD
		    AND T3.CHNL_CD      =  T4.CHNL_CD
        AND T1.ORD_NO	      =  T3.SL_RLSE_NO     
		    AND T2.SL_RLSE_NO   =  T3.SL_RLSE_NO
		    AND T3.SL_ITM_CD    =  T4.ITM_CD
        AND T2.SL_RLSE_NO   =  #SL_RLSE_NO#
        AND T3.SL_RLSE_SEQ  =  #SL_RLSE_SEQ#
	  </select>


    <!-- 생산계획/작업지시 DTL -->
   <insert id="M6521InsertDtl" parameterClass="ModelsLibrary.Man.ManVo">
	   INSERT INTO TB_PROD_LOT_DIV
	   (
	       CHNL_CD
	     , LOT_DIV_NO
	     , LOT_DIV_SEQ
	     , PROD_PLN_DT
	     , ITM_CD
	     , MOLD_CD
	     , LOT_DIV_QTY
	     , CRE_USR_ID
	     , CRE_DT
	     , UPD_USR_ID
	     , UPD_DT
	     , DY_NGT_FLG
	     , ORD_NO
	     , ORD_SEQ
	     , EQ_NO
	     , LOT_DIV_RMK
         , PROD_ORD_NO
         , ROUT_CD
         , ROUT_ITM_CD
         , LOSS_VAL   
         , PRT_VAL    
	   )
	   VALUES
	   (
	        #CHNL_CD#
	     ,  dbo.FF_PROD_WO_ANP_CRT(#CHNL_CD#, #SL_RLSE_NO# )
	     ,  (SELECT ISNULL(MAX(LOT_DIV_SEQ), 0) + 1 FROM TB_PROD_LOT_DIV WHERE CHNL_CD = #CHNL_CD# AND LOT_DIV_NO =  dbo.FF_PROD_WO_ANP_CRT(#CHNL_CD#, #SL_RLSE_NO# ))    
	     ,  #PROD_PLN_DT#
	     ,  #ITM_CD#
	     ,  #MOLD_CD#
	     ,  #LOT_DIV_QTY#
	     ,  #CRE_USR_ID#
	     ,  GETDATE()
	     ,  #UPD_USR_ID#
	     ,  GETDATE()
	     ,  #DY_NGT_FLG#
	     ,  #SL_RLSE_NO#
	     ,  #SL_RLSE_SEQ#
	     ,  #EQ_NO#
	     ,  #MM_RMK#
         ,  #SL_RLSE_NO#
         ,  #ROUT_CD#
         ,  (#ROUT_CD# + '-' + #ITM_CD#)
         ,  #LOSS_VAL#
         ,  #PRT_VAL#
	   )
   </insert>


    <update id="M6521UpdateDtl" parameterClass="ModelsLibrary.Man.ManVo">
      UPDATE TB_PROD_LOT_DIV
        SET PROD_PLN_DT  = #PROD_PLN_DT#
          , EQ_NO        = #EQ_NO#
          , MOLD_CD      = #MOLD_CD#
          , DY_NGT_FLG   = #DY_NGT_FLG#
          , LOT_DIV_QTY  = #LOT_DIV_QTY#
          , UPD_USR_ID   = #UPD_USR_ID#
          , UPD_DT       = GETDATE()
          , LOT_DIV_RMK  = #MM_RMK#
          , ROUT_CD      = #ROUT_CD#
          , LOSS_VAL     = #LOSS_VAL# 
          , PRT_VAL      = #PRT_VAL#
      WHERE 1 = 1
        AND CHNL_CD        = #CHNL_CD#
        AND LOT_DIV_NO     = #LOT_DIV_NO#
        AND LOT_DIV_SEQ    = #LOT_DIV_SEQ#
    </update>

    
    <delete id="M6521DeleteDtl" parameterClass="ModelsLibrary.Man.ManVo">
      DELETE FROM TB_PROD_LOT_DIV
          WHERE 1 = 1
            AND CHNL_CD        = #CHNL_CD#
            AND LOT_DIV_NO     = #LOT_DIV_NO#
            AND LOT_DIV_SEQ    = #LOT_DIV_SEQ#
    </delete>



       <!-- M6684 문서 관리  -->    
     <select id="M6684SelectMaster" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT  ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.ITM_CD) AS RN 
           , T1.ITM_CD
           , T1.ITM_NM
           , T1.ITM_SZ_NM
           , T1.ITM_GRP_CLSS_CD
           , dbo.CD_SYS_CLSS_FNC( T1.CHNL_CD, 'DH02', T1.MTRL_NM_CD) AS GBN
           , T1.N1ST_ITM_GRP_CD
           , T1.CHNL_CD
           , (SELECT TOP 1 X.CAR_TP_NM FROM TB_CD_CAR_TP AS X  WHERE 1=1 AND X.CAR_TP_CD = T1.N1ST_ITM_GRP_CD AND X.CHNL_CD = T1.CHNL_CD) AS N1ST_ITM_GRP_NM
           <!--, (SELECT TOP 1 MAX(X.DWG_NM) FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N') AS DWG_NM
           , (SELECT TOP 1 MAX(X.DWG_FILE_NM)_NM FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N') AS DWG_FILE_NM
           , (SELECT TOP 1 MAX(X.DWG_RMK) FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N') AS DWG_RMK-->
           , (SELECT TOP 1 X.DWG_NM FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N'  ORDER BY X.UPD_DT DESC) AS DWG_NM
           , (SELECT TOP 1 X.DWG_FILE_NM FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N'  ORDER BY X.UPD_DT DESC) AS DWG_FILE_NM
           , (SELECT TOP 1 X.DWG_RMK FROM TB_CD_ITM_DWG_RVIS AS X  WHERE 1=1 AND X.ITM_CD = T1.ITM_CD AND X.CHNL_CD = T1.CHNL_CD AND X.DELT_FLG = 'N' ORDER BY X.UPD_DT DESC) AS DWG_RMK
       FROM TB_CD_ITM   T1
          WHERE 1 = 1
            AND T1.CHNL_CD          = #CHNL_CD#
            AND T1.ITM_GRP_CLSS_CD  = #ITM_GRP_CLSS_CD#
            AND T1.DELT_FLG         = 'N'
     </select>


     <!-- 문서 관리  조회 -->
     <select id="M6684SelectDoc" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT ROW_NUMBER() OVER (PARTITION BY ITM_CD ORDER BY ITM_DWG_SEQ DESC) AS RN
             , CONVERT(VARCHAR, CRE_DT, 20) AS CRE_DT
             , CRE_USR_ID
             , DWG_NM
             , DWG_FILE
             , DWG_FILE_NM
             , DWG_RMK
             , ITM_CD
             , ITM_DWG_SEQ
             , CHNL_CD
         FROM TB_CD_ITM_DWG_RVIS
        WHERE 1 = 1
          AND DELT_FLG = 'N'
          AND ITM_CD   = #ITM_CD#
          AND CHNL_CD  = #CHNL_CD#
     </select>





     <!-- M6684 문서 관리 추가 -->
     <insert id="M6684InsertDoc" parameterClass="ModelsLibrary.Man.ManVo">
        INSERT INTO TB_CD_ITM_DWG_RVIS
        (
            ITM_CD
          , ITM_DWG_SEQ
          , DWG_NM
          , DWG_FILE
          , DWG_FILE_NM
          , DWG_RMK
          , DELT_FLG
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT
          , CHNL_CD
        )
        VALUES
        (
            #ITM_CD#
          , (SELECT ISNULL(MAX(ITM_DWG_SEQ), 0) + 1 FROM TB_CD_ITM_DWG_RVIS WHERE ITM_CD = #ITM_CD# AND CHNL_CD = #CHNL_CD#)
          , #DWG_NM#
          , #DWG_FILE#
          , #DWG_FILE_NM#
          , #DWG_RMK#
          , #DELT_FLG#
          , #CRE_USR_ID#
          , GETDATE()
          , #UPD_USR_ID#
          , GETDATE()
          , #CHNL_CD#
        )
     </insert>




     <!-- M6684 문서 이력 수정 -->
     <update id="M6684UpdateDoc" parameterClass="ModelsLibrary.Man.ManVo">
        UPDATE TB_CD_ITM_DWG_RVIS
          SET   DWG_NM       = #DWG_NM#
            , DWG_FILE     = #DWG_FILE#
            , DWG_RMK      = #DWG_RMK#
            , DWG_FILE_NM  = #DWG_FILE_NM#
            , DELT_FLG     = #DELT_FLG#
            , UPD_USR_ID   = #UPD_USR_ID#
            , UPD_DT       = GETDATE()
          WHERE 1 = 1
            AND ITM_CD      = #ITM_CD#
            AND ITM_DWG_SEQ = #ITM_DWG_SEQ#
            AND CHNL_CD     = #CHNL_CD#
     </update>







    <!-- M7711 - PC 생산 계획 관리 MST  -->
    <select id="M7711SelectMst" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
     SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.OPMZ_NO) AS RN
	      ,	T1.OPMZ_NO
	      ,	T1.CHNL_CD
	      ,	CONVERT(VARCHAR, T1.OPMZ_DT, 23) AS OPMZ_DT
	      ,	T1.OPMZ_RMK
        , dbo.USR_NM_FNC(T1.CHNL_CD, T1.CRE_USR_ID) AS CRE_USR_NM
      FROM TB_OPMZ_MST   T1
        WHERE 1 = 1
          AND T1.CHNL_CD = #CHNL_CD#
          AND T1.OPMZ_DT = CAST (#FM_DT# + ' 00:00:00' AS DATETIME)
    </select>
    
  <!-- M7711 - PC 생산 계획 관리 DTL -->
	  <select id="M7711SelectDtl" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
		  SELECT ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY OPMZ_NO) AS RN
          , OPMZ_NO
          , CONVERT(INT, STEP_NO) AS STEP_NO
          , CONVERT(INT, STEP_SEQ) AS STEP_SEQ
          , CHNL_CD
          , CONVERT(FLOAT, STL_N1ST_LENG) AS STL_N1ST_LENG
          , CONVERT(FLOAT, STL_N2ND_LENG) AS STL_N2ND_LENG
          , RLSE_N1ST_CMD_NO
          , RLSE_N2ND_CMD_NO
          , ITM_N1ST_SHP_CD
          , ITM_N2ND_SHP_CD
          , CONVERT(INT, STL_N1ST_PROC_TM) AS STL_N1ST_PROC_TM
          , CONVERT(INT, STL_N2ND_PROC_TM) AS STL_N2ND_PROC_TM
          , PROC_N1ST_SET
          , PROC_N2ND_SET
          , PROC_N3RD_SET
          , PROC_N4ND_SET
          , CONVERT(INT, IN_STL_LENG) AS IN_STL_LENG
          , CONVERT(INT, IN_STL_QTY) AS IN_STL_QTY
          , STEP_LSS_RTO
          , CONVERT(FLOAT, STEP_TTL_STK) AS STEP_TTL_STK
          , CONVERT(FLOAT, STEP_LSS_TTL) AS STEP_LSS_TTL
          , CONVERT(INT, WT_LIST) AS WT_LIST
          , BP_WT_LIST
          , SL_RLSE_NO
          , SL_RLSE_SEQ
      FROM TB_OPMZ_DTL
        WHERE 1=1 
	        AND CHNL_CD = #CHNL_CD#
	        AND OPMZ_NO = #OPMZ_NO#
	  </select>



    <!-- M6638 - LOC 관리 -->
    <select id="M6638SelectMst" parameterClass="ModelsLibrary.Man.ManVo" resultClass="ModelsLibrary.Man.ManVo">
        SELECT 
            T1.CNTR_NM
          , T1.RLSE_CMD_NO
          , T1.SL_ITM_WGT
          , CONVERT(VARCHAR, T1.IN_REQ_DT, 23) AS  IN_REQ_DT
          , T1.CNTR_PSN_NM
          , T2.SL_CO_CD AS CO_CD
          <!--, dbo.CD_COMPANY_NM_FNC(T1.CHNL_CD, T2.SL_CO_CD) AS CO_NM-->
        FROM TB_SL_RLSE_DTL T1, TB_SL_RLSE T2
	        WHERE 1=1
		        AND T1.CHNL_CD        = #CHNL_CD#
		        AND T1.CHNL_CD        = T2.CHNL_CD
		        AND T1.SL_RLSE_NO     = T2.SL_RLSE_NO
            AND T1.IN_REQ_DT >= CAST (#FM_DT# + ' 00:00:00' AS DATETIME)
            AND T1.IN_REQ_DT <![CDATA[<=]]>  CAST (#TO_DT# + ' 23:59:59' AS DATETIME)
		        AND T1.RLSE_CMD_NO IS NOT NULL
		        AND T1.CNTR_NM IS NOT NULL
		        AND T1.IN_REQ_DT IS NOT NULL         
	  </select>
	  

	  <!--수동수주출력-생산활용 - MST-->
	  <select id="M66333SelectMst" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT 
		        T1.SL_RLSE_NO
		      , CONVERT(CHAR(10), T1.SL_RLSE_DT, 23) AS SL_RLSE_DT
		      , T2.CO_NM
		      , T1.SL_RMK
		      , T1.CHNL_CD
		  FROM TB_SL_RLSE  T1
		      OUTER APPLY (
		             SELECT X.CO_NM
		               FROM TB_CD_CO X
		              WHERE 1 = 1
		                AND X.CHNL_CD = T1.CHNL_CD
		                AND X.CO_NO   = T1.SL_CO_CD
		       ) T2
		  WHERE 1 = 1
		    AND T1.CHNL_CD      = #CHNL_CD#
		    AND T1.SL_RLSE_DT   >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)
		    AND T1.SL_RLSE_DT   <![CDATA[<=]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
	  </select>


	  <!--수동수주출력-생산활용 - DTL-->
	  <select id="M66333SelectDtl" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT
		        T2.CHNL_CD
		      , T2.SL_RLSE_NO
		      , T2.SL_RLSE_SEQ
		      , T2.SL_ITM_QTY
		      , T2.SL_ITM_WGT
		      , T2.ITM_SHP_CD
		      , T3.ITM_IMG
		      , T2.ITM_STL_CD
		      , T2.ITM_STL_SZ_CD
		      , T2.ITM_STL_LENG
		      , T2.ITM_STL_PRD_DESC
		      , T2.CNTR_NM
		      , T2.CNTR_PSN_NM
		      , T2.CNTR_DE_NM
		      , CONVERT(CHAR(10), T2.IN_REQ_DT, 23) AS IN_REQ_DT
		      , T4.A_LEN
		      , T4.A_VAL
		      , T4.B_LEN
		      , T4.B_VAL
		      , T4.C_LEN
		      , T4.C_VAL
		      , T4.D_LEN
		      , T4.D_VAL
		      , T4.E_LEN
		      , T4.E_VAL
		      , T4.F_LEN
		      , T4.F_VAL
		    FROM TB_SL_RLSE       T1
		      , TB_SL_RLSE_DTL    T2
		      OUTER APPLY (
		        SELECT X.A_LEN, X.B_LEN, X.C_LEN, X.D_LEN, X.E_LEN, X.F_LEN, X.A_VAL, X.B_VAL, X.C_VAL, X.D_VAL, X.E_VAL, X.F_VAL
		          FROM TB_MES_PROD_DESC  X
		         WHERE 1 = 1
		           AND X.SL_RLSE_NO   = T2.SL_RLSE_NO
		           AND X.SL_RLSE_SEQ  = T2.SL_RLSE_SEQ
		      ) T4
		      OUTER APPLY (
		        SELECT X.ITM_NM   AS ITM_SHP_NM
		          , X.ITM_CD AS SHP_CD
		          , Z.ITM_IMG
		          FROM TB_CD_ITM  X
		              OUTER APPLY (
		                SELECT Z.IMG  AS ITM_IMG
		                  FROM TB_CD_ITM_IMG Z
		                 WHERE 1 = 1
		                   AND X.CHNL_CD = Z.CHNL_CD
		                   AND X.ITM_CD  = Z.ITM_CD
		              ) Z
		      WHERE 1 = 1
		        AND X.CHNL_CD           = #CHNL_CD#
		        AND X.ITM_GRP_CLSS_CD   = 'P'
		        AND X.DELT_FLG          = 'N'
		        AND X.ITM_CD           = T2.ITM_SHP_CD
		      ) T3
		   WHERE 1 = 1
		     AND T1.CHNL_CD      = T2.CHNL_CD
		     AND T1.CHNL_CD      = #CHNL_CD#
		     AND T1.SL_RLSE_NO   = T2.SL_RLSE_NO
		     AND T1.SL_RLSE_NO   = #SL_RLSE_NO#
	  </select>


	  <isNotNull property="EXTR_STS_CD" >
		  AND T2.EXTR_STS_CD = #EXTR_STS_CD#
	  </isNotNull>

	  <update id="M66333UpdateDtl" parameterClass="ModelsLibrary.Man.ManVo">
		  UPDATE TB_SL_RLSE_DTL
		     SET UPD_USR_ID    = #UPD_USR_ID#
		          , UPD_DT        = GETDATE()
		          <isNotNull property="ITM_SHP_CD" >
			          , ITM_SHP_CD    = #ITM_SHP_CD#
		          </isNotNull>
		          <isNotNull property="ITM_STL_CD" >
			          , ITM_STL_CD     = #ITM_STL_CD#
		          </isNotNull>
		          <isNotNull property="ITM_STL_SZ_CD" >
			          , ITM_STL_SZ_CD  = #ITM_STL_SZ_CD#
		          </isNotNull>
		   FROM TB_SL_RLSE_DTL
		  WHERE 1 = 1
		    AND CHNL_CD      = #CHNL_CD#
		    AND SL_RLSE_NO   = #SL_RLSE_NO#
		    AND SL_RLSE_SEQ  = #SL_RLSE_SEQ#
	  </update>


	  <select id="M6521SelectRoutCd" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT TOP 1 ROUT_CD
            FROM TB_PROD_ROUT_ITM_MAP
           WHERE 1 = 1 
             AND CHNL_CD = #CHNL_CD#
             AND ITM_CD  = #ITM_CD#
             AND ROUT_SEQ = '1' 
	  </select>

	  <select id="M6521SelectMoldNo" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		  SELECT MOLD_NO
               , CUT_SZ_NM
               , MOLD_CAPA_QTY 
            FROM TB_PROD_MOLD_CD 
           WHERE 1 = 1 
             AND CHNL_CD = #CHNL_CD#
	  </select>

	  <select id="M6521SelectPurItmSz" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
		SELECT T2.ITM_CD
             , T4.ITM_NM 
             , T3.INAUD_QTY 
             , T2.N1ST_ITM_SZ_NM + '*'+ T2.N2ND_ITM_SZ_NM AS PUR_ITM_SZ_NM
             , T3.IN_ITM_SZ_NM 
          FROM TB_SL_RLSE_DTL T1
              ,TB_PUR_ORD_DTL T2
         OUTER APPLY (
                      SELECT X.ITM_CD
                           , X.INAUD_QTY
                           , X.N1ST_ITM_SZ_NM + '*' + X.N2ND_ITM_SZ_NM AS IN_ITM_SZ_NM
                        FROM TB_INAUD_DTL X
                       WHERE 1 = 1 
                         AND X.CHNL_CD = #CHNL_CD#
                         AND X.SL_ORD_NO = T2.PUR_ORD_NO
                         AND X.SL_ORD_SEQ = T2.PUR_ORD_SEQ
                         AND X.INAUD_CD = 'RGU' 
                      )T3
         OUTER APPLY (
                      SELECT X.ITM_NM
                        FROM TB_CD_ITM X
                       WHERE 1 = 1 
                         AND X.CHNL_CD = #CHNL_CD#
                         AND X.ITM_CD  = T2.ITM_CD
                      )T4
         WHERE 1 = 1 
           AND T1.CHNL_CD = #CHNL_CD#
           AND T1.CHNL_CD = T2.CHNL_CD
           AND T1.SL_RLSE_NO = T2.ORD_NO  
           AND T1.SL_RLSE_NO = #SL_RLSE_NO#
	  </select>
	  
	  
	  <select id="M66103SelectMstList" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
	   	SELECT 
		       ROW_NUMBER() OVER (PARTITION BY NULL ORDER BY T1.PUR_NO, T2.PUR_SEQ) AS RN
             , T1.PUR_NO               
             , T2.PUR_SEQ         
             , CONVERT(CHAR(10), T1.PUR_DT, 23) AS PUR_DT
             , CONVERT(CHAR(10), T1.DUE_DT, 23) AS DUE_DT       
             , T1.PUR_CO_CD               
             , dbo.CD_COMPANY_NM_FNC(#CHNL_CD#, T1.PUR_CO_CD) AS PUR_CO_NM
             , T2.FLR_FILE_ID           
             , T2.FLR_NO                     
             , T2.FLR_FILE_ID+ '_' + T2.FLR_NM  AS FLR_FILE     
             , T2.FLR_NM              
             , T2.PUR_WGT              
             , T2.DE_CO_NM              
             , T2.CNTR_NM              
             , T2.AREA_NM        
             , T2.EXTR_STS_CD
             , T3.EXTR_STS_NM
             , 'N' AS CHK_FLG
			 , T1.CHNL_CD
          FROM TB_CUST_PUR        T1
             , TB_CUST_PUR_DTL    T2
               OUTER APPLY (
                   SELECT CLSS_DESC AS EXTR_STS_NM
                     FROM TB_SYS_CLSS_CD 
                    WHERE 1 = 1
                      AND CHNL_CD    = #CHNL_CD#
                      AND CLSS_TP_CD = 'L-912'
                      AND CLSS_CD    = T2.EXTR_STS_CD
               ) T3
         WHERE 1 = 1
           AND T1.CHNL_CD   = T2.CHNL_CD
           AND T1.PUR_NO    = T2.PUR_NO
           AND T1.CHNL_CD   = #CHNL_CD#
         <isNotNull property="EXTR_STS_CD" >
           AND T2.EXTR_STS_CD = #EXTR_STS_CD#
         </isNotNull>
           AND T1.PUR_DT >= CAST (#FM_DT# + ' 00:00:00' AS DATETIME)   
           AND T1.PUR_DT <![CDATA[<=]]> CAST (#TO_DT# + ' 23:59:59' AS DATETIME)    
	  </select>
	  
	   <select id="M66103SelectDtlList" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
	      SELECT 
               T1.PUR_NO
             , T1.PUR_SEQ
             , T1.LOG_SEQ
             , T1.STS_CD
             , T2.EXTR_STS_NM
             , T1.STS_DESC 
          FROM TB_BAR_EXTR_LOG T1
               OUTER APPLY (
                   SELECT CLSS_DESC AS EXTR_STS_NM
                     FROM TB_SYS_CLSS_CD 
                    WHERE 1 = 1
                      AND CHNL_CD    = #CHNL_CD#
                      AND CLSS_TP_CD = 'L-912'
                      AND CLSS_CD    = T1.STS_CD
               ) T2
         WHERE 1 = 1
           AND T1.PUR_NO   = #PUR_NO#
           AND T1.PUR_SEQ  = #PUR_SEQ#
	  </select>

	  <select id="M66103SelectBarlistCount" parameterClass="ModelsLibrary.Man.ManVo" resultClass="int">
		  SELECT COUNT(*)
		    FROM TB_BAR_EXTR_LOG
		   WHERE 1 = 1
		     AND PUR_NO = #PUR_NO#
		     AND PUR_SEQ = #PUR_SEQ#
	  </select>
	  
	  <update id="M66103UpdateBarlist" parameterClass="ModelsLibrary.Man.ManVo">
		 UPDATE TB_CUST_PUR_DTL 
            SET EXTR_STS_CD = 'S'
          WHERE 1 = 1
            AND PUR_NO = #PUR_NO#
            AND PUR_SEQ = #PUR_SEQ#
	  </update>
	  
	  <delete id="M66103DeleteBarlist1" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_BAR_LIST 
		   WHERE 1 = 1 
		     AND PUR_NO = #PUR_NO# 
			 AND PUR_SEQ = #PUR_SEQ#
	  </delete>
	  <delete id="M66103DeleteBarlist2" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_BAR_EXTR_LOG 
		   WHERE 1 = 1 
		     AND PUR_NO = #PUR_NO#  
			 AND PUR_SEQ = #PUR_SEQ#
	  </delete>
	  <delete id="M66103DeleteBarlist3" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_SL_RLSE_DTL 
		   WHERE 1 = 1 
		     AND CUST_PUR_NO = #PUR_NO#  
			 AND CUST_PUR_SEQ = #PUR_SEQ#
	  </delete>
	  <delete id="M66103DeleteBarlist4" parameterClass="ModelsLibrary.Man.ManVo">
		  DELETE FROM TB_RBK_CD_ITM 
		   WHERE 1 = 1 
		     AND PUR_NO = #PUR_NO#  
			 AND PUR_SEQ = #PUR_SEQ#
	  </delete>
	  
	  
	  
	  
	  
	  
	  
	  
	  <!-- BarList 추출검증 -->
     <select id="M66105SelectMst" resultClass="ModelsLibrary.Man.ManVo" parameterClass="ModelsLibrary.Man.ManVo">
        SELECT   
		       T1.PUR_NO                 
             , T2.PUR_SEQ              
             , T1.PUR_CO_CD                     
             , T2.DE_CO_NM               
             , T2.CNTR_NM                  
             , T2.FLR_FILE_ID+ '_' + T2.FLR_NM  AS FLR_FILE     
             , T2.FLR_NM                
             , T2.PUR_WGT                
             , T3.PRG_TP_CD     
             , T3.BAR_SHAP_NO     
             , T3.BAR_SHAP_PROD_DESC
             , T3.BAR_STEL_CD     
             , T3.BAR_STEL_SZ
             , T3.BAR_LEN     
             , T3.BAR_QTY
             , T3.BAR_WGT     
             , T3.BAR_PSN_NM
             , T3.BAR_TOT_LEN
             , CASE WHEN T4.SHP_NO IS NULL THEN 'Y' ELSE 'N' END AS VIS_FLG
             , T4.ITM_SHP_NM
          FROM TB_CUST_PUR        T1
             , TB_CUST_PUR_DTL    T2
             , TB_BAR_LIST        T3
               OUTER APPLY (
                    SELECT X.ITM_NM   AS ITM_SHP_NM   
                         , X.ITM_CD  AS SHP_NO
                      FROM TB_CD_ITM  X
                     WHERE 1 = 1
                       AND X.CHNL_CD           = #CHNL_CD#
                       AND X.ITM_GRP_CLSS_CD   = 'P'  
                       AND X.DELT_FLG          = 'N'   
                       AND X.ITM_CD            = T3.BAR_SHAP_NO
                ) T4
             WHERE 1 = 1
               AND T1.CHNL_CD   = T2.CHNL_CD
               AND T1.PUR_NO    = T2.PUR_NO
               AND T2.PUR_NO    = T3.PUR_NO 
               AND T2.PUR_SEQ   = T3.PUR_SEQ
               AND T1.CHNL_CD   = #CHNL_CD#
               AND T1.PUR_DT >= CAST(#FM_DT# + ' 00:00:00' AS DATETIME)   
               AND T1.PUR_DT <![CDATA[ <= ]]> CAST(#TO_DT# + ' 23:59:59' AS DATETIME)
     </select>

  </statements>
</sqlMap>
